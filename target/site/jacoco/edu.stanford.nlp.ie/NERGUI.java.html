<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NERGUI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Stanford CoreNLP</a> &gt; <a href="index.source.html" class="el_package">edu.stanford.nlp.ie</a> &gt; <span class="el_source">NERGUI.java</span></div><h1>NERGUI.java</h1><pre class="source lang-java linenums">package edu.stanford.nlp.ie; 
import edu.stanford.nlp.util.logging.Redwood;

import edu.stanford.nlp.ie.crf.CRFClassifier;
import edu.stanford.nlp.ie.ner.CMMClassifier;
import edu.stanford.nlp.io.IOUtils;
import edu.stanford.nlp.util.Generics;
import edu.stanford.nlp.util.StringUtils;

import javax.swing.*;
import javax.swing.text.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.io.File;
import java.util.Map;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * @author Jenny Finkel
 */

<span class="nc" id="L27">public class NERGUI  {</span>

  /** A logger for this class */
<span class="nc" id="L30">  private static Redwood.RedwoodChannels log = Redwood.channels(NERGUI.class);</span>

  private AbstractSequenceClassifier&lt;?&gt; classifier;

  private JFrame frame;
  private JEditorPane editorPane;
  private JToolBar tagPanel;
  private static final int HEIGHT = 600;
  private static final int WIDTH = 650;
  private Map&lt;String, Color&gt; tagToColorMap;
<span class="nc" id="L40">  private JFileChooser fileChooser = new JFileChooser(System.getProperty(&quot;user.dir&quot;));</span>
<span class="nc" id="L41">  private MutableAttributeSet defaultAttrSet = new SimpleAttributeSet();</span>
<span class="nc" id="L42">  private ActionListener actor = new ActionPerformer();</span>
  private File loadedFile;
<span class="nc" id="L44">  private String untaggedContents = null;</span>
<span class="nc" id="L45">  private String taggedContents = null;</span>
<span class="nc" id="L46">  private String htmlContents = null;</span>

<span class="nc" id="L48">  private JMenuItem saveUntagged = null;</span>
<span class="nc" id="L49">  private JMenuItem saveTaggedAs = null;</span>

  private void createAndShowGUI() {
    //Make sure we have nice window decorations.
<span class="nc" id="L53">    JFrame.setDefaultLookAndFeelDecorated(true);</span>

    //Create and set up the window.
<span class="nc" id="L56">    frame = new JFrame(&quot;Stanford Named Entity Recognizer&quot;);</span>
<span class="nc" id="L57">    frame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);</span>
<span class="nc" id="L58">    frame.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L59">    frame.getContentPane().setSize(WIDTH, HEIGHT);</span>

<span class="nc" id="L61">    frame.setJMenuBar(addMenuBar());</span>

    //frame.setSize(new Dimension(WIDTH, HEIGHT));
<span class="nc" id="L64">    frame.setSize(WIDTH, HEIGHT);</span>

<span class="nc" id="L66">    buildTagPanel();</span>
<span class="nc" id="L67">    buildContentPanel();</span>


    //Display the window.
<span class="nc" id="L71">    frame.pack();</span>
<span class="nc" id="L72">    frame.setSize(WIDTH, HEIGHT);</span>
<span class="nc" id="L73">    frame.setVisible(true);</span>
<span class="nc" id="L74">  }</span>

  private JMenuBar addMenuBar() {
<span class="nc" id="L77">    JMenuBar menubar = new JMenuBar();</span>

<span class="nc" id="L79">    JMenu fileMenu = new JMenu(&quot;File&quot;);</span>
<span class="nc" id="L80">    menubar.add(fileMenu);</span>

<span class="nc" id="L82">    JMenu editMenu = new JMenu(&quot;Edit&quot;);</span>
<span class="nc" id="L83">    menubar.add(editMenu);</span>

<span class="nc" id="L85">    JMenu classifierMenu = new JMenu(&quot;Classifier&quot;);</span>
<span class="nc" id="L86">    menubar.add(classifierMenu);</span>

<span class="nc" id="L88">    final int menuMask = Toolkit.getDefaultToolkit().getMenuShortcutKeyMask();</span>

    /*
     * FILE MENU
     */

<span class="nc" id="L94">    JMenuItem openFile = new JMenuItem(&quot;Open File&quot;);</span>
<span class="nc" id="L95">    openFile.setMnemonic('O');</span>
<span class="nc" id="L96">    openFile.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_F, menuMask));</span>
<span class="nc" id="L97">    openFile.addActionListener(actor);</span>
<span class="nc" id="L98">    fileMenu.add(openFile);</span>

<span class="nc" id="L100">    JMenuItem loadURL = new JMenuItem(&quot;Load URL&quot;);</span>
<span class="nc" id="L101">    loadURL.setMnemonic('L');</span>
<span class="nc" id="L102">    loadURL.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_U, menuMask));</span>
<span class="nc" id="L103">    loadURL.addActionListener(actor);</span>
<span class="nc" id="L104">    fileMenu.add(loadURL);</span>

<span class="nc" id="L106">    fileMenu.add(new JSeparator());</span>

<span class="nc" id="L108">    saveUntagged = new JMenuItem(&quot;Save Untagged File&quot;);</span>
<span class="nc" id="L109">    saveUntagged.setMnemonic('S');</span>
<span class="nc" id="L110">    saveUntagged.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_S, menuMask));</span>
<span class="nc" id="L111">    saveUntagged.addActionListener(actor);</span>
<span class="nc" id="L112">    saveUntagged.setEnabled(false);</span>
<span class="nc" id="L113">    fileMenu.add(saveUntagged);</span>

<span class="nc" id="L115">    JMenuItem saveUntaggedAs = new JMenuItem(&quot;Save Untagged File As ...&quot;);</span>
<span class="nc" id="L116">    saveUntaggedAs.setMnemonic('U');</span>
<span class="nc" id="L117">    saveUntaggedAs.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_U, menuMask));</span>
<span class="nc" id="L118">    saveUntaggedAs.addActionListener(actor);</span>
<span class="nc" id="L119">    fileMenu.add(saveUntaggedAs);</span>

<span class="nc" id="L121">    saveTaggedAs = new JMenuItem(&quot;Save Tagged File As ...&quot;);</span>
<span class="nc" id="L122">    saveTaggedAs.setMnemonic('T');</span>
<span class="nc" id="L123">    saveTaggedAs.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_T, menuMask));</span>
<span class="nc" id="L124">    saveTaggedAs.addActionListener(actor);</span>
<span class="nc" id="L125">    saveTaggedAs.setEnabled(false);</span>
<span class="nc" id="L126">    fileMenu.add(saveTaggedAs);</span>

<span class="nc" id="L128">    fileMenu.add(new JSeparator());</span>

<span class="nc" id="L130">    JMenuItem exit = new JMenuItem(&quot;Exit&quot;);</span>
<span class="nc" id="L131">    exit.setMnemonic('x');</span>
<span class="nc" id="L132">    exit.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_Q, menuMask));</span>
<span class="nc" id="L133">    exit.addActionListener(actor);</span>
<span class="nc" id="L134">    fileMenu.add(exit);</span>


    /*
     * EDIT MENU
     */

<span class="nc" id="L141">    JMenuItem clear = new JMenuItem(&quot;Clear&quot;);</span>
<span class="nc" id="L142">    clear.setMnemonic('C');</span>
<span class="nc" id="L143">    clear.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_L, menuMask));</span>
<span class="nc" id="L144">    clear.addActionListener(actor);</span>
<span class="nc" id="L145">    editMenu.add(clear);</span>


    /*
     * CLASSIFIER MENU
     */

<span class="nc" id="L152">    JMenuItem loadCRF = new JMenuItem(&quot;Load CRF From File&quot;);</span>
<span class="nc" id="L153">    loadCRF.setMnemonic('R');</span>
<span class="nc" id="L154">    loadCRF.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_R, menuMask));</span>
<span class="nc" id="L155">    loadCRF.addActionListener(actor);</span>
<span class="nc" id="L156">    classifierMenu.add(loadCRF);</span>

<span class="nc" id="L158">    JMenuItem loadDefaultCRF = new JMenuItem(&quot;Load Default CRF&quot;);</span>
<span class="nc" id="L159">    loadDefaultCRF.setMnemonic('L');</span>
<span class="nc" id="L160">    loadDefaultCRF.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_L, menuMask));</span>
<span class="nc" id="L161">    loadDefaultCRF.addActionListener(actor);</span>
<span class="nc" id="L162">    classifierMenu.add(loadDefaultCRF);</span>

<span class="nc" id="L164">    JMenuItem loadCMM = new JMenuItem(&quot;Load CMM From File&quot;);</span>
<span class="nc" id="L165">    loadCMM.setMnemonic('M');</span>
<span class="nc" id="L166">    loadCMM.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_M, menuMask));</span>
<span class="nc" id="L167">    loadCMM.addActionListener(actor);</span>
<span class="nc" id="L168">    classifierMenu.add(loadCMM);</span>

<span class="nc" id="L170">    JMenuItem loadDefaultCMM = new JMenuItem(&quot;Load Default CMM&quot;);</span>
<span class="nc" id="L171">    loadDefaultCMM.setMnemonic('D');</span>
<span class="nc" id="L172">    loadDefaultCMM.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_D, menuMask));</span>
<span class="nc" id="L173">    loadDefaultCMM.addActionListener(actor);</span>
<span class="nc" id="L174">    classifierMenu.add(loadDefaultCMM);</span>

<span class="nc" id="L176">    return menubar;</span>

  }


<span class="nc" id="L181">  private class InputListener implements KeyListener {</span>

    public void keyPressed(KeyEvent e) {

<span class="nc" id="L185">    }</span>

    public void keyReleased(KeyEvent e) {

<span class="nc" id="L189">    }</span>

    public void keyTyped(KeyEvent e) {
<span class="nc" id="L192">      saveTaggedAs.setEnabled(false);</span>
<span class="nc" id="L193">    }</span>

  }


<span class="nc" id="L198">  private class ActionPerformer implements ActionListener {</span>

    public void actionPerformed(ActionEvent e) {
<span class="nc" id="L201">      String com = e.getActionCommand();</span>

<span class="nc bnc" id="L203" title="All 50 branches missed.">      switch (com) {</span>
        case &quot;Open File&quot;: {
<span class="nc" id="L205">          File file = getFile(true);</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">          if (file != null) {</span>
<span class="nc" id="L207">            openFile(file);</span>
          }
          break;
        }
        case &quot;Load URL&quot;:
<span class="nc" id="L212">          String url = getURL();</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">          if (url != null) {</span>
<span class="nc" id="L214">            openURL(url);</span>
          }
          break;
        case &quot;Exit&quot;:
<span class="nc" id="L218">          exit();</span>
<span class="nc" id="L219">          break;</span>
        case &quot;Clear&quot;:
<span class="nc" id="L221">          clearDocument();</span>
<span class="nc" id="L222">          break;</span>
        case &quot;Load CRF From File&quot;: {
<span class="nc" id="L224">          File file = getFile(true);</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">          if (file != null) {</span>
<span class="nc" id="L226">            loadClassifier(file, true);</span>
          }
          break;
        }
        case &quot;Load CMM From File&quot;: {
<span class="nc" id="L231">          File file = getFile(true);</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">          if (file != null) {</span>
<span class="nc" id="L233">            loadClassifier(file, false);</span>
          }
          break;
        }
        case &quot;Load Default CRF&quot;:
<span class="nc" id="L238">          loadDefaultClassifier(true);</span>
<span class="nc" id="L239">          break;</span>
        case &quot;Load Default CMM&quot;:
<span class="nc" id="L241">          loadDefaultClassifier(false);</span>
<span class="nc" id="L242">          break;</span>
        case &quot;Extract&quot;:
<span class="nc" id="L244">          extract();</span>
<span class="nc" id="L245">          break;</span>
        case &quot;Save Untagged File&quot;:
<span class="nc" id="L247">          saveUntaggedContents(loadedFile);</span>
<span class="nc" id="L248">          break;</span>
        case &quot;Save Untagged File As ...&quot;:
<span class="nc" id="L250">          saveUntaggedContents(getFile(false));</span>
<span class="nc" id="L251">          break;</span>
        case &quot;Save Tagged File As ...&quot;:
<span class="nc" id="L253">          saveFile(getFile(false), taggedContents);</span>
<span class="nc" id="L254">          break;</span>
        default:
<span class="nc" id="L256">          log.info(&quot;Unknown Action: &quot; + e);</span>
          break;
      }
<span class="nc" id="L259">    }</span>
  }

  public File getFile(boolean open) {
<span class="nc" id="L263">    File file = null;</span>
    int returnVal;
<span class="nc bnc" id="L265" title="All 2 branches missed.">    if (open) {</span>
<span class="nc" id="L266">      returnVal = fileChooser.showOpenDialog(frame);</span>
    } else {
<span class="nc" id="L268">      returnVal = fileChooser.showSaveDialog(frame);</span>
    }
<span class="nc bnc" id="L270" title="All 2 branches missed.">    if(returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L271">      file = fileChooser.getSelectedFile();</span>
<span class="nc bnc" id="L272" title="All 4 branches missed.">      if (open &amp;&amp; !checkFile(file)) { file = null; }</span>
    }
<span class="nc" id="L274">    return file;</span>
  }

  public void saveUntaggedContents(File file) {
    try {
      String contents;
<span class="nc bnc" id="L280" title="All 2 branches missed.">      if (editorPane.getContentType().equals(&quot;text/html&quot;)) {</span>
<span class="nc" id="L281">        contents = editorPane.getText();</span>
      } else {
<span class="nc" id="L283">        Document doc = editorPane.getDocument();</span>
<span class="nc" id="L284">        contents = doc.getText(0, doc.getLength());</span>
      }
<span class="nc" id="L286">      saveFile(file, contents);</span>
<span class="nc" id="L287">      saveUntagged.setEnabled(true);</span>
<span class="nc" id="L288">      loadedFile = file;</span>
<span class="nc" id="L289">    } catch (Exception e) {</span>
<span class="nc" id="L290">      throw new RuntimeException(e);</span>
<span class="nc" id="L291">    }</span>
<span class="nc" id="L292">  }</span>

  public static void saveFile(File file, String contents) {
<span class="nc" id="L295">    StringUtils.printToFile(file, contents);</span>
<span class="nc" id="L296">  }</span>

  public String getURL() {
<span class="nc" id="L299">    String url = JOptionPane.showInputDialog(frame, &quot;URL: &quot;, &quot;Load URL&quot;, JOptionPane.QUESTION_MESSAGE);</span>
<span class="nc" id="L300">    return url;</span>
  }

  public boolean checkFile(File file) {
<span class="nc bnc" id="L304" title="All 2 branches missed.">    if (file.isFile()) {</span>
<span class="nc" id="L305">      fileChooser.setCurrentDirectory(file.getParentFile());</span>
<span class="nc" id="L306">      return true;</span>
    } else {
<span class="nc" id="L308">      String message = &quot;File Not Found: &quot;+file.getAbsolutePath();</span>
<span class="nc" id="L309">      displayError(&quot;File Not Found Error&quot;, message);</span>
<span class="nc" id="L310">      return false;</span>
    }
  }

  public void displayError(String title, String message) {
<span class="nc" id="L315">    JOptionPane.showMessageDialog(frame, message, title, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L316">  }</span>

  public void loadClassifier(File file, boolean crf) {
    try {
<span class="nc bnc" id="L320" title="All 2 branches missed.">      if (crf) {</span>
<span class="nc" id="L321">        classifier = CRFClassifier.getClassifier(file);</span>
      } else {
<span class="nc" id="L323">        classifier = CMMClassifier.getClassifier(file);</span>
      }
<span class="nc" id="L325">    } catch (Exception e) {</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">      String message = &quot;Error loading &quot;+(crf ? &quot;CRF&quot; : &quot;CMM&quot;)+&quot;: &quot;+file.getAbsolutePath();</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">      String title = (crf ? &quot;CRF&quot; : &quot;CMM&quot;)+&quot; Load Error&quot;;</span>
<span class="nc" id="L328">      message += &quot;\nMessage: &quot;+e.getMessage();</span>
<span class="nc" id="L329">      displayError(title, message);</span>
<span class="nc" id="L330">      return;</span>
<span class="nc" id="L331">    }</span>
<span class="nc" id="L332">    removeTags();</span>
<span class="nc" id="L333">    buildTagPanel();</span>
<span class="nc" id="L334">    buildExtractButton();</span>
<span class="nc" id="L335">  }</span>

  public void loadDefaultClassifier(boolean crf) {
    try {
<span class="nc bnc" id="L339" title="All 2 branches missed.">      if (crf) {</span>
<span class="nc" id="L340">        classifier = CRFClassifier.getDefaultClassifier();</span>
      } else {
<span class="nc" id="L342">        classifier = CMMClassifier.getDefaultClassifier();</span>
      }
<span class="nc" id="L344">    } catch (Exception e) {</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">      String message = &quot;Error loading default &quot;+(crf ? &quot;CRF&quot; : &quot;CMM&quot;);</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">      String title = (crf ? &quot;CRF&quot; : &quot;CMM&quot;)+&quot; Load Error&quot;;</span>
<span class="nc" id="L347">      message += &quot;\nMessage: &quot;+e.getMessage();</span>
<span class="nc" id="L348">      displayError(title, message);</span>
<span class="nc" id="L349">      return;</span>
<span class="nc" id="L350">    }</span>
<span class="nc" id="L351">    removeTags();</span>
<span class="nc" id="L352">    buildTagPanel();</span>
<span class="nc" id="L353">    buildExtractButton();</span>
<span class="nc" id="L354">  }</span>

  public void openFile(File file) {
<span class="nc bnc" id="L357" title="All 2 branches missed.">    String encoding = (classifier == null) ? &quot;utf-8&quot; : classifier.flags.inputEncoding;</span>
<span class="nc" id="L358">    String text = IOUtils.slurpFileNoExceptions(file.getPath(), encoding);</span>
<span class="nc" id="L359">    System.out.println(text);</span>
<span class="nc" id="L360">    editorPane.setContentType(&quot;text/plain&quot;);</span>
<span class="nc" id="L361">    editorPane.setText(text);</span>
<span class="nc" id="L362">    System.out.println(editorPane.getText());</span>
<span class="nc" id="L363">    loadedFile = file;</span>
<span class="nc" id="L364">    redraw();</span>
<span class="nc" id="L365">    saveUntagged.setEnabled(true);</span>
<span class="nc" id="L366">  }</span>

  public void openURL(String url) {
    try {
<span class="nc" id="L370">      editorPane.setPage(url);</span>
<span class="nc" id="L371">    } catch (Exception e) {</span>
<span class="nc" id="L372">      e.printStackTrace();</span>
<span class="nc" id="L373">      displayError(&quot;Error Loading URL &quot; + url, &quot;Message: &quot; + e.toString());</span>
<span class="nc" id="L374">      return;</span>
<span class="nc" id="L375">    }</span>
<span class="nc" id="L376">    loadedFile = null;</span>
<span class="nc" id="L377">    redraw();</span>
<span class="nc" id="L378">  }</span>

  public void redraw() {
<span class="nc" id="L381">    String text = editorPane.getText();</span>
<span class="nc" id="L382">    taggedContents = null;</span>
<span class="nc" id="L383">    untaggedContents = null;</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">    if (!editorPane.getContentType().equals(&quot;text/html&quot;)) {</span>
<span class="nc" id="L385">      editorPane.setContentType(&quot;text/rtf&quot;);</span>
<span class="nc" id="L386">      Document doc = editorPane.getDocument();</span>
      try {
<span class="nc" id="L388">        doc.insertString(0, text, defaultAttrSet);</span>
<span class="nc" id="L389">      } catch (Exception e) {</span>
<span class="nc" id="L390">        throw new RuntimeException(e);</span>
<span class="nc" id="L391">      }</span>
<span class="nc" id="L392">      editorPane.revalidate();</span>
<span class="nc" id="L393">      editorPane.repaint();</span>
<span class="nc" id="L394">      editorPane.setEditable(true);</span>
<span class="nc" id="L395">      htmlContents = null;</span>
<span class="nc" id="L396">    } else {</span>
<span class="nc" id="L397">      editorPane.setEditable(false);</span>
<span class="nc" id="L398">      htmlContents = editorPane.getText();</span>
    }

<span class="nc" id="L401">    saveUntagged.setEnabled(false);</span>
<span class="nc" id="L402">    saveTaggedAs.setEnabled(false);</span>
<span class="nc" id="L403">  }</span>

  private void removeTags() {
<span class="nc bnc" id="L406" title="All 2 branches missed.">    if (editorPane.getContentType().equals(&quot;text/html&quot;)) {</span>
<span class="nc" id="L407">      editorPane.setText(htmlContents);</span>
<span class="nc" id="L408">      editorPane.revalidate();</span>
<span class="nc" id="L409">      editorPane.repaint();</span>
    } else {
<span class="nc" id="L411">      DefaultStyledDocument doc = (DefaultStyledDocument)editorPane.getDocument();</span>
<span class="nc" id="L412">      SimpleAttributeSet attr = new SimpleAttributeSet();</span>
<span class="nc" id="L413">      StyleConstants.setForeground(attr, Color.BLACK);</span>
<span class="nc" id="L414">      StyleConstants.setBackground(attr, Color.WHITE);</span>
<span class="nc" id="L415">      doc.setCharacterAttributes(0, doc.getLength(), attr, false);</span>
    }
<span class="nc" id="L417">    saveTaggedAs.setEnabled(false);</span>
<span class="nc" id="L418">  }</span>

  private void extract() {

<span class="nc" id="L422">    log.info(&quot;content type: &quot;+editorPane.getContentType());</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">    if (!editorPane.getContentType().equals(&quot;text/html&quot;)) {</span>

<span class="nc" id="L425">      DefaultStyledDocument doc = (DefaultStyledDocument)editorPane.getDocument();</span>
<span class="nc" id="L426">      String text = null;</span>
      try {
<span class="nc" id="L428">        text = doc.getText(0, doc.getLength());</span>
<span class="nc" id="L429">      } catch (Exception e) {</span>
<span class="nc" id="L430">        throw new RuntimeException(e);</span>
<span class="nc" id="L431">      }</span>
<span class="nc" id="L432">      String labeledText = classifier.classifyWithInlineXML(text);</span>
<span class="nc" id="L433">      taggedContents = labeledText;</span>
<span class="nc" id="L434">      untaggedContents = text;</span>

<span class="nc" id="L436">      Set&lt;String&gt; tags = classifier.labels();</span>
<span class="nc" id="L437">      String background = classifier.backgroundSymbol();</span>
<span class="nc" id="L438">      String tagPattern = &quot;&quot;;</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">      for (String tag : tags) {</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">        if (background.equals(tag)) { continue; }</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">        if (tagPattern.length() &gt; 0) { tagPattern += &quot;|&quot;; }</span>
<span class="nc" id="L442">        tagPattern += tag;</span>
<span class="nc" id="L443">      }</span>

<span class="nc" id="L445">      Pattern startPattern = Pattern.compile(&quot;&lt;(&quot;+tagPattern+&quot;)&gt;&quot;);</span>
<span class="nc" id="L446">      Pattern endPattern = Pattern.compile(&quot;&lt;/(&quot;+tagPattern+&quot;)&gt;&quot;);</span>

<span class="nc" id="L448">      String finalText = labeledText;</span>

<span class="nc" id="L450">      Matcher m = startPattern.matcher(finalText);</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">      while (m.find()) {</span>
<span class="nc" id="L452">        int start = m.start();</span>
<span class="nc" id="L453">        finalText = m.replaceFirst(&quot;&quot;);</span>
<span class="nc" id="L454">        m = endPattern.matcher(finalText);</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">        if (m.find()) {</span>
<span class="nc" id="L456">          int end = m.start();</span>
<span class="nc" id="L457">          String tag = m.group(1);</span>
<span class="nc" id="L458">          finalText = m.replaceFirst(&quot;&quot;);</span>
<span class="nc" id="L459">          AttributeSet attSet = getAttributeSet(tag);</span>
          try {
<span class="nc" id="L461">            String entity = finalText.substring(start, end);</span>
<span class="nc" id="L462">            doc.setCharacterAttributes(start, entity.length(), attSet, false);</span>
<span class="nc" id="L463">          } catch (Exception ex) {</span>
<span class="nc" id="L464">            throw new RuntimeException(ex);</span>
<span class="nc" id="L465">          }</span>
<span class="nc" id="L466">          log.info(tag+&quot;: &quot;+ finalText.substring(start, end));</span>
        } else {
          // print error message
        }
<span class="nc" id="L470">        m = startPattern.matcher(finalText);</span>
<span class="nc" id="L471">      }</span>
<span class="nc" id="L472">      editorPane.revalidate();</span>
<span class="nc" id="L473">      editorPane.repaint();</span>
<span class="nc" id="L474">    } else {</span>
<span class="nc" id="L475">      untaggedContents = editorPane.getText();</span>
<span class="nc" id="L476">      taggedContents = classifier.classifyWithInlineXML(untaggedContents);</span>

<span class="nc" id="L478">      Set&lt;String&gt; tags = classifier.labels();</span>
<span class="nc" id="L479">      String background = classifier.backgroundSymbol();</span>
<span class="nc" id="L480">      String tagPattern = &quot;&quot;;</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">      for (String tag : tags) {</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">        if (background.equals(tag)) { continue; }</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">        if (tagPattern.length() &gt; 0) { tagPattern += &quot;|&quot;; }</span>
<span class="nc" id="L484">        tagPattern += tag;</span>
<span class="nc" id="L485">      }</span>

<span class="nc" id="L487">      Pattern startPattern = Pattern.compile(&quot;&lt;(&quot;+tagPattern+&quot;)&gt;&quot;);</span>
<span class="nc" id="L488">      Pattern endPattern = Pattern.compile(&quot;&lt;/(&quot;+tagPattern+&quot;)&gt;&quot;);</span>

<span class="nc" id="L490">      String finalText = taggedContents;</span>

<span class="nc" id="L492">      Matcher m = startPattern.matcher(finalText);</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">      while (m.find()) {</span>
<span class="nc" id="L494">        String tag = m.group(1);</span>
<span class="nc" id="L495">        String color = colorToHTML(tagToColorMap.get(tag));</span>
<span class="nc" id="L496">        String newTag = &quot;&lt;span style=\&quot;background-color: &quot;+color+&quot;; color: white\&quot;&gt;&quot;;</span>
<span class="nc" id="L497">        finalText = m.replaceFirst(newTag);</span>
<span class="nc" id="L498">        int start = m.start()+newTag.length();</span>
<span class="nc" id="L499">        Matcher m1 = endPattern.matcher(finalText);</span>
<span class="nc" id="L500">        m1.find(m.end());</span>
<span class="nc" id="L501">        String entity = finalText.substring(start, m1.start());</span>
<span class="nc" id="L502">        log.info(tag+&quot;: &quot;+ entity);</span>
<span class="nc" id="L503">        finalText = m1.replaceFirst(&quot;&lt;/span&gt;&quot;);</span>
<span class="nc" id="L504">        m = startPattern.matcher(finalText);</span>
<span class="nc" id="L505">      }</span>
<span class="nc" id="L506">      System.out.println(finalText);</span>
<span class="nc" id="L507">      editorPane.setText(finalText);</span>
<span class="nc" id="L508">      editorPane.revalidate();</span>
<span class="nc" id="L509">      editorPane.repaint();</span>

<span class="nc" id="L511">      log.info(finalText);</span>
    }
<span class="nc" id="L513">    saveTaggedAs.setEnabled(true);</span>
<span class="nc" id="L514">  }</span>

  private AttributeSet getAttributeSet(String tag) {
<span class="nc" id="L517">    MutableAttributeSet attr = new SimpleAttributeSet();</span>
<span class="nc" id="L518">    Color color = tagToColorMap.get(tag);</span>
<span class="nc" id="L519">    StyleConstants.setBackground(attr, color);</span>
<span class="nc" id="L520">    StyleConstants.setForeground(attr, Color.WHITE);</span>
<span class="nc" id="L521">    return attr;</span>
  }

  public void clearDocument() {
<span class="nc" id="L525">    editorPane.setContentType(&quot;text/rtf&quot;);</span>
<span class="nc" id="L526">    Document doc = new DefaultStyledDocument();</span>
<span class="nc" id="L527">    editorPane.setDocument(doc);</span>
    //    defaultAttrSet = ((StyledEditorKit)editorPane.getEditorKit()).getInputAttributes();
    //    StyleConstants.setFontFamily(defaultAttrSet, &quot;Lucinda Sans Unicode&quot;);
<span class="nc" id="L530">    log.info(&quot;attr: &quot;+defaultAttrSet);</span>

    try {
<span class="nc" id="L533">      doc.insertString(0, &quot; &quot;, defaultAttrSet);</span>
<span class="nc" id="L534">    } catch (Exception ex) {</span>
<span class="nc" id="L535">      throw new RuntimeException(ex);</span>
<span class="nc" id="L536">    }</span>

<span class="nc" id="L538">    editorPane.setEditable(true);</span>
<span class="nc" id="L539">    editorPane.revalidate();</span>
<span class="nc" id="L540">    editorPane.repaint();</span>

<span class="nc" id="L542">    saveUntagged.setEnabled(false);</span>
<span class="nc" id="L543">    saveTaggedAs.setEnabled(false);</span>

<span class="nc" id="L545">    taggedContents = null;</span>
<span class="nc" id="L546">    untaggedContents = null;</span>
<span class="nc" id="L547">    htmlContents = null;</span>
<span class="nc" id="L548">    loadedFile = null;</span>

<span class="nc" id="L550">  }</span>

  public void exit() {
    // ask if they're sure?
<span class="nc" id="L554">    System.exit(-1);</span>
<span class="nc" id="L555">  }</span>

  private final static String initText = &quot;In bringing his distinct vision to the Western genre, writer-director Jim Jarmusch has created a quasi-mystical avant-garde drama that remains a deeply spiritual viewing experience. After losing his parents and fianc\u00E9e, a Cleveland accountant named William Blake (a remarkable Johnny Depp) spends all his money and takes a train to the frontier town of Machine in order to work at a factory. Upon arriving in Machine, he is denied his expected job and finds himself a fugitive after murdering a man in self-defense. Wounded and helpless, Blake is befriended by Nobody (Gary Farmer), a wandering Native American who considers him to be a ghostly manifestation of the famous poet. Nobody aids Blake in his flight from three bumbling bounty hunters, preparing him for his final journey--a return to the world of the spirits.&quot;;
  //  private String initText = &quot;In&quot;;

  private void buildContentPanel() {

<span class="nc" id="L562">    editorPane = new JEditorPane ();</span>
<span class="nc" id="L563">    editorPane.setContentType(&quot;text/rtf&quot;);</span>
<span class="nc" id="L564">    editorPane.addKeyListener(new InputListener());</span>

    //    defaultAttrSet = ((StyledEditorKit)editorPane.getEditorKit()).getInputAttributes();
<span class="nc" id="L567">    StyleConstants.setFontFamily(defaultAttrSet, &quot;Lucinda Sans&quot;);</span>

<span class="nc" id="L569">    Document doc = new DefaultStyledDocument();</span>
<span class="nc" id="L570">    editorPane.setDocument(doc);</span>
    try {
<span class="nc" id="L572">      doc.insertString(0, initText, defaultAttrSet);</span>
<span class="nc" id="L573">    } catch (Exception ex) {</span>
<span class="nc" id="L574">      throw new RuntimeException(ex);</span>
<span class="nc" id="L575">    }</span>

<span class="nc" id="L577">    JScrollPane scrollPane = new JScrollPane(editorPane);</span>
<span class="nc" id="L578">    frame.getContentPane().add(scrollPane, BorderLayout.CENTER);</span>

<span class="nc" id="L580">    editorPane.setEditable(true);</span>

<span class="nc" id="L582">  }</span>

  public static String colorToHTML(Color color) {
<span class="nc" id="L585">    String r = Integer.toHexString(color.getRed());</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">    if (r.length() == 0) { r = &quot;00&quot;; }</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">    else if (r.length() == 1) { r = &quot;0&quot; + r; }</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">    else if (r.length() &gt; 2) { throw new IllegalArgumentException(&quot;invalid hex color for red&quot;+r); }</span>

<span class="nc" id="L590">    String g = Integer.toHexString(color.getGreen());</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">    if (g.length() == 0) { g = &quot;00&quot;; }</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">    else if (g.length() == 1) { g = &quot;0&quot; + g; }</span>
<span class="nc bnc" id="L593" title="All 2 branches missed.">    else if (g.length() &gt; 2) { throw new IllegalArgumentException(&quot;invalid hex color for green&quot;+g); }</span>

<span class="nc" id="L595">    String b = Integer.toHexString(color.getBlue());</span>
<span class="nc bnc" id="L596" title="All 2 branches missed.">    if (b.length() == 0) { b = &quot;00&quot;; }</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">    else if (b.length() == 1) { b = &quot;0&quot; + b; }</span>
<span class="nc bnc" id="L598" title="All 2 branches missed.">    else if (b.length() &gt; 2) { throw new IllegalArgumentException(&quot;invalid hex color for blue&quot;+b); }</span>

<span class="nc" id="L600">    return &quot;#&quot;+r+g+b;</span>
  }

  static class ColorIcon implements Icon {
    Color color;

<span class="nc" id="L606">    public ColorIcon(Color c) {</span>
<span class="nc" id="L607">      color = c;</span>
<span class="nc" id="L608">    }</span>

    public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc" id="L611">      g.setColor(color);</span>
<span class="nc" id="L612">      g.fillRect(x, y, getIconWidth(), getIconHeight());</span>
<span class="nc" id="L613">    }</span>

    public int getIconWidth() {
<span class="nc" id="L616">      return 10;</span>
    }

    public int getIconHeight() {
<span class="nc" id="L620">      return 10;</span>
    }
  }

<span class="nc" id="L624">  JButton extractButton = null;</span>

  private void buildExtractButton() {
<span class="nc bnc" id="L627" title="All 2 branches missed.">    if (extractButton == null) {</span>
<span class="nc" id="L628">      JPanel buttonPanel = new JPanel();</span>
<span class="nc" id="L629">      extractButton = new JButton(&quot;Extract&quot;);</span>
<span class="nc" id="L630">      buttonPanel.add(extractButton);</span>
<span class="nc" id="L631">      frame.add(buttonPanel, BorderLayout.SOUTH);</span>
<span class="nc" id="L632">      extractButton.addActionListener(actor);</span>
    }
<span class="nc" id="L634">  }</span>

  private void buildTagPanel() {

<span class="nc bnc" id="L638" title="All 2 branches missed.">    if (tagPanel == null) {</span>
<span class="nc" id="L639">      tagPanel = new JToolBar(SwingConstants.VERTICAL);</span>
<span class="nc" id="L640">      tagPanel.setFloatable(false);</span>
<span class="nc" id="L641">      frame.getContentPane().add(tagPanel, BorderLayout.EAST);</span>
    } else {
<span class="nc" id="L643">      tagPanel.removeAll();</span>
    }

<span class="nc bnc" id="L646" title="All 2 branches missed.">    if (classifier != null) {</span>

<span class="nc" id="L648">      makeTagMaps();</span>

<span class="nc" id="L650">      Set&lt;String&gt; tags = classifier.labels();</span>
<span class="nc" id="L651">      String backgroundSymbol = classifier.backgroundSymbol();</span>

<span class="nc bnc" id="L653" title="All 2 branches missed.">      for (String tag : tags) {</span>
<span class="nc bnc" id="L654" title="All 2 branches missed.">        if (backgroundSymbol.equals(tag)) { continue; }</span>
<span class="nc" id="L655">        Color color = tagToColorMap.get(tag);</span>
<span class="nc" id="L656">        JButton b = new JButton(tag, new ColorIcon(color));</span>
<span class="nc" id="L657">        tagPanel.add(b);</span>
<span class="nc" id="L658">      }</span>
    }
<span class="nc" id="L660">    tagPanel.revalidate();</span>
<span class="nc" id="L661">    tagPanel.repaint();</span>
<span class="nc" id="L662">  }</span>

  private void makeTagMaps() {
<span class="nc" id="L665">    Set&lt;String&gt; tags = classifier.labels();</span>
<span class="nc" id="L666">    String backgroundSymbol = classifier.backgroundSymbol();</span>
<span class="nc" id="L667">    tagToColorMap = makeTagToColorMap(tags, backgroundSymbol);</span>
<span class="nc" id="L668">  }</span>

  public static Map&lt;String, Color&gt; makeTagToColorMap(Set&lt;String&gt; tags,
                                                     String backgroundSymbol) {
<span class="nc" id="L672">    int numColors = tags.size() - 1;</span>
<span class="nc" id="L673">    Color[] colors = getNColors(numColors);</span>
<span class="nc" id="L674">    Map&lt;String, Color&gt; result = Generics.newHashMap();</span>

<span class="nc" id="L676">    int i = 0;</span>
<span class="nc bnc" id="L677" title="All 2 branches missed.">    for (String tag : tags) {</span>
<span class="nc bnc" id="L678" title="All 2 branches missed.">      if (backgroundSymbol.equals(tag)) { continue; }</span>
<span class="nc bnc" id="L679" title="All 2 branches missed.">      if (result.get(tag) != null) { continue; }</span>
<span class="nc" id="L680">      result.put(tag, colors[i++]);</span>
<span class="nc" id="L681">    }</span>
<span class="nc" id="L682">    return result;</span>
  }


<span class="nc" id="L686">  private static Color[] basicColors = new Color[]{new Color(204, 102, 0),</span>
                                                   new Color(102, 0, 102),
                                                   new Color(204, 0, 102),
                                                   new Color(153, 0, 0),
                                                   new Color(153, 0, 204),
                                                   new Color(255, 102, 0),
                                                   new Color(255, 102, 153),
                                                   new Color(204, 152, 255),
                                                   new Color(102, 102, 255),
                                                   new Color(153, 102, 0),
                                                   new Color(51, 102, 51),
                                                   new Color(0, 102, 255)};

//   private static Color[] basicColors = new Color[]{new Color(153, 102, 153),
//                                                    new Color(102, 153, 153),
//                                                    new Color(153, 153, 102),
//                                                    new Color(102, 102, 102),
//                                                    new Color(102, 153, 102),
//                                                    new Color(153, 102, 102),
//                                                    new Color(204, 153, 51),
//                                                    new Color(204, 51, 102),
//                                                    new Color(255, 204, 0),
//                                                    new Color(153, 0, 255),
//                                                    new Color(204, 204, 204),
//                                                    new Color(0, 255, 153)};

//   private static Color[] basicColors = new Color[]{Color.BLUE,
//                                     Color.GREEN,
//                                     Color.RED,
//                                     Color.ORANGE,
//                                     Color.LIGHT_GRAY,
//                                     Color.CYAN,
//                                     Color.MAGENTA,
//                                     Color.YELLOW,
//                                     Color.RED,
//                                     Color.GRAY,
//                                     Color.PINK,
//                                     Color.DARK_GRAY};


  public static Color[] getNColors(int n) {
<span class="nc" id="L727">    Color[] colors = new Color[n];</span>
<span class="nc bnc" id="L728" title="All 2 branches missed.">    if (n &lt;= basicColors.length) {</span>
<span class="nc" id="L729">      System.arraycopy(basicColors, 0, colors, 0, n);</span>
    } else {
<span class="nc" id="L731">      int s = 255 / (int)Math.ceil(Math.pow(n, (1.0 / 3.0)));</span>
<span class="nc" id="L732">      int index = 0;</span>
<span class="nc bnc" id="L733" title="All 2 branches missed.">      OUTER: for (int i = 0; i &lt; 256; i += s) {</span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">        for (int j = 0; j &lt; 256; j += s) {</span>
<span class="nc bnc" id="L735" title="All 2 branches missed.">          for (int k = 0; k &lt; 256; k += s) {</span>
<span class="nc" id="L736">            colors[index++] = new Color(i,j,k);</span>
<span class="nc bnc" id="L737" title="All 2 branches missed.">            if (index == n) { break OUTER; }</span>
          }
        }
      }
    }
<span class="nc" id="L742">    return colors;</span>
  }

  /** Run the GUI.  This program accepts no command-line arguments.
   *  Everything is entered into the GUI.
   */
  public static void main(String[] args) {
    //Schedule a job for the event-dispatching thread:
    //creating and showing this application's GUI.
<span class="nc" id="L751">    SwingUtilities.invokeLater(() -&gt; {</span>
<span class="nc" id="L752">      NERGUI gui = new NERGUI();</span>
<span class="nc" id="L753">      gui.createAndShowGUI();</span>
<span class="nc" id="L754">    });</span>
<span class="nc" id="L755">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>