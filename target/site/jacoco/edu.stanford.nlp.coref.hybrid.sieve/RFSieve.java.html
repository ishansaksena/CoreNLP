<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RFSieve.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Stanford CoreNLP</a> &gt; <a href="index.source.html" class="el_package">edu.stanford.nlp.coref.hybrid.sieve</a> &gt; <span class="el_source">RFSieve.java</span></div><h1>RFSieve.java</h1><pre class="source lang-java linenums">package edu.stanford.nlp.coref.hybrid.sieve;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashSet;
import java.util.List;
import java.util.Locale;
import java.util.Properties;
import java.util.Set;

import edu.stanford.nlp.coref.CorefProperties;
import edu.stanford.nlp.coref.CorefRules;
import edu.stanford.nlp.coref.data.CorefChain;
import edu.stanford.nlp.coref.data.CorefCluster;
import edu.stanford.nlp.coref.data.Dictionaries;
import edu.stanford.nlp.coref.data.Dictionaries.Animacy;
import edu.stanford.nlp.coref.data.Dictionaries.Gender;
import edu.stanford.nlp.coref.data.Dictionaries.MentionType;
import edu.stanford.nlp.coref.data.Dictionaries.Number;
import edu.stanford.nlp.coref.data.Dictionaries.Person;
import edu.stanford.nlp.coref.data.Document;
import edu.stanford.nlp.coref.data.Document.DocType;
import edu.stanford.nlp.coref.data.Mention;
import edu.stanford.nlp.coref.hybrid.HybridCorefPrinter;
import edu.stanford.nlp.coref.hybrid.HybridCorefProperties;
import edu.stanford.nlp.coref.hybrid.rf.RandomForest;
import edu.stanford.nlp.coref.md.RuleBasedCorefMentionFinder;
import edu.stanford.nlp.ling.CoreAnnotations;
import edu.stanford.nlp.ling.CoreAnnotations.SpeakerAnnotation;
import edu.stanford.nlp.ling.CoreLabel;
import edu.stanford.nlp.ling.RVFDatum;
import edu.stanford.nlp.math.ArrayMath;
import edu.stanford.nlp.stats.ClassicCounter;
import edu.stanford.nlp.stats.Counter;
import edu.stanford.nlp.stats.Counters;
import edu.stanford.nlp.trees.Tree;
import edu.stanford.nlp.util.Generics;
import edu.stanford.nlp.util.logging.Redwood;

public class RFSieve extends Sieve  {

  /** A logger for this class */
<span class="nc" id="L42">  private static Redwood.RedwoodChannels log = Redwood.channels(RFSieve.class);</span>

  private static final long serialVersionUID = -4090017054885920527L;

  // for RF sieve
  public RandomForest rf;

  /** the probability threshold for merging two mentions */
  public double thresMerge;

  // constructor for RF sieve
  public RFSieve(RandomForest rf, Properties props, String sievename) {
<span class="nc" id="L54">    super(props, sievename);</span>
<span class="nc" id="L55">    this.rf = rf;</span>
<span class="nc" id="L56">    this.props = props;</span>
<span class="nc" id="L57">    this.classifierType = ClassifierType.RF;</span>
<span class="nc" id="L58">  }</span>

  public void findCoreferentAntecedent(Mention m, int mIdx, Document document, Dictionaries dict, Properties props, StringBuilder sbLog) throws Exception {
<span class="nc" id="L61">    int sentIdx = m.sentNum;</span>

<span class="nc" id="L63">    Counter&lt;Integer&gt; probs = new ClassicCounter&lt;&gt;();</span>

<span class="nc" id="L65">    int mentionDist = 0;</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">    for(int sentDist=0 ; sentDist &lt;= Math.min(this.maxSentDist, sentIdx) ; sentDist++) {</span>
<span class="nc" id="L67">      List&lt;Mention&gt; candidates = getOrderedAntecedents(m, sentIdx-sentDist, mIdx, document.predictedMentions, dict);</span>


<span class="nc bnc" id="L70" title="All 2 branches missed.">      for(Mention candidate : candidates) {</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">        if(skipForAnalysis(candidate, m, props)) continue;</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">        if(candidate == m) continue;</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">        if(!aType.contains(candidate.mentionType)) continue;</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">        if(m.mentionType == MentionType.PRONOMINAL) {</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">          if(!matchedMentionType(m, mTypeStr)) continue;</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">          if(!matchedMentionType(candidate, aTypeStr)) continue;</span>
        }

<span class="nc bnc" id="L79" title="All 4 branches missed.">        if(sentDist==0 &amp;&amp; m.appearEarlierThan(candidate)) continue;   // ignore cataphora</span>
<span class="nc" id="L80">        mentionDist++;</span>

<span class="nc" id="L82">        RVFDatum&lt;Boolean, String&gt; datum = extractDatum(m, candidate, document, mentionDist, dict, props, sievename);</span>

<span class="nc" id="L84">        double probTrue = 0;</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if(this.classifierType == ClassifierType.RF) {</span>
<span class="nc" id="L86">          probTrue = this.rf.probabilityOfTrue(datum);</span>
        }

<span class="nc" id="L89">        probs.setCount(candidate.mentionID, probTrue);</span>
<span class="nc" id="L90">      }</span>
    }

<span class="nc bnc" id="L93" title="All 2 branches missed.">    if(HybridCorefProperties.debug(props)) {</span>
<span class="nc" id="L94">      sbLog.append(HybridCorefPrinter.printErrorLog(m, document, probs, mIdx, dict, this));</span>
    }

<span class="nc bnc" id="L97" title="All 4 branches missed.">    if(probs.size() &gt; 0 &amp;&amp; Counters.max(probs) &gt; this.thresMerge) {</span>
      // merge highest prob candidate
<span class="nc" id="L99">      int antID = Counters.argmax(probs);</span>

<span class="nc" id="L101">      Sieve.merge(document, m.mentionID, antID);</span>
    }
<span class="nc" id="L103">  }</span>
  public static RVFDatum&lt;Boolean, String&gt; extractDatum(Mention m, Mention candidate,
      Document document, int mentionDist, Dictionaries dict, Properties props, String sievename) {
    try {

<span class="nc bnc" id="L108" title="All 2 branches missed.">      boolean label = (document.goldMentions==null)? false : document.isCoref(m, candidate);</span>
<span class="nc" id="L109">      Counter&lt;String&gt; features = new ClassicCounter&lt;&gt;();</span>
<span class="nc" id="L110">      CorefCluster mC = document.corefClusters.get(m.corefClusterID);</span>
<span class="nc" id="L111">      CorefCluster aC = document.corefClusters.get(candidate.corefClusterID);</span>

<span class="nc" id="L113">      CoreLabel mFirst = m.sentenceWords.get(m.startIndex);</span>
<span class="nc" id="L114">      CoreLabel mLast = m.sentenceWords.get(m.endIndex-1);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">      CoreLabel mPreceding = (m.startIndex&gt;0)? m.sentenceWords.get(m.startIndex-1) : null;</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">      CoreLabel mFollowing = (m.endIndex &lt; m.sentenceWords.size())? m.sentenceWords.get(m.endIndex) : null;</span>

<span class="nc" id="L118">      CoreLabel aFirst = candidate.sentenceWords.get(candidate.startIndex);</span>
<span class="nc" id="L119">      CoreLabel aLast = candidate.sentenceWords.get(candidate.endIndex-1);</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">      CoreLabel aPreceding = (candidate.startIndex&gt;0)? candidate.sentenceWords.get(candidate.startIndex-1) : null;</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">      CoreLabel aFollowing = (candidate.endIndex &lt; candidate.sentenceWords.size())? candidate.sentenceWords.get(candidate.endIndex) : null;</span>


      ////////////////////////////////////////////////////////////////////////////////
      ///////    basic features: distance, doctype, mention length, roles ////////////
      ////////////////////////////////////////////////////////////////////////////////
<span class="nc bnc" id="L127" title="All 2 branches missed.">      if(HybridCorefProperties.useBasicFeatures(props, sievename)) {</span>
<span class="nc" id="L128">        int sentDist = m.sentNum - candidate.sentNum;</span>
<span class="nc" id="L129">        features.incrementCount(&quot;SENTDIST&quot;, sentDist);</span>
<span class="nc" id="L130">        features.incrementCount(&quot;MENTIONDIST&quot;, mentionDist);</span>

<span class="nc" id="L132">        int minSentDist = sentDist;</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">        for(Mention a : aC.corefMentions) {</span>
<span class="nc" id="L134">          minSentDist = Math.min(minSentDist, Math.abs(m.sentNum - a.sentNum));</span>
<span class="nc" id="L135">        }</span>
<span class="nc" id="L136">        features.incrementCount(&quot;MINSENTDIST&quot;, minSentDist);</span>

        // When they are in the same sentence, divides a sentence into clauses and add such feature
<span class="nc bnc" id="L139" title="All 2 branches missed.">        if(CorefProperties.useConstituencyParse(props)) {</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">          if(m.sentNum == candidate.sentNum) {</span>
<span class="nc" id="L141">            int clauseCount = 0;</span>
<span class="nc" id="L142">            Tree tree = m.contextParseTree;</span>
<span class="nc" id="L143">            Tree current = m.mentionSubTree;</span>

            while(true){
<span class="nc" id="L146">              current = current.ancestor(1, tree);</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">              if(current.label().value().startsWith(&quot;S&quot;)) {</span>
<span class="nc" id="L148">                clauseCount++;</span>
              }
<span class="nc bnc" id="L150" title="All 2 branches missed.">              if(current.dominates(candidate.mentionSubTree)) break;</span>
<span class="nc bnc" id="L151" title="All 4 branches missed.">              if(current.label().value().equals(&quot;ROOT&quot;) || current.ancestor(1, tree)==null) break;</span>
            }
<span class="nc" id="L153">            features.incrementCount(&quot;CLAUSECOUNT&quot;, clauseCount);</span>
          }
        }

<span class="nc bnc" id="L157" title="All 2 branches missed.">        if(document.docType == DocType.CONVERSATION) features.incrementCount(&quot;B-DOCTYPE-&quot;+document.docType);</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">        if(m.headWord.get(SpeakerAnnotation.class).equalsIgnoreCase(&quot;PER0&quot;)) {</span>
<span class="nc" id="L159">          features.incrementCount(&quot;B-SPEAKER-PER0&quot;);</span>
        }

<span class="nc bnc" id="L162" title="All 4 branches missed.">        if(document.docInfo!=null &amp;&amp; document.docInfo.containsKey(&quot;DOC_ID&quot;)) {</span>
<span class="nc" id="L163">          features.incrementCount(&quot;B-DOCSOURCE-&quot;+document.docInfo.get(&quot;DOC_ID&quot;).split(&quot;/&quot;)[1]);</span>
        }

<span class="nc" id="L166">        features.incrementCount(&quot;M-LENGTH&quot;, m.originalSpan.size());</span>
<span class="nc" id="L167">        features.incrementCount(&quot;A-LENGTH&quot;, candidate.originalSpan.size());</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if(m.originalSpan.size() &lt; candidate.originalSpan.size()) features.incrementCount(&quot;B-A-ISLONGER&quot;);</span>
<span class="nc" id="L169">        features.incrementCount(&quot;A-SIZE&quot;, aC.getCorefMentions().size());</span>
<span class="nc" id="L170">        features.incrementCount(&quot;M-SIZE&quot;, mC.getCorefMentions().size());</span>

<span class="nc" id="L172">        String antRole = &quot;A-NOROLE&quot;;</span>
<span class="nc" id="L173">        String mRole = &quot;M-NOROLE&quot;;</span>

<span class="nc bnc" id="L175" title="All 2 branches missed.">        if(m.isSubject) mRole = &quot;M-SUBJ&quot;;</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">        if(m.isDirectObject) mRole = &quot;M-DOBJ&quot;;</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">        if(m.isIndirectObject) mRole = &quot;M-IOBJ&quot;;</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">        if(m.isPrepositionObject) mRole = &quot;M-POBJ&quot;;</span>

<span class="nc bnc" id="L180" title="All 2 branches missed.">        if(candidate.isSubject) antRole = &quot;A-SUBJ&quot;;</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if(candidate.isDirectObject) antRole = &quot;A-DOBJ&quot;;</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">        if(candidate.isIndirectObject) antRole = &quot;A-IOBJ&quot;;</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">        if(candidate.isPrepositionObject) antRole = &quot;A-POBJ&quot;;</span>

<span class="nc" id="L185">        features.incrementCount(&quot;B-&quot;+mRole);</span>
<span class="nc" id="L186">        features.incrementCount(&quot;B-&quot;+antRole);</span>
<span class="nc" id="L187">        features.incrementCount(&quot;B-&quot;+antRole+&quot;-&quot;+mRole);</span>

<span class="nc bnc" id="L189" title="All 2 branches missed.">        if(HybridCorefProperties.combineObjectRoles(props, sievename)) {</span>
          // combine all objects
<span class="nc bnc" id="L191" title="All 12 branches missed.">          if(m.isDirectObject || m.isIndirectObject || m.isPrepositionObject</span>
              || candidate.isDirectObject || candidate.isIndirectObject || candidate.isPrepositionObject) {
<span class="nc bnc" id="L193" title="All 6 branches missed.">            if(m.isDirectObject || m.isIndirectObject || m.isPrepositionObject) {</span>
<span class="nc" id="L194">              mRole = &quot;M-OBJ&quot;;</span>
<span class="nc" id="L195">              features.incrementCount(&quot;B-M-OBJ&quot;);</span>
            }
<span class="nc bnc" id="L197" title="All 6 branches missed.">            if(candidate.isDirectObject || candidate.isIndirectObject || candidate.isPrepositionObject) {</span>
<span class="nc" id="L198">              antRole = &quot;A-OBJ&quot;;</span>
<span class="nc" id="L199">              features.incrementCount(&quot;B-A-OBJ&quot;);</span>
            }
<span class="nc" id="L201">            features.incrementCount(&quot;B-&quot;+antRole+&quot;-&quot;+mRole);</span>
          }
        }

<span class="nc bnc" id="L205" title="All 2 branches missed.">        if(mFirst.word().toLowerCase().matches(&quot;a|an&quot;)) {</span>
<span class="nc" id="L206">          features.incrementCount(&quot;B-M-START-WITH-INDEFINITE&quot;);</span>
        }
<span class="nc bnc" id="L208" title="All 2 branches missed.">        if(aFirst.word().toLowerCase().matches(&quot;a|an&quot;)) {</span>
<span class="nc" id="L209">          features.incrementCount(&quot;B-A-START-WITH-INDEFINITE&quot;);</span>
        }
<span class="nc bnc" id="L211" title="All 2 branches missed.">        if(mFirst.word().equalsIgnoreCase(&quot;the&quot;)) {</span>
<span class="nc" id="L212">          features.incrementCount(&quot;B-M-START-WITH-DEFINITE&quot;);</span>
        }
<span class="nc bnc" id="L214" title="All 2 branches missed.">        if(aFirst.word().equalsIgnoreCase(&quot;the&quot;)) {</span>
<span class="nc" id="L215">          features.incrementCount(&quot;B-A-START-WITH-DEFINITE&quot;);</span>
        }

<span class="nc bnc" id="L218" title="All 2 branches missed.">        if(dict.indefinitePronouns.contains(m.lowercaseNormalizedSpanString())) {</span>
<span class="nc" id="L219">          features.incrementCount(&quot;B-M-INDEFINITE-PRONOUN&quot;);</span>
        }
<span class="nc bnc" id="L221" title="All 2 branches missed.">        if(dict.indefinitePronouns.contains(candidate.lowercaseNormalizedSpanString())) {</span>
<span class="nc" id="L222">          features.incrementCount(&quot;B-A-INDEFINITE-PRONOUN&quot;);</span>
        }
<span class="nc bnc" id="L224" title="All 2 branches missed.">        if(dict.indefinitePronouns.contains(mFirst.word().toLowerCase())) {</span>
<span class="nc" id="L225">          features.incrementCount(&quot;B-M-INDEFINITE-ADJ&quot;);</span>
        }
<span class="nc bnc" id="L227" title="All 2 branches missed.">        if(dict.indefinitePronouns.contains(aFirst.word().toLowerCase())){</span>
<span class="nc" id="L228">          features.incrementCount(&quot;B-A-INDEFINITE-ADJ&quot;);</span>
        }
<span class="nc bnc" id="L230" title="All 2 branches missed.">        if(dict.reflexivePronouns.contains(m.headString)) {</span>
<span class="nc" id="L231">          features.incrementCount(&quot;B-M-REFLEXIVE&quot;);</span>
        }
<span class="nc bnc" id="L233" title="All 2 branches missed.">        if(dict.reflexivePronouns.contains(candidate.headString)) {</span>
<span class="nc" id="L234">          features.incrementCount(&quot;B-A-REFLEXIVE&quot;);</span>
        }

<span class="nc bnc" id="L237" title="All 2 branches missed.">        if(m.headIndex == m.endIndex-1) features.incrementCount(&quot;B-M-HEADEND&quot;);</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">        if(m.headIndex &lt; m.endIndex-1) {</span>
<span class="nc" id="L239">          CoreLabel headnext = m.sentenceWords.get(m.headIndex+1);</span>
<span class="nc bnc" id="L240" title="All 4 branches missed.">          if(headnext.word().matches(&quot;that|,&quot;) || headnext.tag().startsWith(&quot;W&quot;)) {</span>
<span class="nc" id="L241">            features.incrementCount(&quot;B-M-HASPOSTPHRASE&quot;);</span>
<span class="nc bnc" id="L242" title="All 4 branches missed.">            if(mFirst.tag().equals(&quot;DT&quot;) &amp;&amp; mFirst.word().toLowerCase().matches(&quot;the|this|these|those&quot;)) features.incrementCount(&quot;B-M-THE-HASPOSTPHRASE&quot;);</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">            else if(mFirst.word().toLowerCase().matches(&quot;a|an&quot;)) features.incrementCount(&quot;B-M-INDEFINITE-HASPOSTPHRASE&quot;);</span>
          }
        }

        // shape feature from Bjorkelund &amp; Kuhn
<span class="nc" id="L248">        StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L249">        List&lt;Mention&gt; sortedMentions = new ArrayList&lt;&gt;(aC.corefMentions.size());</span>
<span class="nc" id="L250">        sortedMentions.addAll(aC.corefMentions);</span>
<span class="nc" id="L251">        Collections.sort(sortedMentions, new CorefChain.MentionComparator());</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">        for(Mention a : sortedMentions) {</span>
<span class="nc" id="L253">          sb.append(a.mentionType).append(&quot;-&quot;);</span>
<span class="nc" id="L254">        }</span>
<span class="nc" id="L255">        features.incrementCount(&quot;B-A-SHAPE-&quot;+sb.toString());</span>

<span class="nc" id="L257">        sb = new StringBuilder();</span>
<span class="nc" id="L258">        sortedMentions = new ArrayList&lt;&gt;(mC.corefMentions.size());</span>
<span class="nc" id="L259">        sortedMentions.addAll(mC.corefMentions);</span>
<span class="nc" id="L260">        Collections.sort(sortedMentions, new CorefChain.MentionComparator());</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">        for(Mention men : sortedMentions) {</span>
<span class="nc" id="L262">          sb.append(men.mentionType).append(&quot;-&quot;);</span>
<span class="nc" id="L263">        }</span>
<span class="nc" id="L264">        features.incrementCount(&quot;B-M-SHAPE-&quot;+sb.toString());</span>

<span class="nc bnc" id="L266" title="All 2 branches missed.">        if(CorefProperties.useConstituencyParse(props)) {</span>
<span class="nc" id="L267">          sb = new StringBuilder();</span>
<span class="nc" id="L268">          Tree mTree = m.contextParseTree;</span>
<span class="nc" id="L269">          Tree mHead = mTree.getLeaves().get(m.headIndex).ancestor(1, mTree);</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">          for(Tree node : mTree.pathNodeToNode(mHead, mTree)){</span>
<span class="nc" id="L271">            sb.append(node.value()).append(&quot;-&quot;);</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">            if(node.value().equals(&quot;S&quot;)) break;</span>
<span class="nc" id="L273">          }</span>
<span class="nc" id="L274">          features.incrementCount(&quot;B-M-SYNPATH-&quot;+sb.toString());</span>

<span class="nc" id="L276">          sb = new StringBuilder();</span>
<span class="nc" id="L277">          Tree aTree = candidate.contextParseTree;</span>
<span class="nc" id="L278">          Tree aHead = aTree.getLeaves().get(candidate.headIndex).ancestor(1, aTree);</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">          for(Tree node : aTree.pathNodeToNode(aHead, aTree)){</span>
<span class="nc" id="L280">            sb.append(node.value()).append(&quot;-&quot;);</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">            if(node.value().equals(&quot;S&quot;)) break;</span>
<span class="nc" id="L282">          }</span>
<span class="nc" id="L283">          features.incrementCount(&quot;B-A-SYNPATH-&quot;+sb.toString());</span>
        }


<span class="nc" id="L287">        features.incrementCount(&quot;A-FIRSTAPPEAR&quot;, aC.representative.sentNum);</span>
<span class="nc" id="L288">        features.incrementCount(&quot;M-FIRSTAPPEAR&quot;, mC.representative.sentNum);</span>
<span class="nc" id="L289">        int docSize = document.predictedMentions.size();   // document size in # of sentences</span>
<span class="nc" id="L290">        features.incrementCount(&quot;A-FIRSTAPPEAR-NORMALIZED&quot;, aC.representative.sentNum/docSize);</span>
<span class="nc" id="L291">        features.incrementCount(&quot;M-FIRSTAPPEAR-NORMALIZED&quot;, mC.representative.sentNum/docSize);</span>
      }

      ////////////////////////////////////////////////////////////////////////////////
      ///////    mention detection features                               ////////////
      ////////////////////////////////////////////////////////////////////////////////
<span class="nc bnc" id="L297" title="All 2 branches missed.">      if(HybridCorefProperties.useMentionDetectionFeatures(props, sievename)) {</span>
        // bare plurals
<span class="nc bnc" id="L299" title="All 4 branches missed.">        if(m.originalSpan.size()==1 &amp;&amp; m.headWord.tag().equals(&quot;NNS&quot;)) features.incrementCount(&quot;B-M-BAREPLURAL&quot;);</span>
<span class="nc bnc" id="L300" title="All 4 branches missed.">        if(candidate.originalSpan.size()==1 &amp;&amp; candidate.headWord.tag().equals(&quot;NNS&quot;)) features.incrementCount(&quot;B-A-BAREPLURAL&quot;);</span>

        // pleonastic it
<span class="nc bnc" id="L303" title="All 2 branches missed.">        if(CorefProperties.useConstituencyParse(props)) {</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">          if(RuleBasedCorefMentionFinder.isPleonastic(m, m.contextParseTree)</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">              || RuleBasedCorefMentionFinder.isPleonastic(candidate, candidate.contextParseTree)) {</span>
<span class="nc" id="L306">            features.incrementCount(&quot;B-PLEONASTICIT&quot;);</span>
          }
        }

        // quantRule
<span class="nc bnc" id="L311" title="All 2 branches missed.">        if(dict.quantifiers.contains(mFirst.word().toLowerCase(Locale.ENGLISH))) features.incrementCount(&quot;B-M-QUANTIFIER&quot;);</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">        if(dict.quantifiers.contains(aFirst.word().toLowerCase(Locale.ENGLISH))) features.incrementCount(&quot;B-A-QUANTIFIER&quot;);</span>

        // starts with negation
<span class="nc bnc" id="L315" title="All 2 branches missed.">        if(mFirst.word().toLowerCase(Locale.ENGLISH).matches(&quot;none|no|nothing|not&quot;)</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">            || aFirst.word().toLowerCase(Locale.ENGLISH).matches(&quot;none|no|nothing|not&quot;)) {</span>
<span class="nc" id="L317">          features.incrementCount(&quot;B-NEGATIVE-START&quot;);</span>
        }

        // parititive rule
<span class="nc bnc" id="L321" title="All 2 branches missed.">        if(RuleBasedCorefMentionFinder.partitiveRule(m, m.sentenceWords, dict)) features.incrementCount(&quot;B-M-PARTITIVE&quot;);</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">        if(RuleBasedCorefMentionFinder.partitiveRule(candidate, candidate.sentenceWords, dict)) features.incrementCount(&quot;B-A-PARTITIVE&quot;);</span>

        // %
<span class="nc bnc" id="L325" title="All 2 branches missed.">        if(m.headString.equals(&quot;%&quot;)) features.incrementCount(&quot;B-M-HEAD%&quot;);</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">        if(candidate.headString.equals(&quot;%&quot;)) features.incrementCount(&quot;B-A-HEAD%&quot;);</span>

        // adjective form of nations
<span class="nc bnc" id="L329" title="All 2 branches missed.">        if(dict.isAdjectivalDemonym(m.spanToString())) features.incrementCount(&quot;B-M-ADJ-DEMONYM&quot;);</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">        if(dict.isAdjectivalDemonym(candidate.spanToString())) features.incrementCount(&quot;B-A-ADJ-DEMONYM&quot;);</span>

        // ends with &quot;etc.&quot;
<span class="nc bnc" id="L333" title="All 2 branches missed.">        if(m.lowercaseNormalizedSpanString().endsWith(&quot;etc.&quot;)) features.incrementCount(&quot;B-M-ETC-END&quot;);</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">        if(candidate.lowercaseNormalizedSpanString().endsWith(&quot;etc.&quot;)) features.incrementCount(&quot;B-A-ETC-END&quot;);</span>

      }

      ////////////////////////////////////////////////////////////////////////////////
      ///////    attributes, attributes agree                             ////////////
      ////////////////////////////////////////////////////////////////////////////////
<span class="nc" id="L341">      features.incrementCount(&quot;B-M-NUMBER-&quot;+m.number);</span>
<span class="nc" id="L342">      features.incrementCount(&quot;B-A-NUMBER-&quot;+candidate.number);</span>
<span class="nc" id="L343">      features.incrementCount(&quot;B-M-GENDER-&quot;+m.gender);</span>
<span class="nc" id="L344">      features.incrementCount(&quot;B-A-GENDER-&quot;+candidate.gender);</span>
<span class="nc" id="L345">      features.incrementCount(&quot;B-M-ANIMACY-&quot;+m.animacy);</span>
<span class="nc" id="L346">      features.incrementCount(&quot;B-A-ANIMACY-&quot;+candidate.animacy);</span>
<span class="nc" id="L347">      features.incrementCount(&quot;B-M-PERSON-&quot;+m.person);</span>
<span class="nc" id="L348">      features.incrementCount(&quot;B-A-PERSON-&quot;+candidate.person);</span>
<span class="nc" id="L349">      features.incrementCount(&quot;B-M-NETYPE-&quot;+m.nerString);</span>
<span class="nc" id="L350">      features.incrementCount(&quot;B-A-NETYPE-&quot;+candidate.nerString);</span>

<span class="nc" id="L352">      features.incrementCount(&quot;B-BOTH-NUMBER-&quot;+candidate.number+&quot;-&quot;+m.number);</span>
<span class="nc" id="L353">      features.incrementCount(&quot;B-BOTH-GENDER-&quot;+candidate.gender+&quot;-&quot;+m.gender);</span>
<span class="nc" id="L354">      features.incrementCount(&quot;B-BOTH-ANIMACY-&quot;+candidate.animacy+&quot;-&quot;+m.animacy);</span>
<span class="nc" id="L355">      features.incrementCount(&quot;B-BOTH-PERSON-&quot;+candidate.person+&quot;-&quot;+m.person);</span>
<span class="nc" id="L356">      features.incrementCount(&quot;B-BOTH-NETYPE-&quot;+candidate.nerString+&quot;-&quot;+m.nerString);</span>


<span class="nc" id="L359">      Set&lt;Number&gt; mcNumber = Generics.newHashSet();</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">      for(Number n : mC.numbers) {</span>
<span class="nc" id="L361">        features.incrementCount(&quot;B-MC-NUMBER-&quot;+n);</span>
<span class="nc" id="L362">        mcNumber.add(n);</span>
<span class="nc" id="L363">      }</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">      if(mcNumber.size()==1) {</span>
<span class="nc" id="L365">        features.incrementCount(&quot;B-MC-CLUSTERNUMBER-&quot;+mcNumber.iterator().next());</span>
      } else {
<span class="nc" id="L367">        mcNumber.remove(Number.UNKNOWN);</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">        if(mcNumber.size() == 1) features.incrementCount(&quot;B-MC-CLUSTERNUMBER-&quot;+mcNumber.iterator().next());</span>
<span class="nc" id="L369">        else features.incrementCount(&quot;B-MC-CLUSTERNUMBER-CONFLICT&quot;);</span>
      }

<span class="nc" id="L372">      Set&lt;Gender&gt; mcGender = Generics.newHashSet();</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">      for(Gender g : mC.genders) {</span>
<span class="nc" id="L374">        features.incrementCount(&quot;B-MC-GENDER-&quot;+g);</span>
<span class="nc" id="L375">        mcGender.add(g);</span>
<span class="nc" id="L376">      }</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">      if(mcGender.size()==1) {</span>
<span class="nc" id="L378">        features.incrementCount(&quot;B-MC-CLUSTERGENDER-&quot;+mcGender.iterator().next());</span>
      } else {
<span class="nc" id="L380">        mcGender.remove(Gender.UNKNOWN);</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">        if(mcGender.size() == 1) features.incrementCount(&quot;B-MC-CLUSTERGENDER-&quot;+mcGender.iterator().next());</span>
<span class="nc" id="L382">        else features.incrementCount(&quot;B-MC-CLUSTERGENDER-CONFLICT&quot;);</span>
      }

<span class="nc" id="L385">      Set&lt;Animacy&gt; mcAnimacy = Generics.newHashSet();</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">      for(Animacy a : mC.animacies) {</span>
<span class="nc" id="L387">        features.incrementCount(&quot;B-MC-ANIMACY-&quot;+a);</span>
<span class="nc" id="L388">        mcAnimacy.add(a);</span>
<span class="nc" id="L389">      }</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">      if(mcAnimacy.size()==1) {</span>
<span class="nc" id="L391">        features.incrementCount(&quot;B-MC-CLUSTERANIMACY-&quot;+mcAnimacy.iterator().next());</span>
      } else {
<span class="nc" id="L393">        mcAnimacy.remove(Animacy.UNKNOWN);</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">        if(mcAnimacy.size() == 1) features.incrementCount(&quot;B-MC-CLUSTERANIMACY-&quot;+mcAnimacy.iterator().next());</span>
<span class="nc" id="L395">        else features.incrementCount(&quot;B-MC-CLUSTERANIMACY-CONFLICT&quot;);</span>
      }

<span class="nc" id="L398">      Set&lt;String&gt; mcNER = Generics.newHashSet();</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">      for(String t : mC.nerStrings) {</span>
<span class="nc" id="L400">        features.incrementCount(&quot;B-MC-NETYPE-&quot;+t);</span>
<span class="nc" id="L401">        mcNER.add(t);</span>
<span class="nc" id="L402">      }</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">      if(mcNER.size()==1) {</span>
<span class="nc" id="L404">        features.incrementCount(&quot;B-MC-CLUSTERNETYPE-&quot;+mcNER.iterator().next());</span>
      } else {
<span class="nc" id="L406">        mcNER.remove(&quot;O&quot;);</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">        if(mcNER.size() == 1) features.incrementCount(&quot;B-MC-CLUSTERNETYPE-&quot;+mcNER.iterator().next());</span>
<span class="nc" id="L408">        else features.incrementCount(&quot;B-MC-CLUSTERNETYPE-CONFLICT&quot;);</span>
      }

<span class="nc" id="L411">      Set&lt;Number&gt; acNumber = Generics.newHashSet();</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">      for(Number n : aC.numbers) {</span>
<span class="nc" id="L413">        features.incrementCount(&quot;B-AC-NUMBER-&quot;+n);</span>
<span class="nc" id="L414">        acNumber.add(n);</span>
<span class="nc" id="L415">      }</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">      if(acNumber.size()==1) {</span>
<span class="nc" id="L417">        features.incrementCount(&quot;B-AC-CLUSTERNUMBER-&quot;+acNumber.iterator().next());</span>
      } else {
<span class="nc" id="L419">        acNumber.remove(Number.UNKNOWN);</span>
<span class="nc bnc" id="L420" title="All 2 branches missed.">        if(acNumber.size() == 1) features.incrementCount(&quot;B-AC-CLUSTERNUMBER-&quot;+acNumber.iterator().next());</span>
<span class="nc" id="L421">        else features.incrementCount(&quot;B-AC-CLUSTERNUMBER-CONFLICT&quot;);</span>
      }

<span class="nc" id="L424">      Set&lt;Gender&gt; acGender = Generics.newHashSet();</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">      for(Gender g : aC.genders) {</span>
<span class="nc" id="L426">        features.incrementCount(&quot;B-AC-GENDER-&quot;+g);</span>
<span class="nc" id="L427">        acGender.add(g);</span>
<span class="nc" id="L428">      }</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">      if(acGender.size()==1) {</span>
<span class="nc" id="L430">        features.incrementCount(&quot;B-AC-CLUSTERGENDER-&quot;+acGender.iterator().next());</span>
      } else {
<span class="nc" id="L432">        acGender.remove(Gender.UNKNOWN);</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">        if(acGender.size() == 1) features.incrementCount(&quot;B-AC-CLUSTERGENDER-&quot;+acGender.iterator().next());</span>
<span class="nc" id="L434">        else features.incrementCount(&quot;B-AC-CLUSTERGENDER-CONFLICT&quot;);</span>
      }

<span class="nc" id="L437">      Set&lt;Animacy&gt; acAnimacy = Generics.newHashSet();</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">      for(Animacy a : aC.animacies) {</span>
<span class="nc" id="L439">        features.incrementCount(&quot;B-AC-ANIMACY-&quot;+a);</span>
<span class="nc" id="L440">        acAnimacy.add(a);</span>
<span class="nc" id="L441">      }</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">      if(acAnimacy.size()==1) {</span>
<span class="nc" id="L443">        features.incrementCount(&quot;B-AC-CLUSTERANIMACY-&quot;+acAnimacy.iterator().next());</span>
      } else {
<span class="nc" id="L445">        acAnimacy.remove(Animacy.UNKNOWN);</span>
<span class="nc bnc" id="L446" title="All 2 branches missed.">        if(acAnimacy.size() == 1) features.incrementCount(&quot;B-AC-CLUSTERANIMACY-&quot;+acAnimacy.iterator().next());</span>
<span class="nc" id="L447">        else features.incrementCount(&quot;B-AC-CLUSTERANIMACY-CONFLICT&quot;);</span>
      }

<span class="nc" id="L450">      Set&lt;String&gt; acNER = Generics.newHashSet();</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">      for(String t : aC.nerStrings) {</span>
<span class="nc" id="L452">        features.incrementCount(&quot;B-AC-NETYPE-&quot;+t);</span>
<span class="nc" id="L453">        acNER.add(t);</span>
<span class="nc" id="L454">      }</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">      if(acNER.size()==1) {</span>
<span class="nc" id="L456">        features.incrementCount(&quot;B-AC-CLUSTERNETYPE-&quot;+acNER.iterator().next());</span>
      } else {
<span class="nc" id="L458">        acNER.remove(&quot;O&quot;);</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">        if(acNER.size() == 1) features.incrementCount(&quot;B-AC-CLUSTERNETYPE-&quot;+acNER.iterator().next());</span>
<span class="nc" id="L460">        else features.incrementCount(&quot;B-AC-CLUSTERNETYPE-CONFLICT&quot;);</span>
      }


<span class="nc bnc" id="L464" title="All 2 branches missed.">      if(m.numbersAgree(candidate)) features.incrementCount(&quot;B-NUMBER-AGREE&quot;);</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">      if(m.gendersAgree(candidate)) features.incrementCount(&quot;B-GENDER-AGREE&quot;);</span>
<span class="nc bnc" id="L466" title="All 2 branches missed.">      if(m.animaciesAgree(candidate)) features.incrementCount(&quot;B-ANIMACY-AGREE&quot;);</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">      if(CorefRules.entityAttributesAgree(mC, aC)) features.incrementCount(&quot;B-ATTRIBUTES-AGREE&quot;);</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">      if(CorefRules.entityPersonDisagree(document, m, candidate, dict)) features.incrementCount(&quot;B-PERSON-DISAGREE&quot;);</span>

      ////////////////////////////////////////////////////////////////////////////////
      ///////    dcoref rules                                             ////////////
      ////////////////////////////////////////////////////////////////////////////////
<span class="nc bnc" id="L473" title="All 2 branches missed.">      if(HybridCorefProperties.useDcorefRules(props, sievename)) {</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">        if(CorefRules.entityIWithinI(m, candidate, dict)) features.incrementCount(&quot;B-i-within-i&quot;);</span>
<span class="nc bnc" id="L475" title="All 2 branches missed.">        if(CorefRules.antecedentIsMentionSpeaker(document, m, candidate, dict)) features.incrementCount(&quot;B-ANT-IS-SPEAKER&quot;);</span>
<span class="nc bnc" id="L476" title="All 2 branches missed.">        if(CorefRules.entitySameSpeaker(document, m, candidate)) features.incrementCount(&quot;B-SAME-SPEAKER&quot;);</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">        if(CorefRules.entitySubjectObject(m, candidate)) features.incrementCount(&quot;B-SUBJ-OBJ&quot;);</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">        for(Mention a : aC.corefMentions) {</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">          if(CorefRules.entitySubjectObject(m, a)) features.incrementCount(&quot;B-CLUSTER-SUBJ-OBJ&quot;);</span>
<span class="nc" id="L480">        }</span>

<span class="nc bnc" id="L482" title="All 2 branches missed.">        if(CorefRules.entityPersonDisagree(document, m, candidate, dict)</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">            &amp;&amp; CorefRules.entitySameSpeaker(document, m, candidate)) features.incrementCount(&quot;B-PERSON-DISAGREE-SAME-SPEAKER&quot;);</span>

<span class="nc bnc" id="L485" title="All 2 branches missed.">        if(CorefRules.entityIWithinI(mC, aC, dict)) features.incrementCount(&quot;B-ENTITY-IWITHINI&quot;);</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">        if(CorefRules.antecedentMatchesMentionSpeakerAnnotation(m, candidate, document)) features.incrementCount(&quot;B-ANT-IS-SPEAKER-OF-MENTION&quot;);</span>

<span class="nc" id="L488">        Set&lt;MentionType&gt; mType = HybridCorefProperties.getMentionType(props, sievename);</span>
<span class="nc bnc" id="L489" title="All 4 branches missed.">        if(mType.contains(MentionType.PROPER) || mType.contains(MentionType.NOMINAL)) {</span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">          if(m.headString.equals(candidate.headString)) features.incrementCount(&quot;B-HEADMATCH&quot;);</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">          if(CorefRules.entityHeadsAgree(mC, aC, m, candidate, dict)) features.incrementCount(&quot;B-HEADSAGREE&quot;);</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">          if(CorefRules.entityExactStringMatch(mC, aC, dict, document.roleSet)) features.incrementCount(&quot;B-EXACTSTRINGMATCH&quot;);</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">          if(CorefRules.entityHaveExtraProperNoun(m, candidate, new HashSet&lt;&gt;())) features.incrementCount(&quot;B-HAVE-EXTRA-PROPER-NOUN&quot;);</span>
<span class="nc bnc" id="L494" title="All 2 branches missed.">          if(CorefRules.entityBothHaveProper(mC, aC)) features.incrementCount(&quot;B-BOTH-HAVE-PROPER&quot;);</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">          if(CorefRules.entityHaveDifferentLocation(m, candidate, dict)) features.incrementCount(&quot;B-HAVE-DIFF-LOC&quot;);</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">          if(CorefRules.entityHaveIncompatibleModifier(mC, aC)) features.incrementCount(&quot;B-HAVE-INCOMPATIBLE-MODIFIER&quot;);</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">          if(CorefRules.entityIsAcronym(document, mC, aC)) features.incrementCount(&quot;B-IS-ACRONYM&quot;);</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">          if(CorefRules.entityIsApposition(mC, aC, m, candidate)) features.incrementCount(&quot;B-IS-APPOSITION&quot;);</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">          if(CorefRules.entityIsPredicateNominatives(mC, aC, m, candidate)) features.incrementCount(&quot;B-IS-PREDICATE-NOMINATIVES&quot;);</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">          if(CorefRules.entityIsRoleAppositive(mC, aC, m, candidate, dict)) features.incrementCount(&quot;B-IS-ROLE-APPOSITIVE&quot;);</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">          if(CorefRules.entityNumberInLaterMention(m, candidate)) features.incrementCount(&quot;B-NUMBER-IN-LATER&quot;);</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">          if(CorefRules.entityRelaxedExactStringMatch(mC, aC, m, candidate, dict, document.roleSet)) features.incrementCount(&quot;B-RELAXED-EXACT-STRING-MATCH&quot;);</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">          if(CorefRules.entityRelaxedHeadsAgreeBetweenMentions(mC, aC, m, candidate)) features.incrementCount(&quot;B-RELAXED-HEAD-AGREE&quot;);</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">          if(CorefRules.entitySameProperHeadLastWord(m, candidate)) features.incrementCount(&quot;B-SAME-PROPER-HEAD&quot;);</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">          if(CorefRules.entitySameProperHeadLastWord(mC, aC, m, candidate)) features.incrementCount(&quot;B-CLUSTER-SAME-PROPER-HEAD&quot;);</span>
<span class="nc bnc" id="L506" title="All 2 branches missed.">          if(CorefRules.entityWordsIncluded(mC, aC, m, candidate)) features.incrementCount(&quot;B-WORD-INCLUSION&quot;);</span>
        }
<span class="nc bnc" id="L508" title="All 2 branches missed.">        if(mType.contains(MentionType.LIST)) {</span>
<span class="nc" id="L509">          features.incrementCount(&quot;NUM-LIST-&quot;, numEntitiesInList(m));</span>
<span class="nc bnc" id="L510" title="All 6 branches missed.">          if(m.spanToString().contains(&quot;two&quot;) || m.spanToString().contains(&quot;2&quot;) || m.spanToString().contains(&quot;both&quot;)) features.incrementCount(&quot;LIST-M-TWO&quot;);</span>
<span class="nc bnc" id="L511" title="All 4 branches missed.">          if(m.spanToString().contains(&quot;three&quot;) || m.spanToString().contains(&quot;3&quot;)) features.incrementCount(&quot;LIST-M-THREE&quot;);</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">          if(candidate.spanToString().contains(&quot;two&quot;)</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">              || candidate.spanToString().contains(&quot;2&quot;)</span>
<span class="nc bnc" id="L514" title="All 2 branches missed.">              || candidate.spanToString().contains(&quot;both&quot;)) {</span>
<span class="nc" id="L515">            features.incrementCount(&quot;B-LIST-A-TWO&quot;);</span>
          }
<span class="nc bnc" id="L517" title="All 2 branches missed.">          if(candidate.spanToString().contains(&quot;three&quot;)</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">              || candidate.spanToString().contains(&quot;3&quot;)) {</span>
<span class="nc" id="L519">            features.incrementCount(&quot;B-LIST-A-THREE&quot;);</span>
          }
        }

<span class="nc bnc" id="L523" title="All 2 branches missed.">        if(mType.contains(MentionType.PRONOMINAL)) {</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">          if(dict.firstPersonPronouns.contains(m.headString)) features.incrementCount(&quot;B-M-I&quot;);</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">          if(dict.secondPersonPronouns.contains(m.headString)) features.incrementCount(&quot;B-M-YOU&quot;);</span>
<span class="nc bnc" id="L526" title="All 2 branches missed.">          if(dict.thirdPersonPronouns.contains(m.headString)) features.incrementCount(&quot;B-M-3RDPERSON&quot;);</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">          if(dict.possessivePronouns.contains(m.headString)) features.incrementCount(&quot;B-M-POSSESSIVE&quot;);</span>
<span class="nc bnc" id="L528" title="All 2 branches missed.">          if(dict.neutralPronouns.contains(m.headString)) features.incrementCount(&quot;B-M-NEUTRAL&quot;);</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">          if(dict.malePronouns.contains(m.headString)) features.incrementCount(&quot;B-M-MALE&quot;);</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">          if(dict.femalePronouns.contains(m.headString)) features.incrementCount(&quot;B-M-FEMALE&quot;);</span>

<span class="nc bnc" id="L532" title="All 2 branches missed.">          if(dict.firstPersonPronouns.contains(candidate.headString)) features.incrementCount(&quot;B-A-I&quot;);</span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">          if(dict.secondPersonPronouns.contains(candidate.headString)) features.incrementCount(&quot;B-A-YOU&quot;);</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">          if(dict.thirdPersonPronouns.contains(candidate.headString)) features.incrementCount(&quot;B-A-3RDPERSON&quot;);</span>
<span class="nc bnc" id="L535" title="All 2 branches missed.">          if(dict.possessivePronouns.contains(candidate.headString)) features.incrementCount(&quot;B-A-POSSESSIVE&quot;);</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">          if(dict.neutralPronouns.contains(candidate.headString)) features.incrementCount(&quot;B-A-NEUTRAL&quot;);</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">          if(dict.malePronouns.contains(candidate.headString)) features.incrementCount(&quot;B-A-MALE&quot;);</span>
<span class="nc bnc" id="L538" title="All 2 branches missed.">          if(dict.femalePronouns.contains(candidate.headString)) features.incrementCount(&quot;B-A-FEMALE&quot;);</span>

<span class="nc" id="L540">          features.incrementCount(&quot;B-M-GENERIC-&quot;+m.generic);</span>
<span class="nc" id="L541">          features.incrementCount(&quot;B-A-GENERIC-&quot;+candidate.generic);</span>

<span class="nc bnc" id="L543" title="All 2 branches missed.">          if(HybridCorefPrinter.dcorefPronounSieve.skipThisMention(document, m, mC, dict)) {</span>
<span class="nc" id="L544">            features.incrementCount(&quot;B-SKIPTHISMENTION-true&quot;);</span>
          }

<span class="nc bnc" id="L547" title="All 6 branches missed.">          if(m.spanToString().equalsIgnoreCase(&quot;you&quot;) &amp;&amp; mFollowing!=null &amp;&amp; mFollowing.word().equalsIgnoreCase(&quot;know&quot;)) {</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">            features.incrementCount(&quot;B-YOUKNOW-PRECEDING-POS-&quot; + ((mPreceding==null)? &quot;NULL&quot; : mPreceding.tag()) );</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">            features.incrementCount(&quot;B-YOUKNOW-PRECEDING-WORD-&quot;+ ((mPreceding==null)? &quot;NULL&quot; : mPreceding.word().toLowerCase()) );</span>
<span class="nc bnc" id="L550" title="All 2 branches missed.">            CoreLabel nextword = (m.endIndex+1 &lt; m.sentenceWords.size())? m.sentenceWords.get(m.endIndex+1) : null;</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">            features.incrementCount(&quot;B-YOUKNOW-FOLLOWING-POS-&quot; + ((nextword==null)? &quot;NULL&quot; : nextword.tag()) );</span>
<span class="nc bnc" id="L552" title="All 2 branches missed.">            features.incrementCount(&quot;B-YOUKNOW-FOLLOWING-WORD-&quot;+ ((nextword==null)? &quot;NULL&quot; : nextword.word().toLowerCase()) );</span>
          }
<span class="nc bnc" id="L554" title="All 6 branches missed.">          if(candidate.spanToString().equalsIgnoreCase(&quot;you&quot;) &amp;&amp; aFollowing!=null &amp;&amp; aFollowing.word().equalsIgnoreCase(&quot;know&quot;)) {</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">            features.incrementCount(&quot;B-YOUKNOW-PRECEDING-POS-&quot; + ((aPreceding==null)? &quot;NULL&quot; : aPreceding.tag()) );</span>
<span class="nc bnc" id="L556" title="All 2 branches missed.">            features.incrementCount(&quot;B-YOUKNOW-PRECEDING-WORD-&quot;+ ((aPreceding==null)? &quot;NULL&quot; : aPreceding.word().toLowerCase()) );</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">            CoreLabel nextword = (candidate.endIndex+1 &lt; candidate.sentenceWords.size())? candidate.sentenceWords.get(candidate.endIndex+1) : null;</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">            features.incrementCount(&quot;B-YOUKNOW-FOLLOWING-POS-&quot; + ((nextword==null)? &quot;NULL&quot; : nextword.tag()) );</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">            features.incrementCount(&quot;B-YOUKNOW-FOLLOWING-WORD-&quot;+ ((nextword==null)? &quot;NULL&quot; : nextword.word().toLowerCase()) );</span>
          }
        }

        // discourse match features
<span class="nc bnc" id="L564" title="All 6 branches missed.">        if(m.person==Person.YOU &amp;&amp; document.docType==DocType.ARTICLE &amp;&amp; m.headWord.get(CoreAnnotations.SpeakerAnnotation.class).equals(&quot;PER0&quot;)) {</span>
<span class="nc" id="L565">          features.incrementCount(&quot;B-DISCOURSE-M-YOU-GENERIC?&quot;);</span>
        }
<span class="nc bnc" id="L567" title="All 4 branches missed.">        if(candidate.generic &amp;&amp; candidate.person==Person.YOU) features.incrementCount(&quot;B-DISCOURSE-A-YOU-GENERIC?&quot;);</span>

<span class="nc" id="L569">        String mString = m.lowercaseNormalizedSpanString();</span>
<span class="nc" id="L570">        String antString = candidate.lowercaseNormalizedSpanString();</span>

        // I-I
<span class="nc bnc" id="L573" title="All 6 branches missed.">        if(m.number==Number.SINGULAR &amp;&amp; dict.firstPersonPronouns.contains(mString)</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">            &amp;&amp; candidate.number==Number.SINGULAR &amp;&amp; dict.firstPersonPronouns.contains(antString)</span>
<span class="nc bnc" id="L575" title="All 2 branches missed.">            &amp;&amp; CorefRules.entitySameSpeaker(document, m, candidate)) {</span>
<span class="nc" id="L576">          features.incrementCount(&quot;B-DISCOURSE-I-I-SAMESPEAKER&quot;);</span>
        }

        // (speaker - I)
<span class="nc bnc" id="L580" title="All 4 branches missed.">        if ((m.number==Number.SINGULAR &amp;&amp; dict.firstPersonPronouns.contains(mString))</span>
<span class="nc bnc" id="L581" title="All 2 branches missed.">                &amp;&amp; CorefRules.antecedentIsMentionSpeaker(document, m, candidate, dict)) {</span>
<span class="nc" id="L582">          features.incrementCount(&quot;B-DISCOURSE-SPEAKER-I&quot;);</span>
        }

        // (I - speaker)
<span class="nc bnc" id="L586" title="All 4 branches missed.">        if ((candidate.number==Number.SINGULAR &amp;&amp; dict.firstPersonPronouns.contains(antString))</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">                &amp;&amp; CorefRules.antecedentIsMentionSpeaker(document, candidate, m, dict)) {</span>
<span class="nc" id="L588">          features.incrementCount(&quot;B-DISCOURSE-I-SPEAKER&quot;);</span>
        }
        // Can be iffy if more than two speakers... but still should be okay most of the time
<span class="nc bnc" id="L591" title="All 2 branches missed.">        if (dict.secondPersonPronouns.contains(mString)</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">            &amp;&amp; dict.secondPersonPronouns.contains(antString)</span>
<span class="nc bnc" id="L593" title="All 2 branches missed.">            &amp;&amp; CorefRules.entitySameSpeaker(document, m, candidate)) {</span>
<span class="nc" id="L594">          features.incrementCount(&quot;B-DISCOURSE-BOTH-YOU&quot;);</span>
        }
        // previous I - you or previous you - I in two person conversation
<span class="nc bnc" id="L597" title="All 8 branches missed.">        if (((m.person==Person.I &amp;&amp; candidate.person==Person.YOU</span>
            || (m.person==Person.YOU &amp;&amp; candidate.person==Person.I))
<span class="nc bnc" id="L599" title="All 4 branches missed.">            &amp;&amp; (m.headWord.get(CoreAnnotations.UtteranceAnnotation.class)-candidate.headWord.get(CoreAnnotations.UtteranceAnnotation.class) == 1)</span>
            &amp;&amp; document.docType==DocType.CONVERSATION)) {
<span class="nc" id="L601">          features.incrementCount(&quot;B-DISCOURSE-I-YOU&quot;);</span>
        }
<span class="nc bnc" id="L603" title="All 4 branches missed.">        if (dict.reflexivePronouns.contains(m.headString) &amp;&amp; CorefRules.entitySubjectObject(m, candidate)){</span>
<span class="nc" id="L604">          features.incrementCount(&quot;B-DISCOURSE-REFLEXIVE&quot;);</span>
        }
<span class="nc bnc" id="L606" title="All 6 branches missed.">        if(m.person==Person.I &amp;&amp; candidate.person==Person.I &amp;&amp; !CorefRules.entitySameSpeaker(document, m, candidate)) {</span>
<span class="nc" id="L607">          features.incrementCount(&quot;B-DISCOURSE-I-I-DIFFSPEAKER&quot;);</span>
        }
<span class="nc bnc" id="L609" title="All 6 branches missed.">        if(m.person==Person.YOU &amp;&amp; candidate.person==Person.YOU &amp;&amp; !CorefRules.entitySameSpeaker(document, m, candidate)) {</span>
<span class="nc" id="L610">          features.incrementCount(&quot;B-DISCOURSE-YOU-YOU-DIFFSPEAKER&quot;);</span>
        }
<span class="nc bnc" id="L612" title="All 6 branches missed.">        if(m.person==Person.WE &amp;&amp; candidate.person==Person.WE &amp;&amp; !CorefRules.entitySameSpeaker(document, m, candidate)) {</span>
<span class="nc" id="L613">          features.incrementCount(&quot;B-DISCOURSE-WE-WE-DIFFSPEAKER&quot;);</span>
        }
      }

      ////////////////////////////////////////////////////////////////////////////////
      ///////    POS features                                             ////////////
      ////////////////////////////////////////////////////////////////////////////////
<span class="nc bnc" id="L620" title="All 2 branches missed.">      if(HybridCorefProperties.usePOSFeatures(props, sievename)) {</span>
<span class="nc" id="L621">        features.incrementCount(&quot;B-LEXICAL-M-HEADPOS-&quot;+m.headWord.tag());</span>
<span class="nc" id="L622">        features.incrementCount(&quot;B-LEXICAL-A-HEADPOS-&quot;+candidate.headWord.tag());</span>
<span class="nc" id="L623">        features.incrementCount(&quot;B-LEXICAL-M-FIRSTPOS-&quot;+mFirst.tag());</span>
<span class="nc" id="L624">        features.incrementCount(&quot;B-LEXICAL-A-FIRSTPOS-&quot;+aFirst.tag());</span>
<span class="nc" id="L625">        features.incrementCount(&quot;B-LEXICAL-M-LASTPOS-&quot;+mLast.tag());</span>
<span class="nc" id="L626">        features.incrementCount(&quot;B-LEXICAL-A-LASTPOS-&quot;+aLast.tag());</span>

<span class="nc bnc" id="L628" title="All 2 branches missed.">        features.incrementCount(&quot;B-LEXICAL-M-PRECEDINGPOS-&quot;+ ((mPreceding==null)? &quot;NULL&quot; : mPreceding.tag()) );</span>
<span class="nc bnc" id="L629" title="All 2 branches missed.">        features.incrementCount(&quot;B-LEXICAL-A-PRECEDINGPOS-&quot;+ ((aPreceding==null)? &quot;NULL&quot; : aPreceding.tag()) );</span>
<span class="nc bnc" id="L630" title="All 2 branches missed.">        features.incrementCount(&quot;B-LEXICAL-M-FOLLOWINGPOS-&quot;+ ((mFollowing==null)? &quot;NULL&quot; : mFollowing.tag()) );</span>
<span class="nc bnc" id="L631" title="All 2 branches missed.">        features.incrementCount(&quot;B-LEXICAL-A-FOLLOWINGPOS-&quot;+ ((aFollowing==null)? &quot;NULL&quot; : aFollowing.tag()) );</span>
      }

      ////////////////////////////////////////////////////////////////////////////////
      ///////    lexical features                                         ////////////
      ////////////////////////////////////////////////////////////////////////////////
<span class="nc bnc" id="L637" title="All 2 branches missed.">      if(HybridCorefProperties.useLexicalFeatures(props, sievename)) {</span>

<span class="nc" id="L639">        features.incrementCount(&quot;B-LEXICAL-M-HEADWORD-&quot;+m.headString.toLowerCase());</span>
<span class="nc" id="L640">        features.incrementCount(&quot;B-LEXICAL-A-HEADWORD-&quot;+candidate.headString.toLowerCase());</span>
<span class="nc" id="L641">        features.incrementCount(&quot;B-LEXICAL-M-FIRSTWORD-&quot;+mFirst.word().toLowerCase());</span>
<span class="nc" id="L642">        features.incrementCount(&quot;B-LEXICAL-A-FIRSTWORD-&quot;+aFirst.word().toLowerCase());</span>
<span class="nc" id="L643">        features.incrementCount(&quot;B-LEXICAL-M-LASTWORD-&quot;+mLast.word().toLowerCase());</span>
<span class="nc" id="L644">        features.incrementCount(&quot;B-LEXICAL-A-LASTWORD-&quot;+aLast.word().toLowerCase());</span>

<span class="nc bnc" id="L646" title="All 2 branches missed.">        features.incrementCount(&quot;B-LEXICAL-M-PRECEDINGWORD-&quot;+ ((mPreceding==null)? &quot;NULL&quot; : mPreceding.word().toLowerCase()) );</span>
<span class="nc bnc" id="L647" title="All 2 branches missed.">        features.incrementCount(&quot;B-LEXICAL-A-PRECEDINGWORD-&quot;+ ((aPreceding==null)? &quot;NULL&quot; : aPreceding.word().toLowerCase()) );</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">        features.incrementCount(&quot;B-LEXICAL-M-FOLLOWINGWORD-&quot;+ ((mFollowing==null)? &quot;NULL&quot; : mFollowing.word().toLowerCase()) );</span>
<span class="nc bnc" id="L649" title="All 2 branches missed.">        features.incrementCount(&quot;B-LEXICAL-A-FOLLOWINGWORD-&quot;+ ((aFollowing==null)? &quot;NULL&quot; : aFollowing.word().toLowerCase()) );</span>

        //extra headword, modifiers lexical features
<span class="nc bnc" id="L652" title="All 2 branches missed.">        for(String mHead : mC.heads) {</span>
<span class="nc bnc" id="L653" title="All 2 branches missed.">          if(!aC.heads.contains(mHead)) features.incrementCount(&quot;B-LEXICAL-MC-EXTRAHEAD-&quot;+mHead);</span>
<span class="nc" id="L654">        }</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">        for(String mWord : mC.words) {</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">          if(!aC.words.contains(mWord)) features.incrementCount(&quot;B-LEXICAL-MC-EXTRAWORD-&quot;+mWord);</span>
<span class="nc" id="L657">        }</span>
      }

      ////////////////////////////////////////////////////////////////////////////////
      ///////    word vector features                                     ////////////
      ////////////////////////////////////////////////////////////////////////////////

      // cosine
<span class="nc bnc" id="L665" title="All 2 branches missed.">      if(HybridCorefProperties.useWordEmbedding(props, sievename)) {</span>
        // dimension
<span class="nc" id="L667">        int dim = dict.vectors.entrySet().iterator().next().getValue().length;</span>

        // distance between headword
<span class="nc" id="L670">        float[] mV = dict.vectors.get(m.headString.toLowerCase());</span>
<span class="nc" id="L671">        float[] aV = dict.vectors.get(candidate.headString.toLowerCase());</span>
<span class="nc bnc" id="L672" title="All 4 branches missed.">        if(mV!=null &amp;&amp; aV!=null) {</span>
<span class="nc" id="L673">          features.incrementCount(&quot;WORDVECTOR-DIFF-HEADWORD&quot;, cosine(mV, aV));</span>
        }

<span class="nc" id="L676">        mV = dict.vectors.get(mFirst.word().toLowerCase());</span>
<span class="nc" id="L677">        aV = dict.vectors.get(aFirst.word().toLowerCase());</span>
<span class="nc bnc" id="L678" title="All 4 branches missed.">        if(mV!=null &amp;&amp; aV!=null) {</span>
<span class="nc" id="L679">          features.incrementCount(&quot;WORDVECTOR-DIFF-FIRSTWORD&quot;, cosine(mV, aV));</span>
        }

<span class="nc" id="L682">        mV = dict.vectors.get(mLast.word().toLowerCase());</span>
<span class="nc" id="L683">        aV = dict.vectors.get(aLast.word().toLowerCase());</span>
<span class="nc bnc" id="L684" title="All 4 branches missed.">        if(mV!=null &amp;&amp; aV!=null) {</span>
<span class="nc" id="L685">          features.incrementCount(&quot;WORDVECTOR-DIFF-LASTWORD&quot;, cosine(mV, aV));</span>
        }

<span class="nc bnc" id="L688" title="All 4 branches missed.">        if(mPreceding!=null &amp;&amp; aPreceding!=null) {</span>
<span class="nc" id="L689">          mV = dict.vectors.get(mPreceding.word().toLowerCase());</span>
<span class="nc" id="L690">          aV = dict.vectors.get(aPreceding.word().toLowerCase());</span>
<span class="nc bnc" id="L691" title="All 4 branches missed.">          if(mV!=null &amp;&amp; aV!=null) {</span>
<span class="nc" id="L692">            features.incrementCount(&quot;WORDVECTOR-DIFF-PRECEDINGWORD&quot;, cosine(mV, aV));</span>
          }
        }
<span class="nc bnc" id="L695" title="All 4 branches missed.">        if(mFollowing!=null &amp;&amp; aFollowing!=null) {</span>
<span class="nc" id="L696">          mV = dict.vectors.get(mFollowing.word().toLowerCase());</span>
<span class="nc" id="L697">          aV = dict.vectors.get(aFollowing.word().toLowerCase());</span>
<span class="nc bnc" id="L698" title="All 4 branches missed.">          if(mV!=null &amp;&amp; aV!=null) {</span>
<span class="nc" id="L699">            features.incrementCount(&quot;WORDVECTOR-DIFF-FOLLOWINGWORD&quot;, cosine(mV, aV));</span>
          }
        }

<span class="nc" id="L703">        float[] aggreM = new float[dim];</span>
<span class="nc" id="L704">        float[] aggreA = new float[dim];</span>

<span class="nc bnc" id="L706" title="All 2 branches missed.">        for(CoreLabel cl : m.originalSpan) {</span>
<span class="nc" id="L707">          float[] v = dict.vectors.get(cl.word().toLowerCase());</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">          if(v==null) continue;</span>
<span class="nc" id="L709">          ArrayMath.pairwiseAddInPlace(aggreM, v);</span>
<span class="nc" id="L710">        }</span>
<span class="nc bnc" id="L711" title="All 2 branches missed.">        for(CoreLabel cl : candidate.originalSpan) {</span>
<span class="nc" id="L712">          float[] v = dict.vectors.get(cl.word().toLowerCase());</span>
<span class="nc bnc" id="L713" title="All 2 branches missed.">          if(v==null) continue;</span>
<span class="nc" id="L714">          ArrayMath.pairwiseAddInPlace(aggreA, v);</span>
<span class="nc" id="L715">        }</span>
<span class="nc bnc" id="L716" title="All 4 branches missed.">        if(ArrayMath.L2Norm(aggreM)!=0 &amp;&amp; ArrayMath.L2Norm(aggreA)!=0) {</span>
<span class="nc" id="L717">          features.incrementCount(&quot;WORDVECTOR-AGGREGATE-DIFF&quot;, cosine(aggreM, aggreA));</span>
        }

<span class="nc" id="L720">        int cnt = 0;</span>
<span class="nc" id="L721">        double dist = 0;</span>
<span class="nc bnc" id="L722" title="All 2 branches missed.">        for(CoreLabel mcl : m.originalSpan) {</span>
<span class="nc bnc" id="L723" title="All 2 branches missed.">          for(CoreLabel acl : candidate.originalSpan) {</span>
<span class="nc" id="L724">            mV = dict.vectors.get(mcl.word().toLowerCase());</span>
<span class="nc" id="L725">            aV = dict.vectors.get(acl.word().toLowerCase());</span>
<span class="nc bnc" id="L726" title="All 4 branches missed.">            if(mV==null || aV==null) continue;</span>
<span class="nc" id="L727">            cnt++;</span>
<span class="nc" id="L728">            dist += cosine(mV, aV);</span>
<span class="nc" id="L729">          }</span>
<span class="nc" id="L730">        }</span>
<span class="nc" id="L731">        features.incrementCount(&quot;WORDVECTOR-AVG-DIFF&quot;, dist/cnt);</span>
      }

<span class="nc" id="L734">      return new RVFDatum&lt;&gt;(features, label);</span>
<span class="nc" id="L735">    } catch (Exception e) {</span>
<span class="nc" id="L736">      log.info(&quot;Datum Extraction failed in Sieve.java while processing document: &quot;+document.docInfo.get(&quot;DOC_ID&quot;)+&quot; part: &quot;+document.docInfo.get(&quot;DOC_PART&quot;));</span>
<span class="nc" id="L737">      throw new RuntimeException(e);</span>
    }
  }

  // assume the input vectors are normalized
  private static double cosine(float[] normalizedVector1, float[] normalizedVector2) {
<span class="nc" id="L743">    double inner = ArrayMath.innerProduct(normalizedVector1, normalizedVector2);</span>
<span class="nc" id="L744">    return inner;</span>
  }
  public static int numEntitiesInList(Mention m) {
<span class="nc" id="L747">    int num = 0;</span>
<span class="nc bnc" id="L748" title="All 2 branches missed.">    for(int i=1 ; i &lt; m.originalSpan.size() ; i++) {</span>
<span class="nc" id="L749">      CoreLabel cl = m.originalSpan.get(i);</span>
<span class="nc bnc" id="L750" title="All 2 branches missed.">      if(cl.word().equals(&quot;,&quot;)) num++;</span>
<span class="nc bnc" id="L751" title="All 4 branches missed.">      if((cl.word().equalsIgnoreCase(&quot;and&quot;) || cl.word().equalsIgnoreCase(&quot;or&quot;))</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">          &amp;&amp; !m.originalSpan.get(i-1).word().equals(&quot;,&quot;)) num++;</span>
    }

<span class="nc" id="L755">    return num;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>