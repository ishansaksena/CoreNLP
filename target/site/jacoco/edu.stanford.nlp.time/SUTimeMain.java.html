<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SUTimeMain.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Stanford CoreNLP</a> &gt; <a href="index.source.html" class="el_package">edu.stanford.nlp.time</a> &gt; <span class="el_source">SUTimeMain.java</span></div><h1>SUTimeMain.java</h1><pre class="source lang-java linenums">package edu.stanford.nlp.time;
import edu.stanford.nlp.util.logging.Redwood;

import edu.stanford.nlp.io.IOUtils;
import edu.stanford.nlp.io.ReaderInputStream;
import edu.stanford.nlp.io.TeeStream;
import edu.stanford.nlp.ling.CoreAnnotations;
import edu.stanford.nlp.ling.CoreLabel;
import edu.stanford.nlp.ling.tokensregex.MatchedExpression;
import edu.stanford.nlp.pipeline.*;
import edu.stanford.nlp.process.CoreLabelTokenFactory;
import edu.stanford.nlp.stats.PrecisionRecallStats;
import edu.stanford.nlp.util.*;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;

import java.io.*;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.*;
import java.util.logging.LogManager;
import java.util.regex.Pattern;


/**
 * Main program for testing SUTime.
 * &lt;br&gt;
 * Processing a text string:
 * &lt;pre&gt;
 * -in.type TEXT
 * -date YYYY-MM-dd
 * -i &amp;lt;text&amp;gt;
 * -o &amp;lt;output file&amp;gt;
 * &lt;/pre&gt;
 *
 * Processing a text file:
 * &lt;pre&gt;
 * -in.type TEXTFILE
 * -date YYYY-MM-dd
 * -i input.txt
 * -o &amp;lt;output file&amp;gt;
 * &lt;/pre&gt;
 *
 * Running on Timebank
 * &lt;pre&gt;
 * -in.type TIMEBANK_CSV
 * -i timebank.csv
 * -tempeval2.dct dct.txt
 * -o &amp;lt;output directory&amp;gt;
 * -eval &amp;lt;evaluation script&amp;gt;
 * &lt;/pre&gt;
 *
 * Evaluating on Tempeval2
 * &lt;pre&gt;
 * -in.type TEMPEVAL2
 * -i &amp;lt;directory with english data&amp;gt;
 * -o &amp;lt;output directory&amp;gt;
 * -eval &amp;lt;evaluation script&amp;gt;
 * -tempeval2.dct dct file (with document creation times)
 *
 * TEMPEVAL2 (download from http://timeml.org/site/timebank/timebank.html)
 * Evaluation is token based.
 *
 * TRAINING (english):
 *
 * GUTIME:
 * precision   0.88
 * recall      0.71
 * f1-measure  0.79
 * accuracy    0.98
 * attribute type       0.92
 * attribute value      0.31   // LOW SCORE here is due to difference in format (no -,: in date)
 *
 * After fixing some formats for GUTIME:
 *   (GUTIME syntax is inconsistent at times (1991W 8WE, 19980212EV)
 * attribute value      0.67
 *
 * SUTIME:
 * Default: sutime.teRelHeurLevel=NONE, restrictToTimex3=false
 * precision   0.873
 * recall      0.897
 * f1-measure  0.885
 * accuracy    0.991
 *
 *                                P      R    F1
 * attribute type       0.918 | 0.751 0.802 0.776
 * attribute value      0.762 | 0.623 0.665 0.644
 *
 *                                        P      R    F1
 * mention attribute type       0.900 | 0.780 0.833 0.805
 * mention attribute value      0.742 | 0.643 0.687 0.664
 *
 * sutime.teRelHeurLevel=MORE, restrictToTimex3=true
 * precision   0.876
 * recall      0.889
 * f1-measure  0.882
 * accuracy    0.991
 *                                P      R    F1
 * attribute type       0.918 | 0.744 0.798 0.770
 * attribute value      0.776 | 0.629 0.675 0.651
 *
 *                                        P      R    F1
 * mention attribute type       0.901 | 0.780 0.836 0.807
 * mention attribute value      0.750 | 0.649 0.696 0.672
 *
 * ------------------------------------------------------------------------------
 * TEST (english):
 *
 * GUTIME:
 * precision   0.89
 * recall      0.79
 * f1-measure  0.84
 * accuracy    0.99
 *
 * attribute type       0.95
 * attribute value      0.68
 *
 * SUTIME:
 * Default: sutime.teRelHeurLevel=NONE, restrictToTimex3=false
 * precision   0.878
 * recall      0.963
 * f1-measure  0.918
 * accuracy    0.996
 *
 *                                P      R    F1
 * attribute type       0.953 | 0.820 0.904 0.860
 * attribute value      0.791 | 0.680 0.750 0.713
 *
 *                                        P      R    F1
 * mention attribute type       0.954 | 0.837 0.923 0.878
 * mention attribute value      0.781 | 0.686 0.756 0.720
 *
 * sutime.teRelHeurLevel=MORE, restrictToTimex3=true
 * precision   0.881
 * recall      0.963
 * f1-measure  0.920
 * accuracy    0.995
 *                                P      R    F1
 * attribute type       0.959 | 0.821 0.910 0.863
 * attribute value      0.818 | 0.699 0.776 0.736
 *
 *                                        P      R    F1
 * mention attribute type       0.961 | 0.844 0.936 0.888
 * mention attribute value      0.803 | 0.705 0.782 0.742
 *
 * &lt;/pre&gt;
 * @author Angel Chang
 */
<span class="nc bnc" id="L151" title="All 2 branches missed.">public class SUTimeMain  {</span>

  /** A logger for this class */
<span class="nc" id="L154">  private static final Redwood.RedwoodChannels log = Redwood.channels(SUTimeMain.class);</span>
<span class="nc" id="L155">  protected static String PYTHON = null;</span>


<span class="nc" id="L158">  private SUTimeMain() {} // static class</span>


  /*
   * Other Time corpora: (see also http://timeml.org/site/timebank/timebank.html)
   * LDC2006T08 TimeBank 1.2 (Uses TIMEX3)
   * LDC2005T07 ACE Time Normalization (TERN) 2004 English Training Data v 1.0 (Uses TIMEX2)
   *   GUTime achieved .85, .78, and .82 F-measure for timex2, text, and val fields
   * LDC2010T18 ACE Time Normalization (TERN) 2004 English Evaluation Data V1.0
   */
  ////////////////////////////////////////////////////////////////////////////////////////

<span class="nc" id="L170">  private static class EvalStats {</span>
<span class="nc" id="L171">    PrecisionRecallStats prStats = new PrecisionRecallStats();</span>
//    PrecisionRecallStats tokenPrStats = new PrecisionRecallStats();
<span class="nc" id="L173">    PrecisionRecallStats valPrStats = new PrecisionRecallStats();</span>
<span class="nc" id="L174">    PrecisionRecallStats estPrStats = new PrecisionRecallStats();</span>
  }

  private static class TimebankTimex {
    String timexId;
    String timexVal;
    String timexOrigVal;
    String timexStr;
    int tid;

<span class="nc" id="L184">    private TimebankTimex(String timexId, String timexVal, String timexOrigVal, String timexStr) {</span>
<span class="nc" id="L185">      this.timexId = timexId;</span>
<span class="nc" id="L186">      this.timexVal = timexVal;</span>
<span class="nc" id="L187">      this.timexOrigVal = timexOrigVal;</span>
<span class="nc" id="L188">      this.timexStr = timexStr;</span>
<span class="nc bnc" id="L189" title="All 4 branches missed.">      if (timexId != null &amp;&amp; timexId.length() &gt; 0) {</span>
<span class="nc" id="L190">        tid = Integer.parseInt(timexId);</span>
      }
<span class="nc" id="L192">    }</span>
  }

<span class="nc" id="L195">  private static class TimebankSent {</span>
<span class="nc" id="L196">    boolean initialized = false;</span>
    String docId;
    @SuppressWarnings(&quot;unused&quot;)
    String docFilename;
    String docPubDate;
    String sentId;
    String text;
<span class="nc" id="L203">    List&lt;TimebankTimex&gt; timexes = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L205">    List&lt;String&gt; origItems = new ArrayList&lt;&gt;();</span>

    public boolean add(String item) {
<span class="nc" id="L208">      String[] fields = item.split(&quot;\\s*\\|\\s*&quot;, 9);</span>
<span class="nc" id="L209">      String docId = fields[0];</span>
<span class="nc" id="L210">      String docFilename = fields[1];</span>
<span class="nc" id="L211">      String docPubDate = fields[2];</span>
<span class="nc" id="L212">      String sentId = fields[3];</span>
<span class="nc" id="L213">      String sent = fields[8];</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">      if (initialized) {</span>
        // check compatibility;
<span class="nc bnc" id="L216" title="All 4 branches missed.">        if (!docId.equals(this.docId) || !sentId.equals(this.sentId)) {</span>
<span class="nc" id="L217">          return false;</span>
        }
      } else {
<span class="nc" id="L220">        this.docId = docId;</span>
<span class="nc" id="L221">        this.docFilename = docFilename;</span>
<span class="nc" id="L222">        this.docPubDate = docPubDate;</span>
<span class="nc" id="L223">        this.sentId = sentId;</span>
<span class="nc" id="L224">        this.text = sent;</span>
<span class="nc" id="L225">        initialized = true;</span>
      }

<span class="nc" id="L228">      origItems.add(item);</span>
<span class="nc" id="L229">      String timexId = fields[4];</span>
<span class="nc" id="L230">      String timexVal = fields[5];</span>
<span class="nc" id="L231">      String timexOrigVal = fields[6];</span>
<span class="nc" id="L232">      String timexStr = fields[7];</span>
<span class="nc bnc" id="L233" title="All 4 branches missed.">      if (timexId != null &amp;&amp; timexId.length() &gt; 0) {</span>
<span class="nc" id="L234">        timexes.add(new TimebankTimex(timexId, timexVal, timexOrigVal, timexStr));</span>
      }
<span class="nc" id="L236">      return true;</span>
    }


  }

//Overall: PrecisionRecallStats[tp=877,fp=199,fn=386,p=0.82  (877/1076),r=0.69  (877/1263),f1=0.75]
//Value: PrecisionRecallStats[tp=229,fp=199,fn=1034,p=0.54  (229/428),r=0.18  (229/1263),f1=0.27]

  // Process one item from timebank CSV file
  private static void processTimebankCsvSent(AnnotationPipeline pipeline, TimebankSent sent, PrintWriter pw, EvalStats evalStats)
  {
<span class="nc bnc" id="L248" title="All 2 branches missed.">    if (sent != null) {</span>
<span class="nc" id="L249">      Collections.sort(sent.timexes, (o1, o2) -&gt; {</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">        if (o1.tid == o2.tid) { return 0; }</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">        else return (o1.tid &lt; o2.tid)? -1:1;</span>
      });
<span class="nc" id="L253">      pw.println();</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">      for (String item:sent.origItems) {</span>
<span class="nc" id="L255">        pw.println(&quot;PROC |&quot; + item);</span>
<span class="nc" id="L256">      }</span>
<span class="nc" id="L257">      Annotation annotation = new Annotation(sent.text);</span>
<span class="nc" id="L258">      annotation.set(CoreAnnotations.DocDateAnnotation.class, sent.docPubDate);</span>
<span class="nc" id="L259">      pipeline.annotate(annotation);</span>

<span class="nc" id="L261">      List&lt;CoreMap&gt; timexes = annotation.get(TimeAnnotations.TimexAnnotations.class);</span>
<span class="nc" id="L262">      int i = 0;</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">      for (CoreMap t:timexes) {</span>
        String[] newFields;
<span class="nc bnc" id="L265" title="All 2 branches missed.">        if (sent.timexes.size() &gt; i) {</span>
          String res;
<span class="nc" id="L267">          TimebankTimex goldTimex = sent.timexes.get(i);</span>
<span class="nc" id="L268">          Timex guessTimex = t.get(TimeAnnotations.TimexAnnotation.class);</span>
<span class="nc" id="L269">          String s1 = goldTimex.timexStr.replaceAll(&quot;\\s+&quot;, &quot;&quot;);</span>
<span class="nc" id="L270">          String s2 = guessTimex.text().replaceAll(&quot;\\s+&quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">          if (s1.equals(s2)) {</span>
<span class="nc" id="L272">            evalStats.estPrStats.incrementTP();</span>
<span class="nc" id="L273">            res = &quot;OK&quot;;</span>
          } else {
<span class="nc" id="L275">            evalStats.estPrStats.incrementFP();</span>
<span class="nc" id="L276">            evalStats.estPrStats.incrementFN();</span>
<span class="nc" id="L277">            res = &quot;BAD&quot;;</span>
          }
<span class="nc" id="L279">          newFields = new String[] { res, goldTimex.timexId, goldTimex.timexVal, goldTimex.timexOrigVal, goldTimex.timexStr,</span>
<span class="nc" id="L280">                  t.get(TimeAnnotations.TimexAnnotation.class).toString() };</span>
<span class="nc" id="L281">          i++;</span>
<span class="nc" id="L282">        } else {</span>
<span class="nc" id="L283">          newFields = new String[] { &quot;NONE&quot; , t.get(TimeAnnotations.TimexAnnotation.class).toString()};</span>
<span class="nc" id="L284">          evalStats.estPrStats.incrementFP();</span>
        }
<span class="nc" id="L286">        pw.println(&quot;GOT | &quot;+ StringUtils.join(newFields, &quot;|&quot;));</span>
<span class="nc" id="L287">      }</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">      for (; i &lt; sent.timexes.size(); i++) {</span>
<span class="nc" id="L289">        evalStats.estPrStats.incrementFN();</span>
      }

<span class="nc" id="L292">      i = 0;</span>
<span class="nc" id="L293">      int lastIndex = 0;</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">      for (TimebankTimex goldTimex:sent.timexes) {</span>
<span class="nc" id="L295">          int index = sent.text.indexOf(goldTimex.timexStr, lastIndex);</span>
<span class="nc" id="L296">          int endIndex = index + goldTimex.timexStr.length();</span>
<span class="nc" id="L297">          boolean found = false;</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">          for (; i &lt; timexes.size(); i++) {</span>
<span class="nc" id="L299">            CoreMap t = timexes.get(i);</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">            if (t.get(CoreAnnotations.CharacterOffsetBeginAnnotation.class) &gt;= endIndex) {</span>
<span class="nc" id="L301">              break;</span>
            } else {
<span class="nc bnc" id="L303" title="All 2 branches missed.">              if (t.get(CoreAnnotations.CharacterOffsetBeginAnnotation.class) &gt;= index) {</span>
<span class="nc" id="L304">                found = true;</span>
<span class="nc" id="L305">                evalStats.prStats.incrementTP();</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">                if (goldTimex.timexOrigVal.equals(t.get(TimeAnnotations.TimexAnnotation.class).value())) {</span>
<span class="nc" id="L307">                  evalStats.valPrStats.incrementTP();</span>
                } else {
<span class="nc" id="L309">                  evalStats.valPrStats.incrementFN();</span>
                }
              } else {
<span class="nc" id="L312">                evalStats.prStats.incrementFP();</span>
<span class="nc" id="L313">                evalStats.valPrStats.incrementFP();</span>
              }
            }
          }
<span class="nc bnc" id="L317" title="All 2 branches missed.">          if (!found)  {</span>
<span class="nc" id="L318">            evalStats.prStats.incrementFN();</span>
<span class="nc" id="L319">            evalStats.valPrStats.incrementFN();</span>
          }
<span class="nc" id="L321">          lastIndex = endIndex;</span>
<span class="nc" id="L322">      }</span>

<span class="nc bnc" id="L324" title="All 2 branches missed.">      for (; i &lt; timexes.size(); i++) {</span>
<span class="nc" id="L325">        evalStats.prStats.incrementFP();</span>
<span class="nc" id="L326">        evalStats.valPrStats.incrementFP();</span>
      }
    }
<span class="nc" id="L329">  }</span>



  // Process CSV file with just timebank sentences with time expressions
  public static void processTimebankCsv(AnnotationPipeline pipeline, String in, String out, String eval) throws IOException {
<span class="nc" id="L335">    BufferedReader br = IOUtils.getBufferedFileReader(in);</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">    PrintWriter pw = (out != null)? IOUtils.getPrintWriter(out):new PrintWriter(System.out);</span>
    String line;
//    boolean dataStarted = false;
<span class="nc" id="L339">    boolean dataStarted = true;</span>
<span class="nc" id="L340">    TimebankSent sent = new TimebankSent();</span>
<span class="nc" id="L341">    String item = null;</span>
<span class="nc" id="L342">    EvalStats evalStats = new EvalStats();</span>
<span class="nc" id="L343">    line = br.readLine(); // Skip first line</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">    while ((line = br.readLine()) != null) {</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">      if (line.trim().length() == 0) continue;</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">      if (dataStarted) {</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">        if (line.contains(&quot;|&quot;)) {</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">          if (item != null) {</span>
<span class="nc" id="L349">            boolean addOld = sent.add(item);</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">            if (!addOld) {</span>
<span class="nc" id="L351">              processTimebankCsvSent(pipeline, sent, pw, evalStats);</span>
<span class="nc" id="L352">              sent = new TimebankSent();</span>
<span class="nc" id="L353">              sent.add(item);</span>
            }
          }
<span class="nc" id="L356">          item = line;</span>
        } else {
<span class="nc" id="L358">          item += &quot; &quot; + line;</span>
        }
      } else {
<span class="nc bnc" id="L361" title="All 2 branches missed.">        if (line.matches(&quot;#+ BEGIN DATA #+&quot;)) {</span>
<span class="nc" id="L362">          dataStarted = true;</span>
        }
      }
    }
<span class="nc bnc" id="L366" title="All 2 branches missed.">    if (item != null) {</span>
<span class="nc" id="L367">      boolean addOld = sent.add(item);</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">      if (!addOld) {</span>
<span class="nc" id="L369">        processTimebankCsvSent(pipeline, sent, pw, evalStats);</span>
<span class="nc" id="L370">        sent = new TimebankSent();</span>
<span class="nc" id="L371">        sent.add(item);</span>
      }
<span class="nc" id="L373">      processTimebankCsvSent(pipeline, sent, pw, evalStats);</span>
    }
<span class="nc" id="L375">    br.close();</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">    if (out != null) { pw.close(); }</span>
<span class="nc" id="L377">    System.out.println(&quot;Estimate: &quot; + evalStats.estPrStats.toString(2));</span>
<span class="nc" id="L378">    System.out.println(&quot;Overall: &quot; + evalStats.prStats.toString(2));</span>
<span class="nc" id="L379">    System.out.println(&quot;Value: &quot; + evalStats.valPrStats.toString(2));</span>
<span class="nc" id="L380">  }</span>

  private static String joinWordTags(List&lt;? extends CoreMap&gt; l, String glue, int start, int end) {
<span class="nc" id="L383">    return StringUtils.join(l, glue, in -&gt; in.get(CoreAnnotations.TextAnnotation.class) + '/' + in.get(CoreAnnotations.PartOfSpeechAnnotation.class), start, end);</span>
  }

  private static void processTempEval2Doc(AnnotationPipeline pipeline, Annotation docAnnotation,
                                          Map&lt;String, List&lt;TimexAttributes&gt;&gt; timexMap,
                                          PrintWriter extPw, PrintWriter attrPw, PrintWriter debugPw,
                                          PrintWriter attrDebugPwGold, PrintWriter attrDebugPw) {
<span class="nc" id="L390">    pipeline.annotate(docAnnotation);</span>
<span class="nc" id="L391">    String docId = docAnnotation.get(CoreAnnotations.DocIDAnnotation.class);</span>
<span class="nc" id="L392">    String docDate = docAnnotation.get(CoreAnnotations.DocDateAnnotation.class);</span>
<span class="nc" id="L393">    List&lt;CoreMap&gt; sents = docAnnotation.get(CoreAnnotations.SentencesAnnotation.class);</span>

<span class="nc bnc" id="L395" title="All 2 branches missed.">    if (timexMap != null) {</span>
<span class="nc" id="L396">      List&lt;TimexAttributes&gt; golds = updateTimexText(timexMap, docAnnotation);</span>
<span class="nc bnc" id="L397" title="All 4 branches missed.">      if (attrDebugPwGold != null &amp;&amp; golds != null) {</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">        for (TimexAttributes g:golds) {</span>
<span class="nc" id="L399">          String[] newFields = { docId, docDate,</span>
<span class="nc" id="L400">                  String.valueOf(g.sentIndex),</span>
<span class="nc" id="L401">                  String.valueOf(g.tokenStart),</span>
<span class="nc" id="L402">                  String.valueOf(g.tokenEnd),</span>
                  /*g.tid, */ g.type, g.value, g.text, g.context };
<span class="nc" id="L404">          attrDebugPwGold.println(StringUtils.join(newFields, &quot;\t&quot;));</span>
<span class="nc" id="L405">        }</span>
      }
    }
<span class="nc bnc" id="L408" title="All 2 branches missed.">    if (attrDebugPw != null) {</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">      for (CoreMap sent:sents) {</span>
<span class="nc" id="L410">        List&lt;CoreMap&gt; timexes = sent.get(TimeAnnotations.TimexAnnotations.class);</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">        if (timexes != null) {</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">          for (CoreMap t:timexes) {</span>
<span class="nc" id="L413">            Timex timex = t.get(TimeAnnotations.TimexAnnotation.class);</span>
<span class="nc" id="L414">            int sentIndex = sent.get(CoreAnnotations.SentenceIndexAnnotation.class);</span>
<span class="nc" id="L415">            int sentTokenStart = sent.get(CoreAnnotations.TokenBeginAnnotation.class);</span>
            int tokenStart;
            int tokenEnd;
<span class="nc bnc" id="L418" title="All 2 branches missed.">            if (t.containsKey(CoreAnnotations.TokenBeginAnnotation.class)) {</span>
<span class="nc" id="L419">              tokenStart = t.get(CoreAnnotations.TokenBeginAnnotation.class) - sentTokenStart;</span>
<span class="nc" id="L420">              tokenEnd = t.get(CoreAnnotations.TokenEndAnnotation.class) - sentTokenStart;</span>
            } else {
<span class="nc" id="L422">              CoreMap cm = ChunkAnnotationUtils.getAnnotatedChunkUsingCharOffsets(docAnnotation,</span>
<span class="nc" id="L423">                      t.get(CoreAnnotations.CharacterOffsetBeginAnnotation.class),</span>
<span class="nc" id="L424">                      t.get(CoreAnnotations.CharacterOffsetEndAnnotation.class));</span>
<span class="nc" id="L425">              tokenStart = cm.get(CoreAnnotations.TokenBeginAnnotation.class) - sentTokenStart;</span>
<span class="nc" id="L426">              tokenEnd = cm.get(CoreAnnotations.TokenEndAnnotation.class) - sentTokenStart;</span>
            }
<span class="nc" id="L428">            String context = joinWordTags(sent.get(CoreAnnotations.TokensAnnotation.class), &quot; &quot;, tokenStart-3, tokenEnd+3);</span>
<span class="nc" id="L429">            String[] newFields = { docId, docDate,</span>
<span class="nc" id="L430">                String.valueOf(sentIndex),</span>
<span class="nc" id="L431">                String.valueOf(tokenStart), String.valueOf(tokenEnd),</span>
<span class="nc" id="L432">                /*timex.tid(), */ timex.timexType(), timex.value(), timex.text(), context};</span>
<span class="nc" id="L433">            attrDebugPw.println(StringUtils.join(newFields, &quot;\t&quot;));</span>
<span class="nc" id="L434">          }</span>
        }
<span class="nc" id="L436">      }</span>
    }
<span class="nc bnc" id="L438" title="All 2 branches missed.">    if (debugPw != null) {</span>
<span class="nc" id="L439">      List&lt;CoreMap&gt; timexes = docAnnotation.get(TimeAnnotations.TimexAnnotations.class);</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">      for (CoreMap t:timexes) {</span>
<span class="nc" id="L441">        String[] newFields = { docId, docDate, t.get(TimeAnnotations.TimexAnnotation.class).toString() };</span>
<span class="nc" id="L442">        debugPw.println(&quot;GOT | &quot;+ StringUtils.join(newFields, &quot;|&quot;));</span>
<span class="nc" id="L443">      }</span>
    }
<span class="nc bnc" id="L445" title="All 4 branches missed.">    if (extPw != null || attrPw != null) {</span>
<span class="nc bnc" id="L446" title="All 2 branches missed.">     for (CoreMap sent:sents) {</span>
<span class="nc" id="L447">      int sentTokenBegin = sent.get(CoreAnnotations.TokenBeginAnnotation.class);</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">      for (CoreMap t:sent.get(TimeAnnotations.TimexAnnotations.class)) {</span>
<span class="nc" id="L449">        Timex tmx = t.get(TimeAnnotations.TimexAnnotation.class);</span>
<span class="nc" id="L450">        List&lt;CoreLabel&gt; tokens = t.get(CoreAnnotations.TokensAnnotation.class);</span>
<span class="nc" id="L451">        int tokenIndex = 0;</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">        if (tokens == null) {</span>
<span class="nc" id="L453">          CoreMap cm = ChunkAnnotationUtils.getAnnotatedChunkUsingCharOffsets(docAnnotation,</span>
<span class="nc" id="L454">                  t.get(CoreAnnotations.CharacterOffsetBeginAnnotation.class),</span>
<span class="nc" id="L455">                  t.get(CoreAnnotations.CharacterOffsetEndAnnotation.class));</span>
<span class="nc" id="L456">          tokens = cm.get(CoreAnnotations.TokensAnnotation.class);</span>
<span class="nc" id="L457">          tokenIndex = cm.get(CoreAnnotations.TokenBeginAnnotation.class);</span>
<span class="nc" id="L458">        } else {</span>
<span class="nc" id="L459">          tokenIndex = t.get(CoreAnnotations.TokenBeginAnnotation.class);</span>
        }
<span class="nc" id="L461">        tokenIndex = tokenIndex - sentTokenBegin;</span>
<span class="nc" id="L462">        String sentenceIndex = String.valueOf(sent.get(CoreAnnotations.SentenceIndexAnnotation.class));</span>
<span class="nc" id="L463">        int tokenCount = 0;</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">        for (@SuppressWarnings(&quot;unused&quot;) CoreLabel token:tokens) {</span>
<span class="nc" id="L465">          String[] extFields = {</span>
                  docId,
                  sentenceIndex,
<span class="nc" id="L468">                  String.valueOf(tokenIndex),</span>
                  &quot;timex3&quot;,
<span class="nc" id="L470">                  tmx.tid(),</span>
                  &quot;1&quot;};
<span class="nc" id="L472">          String extString = StringUtils.join(extFields, &quot;\t&quot;);</span>
<span class="nc bnc" id="L473" title="All 2 branches missed.">          if (extPw != null) extPw.println(extString);</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">          if (attrPw != null /* &amp;&amp; tokenCount == 0 */) {</span>
<span class="nc" id="L475">            String[] attrFields = {</span>
                  &quot;type&quot;,
<span class="nc" id="L477">                  tmx.timexType(),</span>
            };
<span class="nc" id="L479">            attrPw.println(extString + &quot;\t&quot; + StringUtils.join(attrFields, &quot;\t&quot;));</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">            if (tmx.value() != null) {</span>
<span class="nc" id="L481">              String val = tmx.value();</span>
              // Fix up expression values (needed for GUTime)
<span class="nc bnc" id="L483" title="All 2 branches missed.">              if (useGUTime) {</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">                if (&quot;TIME&quot;.equals(tmx.timexType())) {</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">                  if (val.matches(&quot;T\\d{4}&quot;)) {</span>
<span class="nc" id="L486">                    val = &quot;T&quot; + val.substring(1,3) + &quot;:&quot; + val.substring(3,5);</span>
                  }
<span class="nc bnc" id="L488" title="All 2 branches missed.">                } else if (&quot;DATE&quot;.equals(tmx.timexType())) {</span>
<span class="nc bnc" id="L489" title="All 2 branches missed.">                  if (val.matches(&quot;\\d{8}T.*&quot;)) {</span>
<span class="nc" id="L490">                    val = val.substring(0,4) + &quot;-&quot; + val.substring(4,6) + &quot;-&quot; + val.substring(6);</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">                  } else if (val.matches(&quot;\\d{8}&quot;)) {</span>
<span class="nc" id="L492">                    val = val.substring(0,4) + &quot;-&quot; + val.substring(4,6) + &quot;-&quot; + val.substring(6,8);</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">                  } else if (val.matches(&quot;\\d\\d\\d\\d..&quot;)) {</span>
<span class="nc" id="L494">                    val = val.substring(0,4) + &quot;-&quot; + val.substring(4,6);</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">                  } else if (val.matches(&quot;[0-9X]{4}W[0-9X]{2}.*&quot;)) {</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">                    if (val.length() &gt; 7) {</span>
<span class="nc" id="L497">                      val = val.substring(0,4) + &quot;-&quot; + val.substring(4,7) + &quot;-&quot; + val.substring(7);</span>
                    } else {
<span class="nc" id="L499">                      val = val.substring(0,4) + &quot;-&quot; + val.substring(4,7);</span>
                    }
                  }
                }
              } /*else {
                // SUTIME
                if (&quot;DATE&quot;.equals(tmx.timexType())) {
                  if (val.matches(&quot;\\d\\d\\dX&quot;)) {
                    val = val.substring(0,3);  // Convert 199X to 199
                  }
                }
              }   */
<span class="nc" id="L511">              attrFields[0] = &quot;value&quot;;</span>
<span class="nc" id="L512">              attrFields[1] = val;</span>

<span class="nc" id="L514">              attrPw.println(extString + &quot;\t&quot; + StringUtils.join(attrFields, &quot;\t&quot;));</span>
            }
          }
<span class="nc" id="L517">          tokenIndex++;</span>
<span class="nc" id="L518">          tokenCount++;</span>
<span class="nc" id="L519">        }</span>
<span class="nc" id="L520">      }</span>
<span class="nc" id="L521">     }</span>
    }
<span class="nc" id="L523">  }</span>

<span class="nc" id="L525">  private static CoreLabelTokenFactory tokenFactory = new CoreLabelTokenFactory();</span>

  private static CoreMap wordsToSentence(List&lt;String&gt; sentWords) {
<span class="nc" id="L528">    String sentText = StringUtils.join(sentWords, &quot; &quot;);</span>
<span class="nc" id="L529">    Annotation sentence = new Annotation(sentText);</span>
<span class="nc" id="L530">    List&lt;CoreLabel&gt; tokens = new ArrayList&lt;&gt;(sentWords.size());</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">    for (String text:sentWords) {</span>
<span class="nc" id="L532">      CoreLabel token = tokenFactory.makeToken();</span>
<span class="nc" id="L533">      token.set(CoreAnnotations.TextAnnotation.class, text);</span>
<span class="nc" id="L534">      tokens.add(token);</span>
<span class="nc" id="L535">    }</span>
<span class="nc" id="L536">    sentence.set(CoreAnnotations.TokensAnnotation.class, tokens);</span>
<span class="nc" id="L537">    return sentence;</span>
  }

  public static Annotation sentencesToDocument(String documentID, String docDate, List&lt;CoreMap&gt; sentences) {
<span class="nc" id="L541">    String docText = ChunkAnnotationUtils.getTokenText(sentences, CoreAnnotations.TextAnnotation.class);</span>
<span class="nc" id="L542">    Annotation document = new Annotation(docText);</span>
<span class="nc" id="L543">    document.set(CoreAnnotations.DocIDAnnotation.class, documentID);</span>
<span class="nc" id="L544">    document.set(CoreAnnotations.DocDateAnnotation.class, docDate);</span>
<span class="nc" id="L545">    document.set(CoreAnnotations.SentencesAnnotation.class, sentences);</span>

    // Accumulate docTokens and label sentence with overall token begin/end, and sentence index annotations
<span class="nc" id="L548">    List&lt;CoreLabel&gt; docTokens = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L549">    int sentenceIndex = 0;</span>
<span class="nc" id="L550">    int tokenBegin = 0;</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">    for (CoreMap sentenceAnnotation:sentences) {</span>
<span class="nc" id="L552">      List&lt;CoreLabel&gt; sentenceTokens = sentenceAnnotation.get(CoreAnnotations.TokensAnnotation.class);</span>
<span class="nc" id="L553">      docTokens.addAll(sentenceTokens);</span>

<span class="nc" id="L555">      int tokenEnd = tokenBegin + sentenceTokens.size();</span>
<span class="nc" id="L556">      sentenceAnnotation.set(CoreAnnotations.TokenBeginAnnotation.class, tokenBegin);</span>
<span class="nc" id="L557">      sentenceAnnotation.set(CoreAnnotations.TokenEndAnnotation.class, tokenEnd);</span>
<span class="nc" id="L558">      sentenceAnnotation.set(CoreAnnotations.SentenceIndexAnnotation.class, sentenceIndex);</span>
<span class="nc" id="L559">      sentenceIndex++;</span>
<span class="nc" id="L560">      tokenBegin = tokenEnd;</span>
<span class="nc" id="L561">    }</span>
<span class="nc" id="L562">    document.set(CoreAnnotations.TokensAnnotation.class, docTokens);</span>

    // Put in character offsets
<span class="nc" id="L565">    int i = 0;</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">    for (CoreLabel token:docTokens) {</span>
<span class="nc" id="L567">      String tokenText = token.get(CoreAnnotations.TextAnnotation.class);</span>
<span class="nc" id="L568">      token.set(CoreAnnotations.CharacterOffsetBeginAnnotation.class, i);</span>
<span class="nc" id="L569">      i+=tokenText.length();</span>
<span class="nc" id="L570">      token.set(CoreAnnotations.CharacterOffsetEndAnnotation.class, i);</span>
<span class="nc" id="L571">      i++; // Skip space</span>
<span class="nc" id="L572">    }</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">    for (CoreMap sentenceAnnotation:sentences) {</span>
<span class="nc" id="L574">      List&lt;CoreLabel&gt; sentenceTokens = sentenceAnnotation.get(CoreAnnotations.TokensAnnotation.class);</span>
<span class="nc" id="L575">      sentenceAnnotation.set(CoreAnnotations.CharacterOffsetBeginAnnotation.class,</span>
<span class="nc" id="L576">              sentenceTokens.get(0).get(CoreAnnotations.CharacterOffsetBeginAnnotation.class));</span>
<span class="nc" id="L577">      sentenceAnnotation.set(CoreAnnotations.CharacterOffsetEndAnnotation.class,</span>
<span class="nc" id="L578">              sentenceTokens.get(sentenceTokens.size()-1).get(CoreAnnotations.CharacterOffsetEndAnnotation.class));</span>
<span class="nc" id="L579">    }</span>

<span class="nc" id="L581">    return document;</span>
  }

  private static class TimexAttributes {
    public String tid;
    public int sentIndex;
    public int tokenStart;
    public int tokenEnd;
    public String text;
    public String type;
    public String value;
    public String context;

<span class="nc" id="L594">    public TimexAttributes(String tid, int sentIndex, int tokenIndex) {</span>
<span class="nc" id="L595">      this.tid = tid;</span>
<span class="nc" id="L596">      this.sentIndex = sentIndex;</span>
<span class="nc" id="L597">      this.tokenStart = tokenIndex;</span>
<span class="nc" id="L598">      this.tokenEnd = tokenIndex + 1;</span>
<span class="nc" id="L599">    }</span>
  }

  private static TimexAttributes findTimex(Map&lt;String,List&lt;TimexAttributes&gt;&gt; timexMap, String docId, String tid) {
    // Find entry
<span class="nc" id="L604">    List&lt;TimexAttributes&gt; list = timexMap.get(docId);</span>
<span class="nc bnc" id="L605" title="All 2 branches missed.">    for (TimexAttributes timex:list) {</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">      if (timex.tid.equals(tid)) {</span>
<span class="nc" id="L607">        return timex;</span>
      }
<span class="nc" id="L609">    }</span>
<span class="nc" id="L610">    return null;</span>
  }

  private static List&lt;TimexAttributes&gt; updateTimexText(Map&lt;String,List&lt;TimexAttributes&gt;&gt; timexMap, Annotation docAnnotation) {
    // Find entry
<span class="nc" id="L615">    String docId = docAnnotation.get(CoreAnnotations.DocIDAnnotation.class);</span>
<span class="nc" id="L616">    List&lt;CoreMap&gt; sents = docAnnotation.get(CoreAnnotations.SentencesAnnotation.class);</span>
<span class="nc" id="L617">    List&lt;TimexAttributes&gt; list = timexMap.get(docId);</span>
<span class="nc bnc" id="L618" title="All 2 branches missed.">    if (list != null) {</span>
<span class="nc bnc" id="L619" title="All 2 branches missed.">      for (TimexAttributes timex:list) {</span>
<span class="nc" id="L620">        CoreMap sent = sents.get(timex.sentIndex);</span>
<span class="nc" id="L621">        List&lt;CoreLabel&gt; tokens = sent.get(CoreAnnotations.TokensAnnotation.class);</span>
<span class="nc" id="L622">        timex.text = StringUtils.joinWords(tokens, &quot; &quot;, timex.tokenStart, timex.tokenEnd);</span>
<span class="nc" id="L623">        timex.context = joinWordTags(tokens, &quot; &quot;, timex.tokenStart - 3, timex.tokenEnd + 3);</span>

/*        StringBuilder sb = new StringBuilder(&quot;&quot;);
        for (int i = timex.tokenStart; i &lt; timex.tokenEnd; i++) {
          if (sb.length() &gt; 0) { sb.append(&quot; &quot;); }
          sb.append(tokens.get(i).word());
        }
        timex.text = sb.toString();

        // Get context
        sb.setLength(0);
        int c1 = Math.max(0, timex.tokenStart - 3);
        int c2 = Math.min(tokens.size(), timex.tokenEnd + 3);
        for (int i = c1; i &lt; c2; i++) {
          if (sb.length() &gt; 0) { sb.append(&quot; &quot;); }
          sb.append(tokens.get(i).word());
        }
        timex.context = sb.toString();             */

<span class="nc" id="L642">      }</span>
<span class="nc" id="L643">      return list;</span>
    }
<span class="nc" id="L645">    return null;</span>
  }

  private static Map&lt;String,List&lt;TimexAttributes&gt;&gt; readTimexAttrExts(String extentsFile, String attrsFile) throws IOException {
<span class="nc" id="L649">    Map&lt;String,List&lt;TimexAttributes&gt;&gt; timexMap = Generics.newHashMap();</span>
<span class="nc" id="L650">    BufferedReader extBr = IOUtils.getBufferedFileReader(extentsFile);</span>
    String line;
<span class="nc" id="L652">    String lastDocId = null;</span>
<span class="nc" id="L653">    TimexAttributes lastTimex = null;</span>
<span class="nc bnc" id="L654" title="All 2 branches missed.">    while ((line = extBr.readLine()) != null) {</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">      if (line.trim().isEmpty()) continue;</span>
      // Simple tab delimited file
<span class="nc" id="L657">      String[] fields = line.split(&quot;\t&quot;);</span>
<span class="nc" id="L658">      String docName = fields[0];</span>
<span class="nc" id="L659">      int sentNo = Integer.parseInt(fields[1]);</span>
<span class="nc" id="L660">      int tokenNo = Integer.parseInt(fields[2]);</span>
<span class="nc" id="L661">      String tid = fields[4];</span>

<span class="nc bnc" id="L663" title="All 8 branches missed.">      if (lastDocId != null &amp;&amp; lastDocId.equals(docName) &amp;&amp; lastTimex != null &amp;&amp; lastTimex.tid.equals(tid)) {</span>
        // Expand previous
<span class="nc bnc" id="L665" title="All 4 branches missed.">        assert(lastTimex.sentIndex == sentNo);</span>
<span class="nc" id="L666">        lastTimex.tokenEnd = tokenNo + 1;</span>
      } else {
<span class="nc" id="L668">        lastDocId = docName;</span>
<span class="nc" id="L669">        lastTimex = new TimexAttributes(tid, sentNo, tokenNo);</span>
<span class="nc" id="L670">        List&lt;TimexAttributes&gt; list = timexMap.get(docName);</span>
<span class="nc bnc" id="L671" title="All 2 branches missed.">        if (list == null) {</span>
<span class="nc" id="L672">          timexMap.put(docName, list = new ArrayList&lt;&gt;());</span>
        }
<span class="nc" id="L674">        list.add(lastTimex);</span>
      }
<span class="nc" id="L676">    }</span>
<span class="nc" id="L677">    extBr.close();</span>

<span class="nc" id="L679">    BufferedReader attrBr = IOUtils.getBufferedFileReader(attrsFile);</span>
<span class="nc bnc" id="L680" title="All 2 branches missed.">    while ((line = attrBr.readLine()) != null) {</span>
<span class="nc bnc" id="L681" title="All 2 branches missed.">      if (line.trim().length() == 0) continue;</span>
      // Simple tab delimited file
<span class="nc" id="L683">      String[] fields = line.split(&quot;\t&quot;);</span>
<span class="nc" id="L684">      String docName = fields[0];</span>
<span class="nc" id="L685">      int sentNo = Integer.parseInt(fields[1]);</span>
<span class="nc" id="L686">      int tokenNo = Integer.parseInt(fields[2]);</span>
<span class="nc" id="L687">      String tid = fields[4];</span>
<span class="nc" id="L688">      String attrname = fields[6];</span>
<span class="nc" id="L689">      String attrvalue = fields[7];</span>

      // Find entry
<span class="nc" id="L692">      TimexAttributes timex = findTimex(timexMap, docName, tid);</span>
<span class="nc bnc" id="L693" title="All 4 branches missed.">      assert(timex.sentIndex == sentNo);</span>
<span class="nc bnc" id="L694" title="All 6 branches missed.">      assert(timex.tokenStart &lt;= tokenNo &amp;&amp; timex.tokenEnd &gt; tokenNo);</span>

<span class="nc bnc" id="L696" title="All 10 branches missed.">      switch (attrname) {</span>
        case &quot;type&quot;:
<span class="nc bnc" id="L698" title="All 6 branches missed.">          assert (timex.type == null || timex.type.equals(attrvalue));</span>
<span class="nc" id="L699">          timex.type = attrvalue;</span>
<span class="nc" id="L700">          break;</span>
        case &quot;value&quot;:
<span class="nc bnc" id="L702" title="All 6 branches missed.">          assert (timex.value == null || timex.value.equals(attrvalue));</span>
<span class="nc" id="L703">          timex.value = attrvalue;</span>
<span class="nc" id="L704">          break;</span>
        default:
<span class="nc" id="L706">          throw new RuntimeException(&quot;Error processing &quot; + attrsFile + &quot;:&quot; +</span>
              &quot;Unknown attribute &quot; + attrname + &quot;: from line &quot; + line);
      }
<span class="nc" id="L709">    }</span>
<span class="nc" id="L710">    attrBr.close();</span>
<span class="nc" id="L711">    return timexMap;</span>
  }

  public static void processTempEval2Tab(AnnotationPipeline pipeline, String in, String out, Map&lt;String,String&gt; docDates) throws IOException
  {
<span class="nc" id="L716">    Map&lt;String,List&lt;TimexAttributes&gt;&gt; timexMap = readTimexAttrExts(in  + &quot;/timex-extents.tab&quot;, in  + &quot;/timex-attributes.tab&quot;);</span>
<span class="nc" id="L717">    BufferedReader br = IOUtils.getBufferedFileReader(in  + &quot;/base-segmentation.tab&quot;);</span>
<span class="nc" id="L718">    PrintWriter debugPw = IOUtils.getPrintWriter(out + &quot;/timex-debug.out&quot;);</span>
<span class="nc" id="L719">    PrintWriter attrPw = IOUtils.getPrintWriter(out + &quot;/timex-attrs.res.tab&quot;);</span>
<span class="nc" id="L720">    PrintWriter extPw = IOUtils.getPrintWriter(out + &quot;/timex-extents.res.tab&quot;);</span>
<span class="nc" id="L721">    PrintWriter attrDebugPwGold = IOUtils.getPrintWriter(out + &quot;/timex-attrs.debug.gold.tab&quot;);</span>
<span class="nc" id="L722">    PrintWriter attrDebugPw = IOUtils.getPrintWriter(out + &quot;/timex-attrs.debug.res.tab&quot;);</span>
    String line;
<span class="nc" id="L724">    String curDocName = null;</span>
<span class="nc" id="L725">    int curSentNo = -1;</span>
<span class="nc" id="L726">    List&lt;String&gt; tokens = null;</span>
<span class="nc" id="L727">    List&lt;CoreMap&gt; sentences = null;</span>
<span class="nc bnc" id="L728" title="All 2 branches missed.">    while ((line = br.readLine()) != null) {</span>
<span class="nc bnc" id="L729" title="All 2 branches missed.">      if (line.trim().length() == 0) continue;</span>
      // Simple tab delimited file
<span class="nc" id="L731">      String[] fields = line.split(&quot;\t&quot;);</span>
<span class="nc" id="L732">      String docName = fields[0];</span>
<span class="nc" id="L733">      int sentNo = Integer.parseInt(fields[1]);</span>
      //int tokenNo = Integer.parseInt(fields[2]);
<span class="nc" id="L735">      String tokenText = fields[3];</span>

      // Create little annotation with sentences and tokens
<span class="nc bnc" id="L738" title="All 2 branches missed.">      if (!docName.equals(curDocName)) {</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">        if (curDocName != null) {</span>
          // Process document
<span class="nc" id="L741">          CoreMap lastSentence = wordsToSentence(tokens);</span>
<span class="nc" id="L742">          sentences.add(lastSentence);</span>
<span class="nc" id="L743">          Annotation docAnnotation = sentencesToDocument(curDocName, docDates.get(curDocName), sentences);</span>
<span class="nc" id="L744">          processTempEval2Doc(pipeline, docAnnotation, timexMap, extPw, attrPw, debugPw, attrDebugPwGold, attrDebugPw);</span>
<span class="nc" id="L745">          curDocName = null;</span>
        }
        // New doc
<span class="nc" id="L748">        tokens = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L749">        sentences = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L750" title="All 2 branches missed.">      } else if (curSentNo != sentNo) {</span>
<span class="nc" id="L751">        CoreMap lastSentence = wordsToSentence(tokens);</span>
<span class="nc" id="L752">        sentences.add(lastSentence);</span>
<span class="nc" id="L753">        tokens = new ArrayList&lt;&gt;();</span>
      }
<span class="nc" id="L755">      tokens.add(tokenText);</span>
<span class="nc" id="L756">      curDocName = docName;</span>
<span class="nc" id="L757">      curSentNo = sentNo;</span>
<span class="nc" id="L758">    }</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">    if (curDocName != null) {</span>
      // Process document
<span class="nc" id="L761">      CoreMap lastSentence = wordsToSentence(tokens);</span>
<span class="nc" id="L762">      sentences.add(lastSentence);</span>
<span class="nc" id="L763">      Annotation docAnnotation = sentencesToDocument(curDocName, docDates.get(curDocName), sentences);</span>
<span class="nc" id="L764">      processTempEval2Doc(pipeline, docAnnotation, timexMap, extPw, attrPw, debugPw, attrDebugPwGold, attrDebugPw);</span>
<span class="nc" id="L765">      curDocName = null;</span>
    }
<span class="nc" id="L767">    br.close();</span>
<span class="nc" id="L768">    extPw.close();</span>
<span class="nc" id="L769">    attrPw.close();</span>
<span class="nc" id="L770">    debugPw.close();</span>
<span class="nc" id="L771">    attrDebugPwGold.close();</span>
<span class="nc" id="L772">    attrDebugPw.close();</span>
<span class="nc" id="L773">  }</span>

  public static void processTempEval2(AnnotationPipeline pipeline, String in, String out, String eval, String dct) throws IOException, ParseException
  {
<span class="nc bnc" id="L777" title="All 2 branches missed.">    Map&lt;String,String&gt; docDates = (dct != null)? IOUtils.readMap(dct):IOUtils.readMap(in + &quot;/dct.txt&quot;);</span>
<span class="nc bnc" id="L778" title="All 2 branches missed.">    if (requiredDocDateFormat != null) {</span>
      // convert from yyyyMMdd to requiredDocDateFormat
<span class="nc" id="L780">      DateFormat defaultFormatter = new SimpleDateFormat(&quot;yyyyMMdd&quot;);</span>
<span class="nc" id="L781">      DateFormat requiredFormatter = new SimpleDateFormat(requiredDocDateFormat);</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">      for (Map.Entry&lt;String, String&gt; docDateEntry : docDates.entrySet()) {</span>
<span class="nc" id="L783">        Date date = defaultFormatter.parse(docDateEntry.getValue());</span>
<span class="nc" id="L784">        docDates.put(docDateEntry.getKey(), requiredFormatter.format(date));</span>
<span class="nc" id="L785">      }</span>
    }
<span class="nc" id="L787">    processTempEval2Tab(pipeline, in, out, docDates);</span>
<span class="nc bnc" id="L788" title="All 2 branches missed.">    if (eval != null) {</span>
<span class="nc" id="L789">      List&lt;String&gt; command = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L790" title="All 2 branches missed.">      if (PYTHON != null) {</span>
<span class="nc" id="L791">        command.add(PYTHON);</span>
      }
<span class="nc" id="L793">      command.add(eval);</span>
<span class="nc" id="L794">      command.add(in + &quot;/base-segmentation.tab&quot;);</span>
<span class="nc" id="L795">      command.add(in + &quot;/timex-extents.tab&quot;);</span>
<span class="nc" id="L796">      command.add(out + &quot;/timex-extents.res.tab&quot;);</span>
<span class="nc" id="L797">      command.add(in + &quot;/timex-attributes.tab&quot;);</span>
<span class="nc" id="L798">      command.add(out + &quot;/timex-attrs.res.tab&quot;);</span>
<span class="nc" id="L799">      ProcessBuilder pb = new ProcessBuilder(command);</span>
<span class="nc" id="L800">      FileOutputStream evalFileOutput = new FileOutputStream(out + &quot;/scores.txt&quot;);</span>
<span class="nc" id="L801">      Writer output = new OutputStreamWriter(</span>
              new TeeStream(System.out, evalFileOutput));
<span class="nc" id="L803">      SystemUtils.run(pb, output, null);</span>
<span class="nc" id="L804">      evalFileOutput.close();</span>
    }
<span class="nc" id="L806">  }</span>

  public static void processTempEval3(AnnotationPipeline pipeline, String in, String out, String evalCmd) throws Exception
  {
    // Process files
<span class="nc" id="L811">    File inFile = new File(in);</span>
<span class="nc bnc" id="L812" title="All 2 branches missed.">    if (inFile.isDirectory()) {</span>
      // input is a directory - process files in directory
<span class="nc" id="L814">      Pattern teinputPattern = Pattern.compile(&quot;\\.(TE3input|tml)$&quot;);</span>
<span class="nc" id="L815">      Iterable&lt;File&gt; files = IOUtils.iterFilesRecursive(inFile, teinputPattern);</span>
<span class="nc" id="L816">      File outDir = new File(out);</span>
<span class="nc" id="L817">      outDir.mkdirs();</span>
<span class="nc bnc" id="L818" title="All 2 branches missed.">      for (File file: files) {</span>
<span class="nc" id="L819">        String inputFilename = file.getAbsolutePath();</span>
<span class="nc" id="L820">        String outputFilename = inputFilename.replace(in, out).replace(&quot;.TE3input&quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L821" title="All 2 branches missed.">        if (!outputFilename.equalsIgnoreCase(inputFilename)) {</span>
          //System.out.println(inputFilename + &quot; =&gt; &quot; + outputFilename);
<span class="nc" id="L823">          processTempEval3File(pipeline, inputFilename, outputFilename);</span>
        } else {
<span class="nc" id="L825">          log.info(&quot;ABORTING: Input file and output is the same - &quot; + inputFilename);</span>
<span class="nc" id="L826">          System.exit(-1);</span>
        }
<span class="nc" id="L828">      }</span>
<span class="nc" id="L829">    } else {</span>
      // input is a file - process file
<span class="nc" id="L831">      processTempEval3File(pipeline, in, out);</span>
    }
    // Evaluate
<span class="nc bnc" id="L834" title="All 2 branches missed.">    if (evalCmd != null) {</span>
      // TODO: apply eval command
    }
<span class="nc" id="L837">  }</span>

  public static void processTempEval3File(AnnotationPipeline pipeline, String in, String out) throws Exception {
    // Process one tempeval file
<span class="nc" id="L841">    Document doc = edu.stanford.nlp.util.XMLUtils.readDocumentFromFile(in);</span>
<span class="nc" id="L842">    Node timemlNode = XMLUtils.getNode(doc, &quot;TimeML&quot;);</span>
<span class="nc" id="L843">    Node docIdNode = XMLUtils.getNode(timemlNode, &quot;DOCID&quot;);</span>
<span class="nc" id="L844">    Node dctNode = XMLUtils.getNode(timemlNode, &quot;DCT&quot;);</span>
<span class="nc" id="L845">    Node dctTimexNode = XMLUtils.getNode(dctNode, &quot;TIMEX3&quot;);</span>
<span class="nc" id="L846">    Node titleNode = XMLUtils.getNode(timemlNode, &quot;TITLE&quot;);</span>
<span class="nc" id="L847">    Node extraInfoNode = XMLUtils.getNode(timemlNode, &quot;EXTRA_INFO&quot;);</span>
<span class="nc" id="L848">    Node textNode = XMLUtils.getNode(timemlNode, &quot;TEXT&quot;);</span>
<span class="nc" id="L849">    String date = XMLUtils.getAttributeValue(dctTimexNode, &quot;value&quot;);</span>
<span class="nc" id="L850">    String text = textNode.getTextContent();</span>
<span class="nc" id="L851">    Annotation annotation = textToAnnotation(pipeline, text, date);</span>
<span class="nc" id="L852">    Element annotatedTextElem = annotationToTmlTextElement(annotation);</span>

<span class="nc" id="L854">    Document annotatedDoc = XMLUtils.createDocument();</span>
<span class="nc" id="L855">    Node newTimemlNode = annotatedDoc.importNode(timemlNode, false);</span>
<span class="nc bnc" id="L856" title="All 2 branches missed.">    if(docIdNode != null){</span>
<span class="nc" id="L857">        newTimemlNode.appendChild(annotatedDoc.importNode(docIdNode, true));</span>
    }
<span class="nc" id="L859">    newTimemlNode.appendChild(annotatedDoc.importNode(dctNode, true));</span>
<span class="nc bnc" id="L860" title="All 2 branches missed.">    if (titleNode != null) {</span>
<span class="nc" id="L861">      newTimemlNode.appendChild(annotatedDoc.importNode(titleNode, true));</span>
    }
<span class="nc bnc" id="L863" title="All 2 branches missed.">    if (extraInfoNode != null) {</span>
<span class="nc" id="L864">      newTimemlNode.appendChild(annotatedDoc.importNode(extraInfoNode, true));</span>
    }
<span class="nc" id="L866">    newTimemlNode.appendChild(annotatedDoc.adoptNode(annotatedTextElem));</span>
<span class="nc" id="L867">    annotatedDoc.appendChild(newTimemlNode);</span>

<span class="nc bnc" id="L869" title="All 2 branches missed.">    PrintWriter pw = (out != null)? IOUtils.getPrintWriter(out):new PrintWriter(System.out);</span>
<span class="nc" id="L870">    String string = XMLUtils.documentToString(annotatedDoc);</span>
<span class="nc" id="L871">    pw.println(string);</span>
<span class="nc" id="L872">    pw.flush();</span>
<span class="nc bnc" id="L873" title="All 2 branches missed.">    if (out != null) pw.close();</span>
<span class="nc" id="L874">  }</span>

  private static String requiredDocDateFormat;
<span class="nc" id="L877">  private static boolean useGUTime = false;</span>

  public static AnnotationPipeline getPipeline(Properties props, boolean tokenize) throws Exception {
//    useGUTime = Boolean.parseBoolean(props.getProperty(&quot;gutime&quot;, &quot;false&quot;));
<span class="nc" id="L881">    AnnotationPipeline pipeline = new AnnotationPipeline();</span>
<span class="nc bnc" id="L882" title="All 2 branches missed.">    if (tokenize) {</span>
<span class="nc" id="L883">      pipeline.addAnnotator(new TokenizerAnnotator(false, &quot;en&quot;));</span>
<span class="nc" id="L884">      pipeline.addAnnotator(new WordsToSentencesAnnotator(false));</span>
    }
<span class="nc" id="L886">    pipeline.addAnnotator(new POSTaggerAnnotator(false));</span>
//    pipeline.addAnnotator(new NumberAnnotator(false));
//    pipeline.addAnnotator(new QuantifiableEntityNormalizingAnnotator(false, false));
<span class="nc" id="L889">    String timeAnnotator = props.getProperty(&quot;timeAnnotator&quot;, &quot;sutime&quot;);</span>
<span class="nc bnc" id="L890" title="All 14 branches missed.">    switch (timeAnnotator) {</span>
      case &quot;gutime&quot;:
<span class="nc" id="L892">        useGUTime = true;</span>
<span class="nc" id="L893">        pipeline.addAnnotator(new GUTimeAnnotator(&quot;gutime&quot;, props));</span>
<span class="nc" id="L894">        break;</span>
      case &quot;heideltime&quot;:
<span class="nc" id="L896">        requiredDocDateFormat = &quot;yyyy-MM-dd&quot;;</span>
<span class="nc" id="L897">        pipeline.addAnnotator(new HeidelTimeAnnotator(&quot;heideltime&quot;, props));</span>
<span class="nc" id="L898">        break;</span>
      case &quot;sutime&quot;:
<span class="nc" id="L900">        pipeline.addAnnotator(new TimeAnnotator(&quot;sutime&quot;, props));</span>
<span class="nc" id="L901">        break;</span>
      default:
<span class="nc" id="L903">        throw new IllegalArgumentException(&quot;Unknown timeAnnotator: &quot; + timeAnnotator);</span>
    }
<span class="nc" id="L905">    return pipeline;</span>
  }

<span class="nc" id="L908">  enum InputType { TEXTFILE, TEXT, TIMEBANK_CSV, TEMPEVAL2, TEMPEVAL3 }</span>

  private static void configLogger(String out) throws IOException {
<span class="nc" id="L911">    File outDir = new File(out);</span>
<span class="nc bnc" id="L912" title="All 2 branches missed.">    if (!outDir.exists()) {</span>
<span class="nc" id="L913">      outDir.mkdirs();</span>
    }
<span class="nc" id="L915">    StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L916">    sb.append(&quot;handlers=java.util.logging.ConsoleHandler, java.util.logging.FileHandler\n&quot;);</span>
<span class="nc" id="L917">    sb.append(&quot;.level=SEVERE\n&quot;);</span>
<span class="nc" id="L918">    sb.append(&quot;edu.stanford.nlp.level=INFO\n&quot;);</span>
<span class="nc" id="L919">    sb.append(&quot;java.util.logging.ConsoleHandler.level=SEVERE\n&quot;);</span>
<span class="nc" id="L920">    sb.append(&quot;java.util.logging.FileHandler.formatter=java.util.logging.SimpleFormatter\n&quot;);</span>
<span class="nc" id="L921">    sb.append(&quot;java.util.logging.FileHandler.level=INFO\n&quot;);</span>
<span class="nc" id="L922">    sb.append(&quot;java.util.logging.FileHandler.pattern=&quot; + out + &quot;/err.log&quot; + &quot;\n&quot;);</span>
<span class="nc" id="L923">    LogManager.getLogManager().readConfiguration(new ReaderInputStream(new StringReader(sb.toString())));</span>
<span class="nc" id="L924">  }</span>

  private static List&lt;Node&gt; createTimexNodes(String str, Integer charBeginOffset, List&lt;CoreMap&gt; timexAnns) {
<span class="nc" id="L927">    List&lt;ValuedInterval&lt;CoreMap,Integer&gt;&gt; timexList = new ArrayList&lt;&gt;(timexAnns.size());</span>
<span class="nc bnc" id="L928" title="All 2 branches missed.">    for (CoreMap timexAnn:timexAnns) {</span>
<span class="nc" id="L929">      timexList.add(new ValuedInterval&lt;&gt;(timexAnn,</span>
<span class="nc" id="L930">              MatchedExpression.COREMAP_TO_CHAR_OFFSETS_INTERVAL_FUNC.apply(timexAnn)));</span>
<span class="nc" id="L931">    }</span>
<span class="nc" id="L932">    Collections.sort(timexList, HasInterval.CONTAINS_FIRST_ENDPOINTS_COMPARATOR );</span>
<span class="nc" id="L933">    return createTimexNodesPresorted(str, charBeginOffset, timexList);</span>
  }

  private static List&lt;Node&gt; createTimexNodesPresorted(String str, Integer charBeginOffset, List&lt;ValuedInterval&lt;CoreMap,Integer&gt;&gt; timexList) {
<span class="nc bnc" id="L937" title="All 2 branches missed.">    if (charBeginOffset == null) charBeginOffset = 0;</span>
<span class="nc" id="L938">    List&lt;Node&gt; nodes = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L939">    int previousEnd = 0;</span>
<span class="nc" id="L940">    List&lt;Element&gt; timexElems = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L941">    List&lt;ValuedInterval&lt;CoreMap,Integer&gt;&gt; processed = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L942">    CollectionValuedMap&lt;Integer, ValuedInterval&lt;CoreMap,Integer&gt;&gt; unprocessed =</span>
<span class="nc" id="L943">            new CollectionValuedMap&lt;&gt;(CollectionFactory.&lt;ValuedInterval&lt;CoreMap, Integer&gt;&gt;arrayListFactory());</span>
<span class="nc bnc" id="L944" title="All 2 branches missed.">    for (ValuedInterval&lt;CoreMap,Integer&gt; v:timexList) {</span>
<span class="nc" id="L945">      CoreMap timexAnn = v.getValue();</span>
<span class="nc" id="L946">      int begin = timexAnn.get(CoreAnnotations.CharacterOffsetBeginAnnotation.class) - charBeginOffset;</span>
<span class="nc" id="L947">      int end = timexAnn.get(CoreAnnotations.CharacterOffsetEndAnnotation.class) - charBeginOffset;</span>
<span class="nc bnc" id="L948" title="All 2 branches missed.">      if (begin &gt;= previousEnd) {</span>
        // Add text
<span class="nc" id="L950">        nodes.add(XMLUtils.createTextNode(str.substring(previousEnd, begin)));</span>
        // Add timex
<span class="nc" id="L952">        Timex timex = timexAnn.get(TimeAnnotations.TimexAnnotation.class);</span>
<span class="nc" id="L953">        Element timexElem = timex.toXmlElement();</span>
<span class="nc" id="L954">        nodes.add(timexElem);</span>
<span class="nc" id="L955">        previousEnd = end;</span>

        // For handling nested timexes
<span class="nc" id="L958">        processed.add(v);</span>
<span class="nc" id="L959">        timexElems.add(timexElem);</span>
<span class="nc" id="L960">      } else {</span>
<span class="nc" id="L961">        unprocessed.add(processed.size()-1, v);</span>
      }
<span class="nc" id="L963">    }</span>
<span class="nc bnc" id="L964" title="All 2 branches missed.">    if (previousEnd &lt; str.length()) {</span>
<span class="nc" id="L965">      nodes.add(XMLUtils.createTextNode(str.substring(previousEnd)));</span>
    }
<span class="nc bnc" id="L967" title="All 2 branches missed.">    for (Integer i:unprocessed.keySet()) {</span>
<span class="nc" id="L968">      ValuedInterval&lt;CoreMap, Integer&gt; v = processed.get(i);</span>
<span class="nc" id="L969">      String elemStr = v.getValue().get(CoreAnnotations.TextAnnotation.class);</span>
<span class="nc" id="L970">      int charStart = v.getValue().get(CoreAnnotations.CharacterOffsetBeginAnnotation.class);</span>
<span class="nc" id="L971">      List&lt;Node&gt; innerElems = createTimexNodesPresorted(elemStr, charStart, (List&lt;ValuedInterval&lt;CoreMap, Integer&gt;&gt;) unprocessed.get(i));</span>
<span class="nc" id="L972">      Element timexElem = timexElems.get(i);</span>
<span class="nc" id="L973">      XMLUtils.removeChildren(timexElem);</span>
<span class="nc bnc" id="L974" title="All 2 branches missed.">      for (Node n:innerElems) {</span>
<span class="nc" id="L975">        timexElem.appendChild(n);</span>
<span class="nc" id="L976">      }</span>
<span class="nc" id="L977">    }</span>
<span class="nc" id="L978">    return nodes;</span>
  }

  public static void processTextFile(AnnotationPipeline pipeline, String in, String out, String date) throws IOException {
<span class="nc" id="L982">    String text = IOUtils.slurpFile(in);</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">    PrintWriter pw = (out != null)? IOUtils.getPrintWriter(out):new PrintWriter(System.out);</span>
<span class="nc" id="L984">    String string = textToAnnotatedXml(pipeline, text, date);</span>
<span class="nc" id="L985">    pw.println(string);</span>
<span class="nc" id="L986">    pw.flush();</span>
<span class="nc bnc" id="L987" title="All 2 branches missed.">    if (out != null) pw.close();</span>
<span class="nc" id="L988">  }</span>

  public static void processText(AnnotationPipeline pipeline, String text, String out, String date) throws IOException {
<span class="nc bnc" id="L991" title="All 2 branches missed.">    PrintWriter pw = (out != null)? IOUtils.getPrintWriter(out):new PrintWriter(System.out);</span>
<span class="nc" id="L992">    String string = textToAnnotatedXml(pipeline, text, date);</span>
<span class="nc" id="L993">    pw.println(string);</span>
<span class="nc" id="L994">    pw.flush();</span>
<span class="nc bnc" id="L995" title="All 2 branches missed.">    if (out != null) pw.close();</span>
<span class="nc" id="L996">  }</span>

  public static String textToAnnotatedXml(AnnotationPipeline pipeline, String text, String date) {
<span class="nc" id="L999">    Annotation annotation = textToAnnotation(pipeline, text, date);</span>
<span class="nc" id="L1000">    Document xmlDoc = annotationToXmlDocument(annotation);</span>
<span class="nc" id="L1001">    return XMLUtils.documentToString(xmlDoc);</span>
  }

  public static Element annotationToTmlTextElement(Annotation annotation) {
<span class="nc" id="L1005">    List&lt;CoreMap&gt; timexAnnsAll = annotation.get(TimeAnnotations.TimexAnnotations.class);</span>
<span class="nc" id="L1006">    Element textElem = XMLUtils.createElement(&quot;TEXT&quot;);</span>
<span class="nc" id="L1007">    List&lt;Node&gt; timexNodes = createTimexNodes(</span>
<span class="nc" id="L1008">            annotation.get(CoreAnnotations.TextAnnotation.class),</span>
<span class="nc" id="L1009">            annotation.get(CoreAnnotations.CharacterOffsetBeginAnnotation.class),</span>
            timexAnnsAll);
<span class="nc bnc" id="L1011" title="All 2 branches missed.">    for (Node node:timexNodes) {</span>
<span class="nc" id="L1012">      textElem.appendChild(node);</span>
<span class="nc" id="L1013">    }</span>
<span class="nc" id="L1014">    return textElem;</span>
  }

  public static Document annotationToXmlDocument(Annotation annotation) {
<span class="nc" id="L1018">    Element dateElem = XMLUtils.createElement(&quot;DATE&quot;);</span>
<span class="nc" id="L1019">    dateElem.setTextContent(annotation.get(CoreAnnotations.DocDateAnnotation.class));</span>
<span class="nc" id="L1020">    Element textElem = annotationToTmlTextElement(annotation);</span>

<span class="nc" id="L1022">    Element docElem = XMLUtils.createElement(&quot;DOC&quot;);</span>
<span class="nc" id="L1023">    docElem.appendChild(dateElem);</span>
<span class="nc" id="L1024">    docElem.appendChild(textElem);</span>

    // Create document and import elements into this document....
<span class="nc" id="L1027">    Document doc = XMLUtils.createDocument();</span>
<span class="nc" id="L1028">    doc.appendChild(doc.importNode(docElem, true));</span>
<span class="nc" id="L1029">    return doc;</span>
  }

  public static Annotation textToAnnotation(AnnotationPipeline pipeline, String text, String date) {
<span class="nc" id="L1033">    Annotation annotation = new Annotation(text);</span>
<span class="nc" id="L1034">    annotation.set(CoreAnnotations.DocDateAnnotation.class, date);</span>
<span class="nc" id="L1035">    pipeline.annotate(annotation);</span>
<span class="nc" id="L1036">    return annotation;</span>
  }

  public static void main(String[] args) throws Exception {
    // Process arguments
<span class="nc" id="L1041">    Properties props = StringUtils.argsToProperties(args);</span>

<span class="nc" id="L1043">    String in = props.getProperty(&quot;i&quot;);</span>
<span class="nc" id="L1044">    String date = props.getProperty(&quot;date&quot;);</span>
<span class="nc" id="L1045">    String dct = props.getProperty(&quot;tempeval2.dct&quot;);</span>
<span class="nc" id="L1046">    String out = props.getProperty(&quot;o&quot;);</span>
<span class="nc" id="L1047">    String inputTypeStr = props.getProperty(&quot;in.type&quot;, InputType.TEXT.name());</span>
<span class="nc" id="L1048">    String eval = props.getProperty(&quot;eval&quot;);</span>
<span class="nc" id="L1049">    PYTHON = props.getProperty(&quot;python&quot;, PYTHON);</span>
<span class="nc" id="L1050">    InputType inputType = InputType.valueOf(inputTypeStr);</span>
    AnnotationPipeline pipeline;
<span class="nc bnc" id="L1052" title="All 6 branches missed.">    switch (inputType) {</span>
      case TEXT:
<span class="nc" id="L1054">        pipeline = getPipeline(props, true);</span>
<span class="nc" id="L1055">        processText(pipeline, in, out, date);</span>
<span class="nc" id="L1056">        break;</span>
      case TEXTFILE:
<span class="nc" id="L1058">        pipeline = getPipeline(props, true);</span>
<span class="nc" id="L1059">        processTextFile(pipeline, in, out, date);</span>
<span class="nc" id="L1060">        break;</span>
      case TIMEBANK_CSV:
<span class="nc" id="L1062">        configLogger(out);</span>
<span class="nc" id="L1063">        pipeline = getPipeline(props, true);</span>
<span class="nc" id="L1064">        processTimebankCsv(pipeline, in, out, eval);</span>
<span class="nc" id="L1065">        break;</span>
      case TEMPEVAL2:
<span class="nc" id="L1067">        configLogger(out);</span>
<span class="nc" id="L1068">        pipeline = getPipeline(props, false);</span>
<span class="nc" id="L1069">        processTempEval2(pipeline, in, out, eval, dct);</span>
<span class="nc" id="L1070">        break;</span>
      case TEMPEVAL3:
<span class="nc" id="L1072">        pipeline = getPipeline(props, true);</span>
<span class="nc" id="L1073">        processTempEval3(pipeline, in, out, eval);</span>
        break;
    }
<span class="nc" id="L1076">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>