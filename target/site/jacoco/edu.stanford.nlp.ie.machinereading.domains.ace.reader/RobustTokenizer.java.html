<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RobustTokenizer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Stanford CoreNLP</a> &gt; <a href="index.source.html" class="el_package">edu.stanford.nlp.ie.machinereading.domains.ace.reader</a> &gt; <span class="el_source">RobustTokenizer.java</span></div><h1>RobustTokenizer.java</h1><pre class="source lang-java linenums">/*
 * RobustTokenizer.java
 * Performs tokenization of natural language English text, following ACE data
 * Use the method tokenize() for smart tokenization
 * @author Mihai
 */

package edu.stanford.nlp.ie.machinereading.domains.ace.reader; 
import edu.stanford.nlp.util.logging.Redwood;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Iterator;
import java.util.List;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import java.io.FileReader;
import java.io.BufferedReader;

import edu.stanford.nlp.ling.Word;
import edu.stanford.nlp.process.AbstractTokenizer;
import edu.stanford.nlp.util.Generics;

public class RobustTokenizer&lt;T extends Word&gt; extends AbstractTokenizer&lt;Word&gt;  {

  /** A logger for this class */
<span class="nc" id="L28">  private static Redwood.RedwoodChannels log = Redwood.channels(RobustTokenizer.class);</span>
  
  /** Buffer to tokenize */
  String buffer;

  /** The set of known abbreviations */
  private AbbreviationMap mAbbreviations;
  
  public final static int MAX_MULTI_WORD_SIZE = 20;

  // basic tokens
<span class="nc" id="L39">  public final static String DOT         = block(&quot;\\.&quot;);</span>
<span class="nc" id="L40">  public final static String DOTDOT      = block(&quot;\\:&quot;);</span>
<span class="nc" id="L41">  public final static String APOSTROPHE  = block(&quot;\\'&quot;);</span>
<span class="nc" id="L42">  public final static String SLASH       = block(&quot;\\/&quot;);</span>
<span class="nc" id="L43">  public final static String UNDERSCORE  = block(&quot;\\_&quot;);</span>
<span class="nc" id="L44">  public final static String MINUS       = block(&quot;\\-&quot;);</span>
<span class="nc" id="L45">  public final static String PLUS        = block(&quot;\\+&quot;);</span>
<span class="nc" id="L46">  public final static String COMMA       = block(&quot;\\,&quot;);</span>
<span class="nc" id="L47">  public final static String DOTCOMMA    = block(&quot;\\;&quot;);</span>
<span class="nc" id="L48">  public final static String QUOTES      = block(or(&quot;\\\&quot;&quot;, &quot;\\'\\'&quot;, &quot;\\'&quot;, &quot;\\`\\`&quot;, &quot;\\`&quot;));</span>
<span class="nc" id="L49">  public final static String DOUBLE_QUOTES = block(or(&quot;\\\&quot;&quot; , &quot;\\'\\'&quot;)); </span>
<span class="nc" id="L50">  public final static String LRB         = block(&quot;\\(&quot;);</span>
<span class="nc" id="L51">  public final static String RRB         = block(&quot;\\)&quot;);</span>
<span class="nc" id="L52">  public final static String LCB         = block(&quot;\\{&quot;);</span>
<span class="nc" id="L53">  public final static String RCB         = block(&quot;\\}&quot;);</span>
<span class="nc" id="L54">  public final static String GREATER     = block(&quot;\\&gt;&quot;);</span>
<span class="nc" id="L55">  public final static String LOWER       = block(&quot;\\&lt;&quot;);</span>
<span class="nc" id="L56">  public final static String AMPERSAND   = block(&quot;\\&amp;&quot;);</span>
<span class="nc" id="L57">  public final static String AT          = block(&quot;\\@&quot;);</span>
<span class="nc" id="L58">  public final static String HTTP        = block(&quot;[hH][tT][tT][pP]\\:\\/\\/&quot;);</span>

  // basic sequences
<span class="nc" id="L61">  public final static String WHITE_SPACE = block(&quot;\\s&quot;);</span>
<span class="nc" id="L62">  public final static String DIGIT       = block(&quot;\\d&quot;);</span>
<span class="nc" id="L63">  public final static String LETTER      = block(&quot;[a-zA-Z]&quot;);</span>
<span class="nc" id="L64">  public final static String UPPER       = block(&quot;[A-Z]&quot;);</span>
<span class="nc" id="L65">  public final static String SIGN        = or(MINUS,PLUS);</span>

  // numbers
<span class="nc" id="L68">  public final static String FULLNUM = </span>
<span class="nc" id="L69">    block(</span>
<span class="nc" id="L70">        zeroOrOne(SIGN) +</span>
<span class="nc" id="L71">        oneOrMore(DIGIT) +</span>
<span class="nc" id="L72">        zeroOrMore(</span>
<span class="nc" id="L73">            zeroOrOne(or(DOT, COMMA, SLASH)) +</span>
<span class="nc" id="L74">            oneOrMore(DIGIT)));</span>
<span class="nc" id="L75">  public final static String DECNUM       = block(DOT + oneOrMore(DIGIT));</span>
<span class="nc" id="L76">  public final static String NUM          = or(FULLNUM, DECNUM);    </span>

  // date and time
<span class="nc" id="L79">  public final static String DATE = </span>
<span class="nc" id="L80">    block(oneOrMore(DIGIT) + SLASH +</span>
<span class="nc" id="L81">        oneOrMore(DIGIT) + SLASH +</span>
<span class="nc" id="L82">        oneOrMore(DIGIT));</span>
<span class="nc" id="L83">  public final static String TIME = </span>
<span class="nc" id="L84">    block(oneOrMore(DIGIT) + </span>
<span class="nc" id="L85">        oneOrMore(block(</span>
            DOTDOT + 
<span class="nc" id="L87">            oneOrMore(DIGIT))));</span>

  // punctuation marks
<span class="nc" id="L90">  public final static String PUNC = </span>
<span class="nc" id="L91">    or(QUOTES, </span>
<span class="nc" id="L92">        block(MINUS + oneOrMore(MINUS)),</span>
<span class="nc" id="L93">        block(DOT + oneOrMore(DOT)));</span>

  // words
<span class="nc" id="L96">  public final static String LETTERS     = oneOrMore(LETTER);</span>
<span class="nc" id="L97">  public final static String BLOCK       = or(NUM, LETTERS); </span>
<span class="nc" id="L98">  public final static String WORD        = </span>
<span class="nc" id="L99">    block(zeroOrOne(APOSTROPHE) + </span>
        BLOCK +
<span class="nc" id="L101">        zeroOrMore(block(</span>
<span class="nc" id="L102">            zeroOrOne(or(UNDERSCORE, </span>
                MINUS, 
                APOSTROPHE,
                SLASH,
                AMPERSAND)) +
                BLOCK)));

  // acronyms
<span class="nc" id="L110">  public final static String ACRONYM = block(oneOrMore(LETTER + DOT));// + zeroOrOne(LETTER));</span>

  // this matches acronyms AFTER abbreviation merging
<span class="nc" id="L113">  public final static String LOOSE_ACRONYM = </span>
<span class="nc" id="L114">    block(oneOrMore((oneOrMore(LETTER) + DOT)) + zeroOrMore(LETTER));</span>

  // other possible constructs
<span class="nc" id="L117">  public final static String PAREN      = or(LRB, RRB, LCB, RCB);</span>
  public final static String SGML       = &quot;&lt;[^&lt;&gt;]+&gt;&quot;;
<span class="nc" id="L119">  public final static String HTMLCODE   = block(AMPERSAND + UPPER + DOTCOMMA);</span>

<span class="nc" id="L121">  public final static String ANY        = block(&quot;\\S&quot;);</span>

  // email addresses must start with a letter, contain @, and end with a letter
<span class="nc" id="L124">  public final static String EMAIL      = block(LETTER +</span>
<span class="nc" id="L125">      zeroOrMore(or(LETTER,</span>
          DIGIT,
          DOT,
          MINUS,
          UNDERSCORE)) + 
          AT + 
<span class="nc" id="L131">          zeroOrMore(or(LETTER,</span>
              DIGIT,
              DOT,
              MINUS,
              UNDERSCORE)) +
              LETTER);
  
  // email addresses must start with a letter, contain @, and end with . com 
<span class="nc" id="L139">  public final static String DOMAIN_EMAIL      = block(LETTER +</span>
<span class="nc" id="L140">      zeroOrMore(or(LETTER,</span>
          DIGIT,
          DOT,
          MINUS,
          UNDERSCORE)) + 
          AT + 
<span class="nc" id="L146">          oneOrMore(or(LETTER, DIGIT, DOT, MINUS, UNDERSCORE)) +</span>
<span class="nc" id="L147">          zeroOrMore(WHITE_SPACE)+ DOT + zeroOrMore(WHITE_SPACE) + or(&quot;org&quot;, &quot;ORG&quot;, &quot;com&quot;, &quot;COM&quot;, &quot;net&quot;, &quot;NET&quot;, &quot;ru&quot;, &quot;us&quot;));</span>

  // URLs must start with http:// or ftp://, followed by at least a letter
<span class="nc" id="L150">  public final static String URL = </span>
<span class="nc" id="L151">    block(HTTP +</span>
<span class="nc" id="L152">        oneOrMore(or(LETTER,</span>
            DIGIT,
            DOT,
            UNDERSCORE,
            SLASH,
            AMPERSAND,
            MINUS,
            PLUS)));
  
  //URLs without http, but ending in org, com, net
<span class="nc" id="L162">  public final static String SMALL_URL = </span>
<span class="nc" id="L163">    block(oneOrMore(oneOrMore(LETTER) + DOT) + zeroOrMore(WHITE_SPACE) + or(&quot;org&quot;, &quot;ORG&quot;, &quot;com&quot;, &quot;COM&quot;, &quot;net&quot;, &quot;NET&quot;, &quot;ru&quot;, &quot;us&quot;));</span>

  // keep sequence of underscores as a single token
<span class="nc" id="L166">  public final static String UNDERSCORESEQ = oneOrMore(&quot;_&quot;);</span>

  // list bullet, e.g., &quot;(a)&quot;
<span class="nc" id="L169">  public final static String LIST_BULLET = block(LRB + LETTER + zeroOrOne(LETTER) + RRB); </span>
  // part of a phone number, e.g., &quot;(214)&quot;
<span class="nc" id="L171">  public final static String PHONE_PART = block(LRB + oneOrMore(DIGIT) + RRB);</span>

  // sequence of digits
<span class="nc" id="L174">  public final static String DIGITSEQ = oneOrMore(DIGIT);</span>

  // the complete pattern
<span class="nc" id="L177">  public final static String RECOGNISED_PATTERN </span>
<span class="nc" id="L178">  = block(block(TIME) + &quot;|&quot; +</span>
<span class="nc" id="L179">      block(DOMAIN_EMAIL) + &quot;|&quot; +</span>
<span class="nc" id="L180">      block(EMAIL) + &quot;|&quot; +</span>
<span class="nc" id="L181">      block(URL) + &quot;|&quot; +</span>
      // block(SMALL_URL) + &quot;|&quot; +
<span class="nc" id="L183">      block(ACRONYM) + &quot;|&quot; + </span>
<span class="nc" id="L184">      block(DATE) + &quot;|&quot; + </span>
<span class="nc" id="L185">      block(PHONE_PART) + &quot;|&quot; + // must be before WORD, otherwise it's broken into multiple tokens</span>
<span class="nc" id="L186">      block(WORD) + &quot;|&quot; +</span>
<span class="nc" id="L187">      block(PUNC) + &quot;|&quot; + </span>
<span class="nc" id="L188">      block(LIST_BULLET) + &quot;|&quot; + </span>
<span class="nc" id="L189">      block(PAREN) + &quot;|&quot; + </span>
<span class="nc" id="L190">      block(SGML) + &quot;|&quot; + </span>
<span class="nc" id="L191">      block(HTMLCODE) + &quot;|&quot; + </span>
<span class="nc" id="L192">      block(UNDERSCORESEQ) + &quot;|&quot; + </span>
<span class="nc" id="L193">      block(ANY));</span>

  /** The overall token pattern */
  private final static Pattern wordPattern;

  /** Pattern to recognize SGML tags */
  private final static Pattern sgmlPattern;

  /** Pattern to recognize slash-separated dates */
  private final static Pattern slashDatePattern;

  /** Pattern to recognize acronyms */
  private final static Pattern acronymPattern;

  /** Pattern to recognize URLs */
  private final static Pattern urlPattern;

  /** Pattern to recognize emails */
  private final static Pattern emailPattern;

  /** Recognized sequences of digits */
  private final static Pattern digitSeqPattern;

  static{
<span class="nc" id="L217">    wordPattern          = Pattern.compile(RECOGNISED_PATTERN); </span>
<span class="nc" id="L218">    sgmlPattern          = Pattern.compile(SGML);</span>
<span class="nc" id="L219">    slashDatePattern     = Pattern.compile(DATE);</span>
<span class="nc" id="L220">    acronymPattern       = Pattern.compile(LOOSE_ACRONYM);</span>
<span class="nc" id="L221">    urlPattern           = Pattern.compile(URL);</span>
<span class="nc" id="L222">    emailPattern         = Pattern.compile(EMAIL);</span>
<span class="nc" id="L223">    digitSeqPattern      = Pattern.compile(DIGITSEQ);</span>
<span class="nc" id="L224">  }</span>
  
<span class="nc" id="L226">  public RobustTokenizer(String buffer) {</span>
<span class="nc" id="L227">    mAbbreviations = new AbbreviationMap(true);</span>
<span class="nc" id="L228">    this.buffer = buffer;</span>
<span class="nc" id="L229">    this.cachedTokens = null;</span>
<span class="nc" id="L230">  }</span>


<span class="nc" id="L233">  public RobustTokenizer(boolean caseInsensitive, String buffer) {</span>
<span class="nc" id="L234">    mAbbreviations = new AbbreviationMap(caseInsensitive);</span>
<span class="nc" id="L235">    this.buffer = buffer;</span>
<span class="nc" id="L236">    this.cachedTokens = null;</span>
<span class="nc" id="L237">  }</span>

  /** any in the set */ 
  public static String range(String s){
<span class="nc" id="L241">    return block(&quot;[&quot; + s + &quot;]&quot;);</span>
  }


  /** zero or one */
  public static String zeroOrOne(String s){
<span class="nc" id="L247">    return block(block(s) + &quot;?&quot;);</span>
  }

  /** zero or more */
  public static String zeroOrMore(String s){
<span class="nc" id="L252">    return block(block(s) + &quot;*&quot;);</span>
  }

  /** one or more */
  public static String oneOrMore(String s){
<span class="nc" id="L257">    return block(block(s) + &quot;+&quot;);</span>
  }

  /** parens */
  public static String block(String s){
<span class="nc" id="L262">    return &quot;(&quot; + s + &quot;)&quot;;</span>
  }

  /** any of the two */
  public static String or(String s1, String s2){
<span class="nc" id="L267">    return block(block(s1) + &quot;|&quot; + block(s2));</span>
  }

  /** any of the three */
  public static String or(String s1, String s2, String s3){
<span class="nc" id="L272">    return block(block(s1) + &quot;|&quot; + block(s2) + &quot;|&quot; + block(s3));</span>
  }

  /** any of the four */
  public static String or(String s1, String s2, String s3, String s4){
<span class="nc" id="L277">    return block(block(s1) + &quot;|&quot; + block(s2) + &quot;|&quot; + block(s3) + &quot;|&quot; + block(s4));</span>
  }

  /** any of the five */
  public static String or(String s1, String s2, String s3, String s4, String s5){
<span class="nc" id="L282">    return block(block(s1) + &quot;|&quot; + block(s2) + &quot;|&quot; + block(s3) + &quot;|&quot; + </span>
<span class="nc" id="L283">        block(s4) + &quot;|&quot; + block(s5));</span>
  }

  /** any of the six */
  public static String or(String s1, String s2, String s3, 
      String s4, String s5, String s6){
<span class="nc" id="L289">    return block(block(s1) + &quot;|&quot; + block(s2) + &quot;|&quot; + block(s3) + &quot;|&quot; + </span>
<span class="nc" id="L290">        block(s4) + &quot;|&quot; + block(s5) + &quot;|&quot; + block(s6));</span>
  }

  /** any of the seven */
  public static String or(String s1, String s2, String s3, 
      String s4, String s5, String s6, String s7){
<span class="nc" id="L296">    return block(block(s1) + &quot;|&quot; + block(s2) + &quot;|&quot; + block(s3) + &quot;|&quot; + </span>
<span class="nc" id="L297">        block(s4) + &quot;|&quot; + block(s5) + &quot;|&quot; + block(s6) + &quot;|&quot; + block(s7));</span>
  }

  /** any of the eight */
  public static String or(String s1, String s2, String s3, String s4, 
      String s5, String s6, String s7, String s8){
<span class="nc" id="L303">    return block(block(s1) + &quot;|&quot; + block(s2) + &quot;|&quot; + block(s3) + &quot;|&quot; + </span>
<span class="nc" id="L304">        block(s4) + &quot;|&quot; + block(s5) + &quot;|&quot; + block(s6) + &quot;|&quot; + </span>
<span class="nc" id="L305">        block(s7) + &quot;|&quot; + block(s8));</span>
  }

  /** any of the nine */
  public static String or(String s1, String s2, String s3, String s4, 
      String s5, String s6, String s7, String s8, String s9){
<span class="nc" id="L311">    return block(block(s1) + &quot;|&quot; + block(s2) + &quot;|&quot; + block(s3) + &quot;|&quot; + </span>
<span class="nc" id="L312">        block(s4) + &quot;|&quot; + block(s5) + &quot;|&quot; + block(s6) + &quot;|&quot; + </span>
<span class="nc" id="L313">        block(s7) + &quot;|&quot; + block(s8) + &quot;|&quot; + block(s9));</span>
  }

  public static String or(String s1, String s2, String s3, String s4, 
      String s5, String s6, String s7, String s8, 
      String s9, String s10){
<span class="nc" id="L319">    return block(block(s1) + &quot;|&quot; + block(s2) + &quot;|&quot; + block(s3) + &quot;|&quot; + </span>
<span class="nc" id="L320">        block(s4) + &quot;|&quot; + block(s5) + &quot;|&quot; + block(s6) + &quot;|&quot; + </span>
<span class="nc" id="L321">        block(s7) + &quot;|&quot; + block(s8) + &quot;|&quot; + block(s9) + &quot;|&quot; +</span>
<span class="nc" id="L322">        block(s10));</span>
  }

  public static String or(String s1, String s2, String s3, String s4, 
      String s5, String s6, String s7, String s8, 
      String s9, String s10, String s11){
<span class="nc" id="L328">    return block(block(s1) + &quot;|&quot; + block(s2) + &quot;|&quot; + block(s3) + &quot;|&quot; + </span>
<span class="nc" id="L329">        block(s4) + &quot;|&quot; + block(s5) + &quot;|&quot; + block(s6) + &quot;|&quot; + </span>
<span class="nc" id="L330">        block(s7) + &quot;|&quot; + block(s8) + &quot;|&quot; + block(s9) + &quot;|&quot; +</span>
<span class="nc" id="L331">        block(s10) + &quot;|&quot; + block(s11));</span>
  }

  public static String or(String s1, String s2, String s3, String s4, 
      String s5, String s6, String s7, String s8, 
      String s9, String s10, String s11, String s12){
<span class="nc" id="L337">    return block(block(s1) + &quot;|&quot; + block(s2) + &quot;|&quot; + block(s3) + &quot;|&quot; + </span>
<span class="nc" id="L338">        block(s4) + &quot;|&quot; + block(s5) + &quot;|&quot; + block(s6) + &quot;|&quot; + </span>
<span class="nc" id="L339">        block(s7) + &quot;|&quot; + block(s8) + &quot;|&quot; + block(s9) + &quot;|&quot; +</span>
<span class="nc" id="L340">        block(s10) + &quot;|&quot; + block(s11) + &quot;|&quot; + block(s12));</span>
  }

  /** not */
  public static String rangeNot(String s){
<span class="nc" id="L345">    return range(block(&quot;^&quot; + s));</span>
  }

  private static int hasApostropheBlock(String s) {
<span class="nc bnc" id="L349" title="All 2 branches missed.">    for(int i = s.length() - 1; i &gt; 0; i --){</span>
<span class="nc bnc" id="L350" title="All 4 branches missed.">      if(s.charAt(i) == '\'' &amp;&amp; i &lt; s.length() - 1){</span>
<span class="nc" id="L351">        return i;</span>
      }

<span class="nc bnc" id="L354" title="All 2 branches missed.">      if(! Character.isLetter(s.charAt(i))){</span>
<span class="nc" id="L355">        return -1;</span>
      }
    }

<span class="nc" id="L359">    return -1;</span>
  }

  private static &lt;T extends WordToken&gt; String concatenate(List&lt;T&gt; tokens,
      int start,
      int end) {
<span class="nc" id="L365">    StringBuffer buffer = new StringBuffer();</span>

<span class="nc bnc" id="L367" title="All 2 branches missed.">    for(; start &lt; end; start ++){</span>
<span class="nc" id="L368">      buffer.append(((WordToken) tokens.get(start)).getWord());</span>
    }
<span class="nc" id="L370">    return buffer.toString();</span>
  }

  private static &lt;T extends WordToken&gt; int countNewLines(List&lt;T&gt; tokens,
      int start,
      int end) {
<span class="nc" id="L376">    int count = 0;</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">    for(int i = start + 1; i &lt; end; i ++){</span>
<span class="nc" id="L378">      count += tokens.get(i).getNewLineCount();</span>
    }
<span class="nc" id="L380">    return count;</span>
  }

  public static boolean isUrl(String s) {
<span class="nc" id="L384">    Matcher match = urlPattern.matcher(s);</span>
<span class="nc" id="L385">    return match.find(0);</span>
  }

  public static boolean isEmail(String s) {
<span class="nc" id="L389">    Matcher match = emailPattern.matcher(s);</span>
<span class="nc" id="L390">    return match.find(0);</span>
  }

  public static boolean isSgml(String s) {
<span class="nc" id="L394">    Matcher match = sgmlPattern.matcher(s);</span>
<span class="nc" id="L395">    return match.find(0);</span>
  }

  public static boolean isSlashDate(String s) {
<span class="nc" id="L399">    Matcher match = slashDatePattern.matcher(s);</span>
<span class="nc" id="L400">    return match.find(0);</span>
  }

  public static boolean isAcronym(String s) {
<span class="nc" id="L404">    Matcher match = acronymPattern.matcher(s);</span>
<span class="nc" id="L405">    return match.find(0);</span>
  }

  public static boolean isDigitSeq(String s) {
<span class="nc" id="L409">    Matcher match = digitSeqPattern.matcher(s);</span>
<span class="nc" id="L410">    return match.find(0);</span>
  }

  public int countNewLines(String s, int start, int end) {
<span class="nc" id="L414">    int count = 0;</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">    for(int i = start; i &lt; end; i ++) {</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">      if(s.charAt(i) == '\n') count ++;</span>
    }
<span class="nc" id="L418">    return count;</span>
  }
  
  /**
   * Smart tokenization storing the output in an array of CoreLabel
   * Sets the following fields:
   * - TextAnnotation - the text of the token
   * - TokenBeginAnnotation - the byte offset of the token (start)
   * - TokenEndAnnotation - the byte offset of the token (end)
   */
  public Word [] tokenizeToWords() {
<span class="nc" id="L429">    List&lt;WordToken&gt; toks = tokenizeToWordTokens();</span>
<span class="nc" id="L430">    Word [] labels = new Word[toks.size()];</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">    for(int i = 0; i &lt; toks.size(); i ++){</span>
<span class="nc" id="L432">      WordToken tok = toks.get(i);</span>
<span class="nc" id="L433">      Word l = new Word(tok.getWord(), tok.getStart(), tok.getEnd());</span>
<span class="nc" id="L434">      labels[i] = l;</span>
    }
<span class="nc" id="L436">    return labels;</span>
  }

  /**
   * Tokenizes a natural language string
   * @return List of WordTokens
   */
  public List&lt;WordToken&gt; tokenizeToWordTokens() {
<span class="nc" id="L444">    List&lt;WordToken&gt; result = new ArrayList&lt;&gt;();</span>

    //
    // replace illegal characters with SPACE
    //
    /*
    StringBuffer buffer = new StringBuffer();
    for(int i = 0; i &lt; originalString.length(); i ++){
    	int c = (int) originalString.charAt(i);
    	//
    	// regular character
    	//
    	if(c &gt; 31 &amp;&amp; c &lt; 127) buffer.append((char) c);

    	else{
    		log.info(&quot;Control character at position &quot; + i + &quot;: &quot; + c);

    		//
    		// DOS new line counts as two characters
    		// 
    		if(c == 10) buffer.append(&quot; &quot;);

    		//
    		// other control character
    		//
    		else buffer.append(' ');
    	}
    }
     */

<span class="nc" id="L474">    Matcher match = wordPattern.matcher(buffer);</span>
<span class="nc" id="L475">    int previousEndMatch = 0;</span>

    //
    // Straight tokenization, ignoring known abbreviations
    //
<span class="nc bnc" id="L480" title="All 2 branches missed.">    while(match.find()){</span>
<span class="nc" id="L481">      String crtMatch = match.group();</span>
<span class="nc" id="L482">      int endMatch = match.end();</span>
<span class="nc" id="L483">      int startMatch = endMatch - crtMatch.length();</span>
      int i;

      // found word ending in &quot;n't&quot;
<span class="nc bnc" id="L487" title="All 2 branches missed.">      if (crtMatch.endsWith(&quot;n't&quot;)){</span>
<span class="nc bnc" id="L488" title="All 2 branches missed.">        if (crtMatch.length() &gt; 3){</span>
<span class="nc" id="L489">          WordToken token1 = </span>
            new WordToken(
<span class="nc" id="L491">                crtMatch.substring(0, crtMatch.length() - 3), </span>
                startMatch, endMatch - 3,
<span class="nc" id="L493">                countNewLines(buffer, previousEndMatch, startMatch));</span>
<span class="nc" id="L494">          result.add(token1);</span>
        }
<span class="nc" id="L496">        WordToken token2 = </span>
<span class="nc" id="L497">          new WordToken(crtMatch.substring(crtMatch.length() - 3, </span>
<span class="nc" id="L498">              crtMatch.length()),</span>
              endMatch - 3, endMatch, 0);
<span class="nc" id="L500">        result.add(token2);</span>
<span class="nc" id="L501">      } </span>

      // found word containing an appostrophe
      // XXX: is this too relaxed? e.g. &quot;O'Hare&quot;
<span class="nc bnc" id="L505" title="All 2 branches missed.">      else if ((i = hasApostropheBlock(crtMatch)) != -1){</span>
<span class="nc" id="L506">        WordToken token1 = new WordToken(crtMatch.substring(0, i), </span>
<span class="nc" id="L507">            startMatch, startMatch + i, countNewLines(buffer, previousEndMatch, startMatch));</span>
<span class="nc" id="L508">        WordToken token2 = </span>
<span class="nc" id="L509">          new WordToken(crtMatch.substring(i, crtMatch.length()),</span>
              startMatch + i, endMatch, 0);
<span class="nc" id="L511">        result.add(token1);</span>
<span class="nc" id="L512">        result.add(token2);</span>
<span class="nc" id="L513">      }</span>

      // just a regular word
      else{
<span class="nc" id="L517">        WordToken token = new WordToken(crtMatch, startMatch, endMatch, </span>
<span class="nc" id="L518">            countNewLines(buffer, previousEndMatch, startMatch));</span>
<span class="nc" id="L519">        result.add(token);</span>
      }

<span class="nc" id="L522">      previousEndMatch = endMatch;</span>
<span class="nc" id="L523">    }   </span>

    //
    // Merge known abreviations
    //
<span class="nc" id="L528">    List&lt;WordToken&gt; resultWithAbs = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">    for(int i = 0; i &lt; result.size(); i ++){</span>
      // where the mw ends
<span class="nc" id="L531">      int end = result.size();</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">      if(end &gt; i + MAX_MULTI_WORD_SIZE) end = i + MAX_MULTI_WORD_SIZE; </span>

<span class="nc" id="L534">      boolean found = false;</span>

      // must have at least two tokens per multiword
<span class="nc bnc" id="L537" title="All 2 branches missed.">      for(; end &gt; i + 1; end --){</span>
<span class="nc" id="L538">        WordToken startToken = result.get(i);</span>
<span class="nc" id="L539">        WordToken endToken = result.get(end - 1);</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">        if(countNewLines(result, i, end) == 0){ // abbreviation tokens cannot appear on different lines</span>
<span class="nc" id="L541">          String conc = concatenate(result, i, end);</span>
<span class="nc" id="L542">          found = false;</span>

          // found a multiword
<span class="nc bnc" id="L545" title="All 2 branches missed.">          if((mAbbreviations.contains(conc) == true)){</span>
<span class="nc" id="L546">            found = true;</span>
<span class="nc" id="L547">            WordToken token = new WordToken(conc, </span>
<span class="nc" id="L548">                startToken.getStart(), </span>
<span class="nc" id="L549">                endToken.getEnd(),</span>
<span class="nc" id="L550">                startToken.getNewLineCount());</span>
<span class="nc" id="L551">            resultWithAbs.add(token);</span>
<span class="nc" id="L552">            i = end - 1;</span>
<span class="nc" id="L553">            break;</span>
          }
        }
      }

      // no multiword starting at this position found
<span class="nc bnc" id="L559" title="All 2 branches missed.">      if(! found){</span>
<span class="nc" id="L560">        resultWithAbs.add(result.get(i));</span>
      }
    }
    
<span class="nc" id="L564">    resultWithAbs = postprocess(resultWithAbs);</span>

<span class="nc" id="L566">    return resultWithAbs;</span>
  }
  
  /**
   * Redefine this method to implement additional domain-specific tokenization rules
   * @param tokens
   */
<span class="nc" id="L573">  protected List&lt;WordToken&gt; postprocess(List&lt;WordToken&gt; tokens) { return tokens; };</span>

  /** 
   * Tokenizes and adds blank spaces were needed between each token 
   */
  public String tokenizeText() throws java.io.IOException{
<span class="nc" id="L579">    List&lt;WordToken&gt; tokenList = tokenizeToWordTokens();</span>
<span class="nc" id="L580">    StringBuffer strBuffer = new StringBuffer();</span>
<span class="nc" id="L581">    Iterator&lt;WordToken&gt; iter = tokenList.iterator();</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">    if (iter.hasNext()){</span>
<span class="nc" id="L583">      strBuffer.append(iter.next());</span>
    }
<span class="nc bnc" id="L585" title="All 2 branches missed.">    while(iter.hasNext()){</span>
<span class="nc" id="L586">      strBuffer.append(&quot; &quot;);</span>
<span class="nc" id="L587">      strBuffer.append(iter.next());</span>
    }
<span class="nc" id="L589">    return strBuffer.toString().replaceAll(&quot;\\s\\s+&quot;, &quot; &quot;);                </span>
  }

  public static class AbbreviationMap {

    private Set&lt;String&gt; mAbbrevSet;

    private static List&lt;String&gt; normalizeCase(boolean caseInsensitive, List&lt;String&gt; words) {
<span class="nc bnc" id="L597" title="All 2 branches missed.">      if(! caseInsensitive) return words;</span>
<span class="nc" id="L598">      List&lt;String&gt; normWords = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L599" title="All 2 branches missed.">      for(String word: words) normWords.add(word.toLowerCase());</span>
<span class="nc" id="L600">      return normWords;</span>
    }

    /** Creates a new instance of AbreviationMap with some know abbreviations */
<span class="nc" id="L604">    public AbbreviationMap(boolean caseInsensitive)  {</span>
<span class="nc" id="L605">      mAbbrevSet = Generics.newHashSet(normalizeCase(caseInsensitive, Arrays.asList(new String[]{</span>
          &quot;1.&quot;,
          &quot;10.&quot;,
          &quot;11.&quot;,
          &quot;12.&quot;,
          &quot;13.&quot;,
          &quot;14.&quot;,
          &quot;15.&quot;,
          &quot;16.&quot;,
          &quot;17.&quot;,
          &quot;18.&quot;,
          &quot;19.&quot;,
          &quot;2.&quot;,
          &quot;20.&quot;,
          &quot;21.&quot;,
          &quot;22.&quot;,
          &quot;23.&quot;,
          &quot;24.&quot;,
          &quot;25.&quot;,
          &quot;26.&quot;,
          &quot;27.&quot;,
          &quot;28.&quot;,
          &quot;29.&quot;,
          &quot;3.&quot;,
          &quot;30.&quot;,
          &quot;31.&quot;,
          &quot;32.&quot;,
          &quot;33.&quot;,
          &quot;34.&quot;,
          &quot;35.&quot;,
          &quot;36.&quot;,
          &quot;37.&quot;,
          &quot;38.&quot;,
          &quot;39.&quot;,
          &quot;4.&quot;,
          &quot;40.&quot;,
          &quot;41.&quot;,
          &quot;42.&quot;,
          &quot;43.&quot;,
          &quot;44.&quot;,
          &quot;45.&quot;,
          &quot;46.&quot;,
          &quot;47.&quot;,
          &quot;48.&quot;,
          &quot;49.&quot;,
          &quot;5.&quot;,
          &quot;50.&quot;,
          &quot;6.&quot;,
          &quot;7.&quot;,
          &quot;8.&quot;,
          &quot;9.&quot;,
          &quot;A.&quot;,
          &quot;A.C.&quot;,
          &quot;A.D.&quot;,
          &quot;A.D.L.&quot;,
          &quot;A.F.&quot;,
          &quot;A.G.&quot;,
          &quot;A.H.&quot;,
          &quot;A.J.C.&quot;,
          &quot;A.L.&quot;,
          &quot;A.M&quot;,
          &quot;A.M.&quot;,
          &quot;A.P.&quot;,
          &quot;A.T.B.&quot;,
          &quot;AUG.&quot;,
          &quot;Act.&quot;,
          &quot;Adm.&quot;,
          &quot;Ala.&quot;,
          &quot;Ariz.&quot;,
          &quot;Ark.&quot;,
          &quot;Assn.&quot;,
          &quot;Ass'n.&quot;,
          &quot;Ass'n&quot;,
          &quot;Aug.&quot;,
          &quot;B.&quot;,
          &quot;B.A.T&quot;,
          &quot;B.B.&quot;,
          &quot;B.F.&quot;,
          &quot;B.J.&quot;,
          &quot;B.V.&quot;,
          &quot;Bancorp.&quot;,
          &quot;Bhd.&quot;,
          &quot;Blvd.&quot;,
          &quot;Br.&quot;,
          &quot;Brig.&quot;,
          &quot;Bros.&quot;,
          &quot;C.&quot;,
          &quot;C.B.&quot;,
          &quot;C.D.s&quot;,
          &quot;C.J.&quot;,
          &quot;C.O.&quot;,
          &quot;C.R.&quot;,
          &quot;C.W.&quot;,
          &quot;CEO.&quot;,
          &quot;CO.&quot;,
          &quot;CORP.&quot;,
          &quot;COS.&quot;,
          &quot;Cal.&quot;,
          &quot;Calif.&quot;,
          &quot;Capt.&quot;,
          &quot;Cie.&quot;,
          &quot;Cir.&quot;,
          &quot;Cmdr.&quot;,
          &quot;Co.&quot;,
          &quot;Col.&quot;,
          &quot;Colo.&quot;,
          &quot;Comdr.&quot;,
          &quot;Conn.&quot;,
          &quot;Corp.&quot;,
          &quot;Cos.&quot;,
          &quot;D.&quot;,
          &quot;D.B.&quot;,
          &quot;D.C&quot;,
          &quot;D.C.&quot;,
          &quot;D.H.&quot;,
          &quot;D.M.&quot;,
          &quot;D.N.&quot;,
          &quot;D.S.&quot;,
          &quot;D.T&quot;,
          &quot;D.T.&quot;,
          &quot;D.s&quot;,
          &quot;Dec.&quot;,
          &quot;Del.&quot;,
          &quot;Dept.&quot;,
          &quot;Dev.&quot;,
          &quot;Dr.&quot;,
          &quot;Ds.&quot;,
          &quot;E.&quot;,
          &quot;E.E.&quot;,
          &quot;E.F.&quot;,
          &quot;E.I.&quot;,
          &quot;E.M.&quot;,
          &quot;E.R.&quot;,
          &quot;E.W.&quot;,
          &quot;Etc.&quot;,
          &quot;F.&quot;,
          &quot;F.A.&quot;,
          &quot;F.A.O.&quot;,
          &quot;F.C&quot;,
          &quot;F.E.&quot;,
          &quot;F.J.&quot;,
          &quot;F.S.B.&quot;,
          &quot;F.W.&quot;,
          &quot;FEB.&quot;,
          &quot;FL.&quot;,
          &quot;Feb.&quot;,
          &quot;Fed.&quot;,
          &quot;Fla.&quot;,
          &quot;Fran.&quot;,
          &quot;French.&quot;,
          &quot;Freon.&quot;,
          &quot;Ft.&quot;,
          &quot;G.&quot;,
          &quot;G.D.&quot;,
          &quot;G.L.&quot;,
          &quot;G.O.&quot;,
          &quot;G.S.&quot;,
          &quot;G.m.b&quot;,
          &quot;G.m.b.H.&quot;,
          &quot;GP.&quot;,
          &quot;GPO.&quot;,
          &quot;Ga.&quot;,
          &quot;Gen.&quot;,
          &quot;Gov.&quot;,
          &quot;H.&quot;,
          &quot;H.F.&quot;,
          &quot;H.G.&quot;,
          &quot;H.H.&quot;,
          &quot;H.J.&quot;,
          &quot;H.L.&quot;,
          &quot;H.R.&quot;,
          &quot;Hon.&quot;,
          &quot;I.&quot;,
          &quot;I.B.M.&quot;,
          &quot;I.C.H.&quot;,
          &quot;I.E.P.&quot;,
          &quot;I.M.&quot;,
          &quot;I.V.&quot;,
          &quot;I.W.&quot;,
          &quot;II.&quot;,
          &quot;III.&quot;,
          &quot;INC.&quot;,
          &quot;Intl.&quot;,
          &quot;Int'l&quot;,
          &quot;IV.&quot;,
          &quot;IX.&quot;,
          &quot;Ill.&quot;,
          &quot;Inc.&quot;,
          &quot;Ind.&quot;,
          &quot;J.&quot;,
          &quot;J.C.&quot;,
          &quot;J.D.&quot;,
          &quot;J.E.&quot;,
          &quot;J.F.&quot;,
          &quot;J.F.K.&quot;,
          &quot;J.H.&quot;,
          &quot;J.L.&quot;,
          &quot;J.M.&quot;,
          &quot;JohnQ.Public&quot;,
          &quot;J.P.&quot;,
          &quot;J.R.&quot;,
          &quot;J.V&quot;,
          &quot;J.V.&quot;,
          &quot;J.X.&quot;,
          &quot;Jan.&quot;,
          &quot;Jansz.&quot;,
          &quot;Je.&quot;,
          &quot;Jos.&quot;,
          &quot;Jr.&quot;,
          &quot;K.&quot;,
          &quot;K.C.&quot;,
          &quot;Kan.&quot;,
          &quot;Ky.&quot;,
          &quot;L.&quot;,
          &quot;L.A.&quot;,
          &quot;L.H.&quot;,
          &quot;L.J.&quot;,
          &quot;L.L.&quot;,
          &quot;L.M.&quot;,
          &quot;L.P&quot;,
          &quot;L.P.&quot;,
          &quot;La.&quot;,
          &quot;Lt.&quot;,
          &quot;Ltd.&quot;,
          &quot;M.&quot;,
          &quot;M.A.&quot;,
          &quot;M.B.A.&quot;,
          &quot;M.D&quot;,
          &quot;M.D.&quot;,
          &quot;M.D.C.&quot;,
          &quot;M.E.&quot;,
          &quot;M.J.&quot;,
          &quot;M.R.&quot;,
          &quot;M.S.&quot;,
          &quot;M.W.&quot;,
          &quot;M8.7sp&quot;,
          &quot;Maj.&quot;,
          &quot;Mar.&quot;,
          &quot;Mass.&quot;,
          &quot;Md.&quot;,
          &quot;Med.&quot;,
          &quot;Messrs.&quot;,
          &quot;Mfg.&quot;,
          &quot;Mich.&quot;,
          &quot;Minn.&quot;,
          &quot;Mir.&quot;,
          &quot;Miss.&quot;,
          &quot;Mo.&quot;,
          &quot;Mr.&quot;,
          &quot;Mrs.&quot;,
          &quot;Ms.&quot;,
          &quot;Mt.&quot;,
          &quot;N.&quot;,
          &quot;N.A.&quot;,
          &quot;N.C&quot;,
          &quot;N.C.&quot;,
          &quot;N.D&quot;,
          &quot;N.D.&quot;,
          &quot;N.H&quot;,
          &quot;N.H.&quot;,
          &quot;N.J&quot;,
          &quot;N.J.&quot;,
          &quot;N.M&quot;,
          &quot;N.M.&quot;,
          &quot;N.V&quot;,
          &quot;N.V.&quot;,
          &quot;N.Y&quot;,
          &quot;N.Y.&quot;,
          &quot;NOV.&quot;,
          &quot;Neb.&quot;,
          &quot;Nev.&quot;,
          &quot;No.&quot;,
          &quot;no.&quot;, 
          &quot;Nos.&quot;,
          &quot;Nov.&quot;,
          &quot;O.&quot;,
          &quot;O.P.&quot;,
          &quot;OK.&quot;,
          &quot;Oct.&quot;,
          &quot;Okla.&quot;,
          &quot;Ore.&quot;,
          &quot;P.&quot;,
          &quot;P.J.&quot;,
          &quot;P.M&quot;,
          &quot;P.M.&quot;,
          &quot;P.R.&quot;,
          &quot;Pa.&quot;,
          &quot;Penn.&quot;,
          &quot;Pfc.&quot;,
          &quot;Ph.&quot;,
          &quot;Ph.D.&quot;,
          &quot;pro-U.N.&quot;,
          &quot;Prof.&quot;,
          &quot;Prop.&quot;,
          &quot;Pty.&quot;,
          &quot;Q.&quot;,
          &quot;R.&quot;,
          &quot;R.D.&quot;,
          &quot;Ret.&quot;,
          &quot;R.H.&quot;,
          &quot;R.I&quot;,
          &quot;R.I.&quot;,
          &quot;R.L.&quot;,
          &quot;R.P.&quot;,
          &quot;R.R.&quot;,
          &quot;R.W.&quot;,
          &quot;RLV.&quot;,
          &quot;Rd.&quot;,
          &quot;Rep.&quot;,
          &quot;Reps.&quot;,
          &quot;Rev.&quot;,
          &quot;S.&quot;,
          &quot;S.A&quot;,
          &quot;S.A.&quot;,
          &quot;S.C&quot;,
          &quot;S.C.&quot;,
          &quot;S.D.&quot;,
          &quot;S.G.&quot;,
          &quot;S.I.&quot;,
          &quot;S.P.&quot;,
          &quot;S.S.&quot;,
          &quot;S.p&quot;,
          &quot;S.p.A&quot;,
          &quot;S.p.A.&quot;,
          &quot;SKr1.5&quot;,
          &quot;Sen.&quot;,
          &quot;Sens.&quot;,
          &quot;Sept.&quot;,
          &quot;Sgt.&quot;,
          &quot;Snr.&quot;,
          &quot;Spc.&quot;,
          &quot;Sr.&quot;,
          &quot;St.&quot;,
          &quot;Sys.&quot;,
          &quot;T.&quot;,
          &quot;T.D.&quot;,
          &quot;T.F.&quot;,
          &quot;T.T.&quot;,
          &quot;T.V.&quot;,
          &quot;TEL.&quot;,
          &quot;Tech.&quot;,
          &quot;Tenn.&quot;,
          &quot;Tex.&quot;,
          &quot;Tx.&quot;,
          &quot;U.&quot;,
          &quot;U.Cal-Davis&quot;,
          &quot;U.K&quot;,
          &quot;U.K.&quot;,
          &quot;U.N.&quot;,
          &quot;U.S.&quot;,
          &quot;U.S.A&quot;,
          &quot;U.S.A.&quot;,
          &quot;U.S.C.&quot;,
          &quot;U.S.C..&quot;,
          &quot;U.S.S.R&quot;,
          &quot;U.S.S.R.&quot;,
          &quot;UK.&quot;,
          &quot;US116.7&quot;,
          &quot;V.&quot;,
          &quot;V.H.&quot;,
          &quot;VI.&quot;,
          &quot;VII.&quot;,
          &quot;VIII.&quot;,
          &quot;VS.&quot;,
          &quot;Va.&quot;,
          &quot;Vs.&quot;,
          &quot;Vt.&quot;,
          &quot;W.&quot;,
          &quot;W.A.&quot;,
          &quot;W.G.&quot;,
          &quot;W.I.&quot;,
          &quot;W.J.&quot;,
          &quot;W.R.&quot;,
          &quot;W.T.&quot;,
          &quot;W.Va&quot;,
          &quot;W.Va.&quot;,
          &quot;Wash.&quot;,
          &quot;Wis.&quot;,
          &quot;Wyo.&quot;,
          &quot;X.&quot;,
          &quot;Y.&quot;,
          &quot;Y.J.&quot;,
          &quot;Z.&quot;,
          &quot;a.&quot;,
          &quot;a.d.&quot;,
          &quot;a.k.a&quot;,
          &quot;a.m&quot;,
          &quot;a.m.&quot;,
          &quot;al.&quot;,
          &quot;b.&quot;,
          &quot;c.&quot;,
          &quot;c.i.f&quot;,
          &quot;cf.&quot;,
          &quot;cnsl.&quot;,
          &quot;cnsls.&quot;,
          &quot;cont'd.&quot;,
          &quot;d.&quot;,
          &quot;deft.&quot;,
          &quot;defts.&quot;,
          &quot;e.&quot;,
          &quot;et.&quot;,
          &quot;etc.&quot;,
          &quot;etseq.&quot;,
          &quot;f.&quot;,
          &quot;f.o.b&quot;,
          &quot;ft.&quot;,
          &quot;g.&quot;,
          &quot;h.&quot;,
          &quot;i.&quot;,
          &quot;i.e.&quot;,
          &quot;j.&quot;,
          &quot;k.&quot;,
          &quot;l.&quot;,
          &quot;m.&quot;,
          &quot;mots.&quot;,
          &quot;n.&quot;,
          &quot;o.&quot;,
          &quot;p.&quot;,
          &quot;p.m&quot;,
          &quot;p.m.&quot;,
          &quot;pltf.&quot;,
          &quot;pltfs.&quot;,
          &quot;prelim.&quot;,
          &quot;r.&quot;,
          &quot;s.&quot;,
          &quot;seq.&quot;,
          &quot;supp.&quot;,
          &quot;sq.&quot;,
          &quot;t.&quot;,
          &quot;u.&quot;,
          &quot;v.&quot;,
          &quot;vs.&quot;,
          &quot;x.&quot;,
          &quot;y.&quot;,
          &quot;z.&quot;,
      })));

<span class="nc" id="L1042">    }</span>

    public boolean contains(String s){
<span class="nc" id="L1045">      return mAbbrevSet.contains(s.toLowerCase());</span>
    }
  }
  
  public static class WordToken {

    /** Start position */
    protected int mStart;

    /** End position */
    protected int mEnd;
    
    /** Counts how many new lines appear between this token and the previous one in the stream */
    protected int mNewLineCount;

    /** The lexem */
    protected String mWord;

    public WordToken(String w, 
        int s,
<span class="nc" id="L1065">        int e) {</span>
<span class="nc" id="L1066">      mWord = w;</span>
<span class="nc" id="L1067">      mStart = s;</span>
<span class="nc" id="L1068">      mEnd = e;</span>
<span class="nc" id="L1069">      mNewLineCount = 0;</span>
<span class="nc" id="L1070">    }</span>
<span class="nc" id="L1071">    public WordToken(String w, int s, int e, int nl) {</span>
<span class="nc" id="L1072">      mWord = w;</span>
<span class="nc" id="L1073">      mStart = s;</span>
<span class="nc" id="L1074">      mEnd = e;</span>
<span class="nc" id="L1075">      mNewLineCount = nl;</span>
<span class="nc" id="L1076">    }</span>

    public String toString() {
<span class="nc" id="L1079">      StringBuffer buffer = new StringBuffer();</span>
<span class="nc" id="L1080">      buffer.append(&quot;[&quot;);</span>
<span class="nc" id="L1081">      buffer.append(mWord);</span>
<span class="nc" id="L1082">      buffer.append(&quot;, &quot;);</span>
<span class="nc" id="L1083">      buffer.append(mStart);</span>
<span class="nc" id="L1084">      buffer.append(&quot;, &quot;);</span>
<span class="nc" id="L1085">      buffer.append(mEnd);</span>
<span class="nc" id="L1086">      buffer.append(&quot;]&quot;);</span>
<span class="nc" id="L1087">      return buffer.toString();</span>
    }

<span class="nc" id="L1090">    public int getStart() { return mStart; }</span>
<span class="nc" id="L1091">    public void setStart(int i) { mStart = i; }</span>

<span class="nc" id="L1093">    public int getEnd() { return mEnd; }</span>
<span class="nc" id="L1094">    public void setEnd(int i) { mEnd = i; }</span>
    
<span class="nc" id="L1096">    public int getNewLineCount() { return mNewLineCount; }</span>
<span class="nc" id="L1097">    public void setNewLineCount(int i) { mNewLineCount = i; } </span>

<span class="nc" id="L1099">    public String getWord() { return mWord; }</span>
<span class="nc" id="L1100">    public void setWord(String w) { mWord = w; }</span>

  }
  
  /** Cached tokens for this buffer. Used by getNext */
  Word [] cachedTokens;
  /** Current position in the cachedTokens list. Used by getNext */
  int cachedPosition;
  
  @Override
  protected Word getNext() {
<span class="nc bnc" id="L1111" title="All 2 branches missed.">    if(cachedTokens == null){</span>
<span class="nc" id="L1112">      cachedTokens = tokenizeToWords();</span>
<span class="nc" id="L1113">      cachedPosition = 0;</span>
    }
    
<span class="nc bnc" id="L1116" title="All 2 branches missed.">    if(cachedPosition &gt;= cachedTokens.length){</span>
<span class="nc" id="L1117">      return null;</span>
    }
    
<span class="nc" id="L1120">    Word token = cachedTokens[cachedPosition];</span>
<span class="nc" id="L1121">    cachedPosition ++;</span>
    
<span class="nc" id="L1123">    return token;</span>
  }

  public static void main(String argv[]) throws Exception {
<span class="nc bnc" id="L1127" title="All 2 branches missed.">    if(argv.length != 1){</span>
<span class="nc" id="L1128">      log.info(&quot;Usage: java edu.stanford.nlp.ie.machinereading.common.RobustTokenizer &lt;file to tokenize&gt;&quot;);</span>
<span class="nc" id="L1129">      System.exit(1);</span>
    }

    // tokenize this file
<span class="nc" id="L1133">    BufferedReader is = </span>
      new BufferedReader(new FileReader(argv[0])); 

    // read the whole file in a buffer
    // XXX: for sure there are more efficient ways of reading a file...
    int ch;
<span class="nc" id="L1139">    StringBuffer buffer = new StringBuffer();</span>
<span class="nc bnc" id="L1140" title="All 2 branches missed.">    while((ch = is.read()) != -1) buffer.append((char) ch);</span>
    
    // create the tokenizer object
<span class="nc" id="L1143">    RobustTokenizer&lt;Word&gt; t = new RobustTokenizer&lt;&gt;(buffer.toString());</span>

<span class="nc" id="L1145">    List&lt;Word&gt; tokens = t.tokenize();</span>
<span class="nc bnc" id="L1146" title="All 2 branches missed.">    for (Word token : tokens) {</span>
<span class="nc" id="L1147">      System.out.println(token);</span>
<span class="nc" id="L1148">    }</span>
<span class="nc" id="L1149">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>