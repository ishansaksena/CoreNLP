<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ParserPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Stanford CoreNLP</a> &gt; <a href="index.source.html" class="el_package">edu.stanford.nlp.parser.ui</a> &gt; <span class="el_source">ParserPanel.java</span></div><h1>ParserPanel.java</h1><pre class="source lang-java linenums">// StanfordLexicalizedParser -- a probabilistic lexicalized NL CFG parser
// Copyright (c) 2002, 2003, 2004, 2005 The Board of Trustees of
// The Leland Stanford Junior University. All Rights Reserved.
//
// This program is free software; you can redistribute it and/or
// modify it under the terms of the GNU General Public License
// as published by the Free Software Foundation; either version 2
// of the License, or (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
//
// For more information, bug reports, fixes, contact:
//    Christopher Manning
//    Dept of Computer Science, Gates 4A
//    Stanford CA 94305-9040
//    USA
//    parser-support@lists.stanford.edu
//    http://nlp.stanford.edu/downloads/lex-parser.shtml

package edu.stanford.nlp.parser.ui; 
import edu.stanford.nlp.util.logging.Redwood;

import edu.stanford.nlp.io.ui.OpenPageDialog;
import edu.stanford.nlp.ling.*;
import edu.stanford.nlp.parser.common.ParserQuery;
import edu.stanford.nlp.parser.lexparser.LexicalizedParser;
import edu.stanford.nlp.process.*;
import edu.stanford.nlp.swing.FontDetector;
import edu.stanford.nlp.trees.PennTreebankLanguagePack;
import edu.stanford.nlp.trees.Tree;
import edu.stanford.nlp.trees.TreebankLanguagePack;
import edu.stanford.nlp.trees.international.pennchinese.ChineseTreebankLanguagePack;
import edu.stanford.nlp.ui.JarFileChooser;

import javax.swing.*;
import javax.swing.text.SimpleAttributeSet;
import javax.swing.text.StyleConstants;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import javax.swing.event.AncestorEvent;
import javax.swing.event.AncestorListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.InputStreamReader;
import java.io.IOException;
import java.io.OutputStreamWriter;
import java.io.StringReader;
import java.net.URL;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;


/**
 * Provides a simple GUI Panel for Parsing.  Allows a user to load a parser
 * created using lexparser.LexicalizedParser, load a text data file or type
 * in text, parse sentences within the input text, and view the resultant
 * parse tree.
 *
 * @author Huy Nguyen (htnguyen@cs.stanford.edu)
 */
public class ParserPanel extends JPanel  {

  /** A logger for this class */
<span class="nc" id="L77">  private static Redwood.RedwoodChannels log = Redwood.channels(ParserPanel.class);</span>

  /**
   *
   */
  private static final long serialVersionUID = -2118491857333662471L;
  // constants for language specification
  public static final int UNTOKENIZED_ENGLISH = 0;
  public static final int TOKENIZED_CHINESE = 1;
  public static final int UNTOKENIZED_CHINESE = 2;

  private static TreebankLanguagePack tlp;
<span class="nc" id="L89">  private String encoding = &quot;UTF-8&quot;;</span>

  // one second in milliseconds
  private static final int ONE_SECOND = 1000;
  // parser takes approximately a minute to load
  private static final int PARSER_LOAD_TIME = 60;
  // parser takes 5-60 seconds to parse a sentence
  private static final int PARSE_TIME = 30;

  // constants for finding nearest sentence boundary
  private static final int SEEK_FORWARD = 1;
  private static final int SEEK_BACK = -1;

  private final JFileChooser jfc;
  private final JFileChooserLocation jfcLocation;
  private final JarFileChooser chooseJarParser;
  private OpenPageDialog pageDialog;

  // for highlighting
  private SimpleAttributeSet normalStyle, highlightStyle;
  private int startIndex, endIndex;

  private TreeJPanel treePanel;
  private LexicalizedParser parser;

  // worker threads to handle long operations
  private LoadParserThread lpThread;
  private ParseThread parseThread;

  // to monitor progress of long operations
  private javax.swing.Timer timer;
  //private ProgressMonitor progressMonitor;
  private int count; // progress count
  // use glass pane to block input to components other than progressMonitor
  private Component glassPane;

  /** Whether to scroll one sentence forward after parsing. */
  private boolean scrollWhenDone;

  /**
   * Creates new form ParserPanel
   */
<span class="nc" id="L131">  public ParserPanel() {</span>
<span class="nc" id="L132">    initComponents();</span>

    // create dialogs for file selection
<span class="nc" id="L135">    jfc = new JFileChooser(System.getProperty(&quot;user.dir&quot;));</span>
<span class="nc" id="L136">    pageDialog = new OpenPageDialog(new Frame(), true);</span>
<span class="nc" id="L137">    pageDialog.setFileChooser(jfc);</span>

<span class="nc" id="L139">    jfcLocation = new JFileChooserLocation(jfc);</span>

<span class="nc" id="L141">    tlp = new PennTreebankLanguagePack();</span>
<span class="nc" id="L142">    encoding = tlp.getEncoding();</span>
<span class="nc" id="L143">    setFont();</span>

    // create a timer
<span class="nc" id="L146">    timer = new javax.swing.Timer(ONE_SECOND, new TimerListener());</span>

    // for (un)highlighting text
<span class="nc" id="L149">    highlightStyle = new SimpleAttributeSet();</span>
<span class="nc" id="L150">    normalStyle = new SimpleAttributeSet();</span>
<span class="nc" id="L151">    StyleConstants.setBackground(highlightStyle, Color.yellow);</span>
<span class="nc" id="L152">    StyleConstants.setBackground(normalStyle, textPane.getBackground());</span>

<span class="nc" id="L154">    this.chooseJarParser = new JarFileChooser(&quot;.*\\.ser\\.gz&quot;, this);</span>
<span class="nc" id="L155">  }</span>

  /**
   * Scrolls back one sentence in the text
   */
  public void scrollBack() {
<span class="nc" id="L161">    highlightSentence(startIndex - 1);</span>
    // scroll to highlight location
<span class="nc" id="L163">    textPane.setCaretPosition(startIndex);</span>
<span class="nc" id="L164">  }</span>

  /**
   * Scrolls forward one sentence in the text
   */
  public void scrollForward() {
<span class="nc" id="L170">    highlightSentence(endIndex + 1);</span>
    // scroll to highlight location
<span class="nc" id="L172">    textPane.setCaretPosition(startIndex);</span>
<span class="nc" id="L173">  }</span>

  /**
   * Highlights specified text region by changing the character attributes
   */
  private void highlightText(int start, int end, SimpleAttributeSet style) {
<span class="nc bnc" id="L179" title="All 2 branches missed.">    if (start &lt; end) {</span>
<span class="nc" id="L180">      textPane.getStyledDocument().setCharacterAttributes(start, end - start + 1, style, false);</span>
    }
<span class="nc" id="L182">  }</span>

  /**
   * Finds the sentence delimited by the closest sentence delimiter preceding
   * start and closest period following start.
   */
  private void highlightSentence(int start) {
<span class="nc" id="L189">    highlightSentence(start, -1);</span>
<span class="nc" id="L190">  }</span>

  /**
   * Finds the sentence delimited by the closest sentence delimiter preceding
   * start and closest period following end.  If end is less than start
   * (or -1), sets right boundary as closest period following start.
   * Actually starts search for preceding sentence delimiter at (start-1)
   */
  private void highlightSentence(int start, int end) {
    // clears highlight.  paints over entire document because the document may have changed
<span class="nc" id="L200">    highlightText(0, textPane.getText().length(), normalStyle);</span>

    // if start&lt;1 set startIndex to 0, otherwise set to index following closest preceding period
<span class="nc bnc" id="L203" title="All 2 branches missed.">    startIndex = (start &lt; 1) ? 0 : nearestDelimiter(textPane.getText(), start, SEEK_BACK) + 1;</span>

    // if end&lt;startIndex, set endIndex to closest period following startIndex
    // else, set it to closest period following end
<span class="nc bnc" id="L207" title="All 2 branches missed.">    endIndex = nearestDelimiter(textPane.getText(), (end &lt; startIndex) ? startIndex : end, SEEK_FORWARD);</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">    if (endIndex == -1) {</span>
<span class="nc" id="L209">      endIndex = textPane.getText().length() - 1;</span>
    }

<span class="nc" id="L212">    highlightText(startIndex, endIndex, highlightStyle);</span>

    // enable/disable scroll buttons as necessary
<span class="nc bnc" id="L215" title="All 2 branches missed.">    backButton.setEnabled(startIndex != 0);</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">    forwardButton.setEnabled(endIndex != textPane.getText().length() - 1);</span>
<span class="nc bnc" id="L217" title="All 4 branches missed.">    parseNextButton.setEnabled(forwardButton.isEnabled() &amp;&amp; parser != null);</span>
<span class="nc" id="L218">  }</span>

  /**
   * Finds the nearest delimiter starting from index start. If &lt;tt&gt;seekDir&lt;/tt&gt;
   * is SEEK_FORWARD, finds the nearest delimiter after start.  Else, if it is
   * SEEK_BACK, finds the nearest delimiter before start.
   */
  private int nearestDelimiter(String text, int start, int seekDir) {
<span class="nc bnc" id="L226" title="All 4 branches missed.">    if (seekDir != SEEK_BACK &amp;&amp; seekDir != SEEK_FORWARD) {</span>
<span class="nc" id="L227">      throw new IllegalArgumentException(&quot;Unknown seek direction &quot; +</span>
                                         seekDir);
    }
<span class="nc" id="L230">    StringReader reader = new StringReader(text);</span>
<span class="nc" id="L231">    DocumentPreprocessor processor = new DocumentPreprocessor(reader);</span>
<span class="nc" id="L232">    TokenizerFactory&lt;? extends HasWord&gt; tf = tlp.getTokenizerFactory();</span>
<span class="nc" id="L233">    processor.setTokenizerFactory(tf);</span>
<span class="nc" id="L234">    List&lt;Integer&gt; boundaries = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">    for (List&lt;HasWord&gt; sentence : processor) {</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">      if (sentence.size() == 0)</span>
<span class="nc" id="L237">        continue;</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">      if (!(sentence.get(0) instanceof HasOffset)) {</span>
<span class="nc" id="L239">        throw new ClassCastException(&quot;Expected HasOffsets from the &quot; +</span>
                                     &quot;DocumentPreprocessor&quot;);
      }
<span class="nc bnc" id="L242" title="All 2 branches missed.">      if (boundaries.size() == 0) {</span>
<span class="nc" id="L243">        boundaries.add(0);</span>
      } else {
<span class="nc" id="L245">        HasOffset first = (HasOffset) sentence.get(0);</span>
<span class="nc" id="L246">        boundaries.add(first.beginPosition());</span>
      }
<span class="nc" id="L248">    }</span>
<span class="nc" id="L249">    boundaries.add(text.length());</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">    for (int i = 0; i &lt; boundaries.size() - 1; ++i) {</span>
<span class="nc bnc" id="L251" title="All 4 branches missed.">      if (boundaries.get(i) &lt;= start &amp;&amp; start &lt; boundaries.get(i + 1)) {</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">        if (seekDir == SEEK_BACK) {</span>
<span class="nc" id="L253">          return boundaries.get(i) - 1;</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">        } else if (seekDir == SEEK_FORWARD) {</span>
<span class="nc" id="L255">          return boundaries.get(i + 1) - 1;</span>
        }
      }
    }
    // The cursor position at the end is actually one past the text length.
    // We might as well highlight the last interval in that case.
<span class="nc bnc" id="L261" title="All 4 branches missed.">    if (boundaries.size() &gt;= 2 &amp;&amp; start &gt;= text.length()) {</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">      if (seekDir == SEEK_BACK) {</span>
<span class="nc" id="L263">        return boundaries.get(boundaries.size() - 2) - 1;</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">      } else if (seekDir == SEEK_FORWARD) {</span>
<span class="nc" id="L265">        return boundaries.get(boundaries.size() - 1) - 1;</span>
      }
    }
<span class="nc" id="L268">    return -1;</span>
  }

  /**
   * Highlights the sentence that is currently being selected by user
   * (via mouse highlight)
   */
  private void highlightSelectedSentence() {
<span class="nc" id="L276">    highlightSentence(textPane.getSelectionStart(), textPane.getSelectionEnd());</span>
<span class="nc" id="L277">  }</span>

  /**
   * Highlights the sentence that is currently being edited
   */
  private void highlightEditedSentence() {
<span class="nc" id="L283">    highlightSentence(textPane.getCaretPosition());</span>

<span class="nc" id="L285">  }</span>

  /**
   * Sets the status text at the bottom of the ParserPanel.
   */
  public void setStatus(String status) {
<span class="nc" id="L291">    statusLabel.setText(status);</span>
<span class="nc" id="L292">  }</span>

  private void setFont() {
<span class="nc bnc" id="L295" title="All 2 branches missed.">    if (tlp instanceof ChineseTreebankLanguagePack) {</span>
<span class="nc" id="L296">      setChineseFont();</span>
    } else {
<span class="nc" id="L298">      textPane.setFont(new Font(&quot;Sans Serif&quot;, Font.PLAIN, 14));</span>
<span class="nc" id="L299">      treePanel.setFont(new Font(&quot;Sans Serif&quot;, Font.PLAIN, 14));</span>
    }
<span class="nc" id="L301">  }</span>

  private void setChineseFont() {
<span class="nc" id="L304">    java.util.List&lt;Font&gt; fonts = FontDetector.supportedFonts(FontDetector.CHINESE);</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">    if (fonts.size() &gt; 0) {</span>
<span class="nc" id="L306">      Font font = new Font(fonts.get(0).getName(), Font.PLAIN, 14);</span>
<span class="nc" id="L307">      textPane.setFont(font);</span>
<span class="nc" id="L308">      treePanel.setFont(font);</span>
<span class="nc" id="L309">      log.info(&quot;Selected font &quot; + font);</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">    } else if (FontDetector.hasFont(&quot;Watanabe Mincho&quot;)) {</span>
<span class="nc" id="L311">      textPane.setFont(new Font(&quot;Watanabe Mincho&quot;, Font.PLAIN, 14));</span>
<span class="nc" id="L312">      treePanel.setFont(new Font(&quot;Watanabe Mincho&quot;, Font.PLAIN, 14));</span>
    } else {
<span class="nc" id="L314">      textPane.setFont(new Font(&quot;Sans Serif&quot;, Font.PLAIN, 14));</span>
<span class="nc" id="L315">      treePanel.setFont(new Font(&quot;Sans Serif&quot;, Font.PLAIN, 14));</span>
    }
<span class="nc" id="L317">  }</span>


  /**
   * Tokenizes the highlighted text (using a tokenizer appropriate for the
   * selected language, and initiates the ParseThread to parse the tokenized
   * text.
   */
  public void parse() {
<span class="nc bnc" id="L326" title="All 2 branches missed.">    if (textPane.getText().length() == 0) {</span>
<span class="nc" id="L327">      return;</span>
    }

    // use endIndex+1 because substring subtracts 1
<span class="nc" id="L331">    String text = textPane.getText().substring(startIndex, endIndex + 1).trim();</span>

<span class="nc bnc" id="L333" title="All 4 branches missed.">    if (parser != null &amp;&amp; text.length() &gt; 0) {</span>
      //Tokenizer&lt;? extends HasWord&gt; toke = tlp.getTokenizerFactory().getTokenizer(new CharArrayReader(text.toCharArray()));
<span class="nc" id="L335">      Tokenizer&lt;? extends HasWord&gt; toke = tlp.getTokenizerFactory().getTokenizer(new StringReader(text));</span>
<span class="nc" id="L336">      List&lt;? extends HasWord&gt; wordList = toke.tokenize();</span>
<span class="nc" id="L337">      parseThread = new ParseThread(wordList);</span>
<span class="nc" id="L338">      parseThread.start();</span>
<span class="nc" id="L339">      startProgressMonitor(&quot;Parsing&quot;, PARSE_TIME);</span>
    }
<span class="nc" id="L341">  }</span>

  /**
   * Opens dialog to load a text data file
   */
  public void loadFile() {
    // centers dialog in panel
<span class="nc" id="L348">    pageDialog.setLocation(getLocationOnScreen().x + (getWidth() - pageDialog.getWidth()) / 2, getLocationOnScreen().y + (getHeight() - pageDialog.getHeight()) / 2);</span>
<span class="nc" id="L349">    pageDialog.setVisible(true);</span>

<span class="nc bnc" id="L351" title="All 2 branches missed.">    if (pageDialog.getStatus() == OpenPageDialog.APPROVE_OPTION) {</span>
<span class="nc" id="L352">      loadFile(pageDialog.getPage());</span>
    }
<span class="nc" id="L354">  }</span>

  /**
   * Loads a text or html file from a file path or URL.  Treats anything
   * beginning with &lt;tt&gt;http:\\&lt;/tt&gt;,&lt;tt&gt;.htm&lt;/tt&gt;, or &lt;tt&gt;.html&lt;/tt&gt; as an
   * html file, and strips all tags from the document
   */
  public void loadFile(String filename) {
<span class="nc bnc" id="L362" title="All 2 branches missed.">    if (filename == null) {</span>
<span class="nc" id="L363">      return;</span>
    }

<span class="nc" id="L366">    File file = new File(filename);</span>

<span class="nc" id="L368">    String urlOrFile = filename;</span>
    // if file can't be found locally, try prepending http:// and looking on web
<span class="nc bnc" id="L370" title="All 4 branches missed.">    if (!file.exists() &amp;&amp; filename.indexOf(&quot;://&quot;) == -1) {</span>
<span class="nc" id="L371">      urlOrFile = &quot;http://&quot; + filename;</span>
    }
    // else prepend file:// to handle local html file urls
<span class="nc bnc" id="L374" title="All 2 branches missed.">    else if (filename.indexOf(&quot;://&quot;) == -1) {</span>
<span class="nc" id="L375">      urlOrFile = &quot;file://&quot; + filename;</span>
    }

    // TODO: why do any of this instead of just reading the file?
    // Also, is this working correctly still?
    // load the document
    Document&lt;Object, Word, Word&gt; doc;
    try {
<span class="nc bnc" id="L383" title="All 6 branches missed.">      if (urlOrFile.startsWith(&quot;http://&quot;) || urlOrFile.endsWith(&quot;.htm&quot;) || urlOrFile.endsWith(&quot;.html&quot;)) {</span>
        // strip tags from html documents
<span class="nc" id="L385">        Document&lt;Object, Word, Word&gt; docPre = new BasicDocument&lt;&gt;().init(new URL(urlOrFile));</span>
<span class="nc" id="L386">        DocumentProcessor&lt;Word, Word, Object, Word&gt; noTags = new StripTagsProcessor&lt;&gt;();</span>
<span class="nc" id="L387">        doc = noTags.processDocument(docPre);</span>
<span class="nc" id="L388">      } else {</span>
<span class="nc" id="L389">        doc = new BasicDocument&lt;&gt;(this.getTokenizerFactory()).init(new InputStreamReader(new FileInputStream(filename), encoding));</span>
      }
<span class="nc" id="L391">    } catch (Exception e) {</span>
<span class="nc" id="L392">      JOptionPane.showMessageDialog(this, &quot;Could not load file &quot; + filename + &quot;\n&quot; + e, null, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L393">      e.printStackTrace();</span>
<span class="nc" id="L394">      setStatus(&quot;Error loading document&quot;);</span>
<span class="nc" id="L395">      return;</span>
<span class="nc" id="L396">    }</span>

    // load the document into the text pane
<span class="nc" id="L399">    StringBuilder docStr = new StringBuilder();</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">    for (Word aDoc : doc) {</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">      if (docStr.length() &gt; 0) {</span>
<span class="nc" id="L402">        docStr.append(' ');</span>
      }
<span class="nc" id="L404">      docStr.append(aDoc.toString());</span>
<span class="nc" id="L405">    }</span>
<span class="nc" id="L406">    textPane.setText(docStr.toString());</span>
<span class="nc" id="L407">    dataFileLabel.setText(urlOrFile);</span>

<span class="nc" id="L409">    highlightSentence(0);</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">    forwardButton.setEnabled(endIndex != textPane.getText().length() - 1);</span>
    // scroll to top of document
<span class="nc" id="L412">    textPane.setCaretPosition(0);</span>

<span class="nc" id="L414">    setStatus(&quot;Done&quot;);</span>
<span class="nc" id="L415">  }</span>

  // TreebankLanguagePack returns a TokenizerFactory&lt;? extends HasWord&gt;
  // which isn't close enough in the type system, but is probably okay in practice
  @SuppressWarnings(&quot;unchecked&quot;)
  private TokenizerFactory&lt;Word&gt; getTokenizerFactory() {
<span class="nc" id="L421">    return (TokenizerFactory&lt;Word&gt;)tlp.getTokenizerFactory();</span>
  }

  /**
   * Opens a dialog and saves the output of the parser on the current
   * text.  If there is no current text, yell at the user and make
   * them feel bad instead.
   */
  public void saveOutput() {
<span class="nc bnc" id="L430" title="All 2 branches missed.">    if (textPane.getText().trim().length() == 0) {</span>
<span class="nc" id="L431">      JOptionPane.showMessageDialog(this, &quot;No text to parse &quot;, null,</span>
                                    JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L433">      return;</span>
    }

<span class="nc" id="L436">    jfc.setDialogTitle(&quot;Save file&quot;);</span>
<span class="nc" id="L437">    int status = jfc.showSaveDialog(this);</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">    if (status == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L439">      saveOutput(jfc.getSelectedFile().getPath());</span>
    }
<span class="nc" id="L441">  }</span>

  /**
   * Saves the results of applying the parser to the current text to
   * the specified filename.
   */
  public void saveOutput(String filename) {
<span class="nc bnc" id="L448" title="All 4 branches missed.">    if (filename == null || filename.equals(&quot;&quot;)) {</span>
<span class="nc" id="L449">      return;</span>
    }

<span class="nc" id="L452">    String text = textPane.getText();</span>
<span class="nc" id="L453">    StringReader reader = new StringReader(text);</span>
<span class="nc" id="L454">    DocumentPreprocessor processor = new DocumentPreprocessor(reader);</span>
<span class="nc" id="L455">    TokenizerFactory&lt;? extends HasWord&gt; tf = tlp.getTokenizerFactory();</span>
<span class="nc" id="L456">    processor.setTokenizerFactory(tf);</span>
<span class="nc" id="L457">    List&lt;List&lt;HasWord&gt;&gt; sentences = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">    for (List&lt;HasWord&gt; sentence : processor) {</span>
<span class="nc" id="L459">      sentences.add(sentence);</span>
<span class="nc" id="L460">    }</span>

<span class="nc" id="L462">    JProgressBar progress = new JProgressBar(0, sentences.size());</span>
<span class="nc" id="L463">    JButton cancel = new javax.swing.JButton();</span>

<span class="nc" id="L465">    JDialog dialog = new JDialog(new Frame(), &quot;Parser Progress&quot;, true);</span>

<span class="nc" id="L467">    dialog.setSize(300, 150);</span>
<span class="nc" id="L468">    dialog.add(BorderLayout.NORTH,</span>
<span class="nc" id="L469">               new JLabel(&quot;Parsing &quot; + sentences.size() + &quot; sentences&quot;));</span>
<span class="nc" id="L470">    dialog.add(BorderLayout.CENTER, progress);</span>
<span class="nc" id="L471">    dialog.add(BorderLayout.SOUTH, cancel);</span>
    //dialog.add(progress);

<span class="nc" id="L474">    final SaveOutputThread thread =</span>
      new SaveOutputThread(filename, progress, dialog, cancel, sentences);

<span class="nc" id="L477">    cancel.setText(&quot;Cancel&quot;);</span>
<span class="nc" id="L478">    cancel.setToolTipText(&quot;Cancel&quot;);</span>
<span class="nc" id="L479">    cancel.addActionListener(evt -&gt; thread.cancelled = true);</span>

<span class="nc" id="L481">    thread.start();</span>

<span class="nc" id="L483">    dialog.setVisible(true);</span>
<span class="nc" id="L484">  }</span>

  /**
   * This class does the processing of the dialog box to a file.  It
   * also checks the cancelled variable after each processing to see
   * if the user has chosen to cancel.  After running, it changes the
   * label on the &quot;cancel&quot; button, waits a couple seconds, and then
   * hides whatever dialog was passed in when originally created.
   */
  class SaveOutputThread extends Thread {
    String filename;
    JProgressBar progress;
    JDialog dialog;
    JButton button;
    List&lt;List&lt;HasWord&gt;&gt; sentences;

    boolean cancelled;

    public SaveOutputThread(String filename, JProgressBar progress,
                            JDialog dialog, JButton button,
<span class="nc" id="L504">                            List&lt;List&lt;HasWord&gt;&gt; sentences) {</span>
<span class="nc" id="L505">      this.filename = filename;</span>
<span class="nc" id="L506">      this.progress = progress;</span>
<span class="nc" id="L507">      this.dialog = dialog;</span>
<span class="nc" id="L508">      this.button = button;</span>
<span class="nc" id="L509">      this.sentences = sentences;</span>
<span class="nc" id="L510">    }</span>

    public void run() {
<span class="nc" id="L513">      int failures = 0;</span>
      try {
<span class="nc" id="L515">        FileOutputStream fos = new FileOutputStream(filename);</span>
<span class="nc" id="L516">        OutputStreamWriter ow = new OutputStreamWriter(fos, &quot;utf-8&quot;);</span>
<span class="nc" id="L517">        BufferedWriter bw = new BufferedWriter(ow);</span>

<span class="nc bnc" id="L519" title="All 2 branches missed.">        for (List&lt;HasWord&gt; sentence : sentences) {</span>
<span class="nc" id="L520">          Tree tree = parser.parseTree(sentence);</span>
<span class="nc bnc" id="L521" title="All 2 branches missed.">          if (tree == null) {</span>
<span class="nc" id="L522">            ++failures;</span>
<span class="nc" id="L523">            log.info(&quot;Failed on sentence &quot; + sentence);</span>
          } else {
<span class="nc" id="L525">            bw.write(tree.toString());</span>
<span class="nc" id="L526">            bw.newLine();</span>
          }

<span class="nc" id="L529">          progress.setValue(progress.getValue() + 1);</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">          if (cancelled) {</span>
<span class="nc" id="L531">            break;</span>
          }
<span class="nc" id="L533">        }</span>
<span class="nc" id="L534">        bw.flush();</span>
<span class="nc" id="L535">        bw.close();</span>
<span class="nc" id="L536">        ow.close();</span>
<span class="nc" id="L537">        fos.close();</span>
<span class="nc" id="L538">      } catch (IOException e) {</span>
<span class="nc" id="L539">        JOptionPane.showMessageDialog(ParserPanel.this, &quot;Could not save file &quot; + filename + &quot;\n&quot; + e, null, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L540">        e.printStackTrace();</span>
<span class="nc" id="L541">        setStatus(&quot;Error saving parsed document&quot;);</span>
<span class="nc" id="L542">      }</span>

<span class="nc bnc" id="L544" title="All 2 branches missed.">      if (failures == 0) {</span>
<span class="nc" id="L545">        button.setText(&quot;Success!&quot;);</span>
      } else {
<span class="nc" id="L547">        button.setText(&quot;Done.  &quot; + failures + &quot; parses failed&quot;);</span>
      }
<span class="nc bnc" id="L549" title="All 4 branches missed.">      if (cancelled &amp;&amp; failures == 0) {</span>
<span class="nc" id="L550">        dialog.setVisible(false);</span>
      } else {
<span class="nc" id="L552">        button.addActionListener(evt -&gt; dialog.setVisible(false));</span>
      }
<span class="nc" id="L554">    }</span>

    static final int WAIT = 2000;
    static final int CYCLE = 50;
  }

  /**
   * Opens dialog to load a serialized parser
   */
  public void loadParser() {
<span class="nc" id="L564">    jfc.setDialogTitle(&quot;Load parser&quot;);</span>
<span class="nc" id="L565">    int status = jfc.showOpenDialog(this);</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">    if (status == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L567">      String filename = jfc.getSelectedFile().getPath();</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">      if (filename.endsWith(&quot;.jar&quot;)) {</span>
<span class="nc" id="L569">        String model = chooseJarParser.show(filename, jfcLocation.location);</span>
<span class="nc bnc" id="L570" title="All 2 branches missed.">        if (model != null) {</span>
<span class="nc" id="L571">          loadJarParser(filename, model);</span>
        }
<span class="nc" id="L573">      } else {</span>
<span class="nc" id="L574">        loadParser(filename);</span>
      }
    }
<span class="nc" id="L577">  }</span>

  public void loadJarParser(String jarFile, String model) {
<span class="nc" id="L580">    lpThread = new LoadParserThread(jarFile, model);</span>
<span class="nc" id="L581">    lpThread.start();</span>
<span class="nc" id="L582">    startProgressMonitor(&quot;Loading Parser&quot;, PARSER_LOAD_TIME);</span>
<span class="nc" id="L583">  }</span>

  /**
   * Loads a serialized parser specified by given path
   */
  public void loadParser(String filename) {
<span class="nc bnc" id="L589" title="All 2 branches missed.">    if (filename == null) {</span>
<span class="nc" id="L590">      return;</span>
    }

    // check if file exists before we start the worker thread and progress monitor
<span class="nc" id="L594">    File file = new File(filename);</span>
<span class="nc bnc" id="L595" title="All 2 branches missed.">    if (file.exists()) {</span>
<span class="nc" id="L596">      lpThread = new LoadParserThread(filename);</span>
<span class="nc" id="L597">      lpThread.start();</span>
<span class="nc" id="L598">      startProgressMonitor(&quot;Loading Parser&quot;, PARSER_LOAD_TIME);</span>
    } else {
<span class="nc" id="L600">      JOptionPane.showMessageDialog(this, &quot;Could not find file &quot; + filename, null, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L601">      setStatus(&quot;Error loading parser&quot;);</span>
    }
<span class="nc" id="L603">  }</span>

  /**
   * Initializes the progress bar with the status text, and the expected
   * number of seconds the process will take, and starts the timer.
   */
  private void startProgressMonitor(String text, int maxCount) {
<span class="nc bnc" id="L610" title="All 2 branches missed.">    if (glassPane == null) {</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">      if (getRootPane() != null) {</span>
<span class="nc" id="L612">        glassPane = getRootPane().getGlassPane();</span>
<span class="nc" id="L613">        glassPane.addMouseListener(new MouseAdapter() {</span>
          @Override
          public void mouseClicked(MouseEvent evt) {
<span class="nc" id="L616">            Toolkit.getDefaultToolkit().beep();</span>
<span class="nc" id="L617">          }</span>
        });
      }
    }
<span class="nc bnc" id="L621" title="All 2 branches missed.">    if (glassPane != null) {</span>
<span class="nc" id="L622">      glassPane.setVisible(true); // block input to components</span>
    }

<span class="nc" id="L625">    statusLabel.setText(text);</span>
<span class="nc" id="L626">    progressBar.setMaximum(maxCount);</span>
<span class="nc" id="L627">    progressBar.setValue(0);</span>
<span class="nc" id="L628">    count = 0;</span>
<span class="nc" id="L629">    timer.start();</span>
<span class="nc" id="L630">    progressBar.setVisible(true);</span>
<span class="nc" id="L631">  }</span>

  /**
   * At the end of a task, shut down the progress monitor
   */
  private void stopProgressMonitor() {
<span class="nc" id="L637">    timer.stop();</span>
    /*if(progressMonitor!=null) {
        progressMonitor.setProgress(progressMonitor.getMaximum());
        progressMonitor.close();
    }*/
<span class="nc" id="L642">    progressBar.setVisible(false);</span>
<span class="nc bnc" id="L643" title="All 2 branches missed.">    if (glassPane != null) {</span>
<span class="nc" id="L644">      glassPane.setVisible(false); // restore input to components</span>
    }
<span class="nc" id="L646">    lpThread = null;</span>
<span class="nc" id="L647">    parseThread = null;</span>
<span class="nc" id="L648">  }</span>

  /**
   * Worker thread for loading the parser.  Loading a parser usually
   * takes ~15s
   */
  private class LoadParserThread extends Thread {
    final String zipFilename;
    final String filename;

<span class="nc" id="L658">    LoadParserThread(String filename) {</span>
<span class="nc" id="L659">      this.filename = filename;</span>
<span class="nc" id="L660">      this.zipFilename = null;</span>
<span class="nc" id="L661">    }</span>

<span class="nc" id="L663">    LoadParserThread(String zipFilename, String filename) {</span>
<span class="nc" id="L664">      this.zipFilename = zipFilename;</span>
<span class="nc" id="L665">      this.filename = filename;</span>
<span class="nc" id="L666">    }</span>

    @Override
    public void run() {
      try {
<span class="nc bnc" id="L671" title="All 2 branches missed.">        if (zipFilename != null) {</span>
<span class="nc" id="L672">          parser = LexicalizedParser.loadModelFromZip(zipFilename, filename);</span>
        } else {
<span class="nc" id="L674">          parser = LexicalizedParser.loadModel(filename);</span>
        }
<span class="nc" id="L676">      } catch (Exception ex) {</span>
<span class="nc" id="L677">        JOptionPane.showMessageDialog(ParserPanel.this, &quot;Error loading parser: &quot; + filename, null, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L678">        setStatus(&quot;Error loading parser&quot;);</span>
<span class="nc" id="L679">        parser = null;</span>
<span class="nc" id="L680">      } catch (OutOfMemoryError e) {</span>
<span class="nc" id="L681">        JOptionPane.showMessageDialog(ParserPanel.this, &quot;Could not load parser. Out of memory.&quot;, null, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L682">        setStatus(&quot;Error loading parser&quot;);</span>
<span class="nc" id="L683">        parser = null;</span>
<span class="nc" id="L684">      }</span>

<span class="nc" id="L686">      stopProgressMonitor();</span>
<span class="nc bnc" id="L687" title="All 2 branches missed.">      if (parser != null) {</span>
<span class="nc" id="L688">        setStatus(&quot;Loaded parser.&quot;);</span>
<span class="nc" id="L689">        parserFileLabel.setText(&quot;Parser: &quot; + filename);</span>
<span class="nc" id="L690">        parseButton.setEnabled(true);</span>
<span class="nc" id="L691">        parseNextButton.setEnabled(true);</span>
<span class="nc" id="L692">        saveOutputButton.setEnabled(true);</span>

<span class="nc" id="L694">        tlp = parser.getOp().langpack();</span>
<span class="nc" id="L695">        encoding = tlp.getEncoding();</span>
      }
<span class="nc" id="L697">    }</span>
  }

  /**
   * Worker thread for parsing.  Parsing a sentence usually takes ~5-60 sec
   */
  private class ParseThread extends Thread {

    List&lt;? extends HasWord&gt; sentence;

<span class="nc" id="L707">    public ParseThread(List&lt;? extends HasWord&gt; sentence) {</span>
<span class="nc" id="L708">      this.sentence = sentence;</span>
<span class="nc" id="L709">    }</span>

    @Override
    public void run() {
      boolean successful;
<span class="nc" id="L714">      ParserQuery parserQuery = parser.parserQuery();</span>
      try {
<span class="nc" id="L716">        successful = parserQuery.parse(sentence);</span>
<span class="nc" id="L717">      } catch (Exception e) {</span>
<span class="nc" id="L718">        stopProgressMonitor();</span>
<span class="nc" id="L719">        JOptionPane.showMessageDialog(ParserPanel.this, &quot;Could not parse selected sentence\n(sentence probably too long)&quot;, null, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L720">        setStatus(&quot;Error parsing&quot;);</span>
<span class="nc" id="L721">        return;</span>
<span class="nc" id="L722">      }</span>

<span class="nc" id="L724">      stopProgressMonitor();</span>
<span class="nc" id="L725">      setStatus(&quot;Done&quot;);</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">      if (successful) {</span>
        // display the best parse
<span class="nc" id="L728">        Tree tree = parserQuery.getBestParse();</span>
        //tree.pennPrint();
<span class="nc" id="L730">        treePanel.setTree(tree);</span>
<span class="nc" id="L731">        clearButton.setEnabled(true);</span>
<span class="nc" id="L732">      } else {</span>
<span class="nc" id="L733">        JOptionPane.showMessageDialog(ParserPanel.this, &quot;Could not parse selected sentence&quot;, null, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L734">        setStatus(&quot;Error parsing&quot;);</span>
<span class="nc" id="L735">        treePanel.setTree(null);</span>
<span class="nc" id="L736">        clearButton.setEnabled(false);</span>
      }
<span class="nc bnc" id="L738" title="All 2 branches missed.">      if (scrollWhenDone) {</span>
<span class="nc" id="L739">        scrollForward();</span>
      }
<span class="nc" id="L741">    }</span>
  }

  private static class JFileChooserLocation implements AncestorListener {
    Point location;

    JFileChooser jfc;

<span class="nc" id="L749">    JFileChooserLocation(JFileChooser jfc) {</span>
<span class="nc" id="L750">      this.jfc = jfc;</span>
<span class="nc" id="L751">      jfc.addAncestorListener(this);</span>
<span class="nc" id="L752">    }</span>

    public void ancestorAdded(AncestorEvent event) {
<span class="nc" id="L755">      location = jfc.getTopLevelAncestor().getLocationOnScreen();</span>
<span class="nc" id="L756">    }</span>

    public void ancestorMoved(AncestorEvent event) {
<span class="nc" id="L759">      location = jfc.getTopLevelAncestor().getLocationOnScreen();</span>
<span class="nc" id="L760">    }</span>

<span class="nc" id="L762">    public void ancestorRemoved(AncestorEvent event) { }</span>
  }

  /**
   * Simulates a timer to update the progress monitor
   */
<span class="nc" id="L768">  private class TimerListener implements ActionListener {</span>
    public void actionPerformed(ActionEvent e) {
      //progressMonitor.setProgress(Math.min(count++,progressMonitor.getMaximum()-1));
<span class="nc" id="L771">      progressBar.setValue(Math.min(count++, progressBar.getMaximum() - 1));</span>
<span class="nc" id="L772">    }</span>
  }

  /**
   * This method is called from within the constructor to
   * initialize the form.
   * WARNING: Do NOT modify this code. The content of this method is
   * always regenerated by the Form Editor.
   */
  private void initComponents()//GEN-BEGIN:initComponents
  {
<span class="nc" id="L783">    splitPane = new javax.swing.JSplitPane();</span>
<span class="nc" id="L784">    topPanel = new javax.swing.JPanel();</span>
<span class="nc" id="L785">    buttonsAndFilePanel = new javax.swing.JPanel();</span>
<span class="nc" id="L786">    loadButtonPanel = new javax.swing.JPanel();</span>
<span class="nc" id="L787">    loadFileButton = new javax.swing.JButton();</span>
<span class="nc" id="L788">    loadParserButton = new javax.swing.JButton();</span>
<span class="nc" id="L789">    saveOutputButton = new javax.swing.JButton();</span>
<span class="nc" id="L790">    buttonPanel = new javax.swing.JPanel();</span>
<span class="nc" id="L791">    backButton = new javax.swing.JButton();</span>
<span class="nc bnc" id="L792" title="All 2 branches missed.">    if (getClass().getResource(&quot;/edu/stanford/nlp/parser/ui/leftarrow.gif&quot;) != null) {</span>
<span class="nc" id="L793">      backButton.setIcon(new javax.swing.ImageIcon(getClass().getResource(&quot;/edu/stanford/nlp/parser/ui/leftarrow.gif&quot;)));</span>
    } else {
<span class="nc" id="L795">      backButton.setText(&quot;&lt; Prev&quot;);</span>
    }
<span class="nc" id="L797">    forwardButton = new javax.swing.JButton();</span>
<span class="nc bnc" id="L798" title="All 2 branches missed.">    if (getClass().getResource(&quot;/edu/stanford/nlp/parser/ui/rightarrow.gif&quot;) != null) {</span>
<span class="nc" id="L799">      forwardButton.setIcon(new javax.swing.ImageIcon(getClass().getResource(&quot;/edu/stanford/nlp/parser/ui/rightarrow.gif&quot;)));</span>
    } else {
<span class="nc" id="L801">      forwardButton.setText(&quot;Next &gt;&quot;);</span>
    }
<span class="nc" id="L803">    parseButton = new javax.swing.JButton();</span>
<span class="nc" id="L804">    parseNextButton = new javax.swing.JButton();</span>
<span class="nc" id="L805">    clearButton = new javax.swing.JButton();</span>
<span class="nc" id="L806">    dataFilePanel = new javax.swing.JPanel();</span>
<span class="nc" id="L807">    dataFileLabel = new javax.swing.JLabel();</span>
<span class="nc" id="L808">    textScrollPane = new javax.swing.JScrollPane();</span>
<span class="nc" id="L809">    textPane = new javax.swing.JTextPane();</span>
<span class="nc" id="L810">    treeContainer = new javax.swing.JPanel();</span>
<span class="nc" id="L811">    parserFilePanel = new javax.swing.JPanel();</span>
<span class="nc" id="L812">    parserFileLabel = new javax.swing.JLabel();</span>
<span class="nc" id="L813">    statusPanel = new javax.swing.JPanel();</span>
<span class="nc" id="L814">    statusLabel = new javax.swing.JLabel();</span>
<span class="nc" id="L815">    progressBar = new javax.swing.JProgressBar();</span>
<span class="nc" id="L816">    progressBar.setVisible(false);</span>

<span class="nc" id="L818">    setLayout(new java.awt.BorderLayout());</span>

<span class="nc" id="L820">    splitPane.setOrientation(javax.swing.JSplitPane.VERTICAL_SPLIT);</span>
<span class="nc" id="L821">    topPanel.setLayout(new java.awt.BorderLayout());</span>

<span class="nc" id="L823">    buttonsAndFilePanel.setLayout(new javax.swing.BoxLayout(buttonsAndFilePanel, javax.swing.BoxLayout.Y_AXIS));</span>

<span class="nc" id="L825">    loadButtonPanel.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));</span>

<span class="nc" id="L827">    loadFileButton.setText(&quot;Load File&quot;);</span>
<span class="nc" id="L828">    loadFileButton.setToolTipText(&quot;Load a data file.&quot;);</span>
<span class="nc" id="L829">    loadFileButton.addActionListener(evt -&gt; loadFileButtonActionPerformed(evt));</span>

<span class="nc" id="L831">    loadButtonPanel.add(loadFileButton);</span>

<span class="nc" id="L833">    loadParserButton.setText(&quot;Load Parser&quot;);</span>
<span class="nc" id="L834">    loadParserButton.setToolTipText(&quot;Load a serialized parser.&quot;);</span>
<span class="nc" id="L835">    loadParserButton.addActionListener(evt -&gt; loadParserButtonActionPerformed(evt));</span>

<span class="nc" id="L837">    loadButtonPanel.add(loadParserButton);</span>

<span class="nc" id="L839">    saveOutputButton.setText(&quot;Save Output&quot;);</span>
<span class="nc" id="L840">    saveOutputButton.setToolTipText(&quot;Save the processed output.&quot;);</span>
<span class="nc" id="L841">    saveOutputButton.setEnabled(false);</span>
<span class="nc" id="L842">    saveOutputButton.addActionListener(evt -&gt; saveOutputButtonActionPerformed(evt));</span>

<span class="nc" id="L844">    loadButtonPanel.add(saveOutputButton);</span>

<span class="nc" id="L846">    buttonsAndFilePanel.add(loadButtonPanel);</span>

<span class="nc" id="L848">    buttonPanel.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));</span>

<span class="nc" id="L850">    backButton.setToolTipText(&quot;Scroll backward one sentence.&quot;);</span>
<span class="nc" id="L851">    backButton.setEnabled(false);</span>
<span class="nc" id="L852">    backButton.addActionListener(evt -&gt; backButtonActionPerformed(evt));</span>

<span class="nc" id="L854">    buttonPanel.add(backButton);</span>

<span class="nc" id="L856">    forwardButton.setToolTipText(&quot;Scroll forward one sentence.&quot;);</span>
<span class="nc" id="L857">    forwardButton.setEnabled(false);</span>
<span class="nc" id="L858">    forwardButton.addActionListener(evt -&gt; forwardButtonActionPerformed(evt));</span>

<span class="nc" id="L860">    buttonPanel.add(forwardButton);</span>

<span class="nc" id="L862">    parseButton.setText(&quot;Parse&quot;);</span>
<span class="nc" id="L863">    parseButton.setToolTipText(&quot;Parse selected sentence.&quot;);</span>
<span class="nc" id="L864">    parseButton.setEnabled(false);</span>
<span class="nc" id="L865">    parseButton.addActionListener(evt -&gt; parseButtonActionPerformed(evt));</span>

<span class="nc" id="L867">    buttonPanel.add(parseButton);</span>

<span class="nc" id="L869">    parseNextButton.setText(&quot;Parse &gt;&quot;);</span>
<span class="nc" id="L870">    parseNextButton.setToolTipText(&quot;Parse selected sentence and then scrolls forward one sentence.&quot;);</span>
<span class="nc" id="L871">    parseNextButton.setEnabled(false);</span>
<span class="nc" id="L872">    parseNextButton.addActionListener(evt -&gt; parseNextButtonActionPerformed(evt));</span>

<span class="nc" id="L874">    buttonPanel.add(parseNextButton);</span>

<span class="nc" id="L876">    clearButton.setText(&quot;Clear&quot;);</span>
<span class="nc" id="L877">    clearButton.setToolTipText(&quot;Clears parse tree.&quot;);</span>
<span class="nc" id="L878">    clearButton.setEnabled(false);</span>
<span class="nc" id="L879">    clearButton.addActionListener(evt -&gt; clearButtonActionPerformed(evt));</span>

<span class="nc" id="L881">    buttonPanel.add(clearButton);</span>

<span class="nc" id="L883">    buttonsAndFilePanel.add(buttonPanel);</span>

<span class="nc" id="L885">    dataFilePanel.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));</span>

<span class="nc" id="L887">    dataFilePanel.add(dataFileLabel);</span>

<span class="nc" id="L889">    buttonsAndFilePanel.add(dataFilePanel);</span>

<span class="nc" id="L891">    topPanel.add(buttonsAndFilePanel, java.awt.BorderLayout.NORTH);</span>

<span class="nc" id="L893">    textPane.setPreferredSize(new java.awt.Dimension(250, 250));</span>
<span class="nc" id="L894">    textPane.addFocusListener(new java.awt.event.FocusAdapter() {</span>
      @Override
      public void focusLost(java.awt.event.FocusEvent evt) {
<span class="nc" id="L897">        textPaneFocusLost(evt);</span>
<span class="nc" id="L898">      }</span>
    });

<span class="nc" id="L901">    textPane.addMouseListener(new java.awt.event.MouseAdapter() {</span>
      @Override
      public void mouseClicked(java.awt.event.MouseEvent evt) {
<span class="nc" id="L904">        textPaneMouseClicked(evt);</span>
<span class="nc" id="L905">      }</span>
    });

<span class="nc" id="L908">    textPane.addMouseMotionListener(new java.awt.event.MouseMotionAdapter() {</span>
      @Override
      public void mouseDragged(java.awt.event.MouseEvent evt) {
<span class="nc" id="L911">        textPaneMouseDragged(evt);</span>
<span class="nc" id="L912">      }</span>
    });

<span class="nc" id="L915">    textScrollPane.setViewportView(textPane);</span>

<span class="nc" id="L917">    topPanel.add(textScrollPane, java.awt.BorderLayout.CENTER);</span>

<span class="nc" id="L919">    splitPane.setLeftComponent(topPanel);</span>

<span class="nc" id="L921">    treeContainer.setLayout(new java.awt.BorderLayout());</span>

<span class="nc" id="L923">    treeContainer.setBackground(new java.awt.Color(255, 255, 255));</span>
<span class="nc" id="L924">    treeContainer.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));</span>
<span class="nc" id="L925">    treeContainer.setForeground(new java.awt.Color(0, 0, 0));</span>
<span class="nc" id="L926">    treeContainer.setPreferredSize(new java.awt.Dimension(200, 200));</span>
<span class="nc" id="L927">    treePanel = new TreeJPanel();</span>
<span class="nc" id="L928">    treeContainer.add(&quot;Center&quot;, treePanel);</span>
<span class="nc" id="L929">    treePanel.setBackground(Color.white);</span>
<span class="nc" id="L930">    parserFilePanel.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));</span>

<span class="nc" id="L932">    parserFilePanel.setBackground(new java.awt.Color(255, 255, 255));</span>
<span class="nc" id="L933">    parserFileLabel.setText(&quot;Parser: None&quot;);</span>
<span class="nc" id="L934">    parserFilePanel.add(parserFileLabel);</span>

<span class="nc" id="L936">    treeContainer.add(parserFilePanel, java.awt.BorderLayout.NORTH);</span>

<span class="nc" id="L938">    splitPane.setRightComponent(treeContainer);</span>

<span class="nc" id="L940">    add(splitPane, java.awt.BorderLayout.CENTER);</span>

<span class="nc" id="L942">    statusPanel.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));</span>

<span class="nc" id="L944">    statusLabel.setText(&quot;Ready&quot;);</span>
<span class="nc" id="L945">    statusPanel.add(statusLabel);</span>

<span class="nc" id="L947">    progressBar.setName(&quot;&quot;);</span>
<span class="nc" id="L948">    statusPanel.add(progressBar);</span>

<span class="nc" id="L950">    add(statusPanel, java.awt.BorderLayout.SOUTH);</span>

    //Roger -- test to see if I can get a bit of a fix with new font

<span class="nc" id="L954">  }//GEN-END:initComponents</span>

  private void textPaneFocusLost(java.awt.event.FocusEvent evt)//GEN-FIRST:event_textPaneFocusLost
  {//GEN-HEADEREND:event_textPaneFocusLost
    // highlights the sentence containing the current location of the cursor
    // note that the cursor is set to the beginning of the sentence when scrolling
<span class="nc" id="L960">    highlightEditedSentence();</span>
<span class="nc" id="L961">  }//GEN-LAST:event_textPaneFocusLost</span>

  private void parseNextButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_parseNextButtonActionPerformed
  {//GEN-HEADEREND:event_parseNextButtonActionPerformed
<span class="nc" id="L965">    parse();</span>
<span class="nc" id="L966">    scrollWhenDone = true;</span>
<span class="nc" id="L967">  }//GEN-LAST:event_parseNextButtonActionPerformed</span>

  private void clearButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_clearButtonActionPerformed
  {//GEN-HEADEREND:event_clearButtonActionPerformed
<span class="nc" id="L971">    treePanel.setTree(null);</span>
<span class="nc" id="L972">    clearButton.setEnabled(false);</span>
<span class="nc" id="L973">  }//GEN-LAST:event_clearButtonActionPerformed</span>

  private void textPaneMouseDragged(java.awt.event.MouseEvent evt)//GEN-FIRST:event_textPaneMouseDragged
  {//GEN-HEADEREND:event_textPaneMouseDragged
<span class="nc" id="L977">    highlightSelectedSentence();</span>
<span class="nc" id="L978">  }//GEN-LAST:event_textPaneMouseDragged</span>

  private void textPaneMouseClicked(java.awt.event.MouseEvent evt)//GEN-FIRST:event_textPaneMouseClicked
  {//GEN-HEADEREND:event_textPaneMouseClicked
<span class="nc" id="L982">    highlightSelectedSentence();</span>
<span class="nc" id="L983">  }//GEN-LAST:event_textPaneMouseClicked</span>

  private void parseButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_parseButtonActionPerformed
  {//GEN-HEADEREND:event_parseButtonActionPerformed
<span class="nc" id="L987">    parse();</span>
<span class="nc" id="L988">    scrollWhenDone = false;</span>
<span class="nc" id="L989">  }//GEN-LAST:event_parseButtonActionPerformed</span>

  private void loadParserButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_loadParserButtonActionPerformed
  {//GEN-HEADEREND:event_loadParserButtonActionPerformed
<span class="nc" id="L993">    loadParser();</span>
<span class="nc" id="L994">  }//GEN-LAST:event_loadParserButtonActionPerformed</span>

  private void saveOutputButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_saveOutputButtonActionPerformed
  {//GEN-HEADEREND:event_saveOutputButtonActionPerformed
<span class="nc" id="L998">    saveOutput();</span>
<span class="nc" id="L999">  }//GEN-LAST:event_saveOutputButtonActionPerformed</span>

  private void loadFileButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_loadFileButtonActionPerformed
  {//GEN-HEADEREND:event_loadFileButtonActionPerformed
<span class="nc" id="L1003">    loadFile();</span>
<span class="nc" id="L1004">  }//GEN-LAST:event_loadFileButtonActionPerformed</span>

  private void backButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_backButtonActionPerformed
  {//GEN-HEADEREND:event_backButtonActionPerformed
<span class="nc" id="L1008">    scrollBack();</span>
<span class="nc" id="L1009">  }//GEN-LAST:event_backButtonActionPerformed</span>

  private void forwardButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_forwardButtonActionPerformed
  {//GEN-HEADEREND:event_forwardButtonActionPerformed
<span class="nc" id="L1013">    scrollForward();</span>
<span class="nc" id="L1014">  }//GEN-LAST:event_forwardButtonActionPerformed</span>


  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JLabel dataFileLabel;
  private javax.swing.JPanel treeContainer;
  private javax.swing.JPanel topPanel;
  private javax.swing.JScrollPane textScrollPane;
  private javax.swing.JButton backButton;
  private javax.swing.JLabel statusLabel;
  private javax.swing.JButton loadFileButton;
  private javax.swing.JPanel loadButtonPanel;
  private javax.swing.JPanel buttonsAndFilePanel;
  private javax.swing.JButton parseButton;
  private javax.swing.JButton parseNextButton;
  private javax.swing.JButton forwardButton;
  private javax.swing.JLabel parserFileLabel;
  private javax.swing.JButton clearButton;
  private javax.swing.JSplitPane splitPane;
  private javax.swing.JPanel statusPanel;
  private javax.swing.JPanel dataFilePanel;
  private javax.swing.JPanel buttonPanel;
  private javax.swing.JTextPane textPane;
  private javax.swing.JProgressBar progressBar;
  private javax.swing.JPanel parserFilePanel;
  private javax.swing.JButton loadParserButton;
  private javax.swing.JButton saveOutputButton;
  // End of variables declaration//GEN-END:variables
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>