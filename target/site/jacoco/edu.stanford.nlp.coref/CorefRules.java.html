<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CorefRules.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Stanford CoreNLP</a> &gt; <a href="index.source.html" class="el_package">edu.stanford.nlp.coref</a> &gt; <span class="el_source">CorefRules.java</span></div><h1>CorefRules.java</h1><pre class="source lang-java linenums">package edu.stanford.nlp.coref;

import java.lang.reflect.Method;
import java.util.Arrays;
import java.util.HashSet;
import java.util.List;
import java.util.Locale;
import java.util.Set;
import java.util.regex.Pattern;

import edu.stanford.nlp.coref.data.CorefCluster;
import edu.stanford.nlp.coref.data.Dictionaries;
import edu.stanford.nlp.coref.data.Document;
import edu.stanford.nlp.coref.data.Mention;
import edu.stanford.nlp.coref.data.Semantics;
import edu.stanford.nlp.coref.data.SpeakerInfo;
import edu.stanford.nlp.coref.data.Dictionaries.Animacy;
import edu.stanford.nlp.coref.data.Dictionaries.Gender;
import edu.stanford.nlp.coref.data.Dictionaries.MentionType;
import edu.stanford.nlp.coref.data.Dictionaries.Number;
import edu.stanford.nlp.coref.data.Dictionaries.Person;

import edu.stanford.nlp.ling.CoreAnnotations;
import edu.stanford.nlp.ling.CoreLabel;
import edu.stanford.nlp.math.NumberMatchingRegex;
import edu.stanford.nlp.stats.Counters;
import edu.stanford.nlp.stats.IntCounter;
import edu.stanford.nlp.util.Generics;
import edu.stanford.nlp.util.Pair;
import edu.stanford.nlp.util.Sets;


/**
 * Rules for coref system (mention detection, entity coref, event coref)
 * The name of the method for mention detection starts with detection,
 * for entity coref starts with entity, and for event coref starts with event.
 *
 * @author heeyoung, recasens
 */
<span class="nc bnc" id="L40" title="All 2 branches missed.">public class CorefRules {</span>
  public static boolean entityBothHaveProper(CorefCluster mentionCluster,
      CorefCluster potentialAntecedent) {
<span class="nc" id="L43">    boolean mentionClusterHaveProper = false;</span>
<span class="nc" id="L44">    boolean potentialAntecedentHaveProper = false;</span>

<span class="nc bnc" id="L46" title="All 2 branches missed.">    for (Mention m : mentionCluster.corefMentions) {</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">      if (m.mentionType==MentionType.PROPER) {</span>
<span class="nc" id="L48">        mentionClusterHaveProper = true;</span>
<span class="nc" id="L49">        break;</span>
      }
<span class="nc" id="L51">    }</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">    for (Mention a : potentialAntecedent.corefMentions) {</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">      if (a.mentionType==MentionType.PROPER) {</span>
<span class="nc" id="L54">        potentialAntecedentHaveProper = true;</span>
<span class="nc" id="L55">        break;</span>
      }
<span class="nc" id="L57">    }</span>
<span class="nc bnc" id="L58" title="All 4 branches missed.">    return (mentionClusterHaveProper &amp;&amp; potentialAntecedentHaveProper);</span>
  }
  public static boolean entitySameProperHeadLastWord(CorefCluster mentionCluster,
      CorefCluster potentialAntecedent, Mention mention, Mention ant) {
<span class="nc bnc" id="L62" title="All 2 branches missed.">    for (Mention m : mentionCluster.getCorefMentions()){</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">      for (Mention a : potentialAntecedent.getCorefMentions()) {</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">        if (entitySameProperHeadLastWord(m, a)) return true;</span>
<span class="nc" id="L65">      }</span>
<span class="nc" id="L66">    }</span>
<span class="nc" id="L67">    return false;</span>
  }

  public static boolean entityAlias(CorefCluster mentionCluster, CorefCluster potentialAntecedent,
      Semantics semantics, Dictionaries dict) throws Exception {

<span class="nc" id="L73">    Mention mention = mentionCluster.getRepresentativeMention();</span>
<span class="nc" id="L74">    Mention antecedent = potentialAntecedent.getRepresentativeMention();</span>
<span class="nc bnc" id="L75" title="All 4 branches missed.">    if(mention.mentionType!=MentionType.PROPER</span>
<span class="nc" id="L76">        || antecedent.mentionType!=MentionType.PROPER) return false;</span>

<span class="nc" id="L78">    Method meth = semantics.wordnet.getClass().getMethod(&quot;alias&quot;, new Class[]{Mention.class, Mention.class});</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">    if((Boolean) meth.invoke(semantics.wordnet, new Object[]{mention, antecedent})) {</span>
<span class="nc" id="L80">      return true;</span>
    }
<span class="nc" id="L82">    return false;</span>
  }
  public static boolean entityIWithinI(CorefCluster mentionCluster,
      CorefCluster potentialAntecedent, Dictionaries dict) {
<span class="nc bnc" id="L86" title="All 2 branches missed.">    for(Mention m : mentionCluster.getCorefMentions()) {</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">      for(Mention a : potentialAntecedent.getCorefMentions()) {</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">        if(entityIWithinI(m, a, dict)) return true;</span>
<span class="nc" id="L89">      }</span>
<span class="nc" id="L90">    }</span>
<span class="nc" id="L91">    return false;</span>
  }
  public static boolean entityPersonDisagree(Document document, CorefCluster mentionCluster, CorefCluster potentialAntecedent, Dictionaries dict){
<span class="nc" id="L94">    boolean disagree = false;</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">    for(Mention m : mentionCluster.getCorefMentions()) {</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">      for(Mention ant : potentialAntecedent.getCorefMentions()) {</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">        if(entityPersonDisagree(document, m, ant, dict)) {</span>
<span class="nc" id="L98">          disagree = true;</span>
<span class="nc" id="L99">          break;</span>
        }
<span class="nc" id="L101">      }</span>
<span class="nc" id="L102">    }</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">    if(disagree) return true;</span>
<span class="nc" id="L104">    else return false;</span>
  }

<span class="nc" id="L107">  private static final List&lt;String&gt; entityWordsToExclude =</span>
<span class="nc" id="L108">          Arrays.asList(new String[]{ &quot;the&quot;,&quot;this&quot;, &quot;mr.&quot;, &quot;miss&quot;, &quot;mrs.&quot;, &quot;dr.&quot;, &quot;ms.&quot;, &quot;inc.&quot;, &quot;ltd.&quot;, &quot;corp.&quot;, &quot;'s&quot;});</span>
  /** Word inclusion except stop words  */
  public static boolean entityWordsIncluded(CorefCluster mentionCluster, CorefCluster potentialAntecedent, Mention mention, Mention ant) {
<span class="nc" id="L111">    Set&lt;String&gt; wordsExceptStopWords = Generics.newHashSet(mentionCluster.words);</span>
<span class="nc" id="L112">    wordsExceptStopWords.removeAll(entityWordsToExclude);</span>
<span class="nc" id="L113">    wordsExceptStopWords.remove(mention.headString.toLowerCase());</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">    if(potentialAntecedent.words.containsAll(wordsExceptStopWords)) return true;</span>
<span class="nc" id="L115">    else return false;</span>
  }

  /** Compatible modifier only  */
  public static boolean entityHaveIncompatibleModifier(CorefCluster mentionCluster, CorefCluster potentialAntecedent) {
<span class="nc bnc" id="L120" title="All 2 branches missed.">    for(Mention m : mentionCluster.corefMentions){</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">      for(Mention ant : potentialAntecedent.corefMentions){</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">        if(entityHaveIncompatibleModifier(m, ant)) return true;</span>
<span class="nc" id="L123">      }</span>
<span class="nc" id="L124">    }</span>
<span class="nc" id="L125">    return false;</span>
  }
  public static boolean entityIsRoleAppositive(CorefCluster mentionCluster, CorefCluster potentialAntecedent, Mention m1, Mention m2, Dictionaries dict) {
<span class="nc bnc" id="L128" title="All 2 branches missed.">    if(!entityAttributesAgree(mentionCluster, potentialAntecedent)) return false;</span>
<span class="nc bnc" id="L129" title="All 4 branches missed.">    return m1.isRoleAppositive(m2, dict) || m2.isRoleAppositive(m1, dict);</span>
  }
  public static boolean entityIsRelativePronoun(Mention m1, Mention m2) {
<span class="nc bnc" id="L132" title="All 4 branches missed.">      return m1.isRelativePronoun(m2) || m2.isRelativePronoun(m1);</span>
  }

  public static boolean entityIsAcronym(Document document, CorefCluster mentionCluster, CorefCluster potentialAntecedent) {
<span class="nc" id="L136">    Pair&lt;Integer, Integer&gt; idPair = Pair.makePair(Math.min(mentionCluster.clusterID, potentialAntecedent.clusterID), Math.max(mentionCluster.clusterID, potentialAntecedent.clusterID));</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">    if(!document.acronymCache.containsKey(idPair)) {</span>
<span class="nc" id="L138">      boolean isAcronym = false;</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">      for(Mention m : mentionCluster.corefMentions){</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">        if(m.isPronominal()) continue;</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">        for(Mention ant : potentialAntecedent.corefMentions){</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">          if(isAcronym(m.originalSpan, ant.originalSpan)) isAcronym = true;</span>
<span class="nc" id="L143">        }</span>
<span class="nc" id="L144">      }</span>
<span class="nc" id="L145">      document.acronymCache.put(idPair, isAcronym);</span>
    }
<span class="nc" id="L147">    return document.acronymCache.get(idPair);</span>
  }

  public static boolean isAcronym(List&lt;CoreLabel&gt; first, List&lt;CoreLabel&gt; second) {
<span class="nc bnc" id="L151" title="All 4 branches missed.">    if (first.size() &gt; 1 &amp;&amp; second.size() &gt; 1) {</span>
<span class="nc" id="L152">      return false;</span>
    }
<span class="nc bnc" id="L154" title="All 4 branches missed.">    if (first.size() == 0 &amp;&amp; second.size() == 0) { return false; }</span>
    List&lt;CoreLabel&gt; longer;
    List&lt;CoreLabel&gt; shorter;

<span class="nc bnc" id="L158" title="All 2 branches missed.">    if (first.size() == second.size()) {</span>
<span class="nc" id="L159">      String firstWord = first.get(0).get(CoreAnnotations.TextAnnotation.class);</span>
<span class="nc" id="L160">      String secondWord = second.get(0).get(CoreAnnotations.TextAnnotation.class);</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">      longer = (firstWord.length() &gt; secondWord.length()) ? first : second;</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">      shorter = (firstWord.length() &gt; secondWord.length()) ? second : first;</span>
<span class="nc" id="L163">    } else {</span>
<span class="nc bnc" id="L164" title="All 4 branches missed.">      longer = (first.size() &gt; 0 &amp;&amp; first.size() &gt; second.size()) ? first : second;</span>
<span class="nc bnc" id="L165" title="All 4 branches missed.">      shorter = (second.size() &gt; 0 &amp;&amp; first.size() &gt; second.size()) ? second : first;</span>
    }

<span class="nc bnc" id="L168" title="All 2 branches missed.">    String acronym = shorter.size() &gt; 0 ? shorter.get(0).get(CoreAnnotations.TextAnnotation.class) : &quot;&lt;UNK&gt;&quot;;</span>
    // This check is not strictly necessary, but it saves a chunk of
    // time iterating through the text of the longer mention
<span class="nc bnc" id="L171" title="All 2 branches missed.">    for (int acronymPos = 0; acronymPos &lt; acronym.length(); ++acronymPos) {</span>
<span class="nc bnc" id="L172" title="All 4 branches missed.">      if (acronym.charAt(acronymPos) &lt; 'A' || acronym.charAt(acronymPos) &gt; 'Z') {</span>
<span class="nc" id="L173">        return false;</span>
      }
    }
<span class="nc" id="L176">    int acronymPos = 0;</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">    for (CoreLabel aLonger1 : longer) {</span>
<span class="nc" id="L178">      String word = aLonger1.get(CoreAnnotations.TextAnnotation.class);</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">      for (int charNum = 0; charNum &lt; word.length(); ++charNum) {</span>
<span class="nc bnc" id="L180" title="All 4 branches missed.">        if (word.charAt(charNum) &gt;= 'A' &amp;&amp; word.charAt(charNum) &lt;= 'Z') {</span>
          // This triggers if there were more &quot;acronym&quot; characters in
          // the longer mention than in the shorter mention
<span class="nc bnc" id="L183" title="All 2 branches missed.">          if (acronymPos &gt;= acronym.length()) {</span>
<span class="nc" id="L184">            return false;</span>
          }
<span class="nc bnc" id="L186" title="All 2 branches missed.">          if (acronym.charAt(acronymPos) != word.charAt(charNum)) {</span>
<span class="nc" id="L187">            return false;</span>
          }
<span class="nc" id="L189">          ++acronymPos;</span>
        }
      }
<span class="nc" id="L192">    }</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">    if (acronymPos != acronym.length()) {</span>
<span class="nc" id="L194">      return false;</span>
    }
<span class="nc bnc" id="L196" title="All 2 branches missed.">    for (CoreLabel aLonger : longer) {</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">      if (aLonger.get(CoreAnnotations.TextAnnotation.class).contains(acronym)) {</span>
<span class="nc" id="L198">        return false;</span>
      }
<span class="nc" id="L200">    }</span>

<span class="nc" id="L202">    return true;</span>
  }

  public static boolean entityIsPredicateNominatives(CorefCluster mentionCluster, CorefCluster potentialAntecedent, Mention m1, Mention m2) {
<span class="nc bnc" id="L206" title="All 2 branches missed.">    if(!entityAttributesAgree(mentionCluster, potentialAntecedent)) return false;</span>
<span class="nc bnc" id="L207" title="All 8 branches missed.">    if ((m1.startIndex &lt;= m2.startIndex &amp;&amp; m1.endIndex &gt;= m2.endIndex)</span>
            || (m1.startIndex &gt;= m2.startIndex &amp;&amp; m1.endIndex &lt;= m2.endIndex)) {
<span class="nc" id="L209">      return false;</span>
    }
<span class="nc bnc" id="L211" title="All 4 branches missed.">    return m1.isPredicateNominatives(m2) || m2.isPredicateNominatives(m1);</span>
  }

  public static boolean entityIsApposition(CorefCluster mentionCluster, CorefCluster potentialAntecedent, Mention m1, Mention m2) {
<span class="nc bnc" id="L215" title="All 2 branches missed.">    if(!entityAttributesAgree(mentionCluster, potentialAntecedent)) return false;</span>
<span class="nc bnc" id="L216" title="All 4 branches missed.">    if(m1.mentionType==MentionType.PROPER &amp;&amp; m2.mentionType==MentionType.PROPER) return false;</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">    if(m1.nerString.equals(&quot;LOCATION&quot;)) return false;</span>
<span class="nc bnc" id="L218" title="All 4 branches missed.">    return m1.isApposition(m2) || m2.isApposition(m1);</span>
  }

  public static boolean entityAttributesAgree(CorefCluster mentionCluster, CorefCluster potentialAntecedent){
<span class="nc" id="L222">    return entityAttributesAgree(mentionCluster, potentialAntecedent, false);</span>
  }

  public static boolean entityAttributesAgree(CorefCluster mentionCluster, CorefCluster potentialAntecedent, boolean ignoreGender){

<span class="nc" id="L227">    boolean hasExtraAnt = false;</span>
<span class="nc" id="L228">    boolean hasExtraThis = false;</span>

    // number
<span class="nc bnc" id="L231" title="All 2 branches missed.">    if(!mentionCluster.numbers.contains(Number.UNKNOWN)){</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">      for(Number n : potentialAntecedent.numbers){</span>
<span class="nc bnc" id="L233" title="All 4 branches missed.">        if(n!=Number.UNKNOWN &amp;&amp; !mentionCluster.numbers.contains(n)) {</span>
<span class="nc" id="L234">          hasExtraAnt = true;</span>
<span class="nc" id="L235">          break;</span>
        }
<span class="nc" id="L237">      }</span>
    }
<span class="nc bnc" id="L239" title="All 2 branches missed.">    if(!potentialAntecedent.numbers.contains(Number.UNKNOWN)){</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">      for(Number n : mentionCluster.numbers){</span>
<span class="nc bnc" id="L241" title="All 4 branches missed.">        if(n!=Number.UNKNOWN &amp;&amp; !potentialAntecedent.numbers.contains(n)) {</span>
<span class="nc" id="L242">          hasExtraThis = true;</span>
<span class="nc" id="L243">          break;</span>
        }
<span class="nc" id="L245">      }</span>
    }

<span class="nc bnc" id="L248" title="All 4 branches missed.">    if(hasExtraAnt &amp;&amp; hasExtraThis) return false;</span>

    // gender
<span class="nc" id="L251">    hasExtraAnt = false;</span>
<span class="nc" id="L252">    hasExtraThis = false;</span>

<span class="nc bnc" id="L254" title="All 2 branches missed.">    if (!ignoreGender) {</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">      if(!mentionCluster.genders.contains(Gender.UNKNOWN)){</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">        for(Gender g : potentialAntecedent.genders){</span>
<span class="nc bnc" id="L257" title="All 4 branches missed.">          if(g!=Gender.UNKNOWN &amp;&amp; !mentionCluster.genders.contains(g)) {</span>
<span class="nc" id="L258">            hasExtraAnt = true;</span>
<span class="nc" id="L259">            break;</span>
          }
<span class="nc" id="L261">        }</span>
      }
<span class="nc bnc" id="L263" title="All 2 branches missed.">      if(!potentialAntecedent.genders.contains(Gender.UNKNOWN)){</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">        for(Gender g : mentionCluster.genders){</span>
<span class="nc bnc" id="L265" title="All 4 branches missed.">          if(g!=Gender.UNKNOWN &amp;&amp; !potentialAntecedent.genders.contains(g)) {</span>
<span class="nc" id="L266">            hasExtraThis = true;</span>
<span class="nc" id="L267">            break;</span>
          }
<span class="nc" id="L269">        }</span>
      }
    }
<span class="nc bnc" id="L272" title="All 4 branches missed.">    if(hasExtraAnt &amp;&amp; hasExtraThis) return false;</span>

    // animacy
<span class="nc" id="L275">    hasExtraAnt = false;</span>
<span class="nc" id="L276">    hasExtraThis = false;</span>

<span class="nc bnc" id="L278" title="All 2 branches missed.">    if(!mentionCluster.animacies.contains(Animacy.UNKNOWN)){</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">      for(Animacy a : potentialAntecedent.animacies){</span>
<span class="nc bnc" id="L280" title="All 4 branches missed.">        if(a!=Animacy.UNKNOWN &amp;&amp; !mentionCluster.animacies.contains(a)) {</span>
<span class="nc" id="L281">          hasExtraAnt = true;</span>
<span class="nc" id="L282">          break;</span>
        }
<span class="nc" id="L284">      }</span>
    }
<span class="nc bnc" id="L286" title="All 2 branches missed.">    if(!potentialAntecedent.animacies.contains(Animacy.UNKNOWN)){</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">      for(Animacy a : mentionCluster.animacies){</span>
<span class="nc bnc" id="L288" title="All 4 branches missed.">        if(a!=Animacy.UNKNOWN &amp;&amp; !potentialAntecedent.animacies.contains(a)) {</span>
<span class="nc" id="L289">          hasExtraThis = true;</span>
<span class="nc" id="L290">          break;</span>
        }
<span class="nc" id="L292">      }</span>
    }
<span class="nc bnc" id="L294" title="All 4 branches missed.">    if(hasExtraAnt &amp;&amp; hasExtraThis) return false;</span>

    // NE type
<span class="nc" id="L297">    hasExtraAnt = false;</span>
<span class="nc" id="L298">    hasExtraThis = false;</span>

<span class="nc bnc" id="L300" title="All 4 branches missed.">    if(!mentionCluster.nerStrings.contains(&quot;O&quot;) &amp;&amp; !mentionCluster.nerStrings.contains(&quot;MISC&quot;)){</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">      for(String ne : potentialAntecedent.nerStrings){</span>
<span class="nc bnc" id="L302" title="All 6 branches missed.">        if(!ne.equals(&quot;O&quot;) &amp;&amp; !ne.equals(&quot;MISC&quot;) &amp;&amp; !mentionCluster.nerStrings.contains(ne)) {</span>
<span class="nc" id="L303">          hasExtraAnt = true;</span>
<span class="nc" id="L304">          break;</span>
        }
<span class="nc" id="L306">      }</span>
    }
<span class="nc bnc" id="L308" title="All 4 branches missed.">    if(!potentialAntecedent.nerStrings.contains(&quot;O&quot;) &amp;&amp; !potentialAntecedent.nerStrings.contains(&quot;MISC&quot;)){</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">      for(String ne : mentionCluster.nerStrings){</span>
<span class="nc bnc" id="L310" title="All 6 branches missed.">        if(!ne.equals(&quot;O&quot;) &amp;&amp; !ne.equals(&quot;MISC&quot;) &amp;&amp; !potentialAntecedent.nerStrings.contains(ne)) {</span>
<span class="nc" id="L311">          hasExtraThis = true;</span>
<span class="nc" id="L312">          break;</span>
        }
<span class="nc" id="L314">      }</span>
    }
<span class="nc bnc" id="L316" title="All 4 branches missed.">    return ! (hasExtraAnt &amp;&amp; hasExtraThis);</span>
  }

  private static &lt;E&gt; boolean attributeSetDisagree(Set&lt;E&gt; s1,Set&lt;E&gt; s2){
<span class="nc" id="L320">    int minSize = Math.min(s1.size(), s2.size());</span>
    // intersection being smaller than the smaller set means both sets
    // have extra elements
<span class="nc bnc" id="L323" title="All 2 branches missed.">    if (minSize &gt; Sets.intersection(s1, s2).size())</span>
<span class="nc" id="L324">      return true;</span>
<span class="nc" id="L325">    return false;</span>
  }

  private static &lt;E&gt; void pruneAttributes(Set&lt;E&gt; attrs, Set&lt;E&gt; unknown) {
<span class="nc bnc" id="L329" title="All 2 branches missed.">    if (attrs.size() &gt; unknown.size())</span>
<span class="nc" id="L330">      attrs.removeAll(unknown);</span>
<span class="nc" id="L331">  }</span>

  private static &lt;E&gt; void pruneAttributes(Set&lt;E&gt; attrs, E unknown) {
<span class="nc bnc" id="L334" title="All 2 branches missed.">    if (attrs.size() &gt; 1)</span>
<span class="nc" id="L335">      attrs.remove(unknown);</span>
<span class="nc" id="L336">  }</span>

<span class="nc" id="L338">  private static final Set&lt;String&gt; UNKNOWN_NER = new HashSet&lt;&gt;(Arrays.asList(&quot;MISC&quot;,&quot;O&quot;));</span>
  private static boolean entityAttributesAgreeChinese(CorefCluster mentionCluster, CorefCluster potentialAntecedent){

<span class="nc" id="L341">    pruneAttributes(mentionCluster.numbers,Number.UNKNOWN);</span>
<span class="nc" id="L342">    pruneAttributes(mentionCluster.genders,Gender.UNKNOWN);</span>
<span class="nc" id="L343">    pruneAttributes(mentionCluster.animacies,Animacy.UNKNOWN);</span>
<span class="nc" id="L344">    pruneAttributes(mentionCluster.nerStrings,UNKNOWN_NER);</span>

<span class="nc" id="L346">    pruneAttributes(potentialAntecedent.numbers,Number.UNKNOWN);</span>
<span class="nc" id="L347">    pruneAttributes(potentialAntecedent.genders,Gender.UNKNOWN);</span>
<span class="nc" id="L348">    pruneAttributes(potentialAntecedent.animacies,Animacy.UNKNOWN);</span>
<span class="nc" id="L349">    pruneAttributes(potentialAntecedent.nerStrings,UNKNOWN_NER);</span>

<span class="nc bnc" id="L351" title="All 2 branches missed.">    if(attributeSetDisagree(mentionCluster.numbers,potentialAntecedent.numbers)</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">        || attributeSetDisagree(mentionCluster.genders,potentialAntecedent.genders)</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">        || attributeSetDisagree(mentionCluster.animacies,potentialAntecedent.animacies)</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">        || attributeSetDisagree(mentionCluster.nerStrings,potentialAntecedent.nerStrings))</span>
<span class="nc" id="L355">      return false;</span>

<span class="nc" id="L357">    return true;</span>
  }

  public static boolean entityAttributesAgree(CorefCluster mentionCluster, CorefCluster potentialAntecedent, Locale lang) {
<span class="nc bnc" id="L361" title="All 2 branches missed.">    if (lang == Locale.CHINESE ) {</span>
<span class="nc" id="L362">      return entityAttributesAgreeChinese(mentionCluster,potentialAntecedent);</span>
    }
<span class="nc" id="L364">    return entityAttributesAgree(mentionCluster, potentialAntecedent);</span>
  }

  public static boolean entityRelaxedHeadsAgreeBetweenMentions(CorefCluster mentionCluster, CorefCluster potentialAntecedent, Mention m, Mention ant) {
<span class="nc bnc" id="L368" title="All 4 branches missed.">    if(m.isPronominal() || ant.isPronominal()) return false;</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">    if(m.headsAgree(ant)) return true;</span>
<span class="nc" id="L370">    return false;</span>
  }

  public static boolean entityHeadsAgree(CorefCluster mentionCluster, CorefCluster potentialAntecedent, Mention m, Mention ant, Dictionaries dict) {
<span class="nc" id="L374">    boolean headAgree = false;</span>
<span class="nc bnc" id="L375" title="All 4 branches missed.">    if(m.isPronominal() || ant.isPronominal()</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">        || dict.allPronouns.contains(m.lowercaseNormalizedSpanString())</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">        || dict.allPronouns.contains(ant.lowercaseNormalizedSpanString())) return false;</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">    for(Mention a : potentialAntecedent.corefMentions){</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">      if(a.headString.equals(m.headString)) headAgree= true;</span>
<span class="nc" id="L380">    }</span>
<span class="nc" id="L381">    return headAgree;</span>
  }
  public static boolean entityExactStringMatch(CorefCluster mentionCluster, CorefCluster potentialAntecedent, Dictionaries dict, Set&lt;Mention&gt; roleSet){
<span class="nc" id="L384">    boolean matched = false;</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">    for(Mention m : mentionCluster.corefMentions){</span>
<span class="nc bnc" id="L386" title="All 4 branches missed.">      if(roleSet!=null &amp;&amp; roleSet.contains(m)) return false;</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">      if(m.isPronominal()) {</span>
<span class="nc" id="L388">        continue;</span>
      }
<span class="nc" id="L390">      String mSpan = m.lowercaseNormalizedSpanString();</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">      if(dict.allPronouns.contains(mSpan)) {</span>
<span class="nc" id="L392">        continue;</span>
      }
<span class="nc bnc" id="L394" title="All 2 branches missed.">      for(Mention ant : potentialAntecedent.corefMentions){</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">        if(ant.isPronominal()) {</span>
<span class="nc" id="L396">          continue;</span>
        }
<span class="nc" id="L398">        String antSpan = ant.lowercaseNormalizedSpanString();</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">        if(dict.allPronouns.contains(antSpan)) continue;</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">        if(mSpan.equals(antSpan)) matched = true;</span>
<span class="nc bnc" id="L401" title="All 4 branches missed.">        if(mSpan.equals(antSpan+&quot; 's&quot;) || antSpan.equals(mSpan+&quot; 's&quot;)) matched = true;</span>
<span class="nc" id="L402">      }</span>
<span class="nc" id="L403">    }</span>
<span class="nc" id="L404">    return matched;</span>
  }
  public static boolean entityExactStringMatch(Mention m, Mention ant, Dictionaries dict, Set&lt;Mention&gt; roleSet){
<span class="nc" id="L407">    boolean matched = false;</span>
<span class="nc bnc" id="L408" title="All 4 branches missed.">    if(roleSet!=null &amp;&amp; roleSet.contains(m)) return false;</span>
<span class="nc bnc" id="L409" title="All 4 branches missed.">    if(m.isPronominal() || ant.isPronominal()) return false;</span>

<span class="nc" id="L411">    String mSpan = m.lowercaseNormalizedSpanString();</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">    if(dict.allPronouns.contains(mSpan)) return false;</span>

<span class="nc" id="L414">    String antSpan = ant.lowercaseNormalizedSpanString();</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">    if(dict.allPronouns.contains(antSpan)) return false;</span>

<span class="nc bnc" id="L417" title="All 2 branches missed.">    if(mSpan.equals(antSpan)) matched = true;</span>
<span class="nc bnc" id="L418" title="All 4 branches missed.">    if(mSpan.equals(antSpan+&quot; 's&quot;) || antSpan.equals(mSpan+&quot; 's&quot;)) matched = true;</span>
<span class="nc" id="L419">    return matched;</span>
  }

  /**
   * Exact string match except phrase after head (only for proper noun):
   * For dealing with a error like {@literal &quot;[Mr. Bickford] &lt;- [Mr. Bickford , an 18-year mediation veteran] }&quot;
   */
  public static boolean entityRelaxedExactStringMatch(
      CorefCluster mentionCluster,
      CorefCluster potentialAntecedent,
      Mention mention,
      Mention ant,
      Dictionaries dict,
      Set&lt;Mention&gt; roleSet){
<span class="nc bnc" id="L433" title="All 4 branches missed.">    if(roleSet!=null &amp;&amp; roleSet.contains(mention)) return false;</span>
<span class="nc bnc" id="L434" title="All 4 branches missed.">    if(mention.mentionType == MentionType.LIST || ant.mentionType == MentionType.LIST) return false;</span>
<span class="nc bnc" id="L435" title="All 4 branches missed.">    if(mention.isPronominal() || ant.isPronominal()</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">        || dict.allPronouns.contains(mention.lowercaseNormalizedSpanString())</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">        || dict.allPronouns.contains(ant.lowercaseNormalizedSpanString())) return false;</span>
<span class="nc" id="L438">    String mentionSpan = mention.removePhraseAfterHead();</span>
<span class="nc" id="L439">    String antSpan = ant.removePhraseAfterHead();</span>
<span class="nc bnc" id="L440" title="All 4 branches missed.">    if(mentionSpan.equals(&quot;&quot;) || antSpan.equals(&quot;&quot;)) return false;</span>

<span class="nc bnc" id="L442" title="All 6 branches missed.">    if(mentionSpan.equals(antSpan) || mentionSpan.equals(antSpan+&quot; 's&quot;) || antSpan.equals(mentionSpan+&quot; 's&quot;)){</span>
<span class="nc" id="L443">      return true;</span>
    }
<span class="nc" id="L445">    return false;</span>
  }

  /** Check whether two mentions are in i-within-i relation (Chomsky, 1981) */
  public static boolean entityIWithinI(Mention m1, Mention m2, Dictionaries dict){
    // check for nesting: i-within-i
<span class="nc bnc" id="L451" title="All 4 branches missed.">    if(!m1.isApposition(m2) &amp;&amp; !m2.isApposition(m1)</span>
<span class="nc bnc" id="L452" title="All 4 branches missed.">        &amp;&amp; !m1.isRelativePronoun(m2) &amp;&amp; !m2.isRelativePronoun(m1)</span>
<span class="nc bnc" id="L453" title="All 4 branches missed.">        &amp;&amp; !m1.isRoleAppositive(m2, dict) &amp;&amp; !m2.isRoleAppositive(m1, dict)</span>
    ){
<span class="nc bnc" id="L455" title="All 4 branches missed.">      if(m1.includedIn(m2) || m2.includedIn(m1)){</span>
<span class="nc" id="L456">        return true;</span>
      }
    }
<span class="nc" id="L459">    return false;</span>
  }


  /** Check whether later mention has incompatible modifier */
  public static boolean entityHaveIncompatibleModifier(Mention m, Mention ant) {
<span class="nc bnc" id="L465" title="All 2 branches missed.">    if(!ant.headString.equalsIgnoreCase(m.headString)) return false;   // only apply to same head mentions</span>
<span class="nc" id="L466">    boolean thisHasExtra = false;</span>
<span class="nc" id="L467">    int lengthThis = m.originalSpan.size();</span>
<span class="nc" id="L468">    int lengthM = ant.originalSpan.size();</span>
<span class="nc" id="L469">    Set&lt;String&gt; thisWordSet = Generics.newHashSet();</span>
<span class="nc" id="L470">    Set&lt;String&gt; antWordSet = Generics.newHashSet();</span>
<span class="nc" id="L471">    Set&lt;String&gt; locationModifier = Generics.newHashSet(Arrays.asList(&quot;east&quot;, &quot;west&quot;, &quot;north&quot;, &quot;south&quot;,</span>
        &quot;eastern&quot;, &quot;western&quot;, &quot;northern&quot;, &quot;southern&quot;, &quot;upper&quot;, &quot;lower&quot;));

<span class="nc bnc" id="L474" title="All 2 branches missed.">    for (int i=0; i&lt; lengthThis ; i++){</span>
<span class="nc" id="L475">      String w1 = m.originalSpan.get(i).get(CoreAnnotations.TextAnnotation.class).toLowerCase();</span>
<span class="nc" id="L476">      String pos1 = m.originalSpan.get(i).get(CoreAnnotations.PartOfSpeechAnnotation.class);</span>
<span class="nc bnc" id="L477" title="All 6 branches missed.">      if (!(pos1.startsWith(&quot;N&quot;) || pos1.startsWith(&quot;JJ&quot;) || pos1.equals(&quot;CD&quot;)</span>
<span class="nc bnc" id="L478" title="All 4 branches missed.">            || pos1.startsWith(&quot;V&quot;)) || w1.equalsIgnoreCase(m.headString)) {</span>
<span class="nc" id="L479">        continue;</span>
      }
<span class="nc" id="L481">      thisWordSet.add(w1);</span>
    }
<span class="nc bnc" id="L483" title="All 2 branches missed.">    for (int j=0 ; j &lt; lengthM ; j++){</span>
<span class="nc" id="L484">      String w2 = ant.originalSpan.get(j).get(CoreAnnotations.TextAnnotation.class).toLowerCase();</span>
<span class="nc" id="L485">      antWordSet.add(w2);</span>
    }
<span class="nc bnc" id="L487" title="All 2 branches missed.">    for (String w : thisWordSet){</span>
<span class="nc bnc" id="L488" title="All 2 branches missed.">      if(!antWordSet.contains(w)) {</span>
<span class="nc" id="L489">        thisHasExtra = true;</span>
<span class="nc" id="L490">        break;</span>
      }
<span class="nc" id="L492">    }</span>
<span class="nc" id="L493">    boolean hasLocationModifier = false;</span>
<span class="nc bnc" id="L494" title="All 2 branches missed.">    for(String l : locationModifier){</span>
<span class="nc bnc" id="L495" title="All 4 branches missed.">      if(antWordSet.contains(l) &amp;&amp; !thisWordSet.contains(l)) {</span>
<span class="nc" id="L496">        hasLocationModifier = true;</span>
<span class="nc" id="L497">        break;</span>
      }
<span class="nc" id="L499">    }</span>
<span class="nc bnc" id="L500" title="All 4 branches missed.">    return (thisHasExtra || hasLocationModifier);</span>
  }
  /** Check whether two mentions have different locations */
<span class="nc" id="L503">  private static final Set&lt;String&gt; locationModifier = Generics.newHashSet(Arrays.asList(&quot;east&quot;, &quot;west&quot;, &quot;north&quot;, &quot;south&quot;,</span>
          &quot;eastern&quot;, &quot;western&quot;, &quot;northern&quot;, &quot;southern&quot;, &quot;northwestern&quot;, &quot;southwestern&quot;, &quot;northeastern&quot;,
          &quot;southeastern&quot;, &quot;upper&quot;, &quot;lower&quot;));
  public static boolean entityHaveDifferentLocation(Mention m, Mention a, Dictionaries dict) {

    // state and country cannot be coref
<span class="nc bnc" id="L509" title="All 4 branches missed.">    if ((dict.statesAbbreviation.containsKey(a.spanToString()) || dict.statesAbbreviation.containsValue(a.spanToString()))</span>
<span class="nc bnc" id="L510" title="All 4 branches missed.">          &amp;&amp; (m.headString.equalsIgnoreCase(&quot;country&quot;) || m.headString.equalsIgnoreCase(&quot;nation&quot;))) {</span>
<span class="nc" id="L511">      return true;</span>
    }

<span class="nc" id="L514">    Set&lt;String&gt; locationM = Generics.newHashSet();</span>
<span class="nc" id="L515">    Set&lt;String&gt; locationA = Generics.newHashSet();</span>
<span class="nc" id="L516">    String mString = m.lowercaseNormalizedSpanString();</span>
<span class="nc" id="L517">    String aString = a.lowercaseNormalizedSpanString();</span>

<span class="nc bnc" id="L519" title="All 2 branches missed.">    for (CoreLabel w : m.originalSpan){</span>
<span class="nc" id="L520">      String text = w.get(CoreAnnotations.TextAnnotation.class);</span>
<span class="nc" id="L521">      String lowercased = text.toLowerCase();</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">      if (locationModifier.contains(lowercased)) return true;</span>
<span class="nc bnc" id="L523" title="All 2 branches missed.">      if (w.get(CoreAnnotations.NamedEntityTagAnnotation.class).equals(&quot;LOCATION&quot;)) {</span>
<span class="nc" id="L524">        String loc = text;</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">        if(dict.statesAbbreviation.containsKey(loc)) loc = dict.statesAbbreviation.get(loc);</span>
<span class="nc" id="L526">        locationM.add(lowercased);</span>
      }
<span class="nc" id="L528">    }</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">    for (CoreLabel w : a.originalSpan){</span>
<span class="nc" id="L530">      String text = w.get(CoreAnnotations.TextAnnotation.class);</span>
<span class="nc" id="L531">      String lowercased = text.toLowerCase();</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">      if (locationModifier.contains(lowercased)) return true;</span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">      if (w.get(CoreAnnotations.NamedEntityTagAnnotation.class).equals(&quot;LOCATION&quot;)) {</span>
<span class="nc" id="L534">        String loc = text;</span>
<span class="nc bnc" id="L535" title="All 2 branches missed.">        if(dict.statesAbbreviation.containsKey(loc)) loc = dict.statesAbbreviation.get(loc);</span>
<span class="nc" id="L536">        locationA.add(lowercased);</span>
      }
<span class="nc" id="L538">    }</span>
<span class="nc" id="L539">    boolean mHasExtra = false;</span>
<span class="nc" id="L540">    boolean aHasExtra = false;</span>
<span class="nc bnc" id="L541" title="All 2 branches missed.">    for (String s : locationM) {</span>
<span class="nc bnc" id="L542" title="All 2 branches missed.">      if (!aString.contains(s)) {</span>
<span class="nc" id="L543">        mHasExtra = true;</span>
<span class="nc" id="L544">        break;</span>
      }
<span class="nc" id="L546">    }</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">    for (String s : locationA) {</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">      if (!mString.contains(s)) {</span>
<span class="nc" id="L549">        aHasExtra = true;</span>
<span class="nc" id="L550">        break;</span>
      }
<span class="nc" id="L552">    }</span>
<span class="nc bnc" id="L553" title="All 4 branches missed.">    if(mHasExtra &amp;&amp; aHasExtra) {</span>
<span class="nc" id="L554">      return true;</span>
    }
<span class="nc" id="L556">    return false;</span>
  }

  /** Check whether two mentions have the same proper head words */
  public static boolean entitySameProperHeadLastWord(Mention m, Mention a) {
<span class="nc bnc" id="L561" title="All 2 branches missed.">    if(!m.headString.equalsIgnoreCase(a.headString)</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">        || !m.sentenceWords.get(m.headIndex).get(CoreAnnotations.PartOfSpeechAnnotation.class).startsWith(&quot;NNP&quot;)</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">        || !a.sentenceWords.get(a.headIndex).get(CoreAnnotations.PartOfSpeechAnnotation.class).startsWith(&quot;NNP&quot;)) {</span>
<span class="nc" id="L564">      return false;</span>
    }
<span class="nc bnc" id="L566" title="All 2 branches missed.">    if(!m.removePhraseAfterHead().toLowerCase().endsWith(m.headString)</span>
<span class="nc bnc" id="L567" title="All 2 branches missed.">        || !a.removePhraseAfterHead().toLowerCase().endsWith(a.headString)) {</span>
<span class="nc" id="L568">      return false;</span>
    }
<span class="nc" id="L570">    Set&lt;String&gt; mProperNouns = Generics.newHashSet();</span>
<span class="nc" id="L571">    Set&lt;String&gt; aProperNouns = Generics.newHashSet();</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">    for (CoreLabel w : m.sentenceWords.subList(m.startIndex, m.headIndex)){</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">      if (w.get(CoreAnnotations.PartOfSpeechAnnotation.class).startsWith(&quot;NNP&quot;)) {</span>
<span class="nc" id="L574">        mProperNouns.add(w.get(CoreAnnotations.TextAnnotation.class));</span>
      }
<span class="nc" id="L576">    }</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">    for (CoreLabel w : a.sentenceWords.subList(a.startIndex, a.headIndex)){</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">      if (w.get(CoreAnnotations.PartOfSpeechAnnotation.class).startsWith(&quot;NNP&quot;)) {</span>
<span class="nc" id="L579">        aProperNouns.add(w.get(CoreAnnotations.TextAnnotation.class));</span>
      }
<span class="nc" id="L581">    }</span>
<span class="nc" id="L582">    boolean mHasExtra = false;</span>
<span class="nc" id="L583">    boolean aHasExtra = false;</span>
<span class="nc bnc" id="L584" title="All 2 branches missed.">    for (String s : mProperNouns) {</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">      if (!aProperNouns.contains(s)) {</span>
<span class="nc" id="L586">        mHasExtra = true;</span>
<span class="nc" id="L587">        break;</span>
      }
<span class="nc" id="L589">    }</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">    for (String s : aProperNouns) {</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">      if (!mProperNouns.contains(s)) {</span>
<span class="nc" id="L592">        aHasExtra = true;</span>
<span class="nc" id="L593">        break;</span>
      }
<span class="nc" id="L595">    }</span>
<span class="nc bnc" id="L596" title="All 4 branches missed.">    if(mHasExtra &amp;&amp; aHasExtra) return false;</span>
<span class="nc" id="L597">    return true;</span>
  }

<span class="nc" id="L600">  private static final Set&lt;String&gt; NUMBERS = Generics.newHashSet(Arrays.asList(new String[]{</span>
          &quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;, &quot;five&quot;, &quot;six&quot;, &quot;seven&quot;, &quot;eight&quot;, &quot;nine&quot;, &quot;ten&quot;, &quot;hundred&quot;, &quot;thousand&quot;, &quot;million&quot;, &quot;billion&quot;}));
  /** Check whether there is a new number in later mention */
  public static boolean entityNumberInLaterMention(Mention mention, Mention ant) {
<span class="nc" id="L604">    Set&lt;String&gt; antecedentWords = Generics.newHashSet();</span>
<span class="nc bnc" id="L605" title="All 2 branches missed.">    for (CoreLabel w : ant.originalSpan){</span>
<span class="nc" id="L606">      antecedentWords.add(w.get(CoreAnnotations.TextAnnotation.class));</span>
<span class="nc" id="L607">    }</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">    for (CoreLabel w : mention.originalSpan) {</span>
<span class="nc" id="L609">      String word = w.get(CoreAnnotations.TextAnnotation.class);</span>
      // Note: this is locale specific for English and ascii numerals
<span class="nc bnc" id="L611" title="All 2 branches missed.">      if (NumberMatchingRegex.isDouble(word)) {</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">        if (!antecedentWords.contains(word)) return true;</span>
      } else {
<span class="nc bnc" id="L614" title="All 4 branches missed.">        if (NUMBERS.contains(word.toLowerCase()) &amp;&amp; !antecedentWords.contains(word)) return true;</span>
      }
<span class="nc" id="L616">    }</span>
<span class="nc" id="L617">    return false;</span>
  }

  /** Have extra proper noun except strings involved in semantic match */
  public static boolean entityHaveExtraProperNoun(Mention m, Mention a, Set&lt;String&gt; exceptWords) {
<span class="nc" id="L622">    Set&lt;String&gt; mProper = Generics.newHashSet();</span>
<span class="nc" id="L623">    Set&lt;String&gt; aProper = Generics.newHashSet();</span>
<span class="nc" id="L624">    String mString = m.spanToString();</span>
<span class="nc" id="L625">    String aString = a.spanToString();</span>

<span class="nc bnc" id="L627" title="All 2 branches missed.">    for (CoreLabel w : m.originalSpan){</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">      if (w.get(CoreAnnotations.PartOfSpeechAnnotation.class).startsWith(&quot;NNP&quot;)) {</span>
<span class="nc" id="L629">        mProper.add(w.get(CoreAnnotations.TextAnnotation.class));</span>
      }
<span class="nc" id="L631">    }</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">    for (CoreLabel w : a.originalSpan){</span>
<span class="nc bnc" id="L633" title="All 2 branches missed.">      if (w.get(CoreAnnotations.PartOfSpeechAnnotation.class).startsWith(&quot;NNP&quot;)) {</span>
<span class="nc" id="L634">        aProper.add(w.get(CoreAnnotations.TextAnnotation.class));</span>
      }
<span class="nc" id="L636">    }</span>
<span class="nc" id="L637">    boolean mHasExtra = false;</span>
<span class="nc" id="L638">    boolean aHasExtra = false;</span>


<span class="nc bnc" id="L641" title="All 2 branches missed.">    for (String s : mProper) {</span>
<span class="nc bnc" id="L642" title="All 4 branches missed.">      if (!aString.contains(s) &amp;&amp; !exceptWords.contains(s.toLowerCase())) {</span>
<span class="nc" id="L643">        mHasExtra = true;</span>
<span class="nc" id="L644">        break;</span>
      }
<span class="nc" id="L646">    }</span>
<span class="nc bnc" id="L647" title="All 2 branches missed.">    for (String s : aProper) {</span>
<span class="nc bnc" id="L648" title="All 4 branches missed.">      if (!mString.contains(s) &amp;&amp; !exceptWords.contains(s.toLowerCase())) {</span>
<span class="nc" id="L649">        aHasExtra = true;</span>
<span class="nc" id="L650">        break;</span>
      }
<span class="nc" id="L652">    }</span>

<span class="nc bnc" id="L654" title="All 4 branches missed.">    if(mHasExtra &amp;&amp; aHasExtra) {</span>
<span class="nc" id="L655">      return true;</span>
    }
<span class="nc" id="L657">    return false;</span>
  }

  /** Is the speaker for mention the same entity as the ant entity? */
  public static boolean antecedentIsMentionSpeaker(Document document,
                                                   Mention mention, Mention ant, Dictionaries dict) {
<span class="nc bnc" id="L663" title="All 2 branches missed.">    if(document.speakerPairs.contains(new Pair&lt;&gt;(mention.mentionID, ant.mentionID))) {</span>
<span class="nc" id="L664">      return true;</span>
    }

<span class="nc bnc" id="L667" title="All 2 branches missed.">    if(antecedentMatchesMentionSpeakerAnnotation(mention, ant, document)) {</span>
<span class="nc" id="L668">      return true;</span>
    }
<span class="nc" id="L670">    return false;</span>
  }

<span class="nc" id="L673">  public static final Pattern WHITESPACE_PATTERN = Pattern.compile(&quot; +&quot;);</span>

  /**
   * The antecedent matches the speaker annotation found in the mention
   */
  public static boolean antecedentMatchesMentionSpeakerAnnotation(Mention mention, Mention ant, Document document) {
<span class="nc bnc" id="L679" title="All 2 branches missed.">    if (mention.headWord == null) {</span>
<span class="nc" id="L680">      return false;</span>
    }
<span class="nc" id="L682">    String speaker = mention.headWord.get(CoreAnnotations.SpeakerAnnotation.class);</span>

<span class="nc bnc" id="L684" title="All 2 branches missed.">    if (speaker == null) {</span>
<span class="nc" id="L685">      return false;</span>
    }

<span class="nc bnc" id="L688" title="All 2 branches missed.">    SpeakerInfo speakerInfo = (document != null)? document.getSpeakerInfo(speaker):null;</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">    if (speakerInfo != null) {</span>
<span class="nc" id="L690">      return (mentionMatchesSpeaker(ant, speakerInfo, false));</span>
    }

    // CAN'T get speaker info - take alternate path

    // We optimize a little here: if the name has no spaces, which is
    // the common case, then it is unnecessarily expensive to call
    // regex split
<span class="nc bnc" id="L698" title="All 2 branches missed.">    if (speaker.indexOf(&quot; &quot;) &gt;= 0) {</span>
      // Perhaps we could optimize this, too, but that would be trickier
<span class="nc bnc" id="L700" title="All 2 branches missed.">      for (String s : WHITESPACE_PATTERN.split(speaker)) {</span>
<span class="nc bnc" id="L701" title="All 2 branches missed.">        if (ant.headString.equalsIgnoreCase(s)) return true;</span>
      }
    } else {
<span class="nc bnc" id="L704" title="All 2 branches missed.">      if (ant.headString.equalsIgnoreCase(speaker)) return true;</span>
    }
<span class="nc" id="L706">    return false;</span>
  }

  public static boolean mentionMatchesSpeaker(Mention mention, SpeakerInfo speakerInfo, boolean strictMatch) {
    // Got info about this speaker
<span class="nc bnc" id="L711" title="All 2 branches missed.">    if (mention.speakerInfo != null) {</span>
<span class="nc bnc" id="L712" title="All 2 branches missed.">      if (mention.speakerInfo == speakerInfo) return true;</span>
    }
<span class="nc bnc" id="L714" title="All 2 branches missed.">    if (speakerInfo.containsMention(mention)) return true;</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">    if (strictMatch) {</span>
<span class="nc" id="L716">      String spkstr = SpeakerInfo.WHITESPACE_PATTERN.matcher(speakerInfo.getSpeakerName()).replaceAll(&quot;&quot;);</span>
<span class="nc" id="L717">      String mstr = SpeakerInfo.WHITESPACE_PATTERN.matcher(mention.spanToString()).replaceAll(&quot;&quot;);</span>
<span class="nc bnc" id="L718" title="All 2 branches missed.">      if (spkstr.equalsIgnoreCase(mstr)) {</span>
<span class="nc" id="L719">        speakerInfo.addMention(mention);</span>
<span class="nc" id="L720">        return true;</span>
      }
<span class="nc" id="L722">    } else {</span>
      // speaker strings are pre-split
<span class="nc bnc" id="L724" title="All 2 branches missed.">      if(!mention.headWord.tag().startsWith(&quot;NNP&quot;)) return false;</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">      for (String s : speakerInfo.getSpeakerNameStrings()) {</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">        if (mention.headString.equalsIgnoreCase(s)) {</span>
<span class="nc" id="L727">          speakerInfo.addMention(mention);</span>
<span class="nc" id="L728">          return true;</span>
        }
      }
<span class="nc bnc" id="L731" title="All 2 branches missed.">      if (speakerInfo.getSpeakerDesc() != null) {</span>
<span class="nc" id="L732">        String spkDescStr = SpeakerInfo.WHITESPACE_PATTERN.matcher(speakerInfo.getSpeakerDesc()).replaceAll(&quot;&quot;);</span>
<span class="nc" id="L733">        String mstr = SpeakerInfo.WHITESPACE_PATTERN.matcher(mention.spanToString()).replaceAll(&quot;&quot;);</span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">        if (spkDescStr.equalsIgnoreCase(mstr)) return true;</span>
      }
    }
<span class="nc" id="L737">    return false;</span>
  }

  public static boolean entityPersonDisagree(Document document, Mention m, Mention ant, Dictionaries dict) {
<span class="nc" id="L741">    boolean sameSpeaker = entitySameSpeaker(document, m, ant);</span>

<span class="nc bnc" id="L743" title="All 4 branches missed.">    if(sameSpeaker &amp;&amp; m.person!=ant.person) {</span>
<span class="nc bnc" id="L744" title="All 12 branches missed.">      if ((m.person == Person.IT &amp;&amp; ant.person == Person.THEY)</span>
           || (m.person == Person.THEY &amp;&amp; ant.person == Person.IT) || (m.person == Person.THEY &amp;&amp; ant.person == Person.THEY)) {
<span class="nc" id="L746">        return false;</span>
<span class="nc bnc" id="L747" title="All 4 branches missed.">      } else if (m.person != Person.UNKNOWN &amp;&amp; ant.person != Person.UNKNOWN)</span>
<span class="nc" id="L748">        return true;</span>
    }
<span class="nc bnc" id="L750" title="All 2 branches missed.">    if(sameSpeaker) {</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">      if(!ant.isPronominal()) {</span>
<span class="nc bnc" id="L752" title="All 6 branches missed.">        if(m.person==Person.I || m.person==Person.WE || m.person==Person.YOU) return true;</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">      } else if(!m.isPronominal()) {</span>
<span class="nc bnc" id="L754" title="All 6 branches missed.">        if(ant.person==Person.I || ant.person==Person.WE || ant.person==Person.YOU) return true;</span>
      }
    }
<span class="nc bnc" id="L757" title="All 6 branches missed.">    if(m.person==Person.YOU &amp;&amp; m != ant &amp;&amp; ant.appearEarlierThan(m)) {</span>
<span class="nc bnc" id="L758" title="All 4 branches missed.">      assert !m.appearEarlierThan(ant);</span>
<span class="nc" id="L759">      int mUtter = m.headWord.get(CoreAnnotations.UtteranceAnnotation.class);</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">      if (document.speakers.containsKey(mUtter - 1)) {</span>
<span class="nc" id="L761">        String previousSpeaker = document.speakers.get(mUtter - 1);</span>
<span class="nc" id="L762">        int previousSpeakerCorefClusterID = getSpeakerClusterId(document, previousSpeaker);</span>
<span class="nc bnc" id="L763" title="All 2 branches missed.">        if (previousSpeakerCorefClusterID &lt; 0) {</span>
<span class="nc" id="L764">          return true;</span>
        }
<span class="nc bnc" id="L766" title="All 4 branches missed.">        if (ant.corefClusterID != previousSpeakerCorefClusterID &amp;&amp; ant.person != Person.I) {</span>
<span class="nc" id="L767">          return true;</span>
        }
<span class="nc" id="L769">      } else {</span>
<span class="nc" id="L770">        return true;</span>
      }
<span class="nc bnc" id="L772" title="All 6 branches missed.">    } else if (ant.person==Person.YOU &amp;&amp; m != ant &amp;&amp; m.appearEarlierThan(ant)) {</span>
<span class="nc bnc" id="L773" title="All 4 branches missed.">      assert !(ant.appearEarlierThan(m));</span>
<span class="nc" id="L774">      int aUtter = ant.headWord.get(CoreAnnotations.UtteranceAnnotation.class);</span>
<span class="nc bnc" id="L775" title="All 2 branches missed.">      if (document.speakers.containsKey(aUtter - 1)) {</span>
<span class="nc" id="L776">        String previousSpeaker = document.speakers.get(aUtter - 1);</span>
<span class="nc" id="L777">        int previousSpeakerCorefClusterID = getSpeakerClusterId(document, previousSpeaker);</span>
<span class="nc bnc" id="L778" title="All 2 branches missed.">        if (previousSpeakerCorefClusterID &lt; 0) {</span>
<span class="nc" id="L779">          return true;</span>
        }
<span class="nc bnc" id="L781" title="All 4 branches missed.">        if (m.corefClusterID != previousSpeakerCorefClusterID &amp;&amp; m.person != Person.I) {</span>
<span class="nc" id="L782">          return true;</span>
        }
<span class="nc" id="L784">      } else {</span>
<span class="nc" id="L785">        return true;</span>
      }
    }
<span class="nc" id="L788">    return false;</span>
  }

  /** Do the mentions share the same speaker? */
  public static boolean entitySameSpeaker(Document document, Mention m, Mention ant) {
<span class="nc" id="L793">    String mSpeakerStr = m.headWord.get(CoreAnnotations.SpeakerAnnotation.class);</span>
<span class="nc bnc" id="L794" title="All 2 branches missed.">    if (mSpeakerStr == null) {</span>
<span class="nc" id="L795">      return false;</span>
    }
<span class="nc" id="L797">    String antSpeakerStr = ant.headWord.get(CoreAnnotations.SpeakerAnnotation.class);</span>
<span class="nc bnc" id="L798" title="All 2 branches missed.">    if (antSpeakerStr == null) {</span>
<span class="nc" id="L799">      return false;</span>
    }

    // Speakers are the same if the speaker strings are the same (most common case?)
<span class="nc bnc" id="L803" title="All 2 branches missed.">    if (mSpeakerStr.equals(antSpeakerStr)) {</span>
<span class="nc" id="L804">      return true;</span>
    } else {
      // Speakers are also the same if they map to the same cluster id...
<span class="nc" id="L807">      int mSpeakerClusterID = getSpeakerClusterId(document, mSpeakerStr);</span>
<span class="nc" id="L808">      int antSpeakerClusterID = getSpeakerClusterId(document, antSpeakerStr);</span>
<span class="nc bnc" id="L809" title="All 4 branches missed.">      if (mSpeakerClusterID &gt;= 0 &amp;&amp; antSpeakerClusterID &gt;= 0) {</span>
<span class="nc bnc" id="L810" title="All 2 branches missed.">        return (mSpeakerClusterID == antSpeakerClusterID);</span>
      } else {
<span class="nc" id="L812">        return false;</span>
      }
    }
  }

  /**
   * Given the name of a speaker, returns the coref cluster id it belongs to (-1 if no cluster)
   * @param document The document to search in
   * @param speakerString The name to search for
   * @return cluster id
   */
  public static int getSpeakerClusterId(Document document, String speakerString) {
<span class="nc" id="L824">    int speakerClusterId = -1;</span>
    // try looking up cluster id from speaker info
<span class="nc" id="L826">    SpeakerInfo speakerInfo = null;</span>
<span class="nc bnc" id="L827" title="All 2 branches missed.">    if (speakerString != null) {</span>
<span class="nc" id="L828">      speakerInfo = document.getSpeakerInfo(speakerString);</span>
<span class="nc bnc" id="L829" title="All 2 branches missed.">      if (speakerInfo != null) {</span>
<span class="nc" id="L830">        speakerClusterId = speakerInfo.getCorefClusterId();</span>
      }
    }
<span class="nc bnc" id="L833" title="All 6 branches missed.">    if (speakerClusterId &lt; 0 &amp;&amp; speakerString != null &amp;&amp; NumberMatchingRegex.isDecimalInteger(speakerString)) {</span>
      // speakerString is number so is mention id
      try {
<span class="nc" id="L836">        int speakerMentionId = Integer.parseInt(speakerString);</span>
<span class="nc" id="L837">        Mention mention = document.predictedMentionsByID.get(speakerMentionId);</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">        if (mention != null) {</span>
<span class="nc" id="L839">          speakerClusterId = mention.corefClusterID;</span>
<span class="nc bnc" id="L840" title="All 2 branches missed.">          if (speakerInfo != null) speakerInfo.addMention(mention);</span>
        }
<span class="nc" id="L842">      } catch (Exception e) {</span>
<span class="nc" id="L843">      }</span>
    }
<span class="nc" id="L845">    return speakerClusterId;</span>
  }

  public static boolean entitySubjectObject(Mention m1, Mention m2) {
<span class="nc bnc" id="L849" title="All 2 branches missed.">    if(m1.sentNum != m2.sentNum) return false;</span>
<span class="nc bnc" id="L850" title="All 4 branches missed.">    if(m1.dependingVerb==null || m2.dependingVerb ==null) return false;</span>
<span class="nc bnc" id="L851" title="All 18 branches missed.">    if (m1.dependingVerb == m2.dependingVerb</span>
         &amp;&amp; ((m1.isSubject &amp;&amp; (m2.isDirectObject || m2.isIndirectObject || m2.isPrepositionObject))
              || (m2.isSubject &amp;&amp; (m1.isDirectObject || m1.isIndirectObject || m1.isPrepositionObject)))) {
<span class="nc" id="L854">      return true;</span>
    }
<span class="nc" id="L856">    return false;</span>
  }

  // Return true if the two mentions are less than n mentions apart in the same sent
  public static boolean entityTokenDistance(Mention m1, Mention m2) {
<span class="nc bnc" id="L861" title="All 4 branches missed.">    if( (m2.sentNum == m1.sentNum) &amp;&amp; (m1.startIndex - m2.startIndex &lt; 6) ) return true;</span>
<span class="nc" id="L862">    return false;</span>
  }

  // COREF_DICT strict: all the mention pairs between the two clusters must match in the dict
  public static boolean entityClusterAllCorefDictionary(CorefCluster menCluster, CorefCluster antCluster,
      Dictionaries dict, int dictColumn, int freq){
<span class="nc" id="L868">    boolean ret = false;</span>
<span class="nc bnc" id="L869" title="All 2 branches missed.">    for(Mention men : menCluster.getCorefMentions()){</span>
<span class="nc bnc" id="L870" title="All 2 branches missed.">      if(men.isPronominal()) continue;</span>
<span class="nc bnc" id="L871" title="All 2 branches missed.">      for(Mention ant : antCluster.getCorefMentions()){</span>
<span class="nc bnc" id="L872" title="All 4 branches missed.">        if(ant.isPronominal() || men.headWord.lemma().equals(ant.headWord.lemma())) continue;</span>
<span class="nc bnc" id="L873" title="All 2 branches missed.">        if(entityCorefDictionary(men, ant, dict, dictColumn, freq)){</span>
<span class="nc" id="L874">          ret = true;</span>
        } else {
<span class="nc" id="L876">          return false;</span>
        }
<span class="nc" id="L878">      }</span>
<span class="nc" id="L879">    }</span>
<span class="nc" id="L880">    return ret;</span>
  }

   // COREF_DICT pairwise: the two mentions match in the dict
   public static boolean entityCorefDictionary(Mention men, Mention ant, Dictionaries dict, int dictVersion, int freq){

<span class="nc" id="L886">     Pair&lt;String, String&gt; mention_pair = new Pair&lt;&gt;(</span>
<span class="nc" id="L887">             men.getSplitPattern()[dictVersion - 1].toLowerCase(),</span>
<span class="nc" id="L888">             ant.getSplitPattern()[dictVersion - 1].toLowerCase());</span>

<span class="nc" id="L890">     int high_freq = -1;</span>
<span class="nc bnc" id="L891" title="All 2 branches missed.">     if(dictVersion == 1){</span>
<span class="nc" id="L892">       high_freq = 75;</span>
<span class="nc bnc" id="L893" title="All 2 branches missed.">     } else if(dictVersion == 2){</span>
<span class="nc" id="L894">       high_freq = 16;</span>
<span class="nc bnc" id="L895" title="All 2 branches missed.">     } else if(dictVersion == 3){</span>
<span class="nc" id="L896">       high_freq = 16;</span>
<span class="nc bnc" id="L897" title="All 2 branches missed.">     } else if(dictVersion == 4){</span>
<span class="nc" id="L898">       high_freq = 16;</span>
     }

<span class="nc bnc" id="L901" title="All 2 branches missed.">     if(dict.corefDict.get(dictVersion-1).getCount(mention_pair) &gt; high_freq) return true;</span>

<span class="nc bnc" id="L903" title="All 2 branches missed.">     if(dict.corefDict.get(dictVersion-1).getCount(mention_pair) &gt; freq){</span>
<span class="nc bnc" id="L904" title="All 2 branches missed.">         if(dict.corefDictPMI.getCount(mention_pair) &gt; 0.18) return true;</span>
<span class="nc bnc" id="L905" title="All 2 branches missed.">         if(!dict.corefDictPMI.containsKey(mention_pair)) return true;</span>
     }
<span class="nc" id="L907">     return false;</span>
   }

   public static boolean contextIncompatible(Mention men, Mention ant, Dictionaries dict) {
<span class="nc" id="L911">     String antHead = ant.headWord.word();</span>
<span class="nc bnc" id="L912" title="All 4 branches missed.">     if ( (ant.mentionType == MentionType.PROPER)</span>
           &amp;&amp; ant.sentNum != men.sentNum
<span class="nc bnc" id="L914" title="All 2 branches missed.">           &amp;&amp; !isContextOverlapping(ant,men)</span>
<span class="nc bnc" id="L915" title="All 2 branches missed.">           &amp;&amp; dict.NE_signatures.containsKey(antHead)) {</span>
<span class="nc" id="L916">       IntCounter&lt;String&gt; ranks = Counters.toRankCounter(dict.NE_signatures.get(antHead));</span>
       List&lt;String&gt; context;
<span class="nc bnc" id="L918" title="All 2 branches missed.">       if (!men.getPremodifierContext().isEmpty()) {</span>
<span class="nc" id="L919">         context = men.getPremodifierContext();</span>
       } else {
<span class="nc" id="L921">         context = men.getContext();</span>
       }
<span class="nc bnc" id="L923" title="All 2 branches missed.">       if (!context.isEmpty()) {</span>
<span class="nc" id="L924">         int highestRank = 100000;</span>
<span class="nc bnc" id="L925" title="All 2 branches missed.">         for (String w: context) {</span>
<span class="nc bnc" id="L926" title="All 4 branches missed.">           if (ranks.containsKey(w) &amp;&amp; ranks.getIntCount(w) &lt; highestRank) {</span>
<span class="nc" id="L927">             highestRank = ranks.getIntCount(w);</span>
           }
           // check in the other direction
<span class="nc bnc" id="L930" title="All 2 branches missed.">           if (dict.NE_signatures.containsKey(w)) {</span>
<span class="nc" id="L931">             IntCounter&lt;String&gt; reverseRanks = Counters.toRankCounter(dict.NE_signatures.get(w));</span>
<span class="nc bnc" id="L932" title="All 4 branches missed.">             if (reverseRanks.containsKey(antHead) &amp;&amp; reverseRanks.getIntCount(antHead) &lt; highestRank) {</span>
<span class="nc" id="L933">               highestRank = reverseRanks.getIntCount(antHead);</span>
             }
           }
<span class="nc" id="L936">         }</span>
<span class="nc bnc" id="L937" title="All 2 branches missed.">         if (highestRank &gt; 10) return true;</span>
       }
     }
<span class="nc" id="L940">     return false;</span>
   }

   public static boolean sentenceContextIncompatible(Mention men, Mention ant, Dictionaries dict) {
<span class="nc bnc" id="L944" title="All 6 branches missed.">     if ( (ant.mentionType != MentionType.PROPER)</span>
          &amp;&amp; (ant.sentNum != men.sentNum)
          &amp;&amp; (men.mentionType != MentionType.PROPER)
<span class="nc bnc" id="L947" title="All 2 branches missed.">          &amp;&amp; !isContextOverlapping(ant,men)) {</span>
<span class="nc bnc" id="L948" title="All 2 branches missed.">       List&lt;String&gt; context1 = !ant.getPremodifierContext().isEmpty() ? ant.getPremodifierContext() : ant.getContext();</span>
<span class="nc bnc" id="L949" title="All 2 branches missed.">       List&lt;String&gt; context2 = !men.getPremodifierContext().isEmpty() ? men.getPremodifierContext() : men.getContext();</span>
<span class="nc bnc" id="L950" title="All 4 branches missed.">       if (!context1.isEmpty() &amp;&amp; !context2.isEmpty()) {</span>
<span class="nc" id="L951">         int highestRank = 100000;</span>
<span class="nc bnc" id="L952" title="All 2 branches missed.">         for (String w1: context1) {</span>
<span class="nc bnc" id="L953" title="All 2 branches missed.">           for (String w2: context2) {</span>
             // check the forward direction
<span class="nc bnc" id="L955" title="All 2 branches missed.">             if (dict.NE_signatures.containsKey(w1)) {</span>
<span class="nc" id="L956">               IntCounter&lt;String&gt; ranks = Counters.toRankCounter(dict.NE_signatures.get(w1));</span>
<span class="nc bnc" id="L957" title="All 4 branches missed.">               if (ranks.containsKey(w2) &amp;&amp; ranks.getIntCount(w2) &lt; highestRank) {</span>
<span class="nc" id="L958">                 highestRank = ranks.getIntCount(w2);</span>
               }
             }
             // check in the other direction
<span class="nc bnc" id="L962" title="All 2 branches missed.">             if (dict.NE_signatures.containsKey(w2)) {</span>
<span class="nc" id="L963">               IntCounter&lt;String&gt; reverseRanks = Counters.toRankCounter(dict.NE_signatures.get(w2));</span>
<span class="nc bnc" id="L964" title="All 4 branches missed.">               if (reverseRanks.containsKey(w1) &amp;&amp; reverseRanks.getIntCount(w1) &lt; highestRank) {</span>
<span class="nc" id="L965">                 highestRank = reverseRanks.getIntCount(w1);</span>
               }
             }
<span class="nc" id="L968">           }</span>
<span class="nc" id="L969">         }</span>
<span class="nc bnc" id="L970" title="All 2 branches missed.">         if (highestRank &gt; 10) return true;</span>
       }
     }
<span class="nc" id="L973">     return false;</span>
   }

   private static boolean isContextOverlapping(Mention m1, Mention m2) {
<span class="nc" id="L977">     Set&lt;String&gt; context1 = Generics.newHashSet();</span>
<span class="nc" id="L978">     Set&lt;String&gt; context2 = Generics.newHashSet();</span>
<span class="nc" id="L979">     context1.addAll(m1.getContext());</span>
<span class="nc" id="L980">     context2.addAll(m2.getContext());</span>
<span class="nc" id="L981">     return Sets.intersects(context1, context2);</span>
   }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>