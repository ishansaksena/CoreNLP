<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TregexGUI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Stanford CoreNLP</a> &gt; <a href="index.source.html" class="el_package">edu.stanford.nlp.trees.tregex.gui</a> &gt; <span class="el_source">TregexGUI.java</span></div><h1>TregexGUI.java</h1><pre class="source lang-java linenums">// Tregex/Tsurgeon, TregexGUI - a GUI for tree search and modification
// Copyright (c) 2007-2008 The Board of Trustees of
// The Leland Stanford Junior University. All Rights Reserved.
//
// This program is free software; you can redistribute it and/or
// modify it under the terms of the GNU General Public License
// as published by the Free Software Foundation; either version 2
// of the License, or (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
//
// This code is a GUI interface to Tregex and Tsurgeon (which were
// written by Rogey Levy and Galen Andrew).
//
// For more information, bug reports, fixes, contact:
//    Christopher Manning
//    Dept of Computer Science, Gates 1A
//    Stanford CA 94305-9010
//    USA
//    Support/Questions: parser-user@lists.stanford.edu
//    Licensing: parser-support@lists.stanford.edu
//    http://www-nlp.stanford.edu/software/tregex.shtml

package edu.stanford.nlp.trees.tregex.gui; 
import edu.stanford.nlp.util.logging.Redwood;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Component;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.KeyboardFocusManager;
import java.awt.Toolkit;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.InputEvent;
import java.awt.event.KeyEvent;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileOutputStream;
import java.io.FileReader;
import java.io.IOException;
import java.io.OutputStreamWriter;
import java.lang.reflect.Method;
import java.util.*;

import javax.swing.*;

import edu.stanford.nlp.io.NumberRangesFileFilter;
import edu.stanford.nlp.swing.FontDetector;
import edu.stanford.nlp.trees.HeadFinder;
import edu.stanford.nlp.trees.TreeReaderFactory;
import edu.stanford.nlp.trees.TreeTransformer;
import edu.stanford.nlp.trees.tregex.gui.MatchesPanel.MatchesPanelListener;
import edu.stanford.nlp.trees.tregex.tsurgeon.Tsurgeon;
import edu.stanford.nlp.util.Generics;
import edu.stanford.nlp.util.ReflectionLoading;

/**
 * Main class for creating a tregex gui.  Manages the components and holds the menu bar.
 * A tregex gui (Interactive Tregex) allows users to perform tregex searches in a gui interface
 * and view the results of those searches.  Search results may be saved.
 *
 * @author Anna Rafferty
 */
@SuppressWarnings(&quot;serial&quot;)
public class TregexGUI extends JFrame implements ActionListener, MatchesPanelListener  {

  /** A logger for this class */
<span class="nc" id="L81">  private static Redwood.RedwoodChannels log = Redwood.channels(TregexGUI.class);</span>

  private static TregexGUI instance; // = null;

  private JMenuItem preferences;
  private JMenuItem loadFiles;
  private JMenuItem saveMatches;
  private JMenuItem saveSentences;
  private JMenuItem saveHistory;
  private JMenuItem loadTsurgeon;
  private JMenuItem tDiff;
  private JMenuItem quit; //for when we're not running on a mac
  private JMenuItem copy;
  private JMenuItem searchMenuItem;
  private JMenuItem prevMatch;
  private JMenuItem nextMatch;
  private JMenuItem prevTreeMatch;
  private JMenuItem nextTreeMatch;
  private JMenuItem clearFileList;

  //file choosing components for loading trees
  private JFileChooser chooser; // = null;
  private static File chooserFile;

  final TreeTransformer transformer;

  //preferences, about panel so that we don't have to remake each time
  private PreferencesPanel preferenceDialog; // = null;
  private JDialog aboutBox; // = null;

  private static final String TRANSFORMER = &quot;transformer&quot;;

  private JMenuBar getMenu() {
<span class="nc" id="L114">    JMenuBar mbar = new JMenuBar();</span>

    //make file menu
<span class="nc" id="L117">    JMenu file = new JMenu(&quot;File&quot;);</span>
<span class="nc" id="L118">    loadFiles = new JMenuItem(&quot;Load trees...&quot;);</span>
<span class="nc" id="L119">    loadFiles.addActionListener(this);</span>
<span class="nc" id="L120">    saveMatches = new JMenuItem(&quot;Save matched trees...&quot;);</span>
<span class="nc" id="L121">    saveMatches.addActionListener(this);</span>
<span class="nc" id="L122">    saveMatches.setEnabled(false);</span>
<span class="nc" id="L123">    saveSentences = new JMenuItem(&quot;Save matched sentences...&quot;);</span>
<span class="nc" id="L124">    saveSentences.addActionListener(this);</span>
<span class="nc" id="L125">    saveSentences.setEnabled(false);</span>
<span class="nc" id="L126">    saveHistory = new JMenuItem(&quot;Save statistics...&quot;);</span>
<span class="nc" id="L127">    saveHistory.addActionListener(this);</span>
<span class="nc" id="L128">    saveHistory.setEnabled(false);</span>
<span class="nc" id="L129">    loadTsurgeon = new JMenuItem(&quot;Load Tsurgeon script...&quot;);</span>
<span class="nc" id="L130">    loadTsurgeon.addActionListener(this);</span>
<span class="nc" id="L131">    clearFileList = new JMenuItem(&quot;Clear tree file list&quot;);</span>
<span class="nc" id="L132">    clearFileList.addActionListener(this);</span>
<span class="nc" id="L133">    clearFileList.setEnabled(false);</span>
<span class="nc" id="L134">    quit = new JMenuItem(&quot;Exit&quot;);</span>
<span class="nc" id="L135">    quit.addActionListener(this);</span>

<span class="nc" id="L137">    file.add(loadFiles);</span>
<span class="nc" id="L138">    file.add(loadTsurgeon);</span>
<span class="nc" id="L139">    file.addSeparator();</span>
<span class="nc" id="L140">    file.add(clearFileList);</span>
<span class="nc" id="L141">    file.addSeparator();</span>
<span class="nc" id="L142">    file.add(saveMatches);</span>
<span class="nc" id="L143">    file.add(saveSentences);</span>
<span class="nc" id="L144">    file.add(saveHistory);</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">    if ( ! isMacOSX()) {</span>
<span class="nc" id="L146">      file.addSeparator();</span>
<span class="nc" id="L147">      file.addSeparator();</span>
<span class="nc" id="L148">      file.add(quit);</span>
    }

    //make edit menu
<span class="nc" id="L152">    JMenu edit = new JMenu(&quot;Edit&quot;);</span>
<span class="nc" id="L153">    copy = new JMenuItem(&quot;Copy&quot;);</span>
<span class="nc" id="L154">    copy.setActionCommand((String)TransferHandler.getCopyAction().</span>
<span class="nc" id="L155">        getValue(Action.NAME));</span>
<span class="nc" id="L156">    copy.addActionListener(new TransferActionListener());</span>
<span class="nc" id="L157">    edit.add(copy);</span>

<span class="nc" id="L159">    JMenu search = new JMenu(&quot;Search&quot;);</span>
<span class="nc" id="L160">    searchMenuItem = new JMenuItem(&quot;Search&quot;);</span>
<span class="nc" id="L161">    searchMenuItem.addActionListener(this);</span>
<span class="nc" id="L162">    search.add(searchMenuItem);</span>
<span class="nc" id="L163">    prevMatch = new JMenuItem(&quot;Display previous match&quot;);</span>
<span class="nc" id="L164">    prevMatch.addActionListener(this);</span>
<span class="nc" id="L165">    search.add(prevMatch);</span>
<span class="nc" id="L166">    nextMatch = new JMenuItem(&quot;Display next match&quot;);</span>
<span class="nc" id="L167">    nextMatch.addActionListener(this);</span>
<span class="nc" id="L168">    search.add(nextMatch);</span>
<span class="nc" id="L169">    search.addSeparator();</span>
<span class="nc" id="L170">    prevTreeMatch = new JMenuItem(&quot;Show previous match within tree&quot;);</span>
<span class="nc" id="L171">    prevTreeMatch.addActionListener(this);</span>
<span class="nc" id="L172">    search.add(prevTreeMatch);</span>
<span class="nc" id="L173">    nextTreeMatch = new JMenuItem(&quot;Show next match within tree&quot;);</span>
<span class="nc" id="L174">    nextTreeMatch.addActionListener(this);</span>
<span class="nc" id="L175">    search.add(nextTreeMatch);</span>

<span class="nc" id="L177">    preferences = new JMenuItem(&quot;Options...&quot;);</span>
<span class="nc" id="L178">    preferences.addActionListener(this);</span>
<span class="nc" id="L179">    tDiff = new JCheckBoxMenuItem(&quot;Tdiff&quot;);</span>
<span class="nc" id="L180">    tDiff.addActionListener(this);</span>

<span class="nc" id="L182">    JMenu tools = new JMenu(&quot;Tools&quot;);</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">    if ( ! isMacOSX()) {</span>
<span class="nc" id="L184">      tools.add(preferences);</span>
    }
<span class="nc" id="L186">    tools.add(tDiff);</span>

<span class="nc" id="L188">    mbar.add(file);</span>
<span class="nc" id="L189">    mbar.add(edit);</span>
<span class="nc" id="L190">    mbar.add(search);</span>
<span class="nc" id="L191">    mbar.add(tools);</span>

<span class="nc" id="L193">    setShortcutKeys(); //sets for appropriate operating system</span>

<span class="nc" id="L195">    loadPreferences();</span>

<span class="nc" id="L197">    return mbar;</span>
  }

  private void setShortcutKeys() {
<span class="nc bnc" id="L201" title="All 2 branches missed.">    if (isMacOSX()) {</span>
<span class="nc" id="L202">      setMacShortcutKeys();</span>
    } else {
<span class="nc" id="L204">      setWindowsShortcutKeys();</span>
    }
<span class="nc" id="L206">  }</span>

  private void setMacShortcutKeys() {
<span class="nc" id="L209">    preferences.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_COMMA, InputEvent.META_MASK));</span>
<span class="nc" id="L210">    loadFiles.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_O, InputEvent.META_MASK));</span>
<span class="nc" id="L211">    saveMatches.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_S, InputEvent.META_MASK));</span>
<span class="nc" id="L212">    saveHistory.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_S, InputEvent.SHIFT_MASK+InputEvent.META_MASK));</span>
<span class="nc" id="L213">    quit.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_Q, InputEvent.META_MASK));</span>
<span class="nc" id="L214">    copy.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_C, InputEvent.META_MASK));</span>

<span class="nc" id="L216">    searchMenuItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_ENTER, InputEvent.META_MASK));</span>
<span class="nc" id="L217">    prevMatch.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_UP, InputEvent.META_MASK));</span>
<span class="nc" id="L218">    nextMatch.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_DOWN, InputEvent.META_MASK));</span>
<span class="nc" id="L219">    prevTreeMatch.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_UP, InputEvent.SHIFT_MASK | InputEvent.META_DOWN_MASK));</span>
<span class="nc" id="L220">    nextTreeMatch.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_DOWN, InputEvent.SHIFT_MASK | InputEvent.META_MASK));</span>

<span class="nc" id="L222">  }</span>

  private void setWindowsShortcutKeys() {
    // preferences.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_COMMA, Event.CTRL_MASK)); // cdm: just skip this, I don't think Windows ever uses comma like this
<span class="nc" id="L226">    loadFiles.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_O, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L227">    saveMatches.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_S, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L228">    saveHistory.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_S, InputEvent.SHIFT_MASK+InputEvent.CTRL_MASK));</span>
<span class="nc" id="L229">    quit.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_Q, InputEvent.CTRL_MASK)); // cdm: maybe should be Control or Alt F4</span>
<span class="nc" id="L230">    copy.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_C, InputEvent.CTRL_MASK));</span>

<span class="nc" id="L232">    searchMenuItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_ENTER, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L233">    prevMatch.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_UP, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L234">    nextMatch.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_DOWN, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L235">    prevTreeMatch.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_UP, InputEvent.SHIFT_MASK | InputEvent.CTRL_MASK));</span>
<span class="nc" id="L236">    nextTreeMatch.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_DOWN, InputEvent.SHIFT_MASK | InputEvent.CTRL_MASK));</span>

<span class="nc" id="L238">  }</span>

  private void initAboutBox() {
<span class="nc" id="L241">    aboutBox = new JDialog(this, &quot;About Tregex&quot;);</span>
<span class="nc" id="L242">    aboutBox.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L243">    aboutBox.getContentPane().add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;Tregex and Tsurgeon&lt;/b&gt;&lt;/html&gt;&quot;, SwingConstants.CENTER), BorderLayout.NORTH);</span>

<span class="nc" id="L245">    aboutBox.getContentPane().add(new JLabel(&quot;&lt;html&gt;Tregex by Galen Andrew and Roger Levy&lt;br&gt;Tsurgeon by Roger Levy&lt;br&gt;Graphical interface by Anna Rafferty&lt;br&gt;Additional features and development by Chris Manning&lt;br&gt;&lt;/html&gt;&quot;, SwingConstants.CENTER), BorderLayout.CENTER);</span>
<span class="nc" id="L246">    aboutBox.getContentPane().add(new JLabel(&quot;&lt;html&gt;&lt;font size=2&gt;\u00A92007 The Board of Trustees of The Leland Stanford Junior University.&lt;br&gt;Distributed under the GNU General Public License&lt;/font&gt;&lt;/html&gt;&quot;, SwingConstants.CENTER), BorderLayout.SOUTH);</span>

<span class="nc" id="L248">  }</span>

  /**
   * Used to change the status of the save file menu item to reflect
   * whether any trees are available to save.
   */
  public void setSaveEnabled(boolean enabled) {
<span class="nc bnc" id="L255" title="All 2 branches missed.">    if(saveMatches.isEnabled() != enabled) {</span>
<span class="nc" id="L256">      saveMatches.setEnabled(enabled);</span>
<span class="nc" id="L257">      saveSentences.setEnabled(enabled);</span>
    }
<span class="nc" id="L259">  }</span>

  /**
   * Used to change the status of the saveHistory file menu item to reflect
   * whether any search statistics are available to save
   */
  public void setSaveHistoryEnabled(boolean enabled) {
<span class="nc bnc" id="L266" title="All 2 branches missed.">    if(saveHistory.isEnabled() != enabled)</span>
<span class="nc" id="L267">      saveHistory.setEnabled(enabled);</span>
<span class="nc" id="L268">  }</span>

  /**
   * Used to change the status of the tsurgeon file menu item to reflect
   * whether tsurgeon is enabled
   */
  public void setTsurgeonEnabled(boolean enabled) {
<span class="nc bnc" id="L275" title="All 2 branches missed.">    if (loadTsurgeon.isEnabled() != enabled)</span>
<span class="nc" id="L276">      loadTsurgeon.setEnabled(enabled);</span>
<span class="nc" id="L277">  }</span>

  private static void setMacProperties() {
<span class="nc" id="L280">    System.setProperty(&quot;com.apple.mrj.application.apple.menu.about.name&quot;, &quot;Tregex&quot;);</span>
<span class="nc" id="L281">    System.setProperty(&quot;apple.laf.useScreenMenuBar&quot;, &quot;true&quot;);</span>

<span class="nc" id="L283">  }</span>

  public static boolean isMacOSX() {
<span class="nc" id="L286">    return System.getProperty(&quot;os.name&quot;).toLowerCase().startsWith(&quot;mac os x&quot;);</span>
  }

  public static TregexGUI getInstance() {
<span class="nc" id="L290">    return instance;</span>
  }

  /**
   * Sets up the file panel, input panel, and match panel
   */
  private static JSplitPane setUpTopPanels() {
<span class="nc" id="L297">    JPanel filePanel = FilePanel.getInstance();</span>
<span class="nc" id="L298">    JPanel inputPanel = InputPanel.getInstance();</span>
<span class="nc" id="L299">    JPanel matchesPanel = MatchesPanel.getInstance();</span>
<span class="nc" id="L300">    JSplitPane inputAndMatchesPane = new JSplitPane(JSplitPane.HORIZONTAL_SPLIT, true, inputPanel, matchesPanel);</span>
<span class="nc" id="L301">    inputAndMatchesPane.setDividerLocation(450);</span>
<span class="nc" id="L302">    inputAndMatchesPane.setResizeWeight(.5);</span>
<span class="nc" id="L303">    inputAndMatchesPane.setBorder(BorderFactory.createEmptyBorder());</span>
<span class="nc" id="L304">    JSplitPane fullTopPanel = new JSplitPane(JSplitPane.HORIZONTAL_SPLIT, true, filePanel, inputAndMatchesPane);</span>
<span class="nc" id="L305">    fullTopPanel.setDividerLocation(275);</span>
<span class="nc" id="L306">    fullTopPanel.setBorder(BorderFactory.createEmptyBorder());</span>
<span class="nc" id="L307">    return fullTopPanel;</span>
  }

  private TregexGUI(Properties props, List&lt;String&gt; initialFiles) {
<span class="nc" id="L311">    super(&quot;Tregex&quot;);</span>
<span class="nc" id="L312">    TregexGUI.instance = this;</span>
<span class="nc" id="L313">    setDefaultLookAndFeelDecorated(true);</span>
<span class="nc" id="L314">    setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);</span>

<span class="nc" id="L316">    String transformerClass = props.getProperty(TRANSFORMER, null);</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">    if (transformerClass == null) {</span>
<span class="nc" id="L318">      transformer = null;</span>
    } else {
<span class="nc" id="L320">      transformer = ReflectionLoading.loadByReflection(transformerClass);</span>
    }

<span class="nc" id="L323">    initAboutBox();</span>
<span class="nc" id="L324">    Container content = getContentPane();</span>
<span class="nc" id="L325">    content.setBackground(Color.lightGray);</span>
    // NB: The menu has to exist before you can successfully create an input.  Bad side effect dependency!
<span class="nc" id="L327">    JMenuBar mbar = getMenu();</span>
<span class="nc" id="L328">    JPanel displayMatchesPanel = DisplayMatchesPanel.getInstance();</span>
<span class="nc" id="L329">    JSplitPane inputAndMatchesPanel = setUpTopPanels();</span>
<span class="nc" id="L330">    MatchesPanel.getInstance().addListener(this);</span>
<span class="nc" id="L331">    this.setFocusTraversalKeysEnabled(true);</span>
<span class="nc" id="L332">    macOSXRegistration();</span>
    // stick it all together now
<span class="nc" id="L334">    setJMenuBar(mbar);</span>
<span class="nc" id="L335">    content.setLayout(new BorderLayout());</span>
<span class="nc" id="L336">    JSplitPane verticalSplit = new JSplitPane(JSplitPane.VERTICAL_SPLIT, inputAndMatchesPanel, displayMatchesPanel);</span>
<span class="nc" id="L337">    verticalSplit.setResizeWeight(.2);</span>
<span class="nc" id="L338">    this.add(verticalSplit, BorderLayout.CENTER);</span>



    // make size
<span class="nc" id="L343">    Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();</span>
<span class="nc" id="L344">    int begX = (int) (screenSize.width * 0.05);</span>
<span class="nc" id="L345">    int begY = (int) (screenSize.height * 0.05);</span>
<span class="nc" id="L346">    screenSize.width = (int) (screenSize.width * 0.9);</span>
<span class="nc" id="L347">    screenSize.height = (int) (screenSize.height * 0.9);</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">    if (screenSize.width &gt; 1200) { screenSize.width = 1200; }</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">    if (screenSize.height &gt; 800) { screenSize.height = 800; }</span>
<span class="nc" id="L350">    setPreferredSize(screenSize);</span>
<span class="nc" id="L351">    Dimension displayMatchesSize = new Dimension((int) (screenSize.getWidth()),(int) (screenSize.getHeight()*3/4.));</span>
<span class="nc" id="L352">    displayMatchesPanel.setPreferredSize(displayMatchesSize);</span>
    // center it
<span class="nc" id="L354">    setBounds(begX, begY, screenSize.width, screenSize.height);</span>
<span class="nc" id="L355">    pack();</span>

<span class="nc bnc" id="L357" title="All 2 branches missed.">    if (initialFiles.size() &gt; 0) {</span>
<span class="nc" id="L358">      File[] files = new File[initialFiles.size()];</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">      for (int i = 0; i &lt; initialFiles.size(); ++i) {</span>
<span class="nc" id="L360">        files[i] = new File(initialFiles.get(i));</span>
      }
<span class="nc" id="L362">      startFileLoadingThread(new EnumMap&lt;&gt;(FilterType.class), files);</span>
    }

<span class="nc" id="L365">    setVisible(true);</span>
<span class="nc" id="L366">  }</span>

  // Generic registration with the Mac OS X application menu.  Checks the platform, then attempts
  // to register with the Apple EAWT.
  // This is based heavily on the Apple sample code for dealing with this issue
  private void macOSXRegistration() {
<span class="nc bnc" id="L372" title="All 2 branches missed.">    if (isMacOSX()) {</span>
      try {
<span class="nc" id="L374">        Class&lt;?&gt; osxAdapter = ClassLoader.getSystemClassLoader().loadClass(&quot;edu.stanford.nlp.trees.tregex.gui.OSXAdapter&quot;);</span>

<span class="nc" id="L376">        Class&lt;?&gt;[] defArgs = {TregexGUI.class};</span>
<span class="nc" id="L377">        Method registerMethod = osxAdapter.getDeclaredMethod(&quot;registerMacOSXApplication&quot;, defArgs);</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">        if (registerMethod != null) {</span>
<span class="nc" id="L379">          Object[] args = { this };</span>
<span class="nc" id="L380">          registerMethod.invoke(osxAdapter, args);</span>
        }
<span class="nc" id="L382">        defArgs[0] = boolean.class;</span>
<span class="nc" id="L383">        Method prefsEnableMethod =  osxAdapter.getDeclaredMethod(&quot;enablePrefs&quot;, defArgs);</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">        if (prefsEnableMethod != null) {</span>
<span class="nc" id="L385">          Object[] args = {Boolean.TRUE};</span>
<span class="nc" id="L386">          prefsEnableMethod.invoke(osxAdapter, args);</span>
        }
<span class="nc" id="L388">      } catch (NoClassDefFoundError e) {</span>
        // This will be thrown first if the OSXAdapter is loaded on a system without the EAWT
        // because OSXAdapter extends ApplicationAdapter in its def
<span class="nc" id="L391">        log.info(&quot;This version of Mac OS X does not support the Apple EAWT.  Application Menu handling has been disabled (&quot; + e + &quot;)&quot;);</span>
<span class="nc" id="L392">      } catch (ClassNotFoundException e) {</span>
        // This shouldn't be reached; if there's a problem with the OSXAdapter we should get the
        // above NoClassDefFoundError first.
<span class="nc" id="L395">        log.info(&quot;This version of Mac OS X does not support the Apple EAWT.  Application Menu handling has been disabled (&quot; + e + &quot;)&quot;);</span>
<span class="nc" id="L396">      } catch (Exception e) {</span>
<span class="nc" id="L397">        log.info(&quot;Exception while loading the OSXAdapter:&quot;);</span>
<span class="nc" id="L398">        e.printStackTrace();</span>
<span class="nc" id="L399">      }</span>
    }
<span class="nc" id="L401">  }</span>



  //Creates a new JFileChooser, doing the boilerplate
  // to start it in the current directory.
  private static JFileChooser createFileChooser() {
<span class="nc" id="L408">    final JFileChooser chooser = new JFileChooser();</span>
    //  sets up default file view
    try {
<span class="nc" id="L411">      chooserFile = new File((new File(&quot;.&quot;).getCanonicalPath()));</span>
<span class="nc" id="L412">    } catch (Exception e) {</span>
      // go with current directory.
<span class="nc" id="L414">    }</span>
<span class="nc" id="L415">    chooser.setCurrentDirectory(chooserFile);</span>

<span class="nc" id="L417">    chooser.addActionListener(e -&gt; {</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">      if(e.getActionCommand().equals(&quot;ApproveSelection&quot;)) {</span>
<span class="nc" id="L419">        chooserFile = chooser.getSelectedFile();</span>
      }
<span class="nc" id="L421">    });</span>
<span class="nc" id="L422">    chooser.setMultiSelectionEnabled(true);</span>
<span class="nc" id="L423">    chooser.setFileSelectionMode(JFileChooser.FILES_AND_DIRECTORIES);</span>
<span class="nc" id="L424">    return chooser;</span>
  }


  /**
   * Load and apply application preferences.
   */
  void loadPreferences() {
    //general parameters
<span class="nc" id="L433">    InputPanel.getInstance().enableTsurgeon(Preferences.getEnableTsurgeon());</span>
<span class="nc" id="L434">    MatchesPanel.getInstance().setShowOnlyMatchedPortion(Preferences.getMatchPortionOnly());</span>
    //display stuff
<span class="nc" id="L436">    MatchesPanel.getInstance().setHighlightColor(Preferences.getHighlightColor());</span>
<span class="nc" id="L437">    InputPanel.getInstance().setNumRecentPatterns(Preferences.getHistorySize());</span>
<span class="nc" id="L438">    MatchesPanel.getInstance().setMaxMatches(Preferences.getMaxMatches());</span>

    //tree display stuff
<span class="nc" id="L441">    DisplayMatchesPanel.getInstance().setMatchedColor(Preferences.getMatchedColor());</span>
<span class="nc" id="L442">    DisplayMatchesPanel.getInstance().setDefaultColor(Preferences.getTreeColor());</span>
<span class="nc" id="L443">    DisplayMatchesPanel.getInstance().setFontName(Preferences.getFont());</span>
<span class="nc" id="L444">    MatchesPanel.getInstance().setFontName(Preferences.getFont());</span>

<span class="nc" id="L446">    int fontSize = Preferences.getFontSize();</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">    if(fontSize != 0)</span>
<span class="nc" id="L448">      DisplayMatchesPanel.getInstance().setFontSize(Preferences.getFontSize());</span>

    //advanced stuff
<span class="nc" id="L451">    HeadFinder hf = Preferences.getHeadFinder();</span>
<span class="nc" id="L452">    InputPanel.getInstance().setHeadFinder(hf);</span>

<span class="nc" id="L454">    TreeReaderFactory trf = Preferences.getTreeReaderFactory();</span>
<span class="nc" id="L455">    FilePanel.getInstance().setTreeReaderFactory(trf);</span>

<span class="nc" id="L457">    String hfName = hf.getClass().getSimpleName();</span>
<span class="nc" id="L458">    String trfName = trf.getClass().getSimpleName();</span>
<span class="nc" id="L459">    String encoding = Preferences.getEncoding();</span>
<span class="nc bnc" id="L460" title="All 4 branches missed.">    if(encoding != null &amp;&amp; !encoding.equals(&quot;&quot;))</span>
<span class="nc" id="L461">      FileTreeModel.setCurEncoding(encoding);</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">    if (PreferencesPanel.isChinese(hfName, trfName))</span>
<span class="nc" id="L463">      setChineseFont();</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">    else if (PreferencesPanel.isArabic(hfName, trfName))</span>
<span class="nc" id="L465">      setArabicFont();</span>

<span class="nc bnc" id="L467" title="All 2 branches missed.">    if (preferenceDialog == null)</span>
<span class="nc" id="L468">      preferenceDialog = new PreferencesPanel(this);</span>
<span class="nc" id="L469">    preferenceDialog.checkEncodingAndDisplay(hfName, trfName);</span>
<span class="nc" id="L470">  }</span>

  private static void setChineseFont() {
<span class="nc" id="L473">    Thread t = new Thread() {</span>
      @Override
      public void run() {
<span class="nc" id="L476">        List&lt;Font&gt; fonts = FontDetector.supportedFonts(FontDetector.CHINESE);</span>
<span class="nc" id="L477">        String fontName = &quot;&quot;;</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">        if ( ! fonts.isEmpty()) {</span>
<span class="nc" id="L479">          fontName = fonts.get(0).getName();</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">        } else if (FontDetector.hasFont(&quot;Watanabe Mincho&quot;)) {</span>
<span class="nc" id="L481">          fontName = &quot;Watanabe Mincho&quot;;</span>
        }

<span class="nc bnc" id="L484" title="All 2 branches missed.">        if(!fontName.equals(&quot;&quot;)) {</span>
<span class="nc" id="L485">          DisplayMatchesPanel.getInstance().setFontName(fontName);</span>
<span class="nc" id="L486">          MatchesPanel.getInstance().setFontName(fontName);</span>
        }
<span class="nc" id="L488">      }</span>
    };
<span class="nc" id="L490">    t.start();</span>
<span class="nc" id="L491">  }</span>

  private static void setArabicFont() {
<span class="nc" id="L494">    Thread t = new Thread() {</span>
      @Override
      public void run() {
<span class="nc" id="L497">        List&lt;Font&gt; fonts = FontDetector.supportedFonts(FontDetector.ARABIC);</span>
<span class="nc" id="L498">        String fontName = &quot;&quot;;</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">        if (fonts.size() &gt; 0) {</span>
<span class="nc" id="L500">          fontName = fonts.get(0).getName();</span>
        }
<span class="nc bnc" id="L502" title="All 2 branches missed.">        if(!fontName.equals(&quot;&quot;)) {</span>
<span class="nc" id="L503">          DisplayMatchesPanel.getInstance().setFontName(fontName);</span>
<span class="nc" id="L504">          MatchesPanel.getInstance().setFontName(fontName);</span>
        }
<span class="nc" id="L506">      }</span>
    };
<span class="nc" id="L508">    t.start();</span>
<span class="nc" id="L509">  }</span>

  /*
   * Method for bringing up the load file dialog box and conveying
   * the chosen files to the filepanel
   */
  private void doLoadFiles() {
<span class="nc bnc" id="L516" title="All 2 branches missed.">    if (chooser == null) {</span>
<span class="nc" id="L517">      chooser = createFileChooser();</span>
    }
<span class="nc" id="L519">    String approveText = chooser.getApproveButtonText();</span>
<span class="nc" id="L520">    chooser.setApproveButtonText(&quot;Load with file filters&quot;);</span>
<span class="nc" id="L521">    int status = chooser.showOpenDialog(this);</span>
<span class="nc" id="L522">    chooser.setApproveButtonText(approveText);</span>
<span class="nc bnc" id="L523" title="All 2 branches missed.">    if (status == JFileChooser.APPROVE_OPTION) {</span>
      //now set up the file filters if there are directories
<span class="nc" id="L525">      File[] selectedFiles = chooser.getSelectedFiles();</span>
<span class="nc" id="L526">      boolean haveDirectory = false;</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">      for (File f : selectedFiles) {</span>
<span class="nc bnc" id="L528" title="All 2 branches missed.">        if (f.isDirectory()) {</span>
<span class="nc" id="L529">          haveDirectory = true;</span>
<span class="nc" id="L530">          break;</span>
        }
      }
<span class="nc bnc" id="L533" title="All 2 branches missed.">      if (haveDirectory) {</span>
<span class="nc" id="L534">        doFileFilters(selectedFiles);</span>
      } else {
<span class="nc" id="L536">        startFileLoadingThread(new EnumMap&lt;&gt;(FilterType.class), selectedFiles);</span>
      }
    }
<span class="nc" id="L539">  }</span>

  public static class TransferActionListener implements ActionListener, PropertyChangeListener {

    private JComponent focusOwner; // = null;

    //This code based on Java DnD tutorial
<span class="nc" id="L546">    public TransferActionListener() {</span>
      KeyboardFocusManager manager = KeyboardFocusManager.
<span class="nc" id="L548">      getCurrentKeyboardFocusManager();</span>
<span class="nc" id="L549">      manager.addPropertyChangeListener(&quot;permanentFocusOwner&quot;, this);</span>
<span class="nc" id="L550">    }</span>

    @Override
    public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L554">      Object o = e.getNewValue();</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">      if (o instanceof JComponent) {</span>
<span class="nc" id="L556">        focusOwner = (JComponent)o;</span>
      } else {
<span class="nc" id="L558">        focusOwner = null;</span>
      }
<span class="nc" id="L560">    }</span>

    @Override
    public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L564" title="All 2 branches missed.">      if (focusOwner == null)</span>
<span class="nc" id="L565">        return;</span>
<span class="nc" id="L566">      String action = e.getActionCommand();</span>
<span class="nc" id="L567">      Action a = focusOwner.getActionMap().get(action);</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">      if (a != null) {</span>
<span class="nc" id="L569">        a.actionPerformed(new ActionEvent(focusOwner,</span>
            ActionEvent.ACTION_PERFORMED,
            null));
      }
<span class="nc" id="L573">    }</span>
  }

  private void doFileFilters(File[] files) {
    //System.out.println(&quot;Doing file filters&quot;);

<span class="nc" id="L579">    final File[] cFiles = files;</span>
<span class="nc" id="L580">    final JPanel fileFilterPanel = new JPanel();</span>
<span class="nc" id="L581">    fileFilterPanel.setLayout(new BoxLayout(fileFilterPanel, BoxLayout.PAGE_AXIS));</span>
<span class="nc" id="L582">    JLabel text = new JLabel(&quot;&lt;html&gt;Please indicate any constraints on the files you want to load. All files in specified folders that satisfy all of the given constraints will be loaded. Just press Okay to load all files.&lt;/html&gt;&quot;);</span>
    //text.setBorder(BorderFactory.createLineBorder(Color.black));
<span class="nc" id="L584">    text.setAlignmentX(SwingConstants.LEADING);</span>
<span class="nc" id="L585">    JPanel textPanel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L586">    textPanel.setPreferredSize(new Dimension(100,50));</span>
    //textPanel.setBorder(BorderFactory.createLineBorder(Color.black));
<span class="nc" id="L588">    textPanel.add(text);</span>
<span class="nc" id="L589">    fileFilterPanel.add(textPanel);</span>
<span class="nc" id="L590">    fileFilterPanel.add(Box.createVerticalStrut(5));</span>
<span class="nc" id="L591">    Box defaultFilter = getNewFilter();</span>
    //defaultFilter.setBorder(BorderFactory.createLineBorder(Color.black));
    //fileFilterPanel.setBorder(BorderFactory.createLineBorder(Color.black));
<span class="nc" id="L594">    fileFilterPanel.add(defaultFilter);</span>
<span class="nc" id="L595">    final JOptionPane fileFilterDialog = new JOptionPane();</span>
<span class="nc" id="L596">    fileFilterDialog.setMessage(fileFilterPanel);</span>
<span class="nc" id="L597">    JButton[] options = new JButton[3];</span>
<span class="nc" id="L598">    JButton okay = new JButton(&quot;Okay&quot;);</span>

<span class="nc" id="L600">    JButton add = new JButton(&quot;Add another filter&quot;);</span>
<span class="nc" id="L601">    JButton cancel = new JButton(&quot;Cancel&quot;);</span>
<span class="nc" id="L602">    options[0] = okay;</span>
<span class="nc" id="L603">    options[1] = add;</span>
<span class="nc" id="L604">    options[2] = cancel;</span>

<span class="nc" id="L606">    fileFilterDialog.setOptions(options);</span>

<span class="nc" id="L608">    final JDialog dialog = fileFilterDialog.createDialog(null, &quot;Set file filters...&quot;);</span>
<span class="nc" id="L609">    okay.addActionListener(arg0 -&gt; {</span>
      // first check if we have a file range option and make sure it's valid
<span class="nc" id="L611">      final EnumMap&lt;FilterType,String&gt; filters = getFilters(fileFilterPanel);</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">      if (filters.containsKey(FilterType.isInRange)) {</span>
        try {
          // if we can creat it, then it's not invalid!
<span class="nc" id="L615">          new NumberRangesFileFilter(filters.get(FilterType.isInRange), false);</span>
<span class="nc" id="L616">        } catch(Exception e) {</span>
<span class="nc" id="L617">          JOptionPane.showMessageDialog(dialog, new JLabel(&quot;&lt;html&gt;Please check the range you specified for the file number.  Ranges must be numerical, and disjoint &lt;br&gt;ranges should be separated by commas.  For example \&quot;1-200,250-375\&quot; is a valid range.&lt;/html&gt;&quot;), &quot;Error in File Number Range&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L618">          return;</span>
<span class="nc" id="L619">        }</span>
      }
<span class="nc" id="L621">      dialog.setVisible(false);</span>
<span class="nc" id="L622">      startFileLoadingThread(filters, cFiles);</span>
<span class="nc" id="L623">    });</span>
<span class="nc" id="L624">    add.addActionListener(e -&gt; {</span>
<span class="nc" id="L625">      fileFilterPanel.add(getNewFilter());</span>
<span class="nc" id="L626">      dialog.pack();</span>
<span class="nc" id="L627">    });</span>
<span class="nc" id="L628">    cancel.addActionListener(e -&gt; dialog.setVisible(false));</span>
<span class="nc" id="L629">    dialog.getRootPane().setDefaultButton(okay);</span>
<span class="nc" id="L630">    dialog.pack();</span>
<span class="nc" id="L631">    dialog.setLocationRelativeTo(this);</span>
<span class="nc" id="L632">    dialog.setVisible(true);</span>
<span class="nc" id="L633">  }</span>

  private void startFileLoadingThread(final EnumMap&lt;FilterType,String&gt; filters, final File[] cFiles) {
<span class="nc" id="L636">    Thread t = new Thread() {</span>
      @Override
      public void run() {
<span class="nc" id="L639">        FilePanel.getInstance().loadFiles(filters, cFiles);</span>
<span class="nc" id="L640">        SwingUtilities.invokeLater(() -&gt; clearFileList.setEnabled(true));</span>
<span class="nc" id="L641">      }</span>
    };
<span class="nc" id="L643">    t.start();</span>

<span class="nc" id="L645">  }</span>

  private static EnumMap&lt;FilterType,String&gt; getFilters(JPanel panel) {
<span class="nc" id="L648">    EnumMap&lt;FilterType,String&gt; filters = new EnumMap&lt;&gt;(FilterType.class);</span>
<span class="nc" id="L649">    Component[] components = panel.getComponents();</span>
<span class="nc bnc" id="L650" title="All 2 branches missed.">    for(Component c : components) {</span>
<span class="nc bnc" id="L651" title="All 2 branches missed.">      if (c.getClass() != Box.class) {</span>
<span class="nc" id="L652">        continue;</span>
      }
<span class="nc" id="L654">      JComboBox filterType = (JComboBox) ((Container) c).getComponent(0);</span>
<span class="nc" id="L655">      JTextField filterValue = (JTextField) ((Container) c).getComponent(2);</span>
<span class="nc" id="L656">      filters.put((FilterType) filterType.getSelectedItem(), filterValue.getText());</span>
    }

<span class="nc" id="L659">    return filters;</span>
  }

  private static Box getNewFilter() {
<span class="nc" id="L663">    Box filter = Box.createHorizontalBox();</span>
<span class="nc" id="L664">    FilterType[] filterTypeOptions = FilterType.values();</span>
<span class="nc" id="L665">    JComboBox filterTypes = new JComboBox(filterTypeOptions );</span>
<span class="nc" id="L666">    filterTypes.setEditable(false);</span>
<span class="nc" id="L667">    filter.add(filterTypes);</span>
<span class="nc" id="L668">    filter.add(Box.createHorizontalGlue());</span>
<span class="nc" id="L669">    JTextField filterInput = new JTextField();</span>
    //filterInput.setMaximumSize(new Dimension(50,50));
<span class="nc" id="L671">    filterInput.setEditable(true);</span>
<span class="nc" id="L672">    filter.add(filterInput);</span>
<span class="nc" id="L673">    return filter;</span>
  }

<span class="nc" id="L676">   public enum FilterType {</span>
<span class="nc" id="L677">    none(&quot;None&quot;),</span>
<span class="nc" id="L678">    hasExtension(&quot;Has extension: &quot;),</span>
<span class="nc" id="L679">    hasPrefix(&quot;Has prefix: &quot;),</span>
//    hasNumGreaterThan(&quot;Has number greater than: &quot;),
//    hasNumLessThan(&quot;Has number less than: &quot;);
<span class="nc" id="L682">    isInRange(&quot;Has number in range: &quot;);</span>

    private final String text;
<span class="nc" id="L685">    private FilterType(String string) {</span>
<span class="nc" id="L686">      text = string;</span>
<span class="nc" id="L687">    }</span>

    @Override
    public String toString() {
<span class="nc" id="L691">      return text;</span>
    }
  }


  /**
   * Method for saving the trees that match the current tregex expression
   */
  private void doSaveFile() {
<span class="nc bnc" id="L700" title="All 2 branches missed.">    if(chooser == null)</span>
<span class="nc" id="L701">      chooser = createFileChooser();</span>
<span class="nc" id="L702">    int status = chooser.showSaveDialog(this);</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">    if (status == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L704">      Thread t = new Thread() {</span>
        @Override
        public void run() {
          try {
            //FileWriter out = new FileWriter(chooser.getSelectedFile());
<span class="nc" id="L709">            BufferedWriter out = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(chooser.getSelectedFile()), FileTreeModel.getCurEncoding()));</span>
<span class="nc" id="L710">            String str = MatchesPanel.getInstance().getMatches();</span>
<span class="nc" id="L711">            out.write(str);</span>
<span class="nc" id="L712">            out.flush();</span>
<span class="nc" id="L713">            out.close();</span>
<span class="nc" id="L714">          } catch(Exception e) {</span>
<span class="nc" id="L715">            log.info(&quot;Exception in save&quot;);</span>
<span class="nc" id="L716">            e.printStackTrace();</span>
<span class="nc" id="L717">          }</span>
<span class="nc" id="L718">        }</span>
      };
<span class="nc" id="L720">      t.start();</span>
    }
<span class="nc" id="L722">  }</span>

  /**
   * Method for saving the sentences with trees that match the current tregex expression
   */
  private void doSaveSentencesFile() {
<span class="nc bnc" id="L728" title="All 2 branches missed.">    if (chooser == null)</span>
<span class="nc" id="L729">      chooser = createFileChooser();</span>
<span class="nc" id="L730">    int status = chooser.showSaveDialog(this);</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">    if(status == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L732">      Thread t = new Thread() {</span>
        @Override
        public void run() {
          try {
<span class="nc" id="L736">            BufferedWriter out = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(chooser.getSelectedFile()), FileTreeModel.getCurEncoding()));</span>
<span class="nc" id="L737">            String str = MatchesPanel.getInstance().getMatchedSentences();</span>
<span class="nc" id="L738">            out.write(str);</span>
<span class="nc" id="L739">            out.flush();</span>
<span class="nc" id="L740">            out.close();</span>
<span class="nc" id="L741">          } catch(Exception e) {</span>
<span class="nc" id="L742">            log.info(&quot;Exception in save&quot;);</span>
<span class="nc" id="L743">            e.printStackTrace();</span>
<span class="nc" id="L744">          }</span>
<span class="nc" id="L745">        }</span>
      };
<span class="nc" id="L747">      t.start();</span>
    }
<span class="nc" id="L749">  }</span>


  /**
   * Method for saving the statistics computed in our runs (unique matches, number of matched trees)
   */
  private void doSaveHistory() {
<span class="nc bnc" id="L756" title="All 2 branches missed.">    if (chooser == null)</span>
<span class="nc" id="L757">      chooser = createFileChooser();</span>
<span class="nc" id="L758">    int status = chooser.showSaveDialog(this);</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">    if(status == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L760">      Thread t = new Thread() {</span>
        @Override
        public void run() {
          try {
<span class="nc" id="L764">            BufferedWriter out = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(chooser.getSelectedFile()), FileTreeModel.getCurEncoding()));</span>
<span class="nc" id="L765">            String hist = InputPanel.getInstance().getHistoryString();</span>
<span class="nc" id="L766">            out.write(hist);</span>
<span class="nc" id="L767">            out.flush();</span>
<span class="nc" id="L768">            out.close();</span>
<span class="nc" id="L769">          } catch(Exception e) {</span>
<span class="nc" id="L770">            log.info(&quot;Exception in save&quot;);</span>
<span class="nc" id="L771">            e.printStackTrace();</span>
<span class="nc" id="L772">          }</span>
<span class="nc" id="L773">        }</span>
      };
<span class="nc" id="L775">      t.start();</span>
    }
<span class="nc" id="L777">  }</span>


  private void loadTsurgeonScript() {
<span class="nc bnc" id="L781" title="All 2 branches missed.">    if (chooser == null)</span>
<span class="nc" id="L782">      chooser = createFileChooser();</span>
<span class="nc" id="L783">    int status = chooser.showOpenDialog(this);</span>
<span class="nc bnc" id="L784" title="All 2 branches missed.">    if(status == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L785">      Thread t = new Thread() {</span>
        @Override
        public void run() {
          try {
<span class="nc" id="L789">            BufferedReader reader = new BufferedReader(new FileReader(chooser.getSelectedFile().toString()));</span>
<span class="nc" id="L790">            final String tregexPatternString = Tsurgeon.getTregexPatternFromReader(reader);</span>
<span class="nc" id="L791">            final String tsurgeonOperationsString = Tsurgeon.getTsurgeonTextFromReader(reader);</span>
<span class="nc" id="L792">            SwingUtilities.invokeLater(() -&gt; InputPanel.getInstance().setScriptAndPattern(tregexPatternString, tsurgeonOperationsString));</span>
<span class="nc" id="L793">          } catch (IOException e) {</span>
<span class="nc" id="L794">            System.out.println(&quot;Error parsing Tsurgeon file&quot;);</span>
            //e.printStackTrace();
<span class="nc" id="L796">          }</span>
<span class="nc" id="L797">        }</span>
      };
<span class="nc" id="L799">      t.start();</span>
    }
<span class="nc" id="L801">  }</span>


  void doPreferences() {
<span class="nc bnc" id="L805" title="All 2 branches missed.">    if (preferenceDialog == null) {</span>
<span class="nc" id="L806">      preferenceDialog = new PreferencesPanel(this);</span>
    }
<span class="nc" id="L808">    preferenceDialog.pack();</span>
<span class="nc" id="L809">    preferenceDialog.setLocationRelativeTo(this);</span>
<span class="nc" id="L810">    preferenceDialog.setVisible(true);</span>
<span class="nc" id="L811">  }</span>

  //Tdiff
<span class="nc" id="L814">  private boolean doTdiff = false;</span>
  public static final int MAX_TDIFF_TREEBANKS = 2;

  private void doTdiff() {
<span class="nc bnc" id="L818" title="All 2 branches missed.">    doTdiff = !doTdiff;</span>
<span class="nc" id="L819">    ((JCheckBoxMenuItem) tDiff).setState(doTdiff);</span>

    // Only allow 2 active treebanks
<span class="nc bnc" id="L822" title="All 2 branches missed.">    if(doTdiff) {</span>
<span class="nc" id="L823">      List&lt;FileTreeNode&gt; activeTreebanks = FilePanel.getInstance().getActiveTreebanks();</span>
<span class="nc bnc" id="L824" title="All 2 branches missed.">      for(int i = 2; i &lt; activeTreebanks.size(); i++)</span>
<span class="nc" id="L825">        activeTreebanks.get(i).setActive(false);</span>
    }
<span class="nc" id="L827">  }</span>

<span class="nc" id="L829">  public boolean isTdiffEnabled() { return doTdiff; }</span>

  public void actionPerformed(ActionEvent e) {
<span class="nc" id="L832">    Object source = e.getSource();</span>

<span class="nc bnc" id="L834" title="All 2 branches missed.">    if (source == loadFiles) {</span>
<span class="nc" id="L835">      doLoadFiles();</span>
<span class="nc bnc" id="L836" title="All 2 branches missed.">    } else if (source == saveMatches) {</span>
<span class="nc" id="L837">      doSaveFile();</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">    } else if (source == saveSentences) {</span>
<span class="nc" id="L839">      doSaveSentencesFile();</span>
<span class="nc bnc" id="L840" title="All 2 branches missed.">    } else if (source == loadTsurgeon) {</span>
<span class="nc" id="L841">      loadTsurgeonScript();</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">    } else if (source == preferences) {</span>
<span class="nc" id="L843">      doPreferences();</span>
<span class="nc bnc" id="L844" title="All 2 branches missed.">    } else if (source == tDiff) {</span>
<span class="nc" id="L845">      doTdiff();</span>
<span class="nc bnc" id="L846" title="All 2 branches missed.">    } else if (source == quit) {</span>
<span class="nc" id="L847">      doQuit();</span>
<span class="nc bnc" id="L848" title="All 2 branches missed.">    } else if (source == saveHistory) {</span>
<span class="nc" id="L849">      doSaveHistory();</span>
<span class="nc bnc" id="L850" title="All 2 branches missed.">    } else if (source == clearFileList) {</span>
<span class="nc" id="L851">      doClearFileList();</span>
<span class="nc bnc" id="L852" title="All 2 branches missed.">    } else if (source == searchMenuItem) {</span>
<span class="nc" id="L853">      InputPanel.getInstance().runSearch();</span>
<span class="nc bnc" id="L854" title="All 2 branches missed.">    } else if (source == prevMatch) {</span>
<span class="nc" id="L855">      MatchesPanel.getInstance().selectPreviousMatch();</span>
<span class="nc bnc" id="L856" title="All 2 branches missed.">    } else if (source == nextMatch) {</span>
<span class="nc" id="L857">      MatchesPanel.getInstance().selectNextMatch();</span>
<span class="nc bnc" id="L858" title="All 2 branches missed.">    } else if (source == prevTreeMatch) {</span>
<span class="nc" id="L859">      DisplayMatchesPanel.getInstance().showPrevMatchedPart();</span>
<span class="nc bnc" id="L860" title="All 2 branches missed.">    } else if (source == nextTreeMatch) {</span>
<span class="nc" id="L861">      DisplayMatchesPanel.getInstance().showNextMatchedPart();</span>
    }
<span class="nc" id="L863">  }</span>

  public void doClearFileList() {
<span class="nc" id="L866">    FilePanel.getInstance().clearAll();</span>
<span class="nc" id="L867">    clearFileList.setEnabled(false);</span>
<span class="nc" id="L868">  }</span>

  public static void doQuit() {
<span class="nc" id="L871">    System.exit(0);</span>
<span class="nc" id="L872">  }</span>



  /**
   * Called by MatchesPanel to alert the frame when the matching trees have changed
   */
  public void matchesChanged() {
<span class="nc bnc" id="L880" title="All 2 branches missed.">    setSaveEnabled(!MatchesPanel.getInstance().isEmpty());</span>
<span class="nc" id="L881">  }</span>


  /**
   * Main method for launching a new tregex gui object
   * &lt;br&gt;
   * If the argument &lt;code&gt;-transformer class&lt;/code&gt; is given, that
   * class is used as a TreeTransformer when loading in trees.
   * &lt;br&gt;
   * All other arguments will be interpreted as filenames to preload.
   */
  public static void main(String[] args) {
<span class="nc bnc" id="L893" title="All 2 branches missed.">    if (isMacOSX()) {</span>
<span class="nc" id="L894">      setMacProperties();</span>
    } else {
      try {
<span class="nc" id="L897">        UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());</span>
<span class="nc" id="L898">      } catch (Exception e) {</span>
<span class="nc" id="L899">        throw new RuntimeException(e);</span>
<span class="nc" id="L900">      }</span>
    }
<span class="nc" id="L902">    Properties props = new Properties();</span>
<span class="nc" id="L903">    List&lt;String&gt; filenames = Generics.newArrayList();</span>
<span class="nc bnc" id="L904" title="All 2 branches missed.">    for (int argIndex = 0; argIndex &lt; args.length; ) {</span>
<span class="nc bnc" id="L905" title="All 2 branches missed.">      if (args[argIndex].equalsIgnoreCase(&quot;-&quot; + TRANSFORMER)) {</span>
<span class="nc" id="L906">        props.setProperty(TRANSFORMER, args[argIndex + 1]);</span>
<span class="nc" id="L907">        argIndex += 2;</span>
      } else {
<span class="nc" id="L909">        filenames.add(args[argIndex++]);</span>
      }
    }
<span class="nc" id="L912">    new TregexGUI(props, filenames);</span>
<span class="nc" id="L913">  }</span>


  public void about() {
<span class="nc" id="L917">    aboutBox.setSize(360, 240);</span>
<span class="nc" id="L918">    aboutBox.setLocation((int)this.getLocation().getX() + 22, (int)this.getLocation().getY() + 22);</span>
<span class="nc" id="L919">    aboutBox.setResizable(false);</span>
<span class="nc" id="L920">    aboutBox.setVisible(true);</span>
<span class="nc" id="L921">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>