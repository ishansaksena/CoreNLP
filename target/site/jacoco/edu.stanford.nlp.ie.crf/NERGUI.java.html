<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NERGUI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Stanford CoreNLP</a> &gt; <a href="index.source.html" class="el_package">edu.stanford.nlp.ie.crf</a> &gt; <span class="el_source">NERGUI.java</span></div><h1>NERGUI.java</h1><pre class="source lang-java linenums">// NERGUI -- a GUI for a probabilistic (CRF) sequence model for NER.
// Copyright (c) 2002-2008 The Board of Trustees of
// The Leland Stanford Junior University. All Rights Reserved.
//
// This program is free software; you can redistribute it and/or
// modify it under the terms of the GNU General Public License
// as published by the Free Software Foundation; either version 2
// of the License, or (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
//
// For more information, bug reports, fixes, contact:
//    Christopher Manning
//    Dept of Computer Science, Gates 1A
//    Stanford CA 94305-9010
//    USA
//    Support/Questions: java-nlp-user@lists.stanford.edu
//    Licensing: java-nlp-support@lists.stanford.edu
//    http://nlp.stanford.edu/downloads/crf-classifier.shtml

package edu.stanford.nlp.ie.crf; 
import edu.stanford.nlp.util.logging.Redwood;

import edu.stanford.nlp.ie.AbstractSequenceClassifier;
import edu.stanford.nlp.ling.CoreLabel;
import edu.stanford.nlp.util.Generics;
import edu.stanford.nlp.util.StringUtils;

import javax.swing.*;
import javax.swing.text.*;
import java.awt.*;
import java.awt.event.*;
import java.io.File;
import java.util.Map;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/** A GUI for Named Entity sequence classifiers.
 *  This version only supports the CRF.
 *
 *  @author Jenny Finkel
 *  @author Christopher Manning
 */
<span class="nc" id="L52">public class NERGUI  {</span>

  /** A logger for this class */
<span class="nc" id="L55">  private static Redwood.RedwoodChannels log = Redwood.channels(NERGUI.class);</span>

  private AbstractSequenceClassifier&lt;CoreLabel&gt; classifier;

  private JFrame frame;
  private JEditorPane editorPane;
  private JToolBar tagPanel;
  private static final int HEIGHT = 600;
  private static final int WIDTH = 650;
  private Map&lt;String, Color&gt; tagToColorMap;
<span class="nc" id="L65">  private JFileChooser fileChooser = new JFileChooser();</span>
<span class="nc" id="L66">  private MutableAttributeSet defaultAttrSet = new SimpleAttributeSet();</span>
<span class="nc" id="L67">  private ActionListener actor = new ActionPerformer();</span>
  private File loadedFile;
<span class="nc" id="L69">  private String taggedContents = null;</span>
<span class="nc" id="L70">  private String htmlContents = null;</span>

<span class="nc" id="L72">  private JMenuItem saveUntagged = null;</span>
<span class="nc" id="L73">  private JMenuItem saveTaggedAs = null;</span>

<span class="nc" id="L75">  private JButton extractButton = null;</span>
<span class="nc" id="L76">  private JMenuItem extract = null;</span>

  private void createAndShowGUI() {
    //Make sure we have nice window decorations.
<span class="nc" id="L80">    JFrame.setDefaultLookAndFeelDecorated(true);</span>

    //Create and set up the window.
<span class="nc" id="L83">    frame = new JFrame(&quot;Stanford Named Entity Recognizer&quot;);</span>
<span class="nc" id="L84">    frame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);</span>
<span class="nc" id="L85">    frame.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L86">    frame.getContentPane().setPreferredSize(new Dimension(WIDTH, HEIGHT));</span>

<span class="nc" id="L88">    frame.setJMenuBar(addMenuBar());</span>

<span class="nc" id="L90">    buildTagPanel();</span>
<span class="nc" id="L91">    buildContentPanel();</span>
<span class="nc" id="L92">    buildExtractButton();</span>
<span class="nc" id="L93">    extractButton.setEnabled(false);</span>
<span class="nc" id="L94">    extract.setEnabled(false);</span>

    //Display the window.
<span class="nc" id="L97">    frame.pack();</span>
<span class="nc" id="L98">    frame.setVisible(true);</span>
<span class="nc" id="L99">  }</span>

  private JMenuBar addMenuBar() {
<span class="nc" id="L102">    JMenuBar menubar = new JMenuBar();</span>

<span class="nc" id="L104">    JMenu fileMenu = new JMenu(&quot;File&quot;);</span>
<span class="nc" id="L105">    menubar.add(fileMenu);</span>

<span class="nc" id="L107">    JMenu editMenu = new JMenu(&quot;Edit&quot;);</span>
<span class="nc" id="L108">    menubar.add(editMenu);</span>

<span class="nc" id="L110">    JMenu classifierMenu = new JMenu(&quot;Classifier&quot;);</span>
<span class="nc" id="L111">    menubar.add(classifierMenu);</span>

    /**
     * FILE MENU
     */

<span class="nc" id="L117">    JMenuItem openFile = new JMenuItem(&quot;Open File&quot;);</span>
<span class="nc" id="L118">    openFile.setMnemonic('O');</span>
<span class="nc" id="L119">    openFile.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_F, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L120">    openFile.addActionListener(actor);</span>
<span class="nc" id="L121">    fileMenu.add(openFile);</span>

<span class="nc" id="L123">    JMenuItem loadURL = new JMenuItem(&quot;Load URL&quot;);</span>
<span class="nc" id="L124">    loadURL.setMnemonic('L');</span>
<span class="nc" id="L125">    loadURL.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_U, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L126">    loadURL.addActionListener(actor);</span>
<span class="nc" id="L127">    fileMenu.add(loadURL);</span>

<span class="nc" id="L129">    fileMenu.add(new JSeparator());</span>

<span class="nc" id="L131">    saveUntagged = new JMenuItem(&quot;Save Untagged File&quot;);</span>
<span class="nc" id="L132">    saveUntagged.setMnemonic('S');</span>
<span class="nc" id="L133">    saveUntagged.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_S, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L134">    saveUntagged.addActionListener(actor);</span>
<span class="nc" id="L135">    saveUntagged.setEnabled(false);</span>
<span class="nc" id="L136">    fileMenu.add(saveUntagged);</span>

<span class="nc" id="L138">    JMenuItem saveUntaggedAs = new JMenuItem(&quot;Save Untagged File As ...&quot;);</span>
<span class="nc" id="L139">    saveUntaggedAs.setMnemonic('U');</span>
<span class="nc" id="L140">    saveUntaggedAs.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_U, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L141">    saveUntaggedAs.addActionListener(actor);</span>
<span class="nc" id="L142">    fileMenu.add(saveUntaggedAs);</span>

<span class="nc" id="L144">    saveTaggedAs = new JMenuItem(&quot;Save Tagged File As ...&quot;);</span>
<span class="nc" id="L145">    saveTaggedAs.setMnemonic('T');</span>
<span class="nc" id="L146">    saveTaggedAs.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_T, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L147">    saveTaggedAs.addActionListener(actor);</span>
<span class="nc" id="L148">    saveTaggedAs.setEnabled(false);</span>
<span class="nc" id="L149">    fileMenu.add(saveTaggedAs);</span>

<span class="nc" id="L151">    fileMenu.add(new JSeparator());</span>

<span class="nc" id="L153">    JMenuItem exit = new JMenuItem(&quot;Exit&quot;);</span>
<span class="nc" id="L154">    exit.setMnemonic('x');</span>
<span class="nc" id="L155">    exit.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_Q, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L156">    exit.addActionListener(actor);</span>
<span class="nc" id="L157">    fileMenu.add(exit);</span>


    /**
     * EDIT MENU
     */

<span class="nc" id="L164">    JMenuItem cut = new JMenuItem(&quot;Cut&quot;);</span>
<span class="nc" id="L165">    cut.setMnemonic('X');</span>
<span class="nc" id="L166">    cut.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_X, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L167">    cut.addActionListener(actor);</span>
<span class="nc" id="L168">    editMenu.add(cut);</span>

<span class="nc" id="L170">    JMenuItem copy = new JMenuItem(&quot;Copy&quot;);</span>
<span class="nc" id="L171">    copy.setMnemonic('C');</span>
<span class="nc" id="L172">    copy.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_C, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L173">    copy.addActionListener(actor);</span>
<span class="nc" id="L174">    editMenu.add(copy);</span>

<span class="nc" id="L176">    JMenuItem paste = new JMenuItem(&quot;Paste&quot;);</span>
<span class="nc" id="L177">    paste.setMnemonic('V');</span>
<span class="nc" id="L178">    paste.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_V, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L179">    paste.addActionListener(actor);</span>
<span class="nc" id="L180">    editMenu.add(paste);</span>

<span class="nc" id="L182">    JMenuItem clear = new JMenuItem(&quot;Clear&quot;);</span>
<span class="nc" id="L183">    clear.setMnemonic('C');</span>
<span class="nc" id="L184">    clear.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_L, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L185">    clear.addActionListener(actor);</span>
<span class="nc" id="L186">    editMenu.add(clear);</span>


    /**
     * CLASSIFIER MENU
     */

<span class="nc" id="L193">    JMenuItem loadCRF = new JMenuItem(&quot;Load CRF From File&quot;);</span>
<span class="nc" id="L194">    loadCRF.setMnemonic('R');</span>
<span class="nc" id="L195">    loadCRF.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_R, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L196">    loadCRF.addActionListener(actor);</span>
<span class="nc" id="L197">    classifierMenu.add(loadCRF);</span>

<span class="nc" id="L199">    JMenuItem loadDefaultCRF = new JMenuItem(&quot;Load Default CRF&quot;);</span>
<span class="nc" id="L200">    loadDefaultCRF.setMnemonic('L');</span>
<span class="nc" id="L201">    loadDefaultCRF.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_L, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L202">    loadDefaultCRF.addActionListener(actor);</span>
<span class="nc" id="L203">    classifierMenu.add(loadDefaultCRF);</span>

<span class="nc" id="L205">    extract = new JMenuItem(&quot;Run NER&quot;);</span>
<span class="nc" id="L206">    extract.setMnemonic('N');</span>
<span class="nc" id="L207">    extract.setAccelerator(KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_N, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L208">    extract.addActionListener(actor);</span>
<span class="nc" id="L209">    classifierMenu.add(extract);</span>

<span class="nc" id="L211">    return menubar;</span>
  }


<span class="nc" id="L215">  private class InputListener implements KeyListener {</span>

    @Override
    public void keyPressed(KeyEvent e) {
<span class="nc" id="L219">    }</span>

    @Override
    public void keyReleased(KeyEvent e) {
<span class="nc" id="L223">    }</span>

    @Override
    public void keyTyped(KeyEvent e) {
<span class="nc" id="L227">      saveTaggedAs.setEnabled(false);</span>
<span class="nc" id="L228">    }</span>

  }


<span class="nc" id="L233">  private class ActionPerformer implements ActionListener {</span>

    @Override
    public void actionPerformed(ActionEvent e) {
<span class="nc" id="L237">      String com = e.getActionCommand();</span>

<span class="nc bnc" id="L239" title="All 54 branches missed.">      switch (com) {</span>
        case &quot;Open File&quot;: {
<span class="nc" id="L241">          File file = getFile(true);</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">          if (file != null) {</span>
<span class="nc" id="L243">            openFile(file);</span>
          }
          break;
        }
        case &quot;Load URL&quot;:
<span class="nc" id="L248">          String url = getURL();</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">          if (url != null) {</span>
<span class="nc" id="L250">            openURL(url);</span>
          }
          break;
        case &quot;Exit&quot;:
<span class="nc" id="L254">          exit();</span>
<span class="nc" id="L255">          break;</span>
        case &quot;Clear&quot;:
<span class="nc" id="L257">          clearDocument();</span>
<span class="nc" id="L258">          break;</span>
        case &quot;Cut&quot;:
<span class="nc" id="L260">          cutDocument();</span>
<span class="nc" id="L261">          break;</span>
        case &quot;Copy&quot;:
<span class="nc" id="L263">          copyDocument();</span>
<span class="nc" id="L264">          break;</span>
        case &quot;Paste&quot;:
<span class="nc" id="L266">          pasteDocument();</span>
<span class="nc" id="L267">          break;</span>
        case &quot;Load CRF From File&quot;: {
<span class="nc" id="L269">          File file = getFile(true);</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">          if (file != null) {</span>
<span class="nc" id="L271">            loadClassifier(file);</span>
          }
          break;
        }
        case &quot;Load Default CRF&quot;:
<span class="nc" id="L276">          loadClassifier(null);</span>
<span class="nc" id="L277">          break;</span>
        case &quot;Run NER&quot;:
<span class="nc" id="L279">          extract();</span>
<span class="nc" id="L280">          break;</span>
        case &quot;Save Untagged File&quot;:
<span class="nc" id="L282">          saveUntaggedContents(loadedFile);</span>
<span class="nc" id="L283">          break;</span>
        case &quot;Save Untagged File As ...&quot;:
<span class="nc" id="L285">          saveUntaggedContents(getFile(false));</span>
<span class="nc" id="L286">          break;</span>
        case &quot;Save Tagged File As ...&quot;:
<span class="nc" id="L288">          File f = getFile(false);</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">          if (f != null) {</span>
            // i.e., they didn't cancel out of the file dialog
<span class="nc" id="L291">            saveFile(f, taggedContents);</span>
          }
          break;
        default:
<span class="nc" id="L295">          log.info(&quot;Unknown Action: &quot; + e);</span>
          break;
      }
<span class="nc" id="L298">    }</span>
  }

  public File getFile(boolean open) {
<span class="nc" id="L302">    File file = null;</span>
    int returnVal;
<span class="nc bnc" id="L304" title="All 2 branches missed.">    if (open) {</span>
<span class="nc" id="L305">      returnVal = fileChooser.showOpenDialog(frame);</span>
    } else {
<span class="nc" id="L307">      returnVal = fileChooser.showSaveDialog(frame);</span>
    }
<span class="nc bnc" id="L309" title="All 2 branches missed.">    if(returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L310">      file = fileChooser.getSelectedFile();</span>
<span class="nc bnc" id="L311" title="All 4 branches missed.">      if (open &amp;&amp; !checkFile(file)) { file = null; }</span>
    }
<span class="nc" id="L313">    return file;</span>
  }

  public void saveUntaggedContents(File file) {
    try {
      String contents;
<span class="nc bnc" id="L319" title="All 2 branches missed.">      if (editorPane.getContentType().equals(&quot;text/html&quot;)) {</span>
<span class="nc" id="L320">        contents = editorPane.getText();</span>
      } else {
<span class="nc" id="L322">        Document doc = editorPane.getDocument();</span>
<span class="nc" id="L323">        contents = doc.getText(0, doc.getLength());</span>
      }
<span class="nc" id="L325">      saveFile(file, contents);</span>
<span class="nc" id="L326">      saveUntagged.setEnabled(true);</span>
<span class="nc" id="L327">      loadedFile = file;</span>
<span class="nc" id="L328">    } catch (Exception e) {</span>
<span class="nc" id="L329">      throw new RuntimeException(e);</span>
<span class="nc" id="L330">    }</span>
<span class="nc" id="L331">  }</span>

  public static void saveFile(File file, String contents) {
<span class="nc" id="L334">    StringUtils.printToFile(file, contents);</span>
<span class="nc" id="L335">  }</span>

  public String getURL() {
<span class="nc" id="L338">    String url = JOptionPane.showInputDialog(frame, &quot;URL: &quot;, &quot;Load URL&quot;, JOptionPane.QUESTION_MESSAGE);</span>
<span class="nc" id="L339">    return url;</span>
  }

  public boolean checkFile(File file) {
<span class="nc bnc" id="L343" title="All 2 branches missed.">    if (file.isFile()) {</span>
<span class="nc" id="L344">      fileChooser.setCurrentDirectory(file.getParentFile());</span>
<span class="nc" id="L345">      return true;</span>
    } else {
<span class="nc" id="L347">      String message = &quot;File Not Found: &quot;+file.getAbsolutePath();</span>
<span class="nc" id="L348">      displayError(&quot;File Not Found Error&quot;, message);</span>
<span class="nc" id="L349">      return false;</span>
    }
  }

  public void displayError(String title, String message) {
<span class="nc" id="L354">    JOptionPane.showMessageDialog(frame, message, title, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L355">  }</span>

  /** Load a classifier from a file or the default.
   *  The default is specified by passing in &lt;code&gt;null&lt;/code&gt;.
   */
  public void loadClassifier(File file) {
    try {
<span class="nc bnc" id="L362" title="All 2 branches missed.">      if (file != null) {</span>
<span class="nc" id="L363">        classifier = CRFClassifier.getClassifier(file);</span>
      } else {
        // default classifier in jar
<span class="nc" id="L366">        classifier = CRFClassifier.getDefaultClassifier();</span>
      }
<span class="nc" id="L368">    } catch (Throwable e) {</span>
      // we catch Throwable, since we'd also like to be able to get an
      // OutOfMemoryError
      String message;
<span class="nc bnc" id="L372" title="All 2 branches missed.">      if (file != null) {</span>
<span class="nc" id="L373">        message = &quot;Error loading CRF: &quot; + file.getAbsolutePath();</span>
      } else {
<span class="nc" id="L375">        message = &quot;Error loading default CRF&quot;;</span>
      }
<span class="nc" id="L377">      log.info(message);</span>
<span class="nc" id="L378">      String title = &quot;CRF Load Error&quot;;</span>
<span class="nc" id="L379">      String msg = e.toString();</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">      if (msg != null) {</span>
<span class="nc" id="L381">        message += &quot;\n&quot; + msg;</span>
      }
<span class="nc" id="L383">      displayError(title, message);</span>
<span class="nc" id="L384">      return;</span>
<span class="nc" id="L385">    }</span>
<span class="nc" id="L386">    removeTags();</span>
<span class="nc" id="L387">    buildTagPanel();</span>
    // buildExtractButton();
<span class="nc" id="L389">    extractButton.setEnabled(true);</span>
<span class="nc" id="L390">    extract.setEnabled(true);</span>
<span class="nc" id="L391">  }</span>

  public void openFile(File file) {
<span class="nc" id="L394">    openURL(file.toURI().toString());</span>
<span class="nc" id="L395">    loadedFile = file;</span>
<span class="nc" id="L396">    saveUntagged.setEnabled(true);</span>
<span class="nc" id="L397">  }</span>

  public void openURL(String url) {
    try {
<span class="nc" id="L401">      editorPane.setPage(url);</span>
<span class="nc" id="L402">    } catch (Exception e) {</span>
<span class="nc" id="L403">      log.info(&quot;Error loading |&quot; + url + &quot;|&quot;);</span>
<span class="nc" id="L404">      e.printStackTrace();</span>
<span class="nc" id="L405">      displayError(&quot;Error Loading URL &quot; + url, &quot;Message: &quot; + e.toString());</span>
<span class="nc" id="L406">      return;</span>
<span class="nc" id="L407">    }</span>
<span class="nc" id="L408">    loadedFile = null;</span>
<span class="nc" id="L409">    String text = editorPane.getText();</span>
<span class="nc" id="L410">    taggedContents = null;</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">    if (!editorPane.getContentType().equals(&quot;text/html&quot;)) {</span>
<span class="nc" id="L412">      editorPane.setContentType(&quot;text/rtf&quot;);</span>
<span class="nc" id="L413">      Document doc = editorPane.getDocument();</span>
      try {
<span class="nc" id="L415">        doc.insertString(0, text, defaultAttrSet);</span>
<span class="nc" id="L416">      } catch (Exception e) {</span>
<span class="nc" id="L417">        throw new RuntimeException(e);</span>
<span class="nc" id="L418">      }</span>
<span class="nc" id="L419">      editorPane.revalidate();</span>
<span class="nc" id="L420">      editorPane.repaint();</span>
<span class="nc" id="L421">      editorPane.setEditable(true);</span>
<span class="nc" id="L422">      htmlContents = null;</span>
<span class="nc" id="L423">    } else {</span>
<span class="nc" id="L424">      editorPane.setEditable(false);</span>
<span class="nc" id="L425">      htmlContents = editorPane.getText();</span>
    }

<span class="nc" id="L428">    saveUntagged.setEnabled(false);</span>
<span class="nc" id="L429">    saveTaggedAs.setEnabled(false);</span>
<span class="nc" id="L430">  }</span>

  private void removeTags() {
<span class="nc bnc" id="L433" title="All 2 branches missed.">    if (editorPane.getContentType().equals(&quot;text/html&quot;)) {</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">      if (htmlContents != null) {</span>
<span class="nc" id="L435">        editorPane.setText(htmlContents);</span>
      }
<span class="nc" id="L437">      editorPane.revalidate();</span>
<span class="nc" id="L438">      editorPane.repaint();</span>
    } else {
<span class="nc" id="L440">      DefaultStyledDocument doc = (DefaultStyledDocument)editorPane.getDocument();</span>
<span class="nc" id="L441">      SimpleAttributeSet attr = new SimpleAttributeSet();</span>
<span class="nc" id="L442">      StyleConstants.setForeground(attr, Color.BLACK);</span>
<span class="nc" id="L443">      StyleConstants.setBackground(attr, Color.WHITE);</span>
<span class="nc" id="L444">      doc.setCharacterAttributes(0, doc.getLength(), attr, false);</span>
    }
<span class="nc" id="L446">    saveTaggedAs.setEnabled(false);</span>
<span class="nc" id="L447">  }</span>


  private void extract() {
<span class="nc" id="L451">    log.info(&quot;content type: &quot;+editorPane.getContentType());</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">    if (!editorPane.getContentType().equals(&quot;text/html&quot;)) {</span>

<span class="nc" id="L454">      DefaultStyledDocument doc = (DefaultStyledDocument)editorPane.getDocument();</span>
<span class="nc" id="L455">      String text = null;</span>
      try {
<span class="nc" id="L457">        text = doc.getText(0, doc.getLength());</span>
<span class="nc" id="L458">      } catch (Exception e) {</span>
<span class="nc" id="L459">        e.printStackTrace();</span>
<span class="nc" id="L460">      }</span>
<span class="nc" id="L461">      String labeledText = classifier.classifyWithInlineXML(text);</span>
<span class="nc" id="L462">      taggedContents = labeledText;</span>

<span class="nc" id="L464">      Set&lt;String&gt; tags = classifier.labels();</span>
<span class="nc" id="L465">      String background = classifier.backgroundSymbol();</span>
<span class="nc" id="L466">      StringBuilder tagPattern = new StringBuilder();</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">      for (String tag : tags) {</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">        if (background.equals(tag)) { continue; }</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">        if (tagPattern.length() &gt; 0) { tagPattern.append('|'); }</span>
<span class="nc" id="L470">        tagPattern.append(tag);</span>
<span class="nc" id="L471">      }</span>

<span class="nc" id="L473">      Pattern startPattern = Pattern.compile(&quot;&lt;(&quot; + tagPattern + &quot;)&gt;&quot;);</span>
<span class="nc" id="L474">      Pattern endPattern = Pattern.compile(&quot;&lt;/(&quot; + tagPattern + &quot;)&gt;&quot;);</span>

<span class="nc" id="L476">      String finalText = labeledText;</span>

<span class="nc" id="L478">      Matcher m = startPattern.matcher(finalText);</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">      while (m.find()) {</span>
<span class="nc" id="L480">        int start = m.start();</span>
<span class="nc" id="L481">        finalText = m.replaceFirst(&quot;&quot;);</span>
<span class="nc" id="L482">        m = endPattern.matcher(finalText);</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">        if (m.find()) {</span>
<span class="nc" id="L484">          int end = m.start();</span>
<span class="nc" id="L485">          String tag = m.group(1);</span>
<span class="nc" id="L486">          finalText = m.replaceFirst(&quot;&quot;);</span>
<span class="nc" id="L487">          AttributeSet attSet = getAttributeSet(tag);</span>
          try {
<span class="nc" id="L489">            String entity = finalText.substring(start, end);</span>
<span class="nc" id="L490">            doc.setCharacterAttributes(start, entity.length(), attSet, false);</span>
<span class="nc" id="L491">          } catch (Exception ex) {</span>
<span class="nc" id="L492">            ex.printStackTrace();</span>
<span class="nc" id="L493">            System.exit(-1);</span>
<span class="nc" id="L494">          }</span>
<span class="nc" id="L495">          log.info(tag+&quot;: &quot;+ finalText.substring(start, end));</span>
<span class="nc" id="L496">        } else {</span>
<span class="nc" id="L497">          log.info(&quot;Couldn't find end pattern!&quot;);</span>
        }
<span class="nc" id="L499">        m = startPattern.matcher(finalText);</span>
<span class="nc" id="L500">      }</span>
<span class="nc" id="L501">      editorPane.revalidate();</span>
<span class="nc" id="L502">      editorPane.repaint();</span>
<span class="nc" id="L503">    } else {</span>
<span class="nc" id="L504">      String untaggedContents = editorPane.getText();</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">      if (untaggedContents == null) { untaggedContents = &quot;&quot;; }</span>
<span class="nc" id="L506">      taggedContents = classifier.classifyWithInlineXML(untaggedContents);</span>

<span class="nc" id="L508">      Set&lt;String&gt; tags = classifier.labels();</span>
<span class="nc" id="L509">      String background = classifier.backgroundSymbol();</span>
<span class="nc" id="L510">      StringBuilder tagPattern = new StringBuilder();</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">      for (String tag : tags) {</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">        if (background.equals(tag)) { continue; }</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">        if (tagPattern.length() &gt; 0) { tagPattern.append('|'); }</span>
<span class="nc" id="L514">        tagPattern.append(tag);</span>
<span class="nc" id="L515">      }</span>

<span class="nc" id="L517">      Pattern startPattern = Pattern.compile(&quot;&lt;(&quot; + tagPattern + &quot;)&gt;&quot;);</span>
<span class="nc" id="L518">      Pattern endPattern = Pattern.compile(&quot;&lt;/(&quot; + tagPattern + &quot;)&gt;&quot;);</span>

<span class="nc" id="L520">      String finalText = taggedContents;</span>

<span class="nc" id="L522">      Matcher m = startPattern.matcher(finalText);</span>
<span class="nc bnc" id="L523" title="All 2 branches missed.">      while (m.find()) {</span>
<span class="nc" id="L524">        String tag = m.group(1);</span>
<span class="nc" id="L525">        String color = colorToHTML(tagToColorMap.get(tag));</span>
<span class="nc" id="L526">        String newTag = &quot;&lt;span style=\&quot;background-color: &quot;+color+&quot;; color: white\&quot;&gt;&quot;;</span>
<span class="nc" id="L527">        finalText = m.replaceFirst(newTag);</span>
<span class="nc" id="L528">        int start = m.start()+newTag.length();</span>
<span class="nc" id="L529">        Matcher m1 = endPattern.matcher(finalText);</span>
<span class="nc" id="L530">        m1.find(m.end());</span>
<span class="nc" id="L531">        String entity = finalText.substring(start, m1.start());</span>
<span class="nc" id="L532">        log.info(tag+&quot;: &quot;+ entity);</span>
<span class="nc" id="L533">        finalText = m1.replaceFirst(&quot;&lt;/span&gt;&quot;);</span>
<span class="nc" id="L534">        m = startPattern.matcher(finalText);</span>
<span class="nc" id="L535">      }</span>
      // System.out.println(finalText);
<span class="nc" id="L537">      editorPane.setText(finalText);</span>
<span class="nc" id="L538">      editorPane.revalidate();</span>
<span class="nc" id="L539">      editorPane.repaint();</span>

      // log.info(finalText);
    }
<span class="nc" id="L543">    saveTaggedAs.setEnabled(true);</span>
<span class="nc" id="L544">  }</span>

  private AttributeSet getAttributeSet(String tag) {
<span class="nc" id="L547">    MutableAttributeSet attr = new SimpleAttributeSet();</span>
<span class="nc" id="L548">    Color color = tagToColorMap.get(tag);</span>
<span class="nc" id="L549">    StyleConstants.setBackground(attr, color);</span>
<span class="nc" id="L550">    StyleConstants.setForeground(attr, Color.WHITE);</span>
<span class="nc" id="L551">    return attr;</span>
  }

  public void clearDocument() {
<span class="nc" id="L555">    editorPane.setContentType(&quot;text/rtf&quot;);</span>
<span class="nc" id="L556">    Document doc = new DefaultStyledDocument();</span>
<span class="nc" id="L557">    editorPane.setDocument(doc);</span>
    //    defaultAttrSet = ((StyledEditorKit)editorPane.getEditorKit()).getInputAttributes();
    //    StyleConstants.setFontFamily(defaultAttrSet, &quot;Lucinda Sans Unicode&quot;);
<span class="nc" id="L560">    log.info(&quot;attr: &quot;+defaultAttrSet);</span>

    try {
<span class="nc" id="L563">      doc.insertString(0, &quot; &quot;, defaultAttrSet);</span>
<span class="nc" id="L564">    } catch (Exception ex) {</span>
<span class="nc" id="L565">      throw new RuntimeException(ex);</span>
<span class="nc" id="L566">    }</span>

<span class="nc" id="L568">    editorPane.setEditable(true);</span>
<span class="nc" id="L569">    editorPane.revalidate();</span>
<span class="nc" id="L570">    editorPane.repaint();</span>

<span class="nc" id="L572">    saveUntagged.setEnabled(false);</span>
<span class="nc" id="L573">    saveTaggedAs.setEnabled(false);</span>

<span class="nc" id="L575">    taggedContents = null;</span>
<span class="nc" id="L576">    htmlContents = null;</span>
<span class="nc" id="L577">    loadedFile = null;</span>

<span class="nc" id="L579">  }</span>

  public void cutDocument() {
<span class="nc" id="L582">    editorPane.cut();</span>
<span class="nc" id="L583">    saveTaggedAs.setEnabled(false);</span>
<span class="nc" id="L584">  }</span>

  public void copyDocument() {
<span class="nc" id="L587">    editorPane.copy();</span>
<span class="nc" id="L588">  }</span>

  public void pasteDocument() {
<span class="nc" id="L591">    editorPane.paste();</span>
<span class="nc" id="L592">    saveTaggedAs.setEnabled(false);</span>
<span class="nc" id="L593">  }</span>



  static void exit() {
    // ask if they're sure?
<span class="nc" id="L599">    System.exit(-1);</span>
<span class="nc" id="L600">  }</span>

  private static final String initText = &quot;In bringing his distinct vision to the Western genre, writer-director Jim Jarmusch has created a quasi-mystical avant-garde drama that remains a deeply spiritual viewing experience. After losing his parents and fianc\u00E9e, a Cleveland accountant named William Blake (a remarkable Johnny Depp) spends all his money and takes a train to the frontier town of Machine in order to work at a factory. Upon arriving in Machine, he is denied his expected job and finds himself a fugitive after murdering a man in self-defense. Wounded and helpless, Blake is befriended by Nobody (Gary Farmer), a wandering Native American who considers him to be a ghostly manifestation of the famous poet. Nobody aids Blake in his flight from three bumbling bounty hunters, preparing him for his final journey--a return to the world of the spirits.&quot;;
  //  private String initText = &quot;In&quot;;

  private void buildContentPanel() {

<span class="nc" id="L607">    editorPane = new JEditorPane ();</span>
<span class="nc" id="L608">    editorPane.setContentType(&quot;text/rtf&quot;);</span>
<span class="nc" id="L609">    editorPane.addKeyListener(new InputListener());</span>

    //    defaultAttrSet = ((StyledEditorKit)editorPane.getEditorKit()).getInputAttributes();
<span class="nc" id="L612">    StyleConstants.setFontFamily(defaultAttrSet, &quot;Lucida Sans&quot;);</span>

<span class="nc" id="L614">    Document doc = new DefaultStyledDocument();</span>
<span class="nc" id="L615">    editorPane.setDocument(doc);</span>
    try {
<span class="nc" id="L617">      doc.insertString(0, initText, defaultAttrSet);</span>
<span class="nc" id="L618">    } catch (Exception ex) {</span>
<span class="nc" id="L619">      throw new RuntimeException(ex);</span>
<span class="nc" id="L620">    }</span>

<span class="nc" id="L622">    JScrollPane scrollPane = new JScrollPane(editorPane);</span>
<span class="nc" id="L623">    frame.getContentPane().add(scrollPane, BorderLayout.CENTER);</span>

<span class="nc" id="L625">    editorPane.setEditable(true);</span>
<span class="nc" id="L626">  }</span>


  public static String colorToHTML(Color color) {
<span class="nc" id="L630">    String r = Integer.toHexString(color.getRed());</span>
<span class="nc bnc" id="L631" title="All 2 branches missed.">    if (r.length() == 0) { r = &quot;00&quot;; }</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">    else if (r.length() == 1) { r = &quot;0&quot; + r; }</span>
<span class="nc bnc" id="L633" title="All 2 branches missed.">    else if (r.length() &gt; 2) { throw new IllegalArgumentException(&quot;invalid hex color for red&quot;+r); }</span>

<span class="nc" id="L635">    String g = Integer.toHexString(color.getGreen());</span>
<span class="nc bnc" id="L636" title="All 2 branches missed.">    if (g.length() == 0) { g = &quot;00&quot;; }</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">    else if (g.length() == 1) { g = &quot;0&quot; + g; }</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">    else if (g.length() &gt; 2) { throw new IllegalArgumentException(&quot;invalid hex color for green&quot;+g); }</span>

<span class="nc" id="L640">    String b = Integer.toHexString(color.getBlue());</span>
<span class="nc bnc" id="L641" title="All 2 branches missed.">    if (b.length() == 0) { b = &quot;00&quot;; }</span>
<span class="nc bnc" id="L642" title="All 2 branches missed.">    else if (b.length() == 1) { b = &quot;0&quot; + b; }</span>
<span class="nc bnc" id="L643" title="All 2 branches missed.">    else if (b.length() &gt; 2) { throw new IllegalArgumentException(&quot;invalid hex color for blue&quot;+b); }</span>

<span class="nc" id="L645">    return &quot;#&quot;+r+g+b;</span>
  }

<span class="nc" id="L648">  static class ColorIcon implements Icon {</span>
    Color color;

<span class="nc" id="L651">    public ColorIcon(Color c) {</span>
<span class="nc" id="L652">      color = c;</span>
<span class="nc" id="L653">    }</span>

    @Override
    public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc" id="L657">      g.setColor(color);</span>
<span class="nc" id="L658">      g.fillRect(x, y, getIconWidth(), getIconHeight());</span>
<span class="nc" id="L659">    }</span>

    @Override
    public int getIconWidth() {
<span class="nc" id="L663">      return 10;</span>
    }

    @Override
    public int getIconHeight() {
<span class="nc" id="L668">      return 10;</span>
    }
  }

  private void buildExtractButton() {
<span class="nc bnc" id="L673" title="All 2 branches missed.">    if (extractButton == null) {</span>
<span class="nc" id="L674">      JPanel buttonPanel = new JPanel();</span>
<span class="nc" id="L675">      extractButton = new JButton(&quot;Run NER&quot;);</span>
<span class="nc" id="L676">      buttonPanel.add(extractButton);</span>
<span class="nc" id="L677">      frame.getContentPane().add(buttonPanel, BorderLayout.SOUTH);</span>
<span class="nc" id="L678">      extractButton.addActionListener(actor);</span>
    }
<span class="nc" id="L680">  }</span>

  private void buildTagPanel() {

<span class="nc bnc" id="L684" title="All 2 branches missed.">    if (tagPanel == null) {</span>
<span class="nc" id="L685">      tagPanel = new JToolBar(SwingConstants.VERTICAL);</span>
<span class="nc" id="L686">      tagPanel.setFloatable(false);</span>
<span class="nc" id="L687">      frame.getContentPane().add(tagPanel, BorderLayout.EAST);</span>
    } else {
<span class="nc" id="L689">      tagPanel.removeAll();</span>
    }

<span class="nc bnc" id="L692" title="All 2 branches missed.">    if (classifier != null) {</span>

<span class="nc" id="L694">      makeTagMaps();</span>

<span class="nc" id="L696">      Set&lt;String&gt; tags = classifier.labels();</span>
<span class="nc" id="L697">      String backgroundSymbol = classifier.backgroundSymbol();</span>

<span class="nc bnc" id="L699" title="All 2 branches missed.">      for (String tag : tags) {</span>
<span class="nc bnc" id="L700" title="All 2 branches missed.">        if (backgroundSymbol.equals(tag)) { continue; }</span>
<span class="nc" id="L701">        Color color = tagToColorMap.get(tag);</span>
<span class="nc" id="L702">        JButton b = new JButton(tag, new ColorIcon(color));</span>
<span class="nc" id="L703">        tagPanel.add(b);</span>
<span class="nc" id="L704">      }</span>
    }
<span class="nc" id="L706">    tagPanel.revalidate();</span>
<span class="nc" id="L707">    tagPanel.repaint();</span>
<span class="nc" id="L708">  }</span>

  private void makeTagMaps() {
<span class="nc" id="L711">    Set&lt;String&gt; tags = classifier.labels();</span>
<span class="nc" id="L712">    String backgroundSymbol = classifier.backgroundSymbol();</span>
<span class="nc" id="L713">    tagToColorMap = makeTagToColorMap(tags, backgroundSymbol);</span>
<span class="nc" id="L714">  }</span>

  public static Map&lt;String, Color&gt; makeTagToColorMap(Set&lt;String&gt; tags,
                                                     String backgroundSymbol) {
<span class="nc" id="L718">    int numColors = tags.size() - 1;</span>
<span class="nc" id="L719">    Color[] colors = getNColors(numColors);</span>
<span class="nc" id="L720">    Map&lt;String, Color&gt; result = Generics.newHashMap();</span>

<span class="nc" id="L722">    int i = 0;</span>
<span class="nc bnc" id="L723" title="All 2 branches missed.">    for (String tag : tags) {</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">      if (backgroundSymbol.equals(tag)) { continue; }</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">      if (result.get(tag) != null) { continue; }</span>
<span class="nc" id="L726">      result.put(tag, colors[i++]);</span>
<span class="nc" id="L727">    }</span>
<span class="nc" id="L728">    return result;</span>
  }


<span class="nc" id="L732">  private static Color[] basicColors = new Color[]{new Color(204, 102, 0),</span>
                                                   new Color(102, 0, 102),
                                                   new Color(204, 0, 102),
                                                   new Color(153, 0, 0),
                                                   new Color(153, 0, 204),
                                                   new Color(255, 102, 0),
                                                   new Color(255, 102, 153),
                                                   new Color(204, 152, 255),
                                                   new Color(102, 102, 255),
                                                   new Color(153, 102, 0),
                                                   new Color(51, 102, 51),
                                                   new Color(0, 102, 255)};

//   private static Color[] basicColors = new Color[]{new Color(153, 102, 153),
//                                                    new Color(102, 153, 153),
//                                                    new Color(153, 153, 102),
//                                                    new Color(102, 102, 102),
//                                                    new Color(102, 153, 102),
//                                                    new Color(153, 102, 102),
//                                                    new Color(204, 153, 51),
//                                                    new Color(204, 51, 102),
//                                                    new Color(255, 204, 0),
//                                                    new Color(153, 0, 255),
//                                                    new Color(204, 204, 204),
//                                                    new Color(0, 255, 153)};

//   private static Color[] basicColors = new Color[]{Color.BLUE,
//                                     Color.GREEN,
//                                     Color.RED,
//                                     Color.ORANGE,
//                                     Color.LIGHT_GRAY,
//                                     Color.CYAN,
//                                     Color.MAGENTA,
//                                     Color.YELLOW,
//                                     Color.RED,
//                                     Color.GRAY,
//                                     Color.PINK,
//                                     Color.DARK_GRAY};


  public static Color[] getNColors(int n) {
<span class="nc" id="L773">    Color[] colors = new Color[n];</span>
<span class="nc bnc" id="L774" title="All 2 branches missed.">    if (n &lt;= basicColors.length) {</span>
<span class="nc" id="L775">      System.arraycopy(basicColors, 0, colors, 0, n);</span>
    } else {
<span class="nc" id="L777">      int s = 255 / (int)Math.ceil(Math.pow(n, (1.0 / 3.0)));</span>
<span class="nc" id="L778">      int index = 0;</span>
<span class="nc bnc" id="L779" title="All 2 branches missed.">      OUTER: for (int i = 0; i &lt; 256; i += s) {</span>
<span class="nc bnc" id="L780" title="All 2 branches missed.">        for (int j = 0; j &lt; 256; j += s) {</span>
<span class="nc bnc" id="L781" title="All 2 branches missed.">          for (int k = 0; k &lt; 256; k += s) {</span>
<span class="nc" id="L782">            colors[index++] = new Color(i,j,k);</span>
<span class="nc bnc" id="L783" title="All 2 branches missed.">            if (index == n) { break OUTER; }</span>
          }
        }
      }
    }
<span class="nc" id="L788">    return colors;</span>
  }

  public static boolean isMacOSX() {
<span class="nc" id="L792">    return System.getProperty(&quot;os.name&quot;).toLowerCase().startsWith(&quot;mac os x&quot;);</span>
  }

  /** Run the GUI.  This program accepts no command-line arguments.
   *  Everything is entered into the GUI.
   */
  public static void main(String[] args) {
    //Schedule a job for the event-dispatching thread:
    //creating and showing this application's GUI.
<span class="nc bnc" id="L801" title="All 2 branches missed.">    if (isMacOSX()) {</span>
<span class="nc" id="L802">      System.setProperty(&quot;apple.laf.useScreenMenuBar&quot;, &quot;true&quot;);</span>
    }
<span class="nc" id="L804">    SwingUtilities.invokeLater(() -&gt; {</span>
<span class="nc" id="L805">      NERGUI gui = new NERGUI();</span>
<span class="nc" id="L806">      gui.createAndShowGUI();</span>
<span class="nc" id="L807">    });</span>
<span class="nc" id="L808">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>