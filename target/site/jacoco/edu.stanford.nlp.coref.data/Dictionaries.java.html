<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Dictionaries.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Stanford CoreNLP</a> &gt; <a href="index.source.html" class="el_package">edu.stanford.nlp.coref.data</a> &gt; <span class="el_source">Dictionaries.java</span></div><h1>Dictionaries.java</h1><pre class="source lang-java linenums">package edu.stanford.nlp.coref.data;
import edu.stanford.nlp.util.StringUtils;
import edu.stanford.nlp.util.logging.Redwood;

import java.io.BufferedReader;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.Properties;
import java.util.Set;

import edu.stanford.nlp.coref.hybrid.HybridCorefProperties;
import edu.stanford.nlp.io.IOUtils;
import edu.stanford.nlp.io.RuntimeIOException;
import edu.stanford.nlp.neural.VectorMap;
import edu.stanford.nlp.pipeline.DefaultPaths;
import edu.stanford.nlp.stats.ClassicCounter;
import edu.stanford.nlp.stats.Counter;
import edu.stanford.nlp.util.Generics;
import edu.stanford.nlp.util.Pair;
import edu.stanford.nlp.util.PropertiesUtils;

/**
 * Stores various data used for coreference.
 * TODO: get rid of dependence on HybridCorefProperties
 * @author Heeyoung Lee
 */
public class Dictionaries  {

  /** A logger for this class */
<span class="nc" id="L36">  private static Redwood.RedwoodChannels log = Redwood.channels(Dictionaries.class);</span>

<span class="nc" id="L38">  public enum MentionType {</span>
<span class="nc" id="L39">    PRONOMINAL(1), NOMINAL(3), PROPER(4), LIST(2);</span>

    /**
     * A higher representativeness means that this type of mention is more preferred for choosing
     * the representative mention. See {@link Mention#moreRepresentativeThan(Mention)}.
     */
    public final int representativeness;
<span class="nc" id="L46">    MentionType(int representativeness) { this.representativeness = representativeness; }</span>
  }

<span class="nc" id="L49">  public enum Gender { MALE, FEMALE, NEUTRAL, UNKNOWN }</span>

<span class="nc" id="L51">  public enum Number { SINGULAR, PLURAL, UNKNOWN }</span>
<span class="nc" id="L52">  public enum Animacy { ANIMATE, INANIMATE, UNKNOWN }</span>
<span class="nc" id="L53">  public enum Person { I, YOU, HE, SHE, WE, THEY, IT, UNKNOWN}</span>

  public Set&lt;String&gt; reportVerb;
  public Set&lt;String&gt; reportNoun;
  public Set&lt;String&gt; nonWords;
  public Set&lt;String&gt; copulas;
  public Set&lt;String&gt; quantifiers;
  public Set&lt;String&gt; parts;
  public Set&lt;String&gt; temporals;

  public Set&lt;String&gt; femalePronouns;
  public Set&lt;String&gt; malePronouns;
  public Set&lt;String&gt; neutralPronouns;
  public Set&lt;String&gt; possessivePronouns;
  public Set&lt;String&gt; otherPronouns;
  public Set&lt;String&gt; thirdPersonPronouns;
  public Set&lt;String&gt; secondPersonPronouns;
  public Set&lt;String&gt; firstPersonPronouns;
  public Set&lt;String&gt; moneyPercentNumberPronouns;
  public Set&lt;String&gt; dateTimePronouns;
  public Set&lt;String&gt; organizationPronouns;
  public Set&lt;String&gt; locationPronouns;
  public Set&lt;String&gt; inanimatePronouns;
  public Set&lt;String&gt; animatePronouns;
  public Set&lt;String&gt; indefinitePronouns;
  public Set&lt;String&gt; relativePronouns;
  public Set&lt;String&gt; interrogativePronouns;
  public Set&lt;String&gt; GPEPronouns;
  public Set&lt;String&gt; pluralPronouns;
  public Set&lt;String&gt; singularPronouns;
  public Set&lt;String&gt; facilityVehicleWeaponPronouns;
  public Set&lt;String&gt; miscPronouns;
  public Set&lt;String&gt; reflexivePronouns;
  public Set&lt;String&gt; transparentNouns;
  public Set&lt;String&gt; stopWords;
  public Set&lt;String&gt; notOrganizationPRP;
  public Set&lt;String&gt; quantifiers2;
  public Set&lt;String&gt; determiners;
  public Set&lt;String&gt; negations;
  public Set&lt;String&gt; neg_relations;
  public Set&lt;String&gt; modals;
  public Set&lt;String&gt; titleWords;
  public Set&lt;String&gt; removeWords;
  public Set&lt;String&gt; removeChars;

<span class="nc" id="L98">  public final Set&lt;String&gt; personPronouns = Generics.newHashSet();</span>
<span class="nc" id="L99">  public final Set&lt;String&gt; allPronouns = Generics.newHashSet();</span>

<span class="nc" id="L101">  public final Map&lt;String, String&gt; statesAbbreviation = Generics.newHashMap();</span>
<span class="nc" id="L102">  private final Map&lt;String, Set&lt;String&gt;&gt; demonyms = Generics.newHashMap();</span>
<span class="nc" id="L103">  public final Set&lt;String&gt; demonymSet = Generics.newHashSet();</span>
<span class="nc" id="L104">  private final Set&lt;String&gt; adjectiveNation = Generics.newHashSet();</span>

<span class="nc" id="L106">  public final Set&lt;String&gt; countries = Generics.newHashSet();</span>
<span class="nc" id="L107">  public final Set&lt;String&gt; statesAndProvinces = Generics.newHashSet();</span>

<span class="nc" id="L109">  public final Set&lt;String&gt; neutralWords = Generics.newHashSet();</span>
<span class="nc" id="L110">  public final Set&lt;String&gt; femaleWords = Generics.newHashSet();</span>
<span class="nc" id="L111">  public final Set&lt;String&gt; maleWords = Generics.newHashSet();</span>

<span class="nc" id="L113">  public final Set&lt;String&gt; pluralWords = Generics.newHashSet();</span>
<span class="nc" id="L114">  public final Set&lt;String&gt; singularWords = Generics.newHashSet();</span>

<span class="nc" id="L116">  public final Set&lt;String&gt; inanimateWords = Generics.newHashSet();</span>
<span class="nc" id="L117">  public final Set&lt;String&gt; animateWords = Generics.newHashSet();</span>

<span class="nc" id="L119">  public final Map&lt;List&lt;String&gt;, Gender&gt; genderNumber = Generics.newHashMap();</span>

<span class="nc" id="L121">  public final ArrayList&lt;Counter&lt;Pair&lt;String, String&gt;&gt;&gt; corefDict = new ArrayList&lt;&gt;(4);</span>
<span class="nc" id="L122">  public final Counter&lt;Pair&lt;String, String&gt;&gt; corefDictPMI = new ClassicCounter&lt;&gt;();</span>
<span class="nc" id="L123">  public final Map&lt;String,Counter&lt;String&gt;&gt; NE_signatures = Generics.newHashMap();</span>

  private void readWordLists(Locale lang) {
<span class="nc bnc" id="L126" title="All 9 branches missed.">    switch (lang.getLanguage()) {</span>
      default: case &quot;en&quot;:
<span class="nc" id="L128">      reportVerb = WordLists.reportVerbEn;</span>
<span class="nc" id="L129">      reportNoun = WordLists.reportNounEn;</span>
<span class="nc" id="L130">      nonWords = WordLists.nonWordsEn;</span>
<span class="nc" id="L131">      copulas = WordLists.copulasEn;</span>
<span class="nc" id="L132">      quantifiers = WordLists.quantifiersEn;</span>
<span class="nc" id="L133">      parts = WordLists.partsEn;</span>
<span class="nc" id="L134">      temporals = WordLists.temporalsEn;</span>
<span class="nc" id="L135">      femalePronouns = WordLists.femalePronounsEn;</span>
<span class="nc" id="L136">      malePronouns = WordLists.malePronounsEn;</span>
<span class="nc" id="L137">      neutralPronouns = WordLists.neutralPronounsEn;</span>
<span class="nc" id="L138">      possessivePronouns = WordLists.possessivePronounsEn;</span>
<span class="nc" id="L139">      otherPronouns = WordLists.otherPronounsEn;</span>
<span class="nc" id="L140">      thirdPersonPronouns = WordLists.thirdPersonPronounsEn;</span>
<span class="nc" id="L141">      secondPersonPronouns = WordLists.secondPersonPronounsEn;</span>
<span class="nc" id="L142">      firstPersonPronouns = WordLists.firstPersonPronounsEn;</span>
<span class="nc" id="L143">      moneyPercentNumberPronouns = WordLists.moneyPercentNumberPronounsEn;</span>
<span class="nc" id="L144">      dateTimePronouns = WordLists.dateTimePronounsEn;</span>
<span class="nc" id="L145">      organizationPronouns = WordLists.organizationPronounsEn;</span>
<span class="nc" id="L146">      locationPronouns = WordLists.locationPronounsEn;</span>
<span class="nc" id="L147">      inanimatePronouns = WordLists.inanimatePronounsEn;</span>
<span class="nc" id="L148">      animatePronouns = WordLists.animatePronounsEn;</span>
<span class="nc" id="L149">      indefinitePronouns = WordLists.indefinitePronounsEn;</span>
<span class="nc" id="L150">      relativePronouns = WordLists.relativePronounsEn;</span>
<span class="nc" id="L151">      GPEPronouns = WordLists.GPEPronounsEn;</span>
<span class="nc" id="L152">      pluralPronouns = WordLists.pluralPronounsEn;</span>
<span class="nc" id="L153">      singularPronouns = WordLists.singularPronounsEn;</span>
<span class="nc" id="L154">      facilityVehicleWeaponPronouns = WordLists.facilityVehicleWeaponPronounsEn;</span>
<span class="nc" id="L155">      miscPronouns = WordLists.miscPronounsEn;</span>
<span class="nc" id="L156">      reflexivePronouns = WordLists.reflexivePronounsEn;</span>
<span class="nc" id="L157">      transparentNouns = WordLists.transparentNounsEn;</span>
<span class="nc" id="L158">      stopWords = WordLists.stopWordsEn;</span>
<span class="nc" id="L159">      notOrganizationPRP = WordLists.notOrganizationPRPEn;</span>
<span class="nc" id="L160">      quantifiers2 = WordLists.quantifiers2En;</span>
<span class="nc" id="L161">      determiners = WordLists.determinersEn;</span>
<span class="nc" id="L162">      negations = WordLists.negationsEn;</span>
<span class="nc" id="L163">      neg_relations = WordLists.neg_relationsEn;</span>
<span class="nc" id="L164">      modals = WordLists.modalsEn;</span>
<span class="nc" id="L165">      break;</span>

      case &quot;zh&quot;:
<span class="nc" id="L168">      reportVerb = WordLists.reportVerbZh;</span>
<span class="nc" id="L169">      reportNoun = WordLists.reportNounZh;</span>
<span class="nc" id="L170">      nonWords = WordLists.nonWordsZh;</span>
<span class="nc" id="L171">      copulas = WordLists.copulasZh;</span>
<span class="nc" id="L172">      quantifiers = WordLists.quantifiersZh;</span>
<span class="nc" id="L173">      parts = WordLists.partsZh;</span>
<span class="nc" id="L174">      temporals = WordLists.temporalsZh;</span>
<span class="nc" id="L175">      femalePronouns = WordLists.femalePronounsZh;</span>
<span class="nc" id="L176">      malePronouns = WordLists.malePronounsZh;</span>
<span class="nc" id="L177">      neutralPronouns = WordLists.neutralPronounsZh;</span>
<span class="nc" id="L178">      possessivePronouns = WordLists.possessivePronounsZh;</span>
<span class="nc" id="L179">      otherPronouns = WordLists.otherPronounsZh;</span>
<span class="nc" id="L180">      thirdPersonPronouns = WordLists.thirdPersonPronounsZh;</span>
<span class="nc" id="L181">      secondPersonPronouns = WordLists.secondPersonPronounsZh;</span>
<span class="nc" id="L182">      firstPersonPronouns = WordLists.firstPersonPronounsZh;</span>
<span class="nc" id="L183">      moneyPercentNumberPronouns = WordLists.moneyPercentNumberPronounsZh;</span>
<span class="nc" id="L184">      dateTimePronouns = WordLists.dateTimePronounsZh;</span>
<span class="nc" id="L185">      organizationPronouns = WordLists.organizationPronounsZh;</span>
<span class="nc" id="L186">      locationPronouns = WordLists.locationPronounsZh;</span>
<span class="nc" id="L187">      inanimatePronouns = WordLists.inanimatePronounsZh;</span>
<span class="nc" id="L188">      animatePronouns = WordLists.animatePronounsZh;</span>
<span class="nc" id="L189">      indefinitePronouns = WordLists.indefinitePronounsZh;</span>
<span class="nc" id="L190">      relativePronouns = WordLists.relativePronounsZh;</span>
<span class="nc" id="L191">      interrogativePronouns = WordLists.interrogativePronounsZh;</span>
<span class="nc" id="L192">      GPEPronouns = WordLists.GPEPronounsZh;</span>
<span class="nc" id="L193">      pluralPronouns = WordLists.pluralPronounsZh;</span>
<span class="nc" id="L194">      singularPronouns = WordLists.singularPronounsZh;</span>
<span class="nc" id="L195">      facilityVehicleWeaponPronouns = WordLists.facilityVehicleWeaponPronounsZh;</span>
<span class="nc" id="L196">      miscPronouns = WordLists.miscPronounsZh;</span>
<span class="nc" id="L197">      reflexivePronouns = WordLists.reflexivePronounsZh;</span>
<span class="nc" id="L198">      transparentNouns = WordLists.transparentNounsZh;</span>
<span class="nc" id="L199">      stopWords = WordLists.stopWordsZh;</span>
<span class="nc" id="L200">      notOrganizationPRP = WordLists.notOrganizationPRPZh;</span>
<span class="nc" id="L201">      quantifiers2 = WordLists.quantifiers2Zh;</span>
<span class="nc" id="L202">      determiners = WordLists.determinersZh;</span>
<span class="nc" id="L203">      negations = WordLists.negationsZh;</span>
<span class="nc" id="L204">      neg_relations = WordLists.neg_relationsZh;</span>
<span class="nc" id="L205">      modals = WordLists.modalsZh;</span>
<span class="nc" id="L206">      titleWords = WordLists.titleWordsZh;</span>
<span class="nc" id="L207">      removeWords = WordLists.removeWordsZh;</span>
<span class="nc" id="L208">      removeChars = WordLists.removeCharsZh;</span>
      break;
    }
<span class="nc" id="L211">  }</span>

  public int dimVector;

<span class="nc" id="L215">  public VectorMap vectors = new VectorMap();</span>

<span class="nc" id="L217">  public Map&lt;String, String&gt; strToEntity = Generics.newHashMap();</span>
<span class="nc" id="L218">  public Counter&lt;String&gt; dictScore = new ClassicCounter&lt;&gt;();</span>

  private void setPronouns() {
<span class="nc bnc" id="L221" title="All 2 branches missed.">    for(String s: animatePronouns){</span>
<span class="nc" id="L222">      personPronouns.add(s);</span>
<span class="nc" id="L223">    }</span>

<span class="nc" id="L225">    allPronouns.addAll(firstPersonPronouns);</span>
<span class="nc" id="L226">    allPronouns.addAll(secondPersonPronouns);</span>
<span class="nc" id="L227">    allPronouns.addAll(thirdPersonPronouns);</span>
<span class="nc" id="L228">    allPronouns.addAll(otherPronouns);</span>

<span class="nc" id="L230">    stopWords.addAll(allPronouns);</span>
<span class="nc" id="L231">  }</span>

  /** The format of each line of this file is
   *     fullStateName ( TAB  abbrev )*
   *  The file is cased and checked cased.
   *  The result is: statesAbbreviation is a hash from each abbrev to the fullStateName.
   */
  public void loadStateAbbreviation(String statesFile) {
<span class="nc" id="L239">    BufferedReader reader = null;</span>
    try {
<span class="nc" id="L241">      reader = IOUtils.readerFromString(statesFile);</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">      for (String line; (line = reader.readLine()) != null; ) {</span>
<span class="nc" id="L243">        String[] tokens = line.split(&quot;\t&quot;);</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">        for (String token : tokens) {</span>
<span class="nc" id="L245">          statesAbbreviation.put(token, tokens[0]);</span>
        }
<span class="nc" id="L247">      }</span>
<span class="nc" id="L248">    } catch (IOException e) {</span>
<span class="nc" id="L249">      throw new RuntimeIOException(e);</span>
    } finally {
<span class="nc" id="L251">      IOUtils.closeIgnoringExceptions(reader);</span>
<span class="nc" id="L252">    }</span>
<span class="nc" id="L253">  }</span>

  /** If the input string is an abbreviation of a U.S. state name
   *  or the canonical name, the canonical name is returned.
   *  Otherwise, null is returned.
   *
   *  @param name Is treated as a cased string. ME != me
   */
  public String lookupCanonicalAmericanStateName(String name) {
<span class="nc" id="L262">    return statesAbbreviation.get(name);</span>
  }

  /** The format of the demonyms file is
   *     countryCityOrState ( TAB demonym )*
   *  Lines starting with # are ignored
   *  The file is cased but stored in in-memory data structures uncased.
   *  The results are:
   *  demonyms is a has from each country (etc.) to a set of demonymic Strings;
   *  adjectiveNation is a set of demonymic Strings;
   *  demonymSet has all country (etc.) names and all demonymic Strings.
   */
  private void loadDemonymLists(String demonymFile) {
<span class="nc" id="L275">    BufferedReader reader = null;</span>
    try {
<span class="nc" id="L277">      reader = IOUtils.readerFromString(demonymFile);</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">      for (String line; (line = reader.readLine()) != null; ) {</span>
<span class="nc" id="L279">        line = line.toLowerCase(Locale.ENGLISH);</span>
<span class="nc" id="L280">        String[] tokens = line.split(&quot;\t&quot;);</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">        if (tokens[0].startsWith(&quot;#&quot;)) continue;</span>
<span class="nc" id="L282">        Set&lt;String&gt; set = Generics.newHashSet();</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">        for (String s : tokens) {</span>
<span class="nc" id="L284">          set.add(s);</span>
<span class="nc" id="L285">          demonymSet.add(s);</span>
        }
<span class="nc" id="L287">        demonyms.put(tokens[0], set);</span>
<span class="nc" id="L288">      }</span>
<span class="nc" id="L289">      adjectiveNation.addAll(demonymSet);</span>
<span class="nc" id="L290">      adjectiveNation.removeAll(demonyms.keySet());</span>
<span class="nc" id="L291">    } catch (IOException e) {</span>
<span class="nc" id="L292">      throw new RuntimeIOException(e);</span>
    } finally {
<span class="nc" id="L294">      IOUtils.closeIgnoringExceptions(reader);</span>
<span class="nc" id="L295">    }</span>
<span class="nc" id="L296">  }</span>

  /** Returns a set of demonyms for a country (or city or region).
   *  @param name Some string perhaps a country name like &quot;Australia&quot;
   *  @return A Set of demonym Strings, perhaps { &quot;Australian&quot;, &quot;Aussie&quot;, &quot;Aussies&quot; }.
   *     If none are known (including if the argument isn't a country/region name,
   *     then the empty set will be returned.
   */
  public Set&lt;String&gt; getDemonyms(String name) {
<span class="nc" id="L305">    Set&lt;String&gt; result = demonyms.get(name);</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">    if (result == null) {</span>
<span class="nc" id="L307">      result = Collections.emptySet();</span>
    }
<span class="nc" id="L309">    return result;</span>
  }

  /** Returns whether this mention (possibly multi-word) is the
   *  adjectival form of a demonym, like &quot;African&quot; or &quot;Iraqi&quot;.
   *  True if it is an adjectival form, even if also a name for a
   *  person of that country (such as &quot;Iraqi&quot;).
   */
  public boolean isAdjectivalDemonym(String token) {
<span class="nc" id="L318">    return adjectiveNation.contains(token.toLowerCase(Locale.ENGLISH));</span>
  }

  private static void getWordsFromFile(String filename, Set&lt;String&gt; resultSet, boolean lowercase) throws IOException {
<span class="nc bnc" id="L322" title="All 2 branches missed.">    if(filename==null) {</span>
<span class="nc" id="L323">      return ;</span>
    }
<span class="nc" id="L325">    BufferedReader reader = IOUtils.readerFromString(filename);</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">    while(reader.ready()) {</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">      if(lowercase) resultSet.add(reader.readLine().toLowerCase());</span>
<span class="nc" id="L328">      else resultSet.add(reader.readLine());</span>
    }
<span class="nc" id="L330">    IOUtils.closeIgnoringExceptions(reader);</span>
<span class="nc" id="L331">  }</span>

  private void loadAnimacyLists(String animateWordsFile, String inanimateWordsFile) {
    try {
<span class="nc" id="L335">      getWordsFromFile(animateWordsFile, animateWords, false);</span>
<span class="nc" id="L336">      getWordsFromFile(inanimateWordsFile, inanimateWords, false);</span>
<span class="nc" id="L337">    } catch (IOException e) {</span>
<span class="nc" id="L338">      throw new RuntimeIOException(e);</span>
<span class="nc" id="L339">    }</span>
<span class="nc" id="L340">  }</span>

  private void loadGenderLists(String maleWordsFile, String neutralWordsFile, String femaleWordsFile) {
    try {
<span class="nc" id="L344">      getWordsFromFile(maleWordsFile, maleWords, false);</span>
<span class="nc" id="L345">      getWordsFromFile(neutralWordsFile, neutralWords, false);</span>
<span class="nc" id="L346">      getWordsFromFile(femaleWordsFile, femaleWords, false);</span>
<span class="nc" id="L347">    } catch (IOException e) {</span>
<span class="nc" id="L348">      throw new RuntimeIOException(e);</span>
<span class="nc" id="L349">    }</span>
<span class="nc" id="L350">  }</span>

  private void loadNumberLists(String pluralWordsFile, String singularWordsFile) {
    try {
<span class="nc" id="L354">      getWordsFromFile(pluralWordsFile, pluralWords, false);</span>
<span class="nc" id="L355">      getWordsFromFile(singularWordsFile, singularWords, false);</span>
<span class="nc" id="L356">    } catch (IOException e) {</span>
<span class="nc" id="L357">      throw new RuntimeIOException(e);</span>
<span class="nc" id="L358">    }</span>
<span class="nc" id="L359">  }</span>
  private void loadStatesLists(String file) {
    try {
<span class="nc" id="L362">      getWordsFromFile(file, statesAndProvinces, true);</span>
<span class="nc" id="L363">    } catch (IOException e) {</span>
<span class="nc" id="L364">      throw new RuntimeIOException(e);</span>
<span class="nc" id="L365">    }</span>
<span class="nc" id="L366">  }</span>

  private void loadCountriesLists(String file) {
    try{
<span class="nc" id="L370">      BufferedReader reader = IOUtils.readerFromString(file);</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">      for (String line; (line = reader.readLine()) != null; ) {</span>
<span class="nc" id="L372">        countries.add(line.split(&quot;\t&quot;)[1].toLowerCase());</span>
      }
<span class="nc" id="L374">      reader.close();</span>
<span class="nc" id="L375">    } catch (IOException e) {</span>
<span class="nc" id="L376">      throw new RuntimeIOException(e);</span>
<span class="nc" id="L377">    }</span>
<span class="nc" id="L378">  }</span>
  /**
   * Load Bergsma and Lin (2006) gender and number list.
   * &lt;br&gt;
   * The list is converted from raw text and numbers to a serialized
   * map, which saves quite a bit of time loading.
   * See edu.stanford.nlp.dcoref.util.ConvertGenderFile
   */
/*
  private void loadGenderNumber(String file, String neutralWordsFile) {
    try {
      getWordsFromFile(neutralWordsFile, neutralWords, false);
      Map&lt;List&lt;String&gt;, Gender&gt; temp = IOUtils.readObjectFromURLOrClasspathOrFileSystem(file);
      genderNumber.putAll(temp);
    } catch (IOException e) {
      throw new RuntimeIOException(e);
    } catch (ClassNotFoundException e) {
      throw new RuntimeIOException(e);
    }
  }
*/
  /**
   * Load Bergsma and Lin (2006) gender and number list.
   *
   */
  private void loadGenderNumber(String file, String neutralWordsFile) {
    try {
<span class="nc" id="L405">      getWordsFromFile(neutralWordsFile, neutralWords, false);</span>
<span class="nc" id="L406">      BufferedReader reader = IOUtils.readerFromString(file);</span>
<span class="nc" id="L407">      String[] split = new String[2];</span>
<span class="nc" id="L408">      String[] countStr = new String[3];</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">      for (String line; (line = reader.readLine()) != null; ) {</span>
<span class="nc" id="L410">        StringUtils.splitOnChar(split, line, '\t');</span>
<span class="nc" id="L411">        StringUtils.splitOnChar(countStr, split[1], ' ');</span>

<span class="nc" id="L413">        int male = Integer.parseInt(countStr[0]);</span>
<span class="nc" id="L414">        int female = Integer.parseInt(countStr[1]);</span>
<span class="nc" id="L415">        int neutral = Integer.parseInt(countStr[2]);</span>

<span class="nc" id="L417">        Gender gender = Gender.UNKNOWN;</span>
<span class="nc bnc" id="L418" title="All 4 branches missed.">        if (male * 0.5 &gt; female + neutral &amp;&amp; male &gt; 2) {</span>
<span class="nc" id="L419">          gender = Gender.MALE;</span>
<span class="nc bnc" id="L420" title="All 4 branches missed.">        } else if (female * 0.5 &gt; male + neutral &amp;&amp; female &gt; 2) {</span>
<span class="nc" id="L421">          gender = Gender.FEMALE;</span>
<span class="nc bnc" id="L422" title="All 4 branches missed.">        } else if (neutral * 0.5 &gt; male + female &amp;&amp; neutral &gt; 2) {</span>
<span class="nc" id="L423">          gender = Gender.NEUTRAL;</span>
        }

<span class="nc bnc" id="L426" title="All 2 branches missed.">        if (gender == Gender.UNKNOWN) {</span>
<span class="nc" id="L427">          continue;</span>
        }

<span class="nc" id="L430">        String[] words = split[0].split(&quot; &quot;);</span>
<span class="nc" id="L431">        List&lt;String&gt; tokens = Arrays.asList(words);</span>

<span class="nc" id="L433">        genderNumber.put(tokens, gender);</span>
<span class="nc" id="L434">      }</span>
<span class="nc" id="L435">      reader.close();</span>
<span class="nc" id="L436">    } catch (IOException e) {</span>
<span class="nc" id="L437">      throw new RuntimeIOException(e);</span>
<span class="nc" id="L438">    }</span>
<span class="nc" id="L439">  }</span>
  public void loadChineseGenderNumberAnimacy(String file) {
<span class="nc" id="L441">    String[] split = new String[8];</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">    for (String line : IOUtils.readLines(file)) {</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">      if(line.startsWith(&quot;#WORD&quot;)) continue;    // ignore first row</span>
<span class="nc" id="L444">      StringUtils.splitOnChar(split, line, '\t');</span>

<span class="nc" id="L446">      String word = split[0];</span>
<span class="nc" id="L447">      int animate = Integer.parseInt(split[1]);</span>
<span class="nc" id="L448">      int inanimate = Integer.parseInt(split[2]);</span>
<span class="nc" id="L449">      int male = Integer.parseInt(split[3]);</span>
<span class="nc" id="L450">      int female = Integer.parseInt(split[4]);</span>
<span class="nc" id="L451">      int neutral = Integer.parseInt(split[5]);</span>
<span class="nc" id="L452">      int singular = Integer.parseInt(split[6]);</span>
<span class="nc" id="L453">      int plural = Integer.parseInt(split[7]);</span>

<span class="nc bnc" id="L455" title="All 4 branches missed.">      if (male * 0.5 &gt; female + neutral &amp;&amp; male &gt; 2) {</span>
<span class="nc" id="L456">        maleWords.add(word);</span>
<span class="nc bnc" id="L457" title="All 4 branches missed.">      } else if (female * 0.5 &gt; male + neutral &amp;&amp; female &gt; 2) {</span>
<span class="nc" id="L458">        femaleWords.add(word);</span>
<span class="nc bnc" id="L459" title="All 4 branches missed.">      } else if (neutral * 0.5 &gt; male + female &amp;&amp; neutral &gt; 2) {</span>
<span class="nc" id="L460">        neutralWords.add(word);</span>
      }

<span class="nc bnc" id="L463" title="All 4 branches missed.">      if (animate * 0.5 &gt; inanimate &amp;&amp; animate &gt; 2) {</span>
<span class="nc" id="L464">        animateWords.add(word);</span>
<span class="nc bnc" id="L465" title="All 4 branches missed.">      } else if (inanimate * 0.5 &gt; animate &amp;&amp; inanimate &gt; 2) {</span>
<span class="nc" id="L466">        inanimateWords.add(word);</span>
      }

<span class="nc bnc" id="L469" title="All 4 branches missed.">      if (singular * 0.5 &gt; plural &amp;&amp; singular &gt;2) {</span>
<span class="nc" id="L470">        singularWords.add(word);</span>
<span class="nc bnc" id="L471" title="All 4 branches missed.">      } else if (plural * 0.5 &gt; singular &amp;&amp; plural &gt; 2) {</span>
<span class="nc" id="L472">        pluralWords.add(word);</span>
      }
<span class="nc" id="L474">    }</span>
<span class="nc" id="L475">  }</span>

  private static void loadCorefDict(String[] file,
      ArrayList&lt;Counter&lt;Pair&lt;String, String&gt;&gt;&gt; dict) {

<span class="nc bnc" id="L480" title="All 2 branches missed.">    for(int i = 0; i &lt; 4; i++){</span>
<span class="nc" id="L481">      dict.add(new ClassicCounter&lt;&gt;());</span>

<span class="nc" id="L483">      BufferedReader reader = null;</span>
      try {
<span class="nc" id="L485">        reader = IOUtils.readerFromString(file[i]);</span>
        // Skip the first line (header)
<span class="nc" id="L487">        reader.readLine();</span>

<span class="nc bnc" id="L489" title="All 2 branches missed.">        while(reader.ready()) {</span>
<span class="nc" id="L490">          String[] split = reader.readLine().split(&quot;\t&quot;);</span>
<span class="nc" id="L491">          dict.get(i).setCount(new Pair&lt;&gt;(split[0], split[1]), Double.parseDouble(split[2]));</span>
<span class="nc" id="L492">        }</span>

<span class="nc" id="L494">      } catch (IOException e) {</span>
<span class="nc" id="L495">        throw new RuntimeException(e);</span>
      } finally {
<span class="nc" id="L497">        IOUtils.closeIgnoringExceptions(reader);</span>
<span class="nc" id="L498">      }</span>
    }
<span class="nc" id="L500">  }</span>

  private static void loadCorefDictPMI(String file, Counter&lt;Pair&lt;String, String&gt;&gt; dict) {

<span class="nc" id="L504">      BufferedReader reader = null;</span>
      try {
<span class="nc" id="L506">        reader = IOUtils.readerFromString(file);</span>
        // Skip the first line (header)
<span class="nc" id="L508">        reader.readLine();</span>

<span class="nc bnc" id="L510" title="All 2 branches missed.">        while(reader.ready()) {</span>
<span class="nc" id="L511">          String[] split = reader.readLine().split(&quot;\t&quot;);</span>
<span class="nc" id="L512">          dict.setCount(new Pair&lt;&gt;(split[0], split[1]), Double.parseDouble(split[3]));</span>
<span class="nc" id="L513">        }</span>

<span class="nc" id="L515">      } catch (IOException e) {</span>
<span class="nc" id="L516">        throw new RuntimeException(e);</span>
      } finally {
<span class="nc" id="L518">        IOUtils.closeIgnoringExceptions(reader);</span>
<span class="nc" id="L519">      }</span>
<span class="nc" id="L520">  }</span>

  private static void loadSignatures(String file, Map&lt;String,Counter&lt;String&gt;&gt; sigs) {
<span class="nc" id="L523">    BufferedReader reader = null;</span>
    try {
<span class="nc" id="L525">      reader = IOUtils.readerFromString(file);</span>

<span class="nc bnc" id="L527" title="All 2 branches missed.">      while(reader.ready()) {</span>
<span class="nc" id="L528">        String[] split = reader.readLine().split(&quot;\t&quot;);</span>
<span class="nc" id="L529">        Counter&lt;String&gt; cntr = new ClassicCounter&lt;&gt;();</span>
<span class="nc" id="L530">        sigs.put(split[0], cntr);</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">        for (int i = 1; i &lt; split.length; i=i+2) {</span>
<span class="nc" id="L532">          cntr.setCount(split[i], Double.parseDouble(split[i+1]));</span>
        }
<span class="nc" id="L534">      }</span>
<span class="nc" id="L535">    } catch (IOException e) {</span>
<span class="nc" id="L536">      throw new RuntimeException(e);</span>
    } finally {
<span class="nc" id="L538">      IOUtils.closeIgnoringExceptions(reader);</span>
<span class="nc" id="L539">    }</span>
<span class="nc" id="L540">  }</span>

  public void loadSemantics(Properties props) throws ClassNotFoundException, IOException {
<span class="nc" id="L543">    log.info(&quot;LOADING SEMANTICS&quot;);</span>

//    wordnet = new WordNet();

    // load word vector
<span class="nc bnc" id="L548" title="All 2 branches missed.">    if(HybridCorefProperties.loadWordEmbedding(props)) {</span>
<span class="nc" id="L549">      log.info(&quot;LOAD: WordVectors&quot;);</span>
<span class="nc" id="L550">      String wordvectorFile = HybridCorefProperties.getPathSerializedWordVectors(props);</span>
<span class="nc" id="L551">      String word2vecFile = HybridCorefProperties.getPathWord2Vec(props);</span>
      try {
        // Try to read the serialized vectors
<span class="nc" id="L554">        vectors = VectorMap.deserialize(wordvectorFile);</span>
<span class="nc" id="L555">      } catch (IOException e) {</span>
        // If that fails, try to read the vectors from the word2vec file
<span class="nc bnc" id="L557" title="All 2 branches missed.">        if(new File(word2vecFile).exists()) {</span>
<span class="nc" id="L558">          vectors = VectorMap.readWord2Vec(word2vecFile);</span>
<span class="nc bnc" id="L559" title="All 4 branches missed.">          if (wordvectorFile != null &amp;&amp; !wordvectorFile.startsWith(&quot;edu&quot;)) {</span>
<span class="nc" id="L560">            vectors.serialize(wordvectorFile);</span>
          }
        } else {
          // If that fails, give up and crash
<span class="nc" id="L564">          throw new RuntimeIOException(e);</span>
        }
<span class="nc" id="L566">      }</span>
<span class="nc" id="L567">      dimVector = vectors.entrySet().iterator().next().getValue().length;</span>

//    if(Boolean.parseBoolean(props.getProperty(&quot;useValDictionary&quot;))) {
//      log.info(&quot;LOAD: ValDictionary&quot;);
//      for(String line : IOUtils.readLines(valDict)) {
//        String[] split = line.toLowerCase().split(&quot;\t&quot;);
//        strToEntity.put(split[0], split[2]);
//        dictScore.setCount(split[0], Double.parseDouble(split[1]));
//      }
//    }
    }
<span class="nc" id="L578">  }</span>

  public Dictionaries(Properties props) throws ClassNotFoundException, IOException {
<span class="nc" id="L581">    this(props.getProperty(HybridCorefProperties.LANG_PROP, HybridCorefProperties.LANGUAGE_DEFAULT.toLanguageTag()),</span>
<span class="nc" id="L582">        props.getProperty(HybridCorefProperties.DEMONYM_PROP, DefaultPaths.DEFAULT_DCOREF_DEMONYM),</span>
<span class="nc" id="L583">        props.getProperty(HybridCorefProperties.ANIMATE_PROP, DefaultPaths.DEFAULT_DCOREF_ANIMATE),</span>
<span class="nc" id="L584">        props.getProperty(HybridCorefProperties.INANIMATE_PROP, DefaultPaths.DEFAULT_DCOREF_INANIMATE),</span>
<span class="nc" id="L585">        props.getProperty(HybridCorefProperties.MALE_PROP),</span>
<span class="nc" id="L586">        props.getProperty(HybridCorefProperties.NEUTRAL_PROP),</span>
<span class="nc" id="L587">        props.getProperty(HybridCorefProperties.FEMALE_PROP),</span>
<span class="nc" id="L588">        props.getProperty(HybridCorefProperties.PLURAL_PROP),</span>
<span class="nc" id="L589">        props.getProperty(HybridCorefProperties.SINGULAR_PROP),</span>
<span class="nc" id="L590">        props.getProperty(HybridCorefProperties.STATES_PROP, DefaultPaths.DEFAULT_DCOREF_STATES),</span>
<span class="nc" id="L591">        props.getProperty(HybridCorefProperties.GENDER_NUMBER_PROP, HybridCorefProperties.getGenderNumber(props)),</span>
<span class="nc" id="L592">        props.getProperty(HybridCorefProperties.COUNTRIES_PROP, DefaultPaths.DEFAULT_DCOREF_COUNTRIES),</span>
<span class="nc" id="L593">        props.getProperty(HybridCorefProperties.STATES_PROVINCES_PROP, DefaultPaths.DEFAULT_DCOREF_STATES_AND_PROVINCES),</span>
<span class="nc" id="L594">        HybridCorefProperties.getSieves(props).contains(&quot;CorefDictionaryMatch&quot;),</span>
<span class="nc" id="L595">        PropertiesUtils.getStringArray(props, HybridCorefProperties.DICT_LIST_PROP,</span>
            new String[]{DefaultPaths.DEFAULT_DCOREF_DICT1, DefaultPaths.DEFAULT_DCOREF_DICT2,
                DefaultPaths.DEFAULT_DCOREF_DICT3, DefaultPaths.DEFAULT_DCOREF_DICT4}),
<span class="nc" id="L598">        props.getProperty(HybridCorefProperties.DICT_PMI_PROP, DefaultPaths.DEFAULT_DCOREF_DICT1),</span>
<span class="nc" id="L599">        props.getProperty(HybridCorefProperties.SIGNATURES_PROP, DefaultPaths.DEFAULT_DCOREF_NE_SIGNATURES));</span>
    /*if(CorefProperties.useSemantics(props)) {
      loadSemantics(props);
    } else {
      log.info(&quot;SEMANTICS NOT LOADED&quot;);
    }*/
<span class="nc bnc" id="L605" title="All 2 branches missed.">    if(props.containsKey(&quot;coref.zh.dict&quot;)) {</span>
<span class="nc" id="L606">      loadChineseGenderNumberAnimacy(props.getProperty(&quot;coref.zh.dict&quot;));</span>
    }
<span class="nc" id="L608">  }</span>

  public static String signature(Properties props) {
<span class="nc" id="L611">    StringBuilder os = new StringBuilder();</span>
<span class="nc" id="L612">    os.append(HybridCorefProperties.DEMONYM_PROP + &quot;:&quot; +</span>
<span class="nc" id="L613">            props.getProperty(HybridCorefProperties.DEMONYM_PROP,</span>
                    DefaultPaths.DEFAULT_DCOREF_DEMONYM));
<span class="nc" id="L615">    os.append(HybridCorefProperties.ANIMATE_PROP + &quot;:&quot; +</span>
<span class="nc" id="L616">            props.getProperty(HybridCorefProperties.ANIMATE_PROP,</span>
                    DefaultPaths.DEFAULT_DCOREF_ANIMATE));
<span class="nc" id="L618">    os.append(HybridCorefProperties.INANIMATE_PROP + &quot;:&quot; +</span>
<span class="nc" id="L619">            props.getProperty(HybridCorefProperties.INANIMATE_PROP,</span>
                    DefaultPaths.DEFAULT_DCOREF_INANIMATE));
<span class="nc bnc" id="L621" title="All 2 branches missed.">    if(props.containsKey(HybridCorefProperties.MALE_PROP)) {</span>
<span class="nc" id="L622">      os.append(HybridCorefProperties.MALE_PROP + &quot;:&quot; +</span>
<span class="nc" id="L623">            props.getProperty(HybridCorefProperties.MALE_PROP));</span>
    }
<span class="nc bnc" id="L625" title="All 2 branches missed.">    if(props.containsKey(HybridCorefProperties.NEUTRAL_PROP)) {</span>
<span class="nc" id="L626">      os.append(HybridCorefProperties.NEUTRAL_PROP + &quot;:&quot; +</span>
<span class="nc" id="L627">            props.getProperty(HybridCorefProperties.NEUTRAL_PROP));</span>
    }
<span class="nc bnc" id="L629" title="All 2 branches missed.">    if(props.containsKey(HybridCorefProperties.FEMALE_PROP)) {</span>
<span class="nc" id="L630">      os.append(HybridCorefProperties.FEMALE_PROP + &quot;:&quot; +</span>
<span class="nc" id="L631">            props.getProperty(HybridCorefProperties.FEMALE_PROP));</span>
    }
<span class="nc bnc" id="L633" title="All 2 branches missed.">    if(props.containsKey(HybridCorefProperties.PLURAL_PROP)) {</span>
<span class="nc" id="L634">      os.append(HybridCorefProperties.PLURAL_PROP + &quot;:&quot; +</span>
<span class="nc" id="L635">            props.getProperty(HybridCorefProperties.PLURAL_PROP));</span>
    }
<span class="nc bnc" id="L637" title="All 2 branches missed.">    if(props.containsKey(HybridCorefProperties.SINGULAR_PROP)) {</span>
<span class="nc" id="L638">      os.append(HybridCorefProperties.SINGULAR_PROP + &quot;:&quot; +</span>
<span class="nc" id="L639">            props.getProperty(HybridCorefProperties.SINGULAR_PROP));</span>
    }
<span class="nc" id="L641">    os.append(HybridCorefProperties.STATES_PROP + &quot;:&quot; +</span>
<span class="nc" id="L642">            props.getProperty(HybridCorefProperties.STATES_PROP,</span>
                    DefaultPaths.DEFAULT_DCOREF_STATES));
<span class="nc" id="L644">    os.append(HybridCorefProperties.GENDER_NUMBER_PROP + &quot;:&quot; +</span>
<span class="nc" id="L645">            props.getProperty(HybridCorefProperties.GENDER_NUMBER_PROP,</span>
                    DefaultPaths.DEFAULT_DCOREF_GENDER_NUMBER));
<span class="nc" id="L647">    os.append(HybridCorefProperties.COUNTRIES_PROP + &quot;:&quot; +</span>
<span class="nc" id="L648">            props.getProperty(HybridCorefProperties.COUNTRIES_PROP,</span>
                    DefaultPaths.DEFAULT_DCOREF_COUNTRIES));
<span class="nc" id="L650">    os.append(HybridCorefProperties.STATES_PROVINCES_PROP + &quot;:&quot; +</span>
<span class="nc" id="L651">            props.getProperty(HybridCorefProperties.STATES_PROVINCES_PROP,</span>
                    DefaultPaths.DEFAULT_DCOREF_STATES_AND_PROVINCES));
<span class="nc" id="L653">    return os.toString();</span>
  }

  public Dictionaries(
      String language,
      String demonymWords,
      String animateWords,
      String inanimateWords,
      String maleWords,
      String neutralWords,
      String femaleWords,
      String pluralWords,
      String singularWords,
      String statesWords,
      String genderNumber,
      String countries,
      String states,
      boolean loadCorefDict,
      String[] corefDictFiles,
      String corefDictPMIFile,
<span class="nc" id="L673">      String signaturesFile) {</span>
<span class="nc" id="L674">    Locale lang = Locale.forLanguageTag(language);</span>
<span class="nc" id="L675">    readWordLists(lang);</span>
<span class="nc" id="L676">    loadDemonymLists(demonymWords);</span>
<span class="nc" id="L677">    loadStateAbbreviation(statesWords);</span>
<span class="nc" id="L678">    loadAnimacyLists(animateWords, inanimateWords);</span>
<span class="nc" id="L679">    loadGenderLists(maleWords, neutralWords, femaleWords);</span>
<span class="nc" id="L680">    loadNumberLists(pluralWords, singularWords);</span>
<span class="nc" id="L681">    loadGenderNumber(genderNumber, neutralWords);</span>
<span class="nc" id="L682">    loadCountriesLists(countries);</span>
<span class="nc" id="L683">    loadStatesLists(states);</span>
<span class="nc" id="L684">    setPronouns();</span>
<span class="nc bnc" id="L685" title="All 2 branches missed.">    if(loadCorefDict){</span>
<span class="nc" id="L686">      loadCorefDict(corefDictFiles, corefDict);</span>
<span class="nc" id="L687">      loadCorefDictPMI(corefDictPMIFile, corefDictPMI);</span>
<span class="nc" id="L688">      loadSignatures(signaturesFile, NE_signatures);</span>
    }
<span class="nc" id="L690">  }</span>

  public Dictionaries() throws ClassNotFoundException, IOException {
<span class="nc" id="L693">    this(new Properties());</span>
<span class="nc" id="L694">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>