<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Mention.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Stanford CoreNLP</a> &gt; <a href="index.source.html" class="el_package">edu.stanford.nlp.coref.data</a> &gt; <span class="el_source">Mention.java</span></div><h1>Mention.java</h1><pre class="source lang-java linenums">//
// StanfordCoreNLP -- a suite of NLP tools
// Copyright (c) 2009-2010 The Board of Trustees of
// The Leland Stanford Junior University. All Rights Reserved.
//
// This program is free software; you can redistribute it and/or
// modify it under the terms of the GNU General Public License
// as published by the Free Software Foundation; either version 2
// of the License, or (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
//
// For more information, bug reports, fixes, contact:
//    Christopher Manning
//    Dept of Computer Science, Gates 1A
//    Stanford CA 94305-9010
//    USA
//

package edu.stanford.nlp.coref.data;

import java.io.Serializable;
import java.lang.reflect.Method;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.List;
import java.util.Locale;
import java.util.Objects;
import java.util.Set;

import edu.stanford.nlp.coref.data.Dictionaries.Animacy;
import edu.stanford.nlp.coref.data.Dictionaries.Gender;
import edu.stanford.nlp.coref.data.Dictionaries.MentionType;
import edu.stanford.nlp.coref.data.Dictionaries.Number;
import edu.stanford.nlp.coref.data.Dictionaries.Person;

import edu.stanford.nlp.classify.LogisticClassifier;
import edu.stanford.nlp.ling.AbstractCoreLabel;
import edu.stanford.nlp.ling.BasicDatum;
import edu.stanford.nlp.ling.CoreAnnotation;
import edu.stanford.nlp.ling.CoreAnnotations;
import edu.stanford.nlp.ling.CoreLabel;
import edu.stanford.nlp.ling.IndexedWord;
import edu.stanford.nlp.semgraph.SemanticGraph;
import edu.stanford.nlp.semgraph.semgrex.SemgrexMatcher;
import edu.stanford.nlp.semgraph.semgrex.SemgrexPattern;
import edu.stanford.nlp.stats.IntCounter;
import edu.stanford.nlp.trees.GrammaticalRelation;
import edu.stanford.nlp.trees.Tree;
import edu.stanford.nlp.trees.UniversalEnglishGrammaticalRelations;
import edu.stanford.nlp.util.*;

/**
 * One mention for the SieveCoreferenceSystem.
 *
 * @author Jenny Finkel, Karthik Raghunathan, Heeyoung Lee, Marta Recasens
 */
<span class="nc bnc" id="L66" title="All 2 branches missed.">public class Mention implements CoreAnnotation&lt;Mention&gt;, Serializable {</span>

  private static final long serialVersionUID = -7524485803945717057L;

<span class="nc" id="L70">  public Mention() {</span>
<span class="nc" id="L71">  }</span>

<span class="nc" id="L73">  public Mention(int mentionID, int startIndex, int endIndex, List&lt;CoreLabel&gt; sentenceWords, SemanticGraph basicDependency, SemanticGraph enhancedDependency){</span>
<span class="nc" id="L74">    this.mentionID = mentionID;</span>
<span class="nc" id="L75">    this.startIndex = startIndex;</span>
<span class="nc" id="L76">    this.endIndex = endIndex;</span>
<span class="nc" id="L77">    this.sentenceWords = sentenceWords;</span>
<span class="nc" id="L78">    this.basicDependency = basicDependency;</span>
<span class="nc" id="L79">    this.enhancedDependency = enhancedDependency;</span>
<span class="nc" id="L80">  }</span>

  public Mention(int mentionID, int startIndex, int endIndex, List&lt;CoreLabel&gt; sentenceWords, SemanticGraph basicDependency, SemanticGraph enhancedDependency, List&lt;CoreLabel&gt; mentionSpan){
<span class="nc" id="L83">    this(mentionID, startIndex, endIndex, sentenceWords, basicDependency, enhancedDependency);</span>
<span class="nc" id="L84">    this.originalSpan = mentionSpan;</span>
<span class="nc" id="L85">  }</span>

  public Mention(int mentionID, int startIndex, int endIndex, List&lt;CoreLabel&gt; sentenceWords, SemanticGraph basicDependency, SemanticGraph enhancedDependency, List&lt;CoreLabel&gt; mentionSpan, Tree mentionTree){
<span class="nc" id="L88">    this(mentionID, startIndex, endIndex, sentenceWords, basicDependency, enhancedDependency, mentionSpan);</span>
<span class="nc" id="L89">    this.mentionSubTree = mentionTree;</span>
<span class="nc" id="L90">  }</span>

  public MentionType mentionType;
  public Number number;
  public Gender gender;
  public Animacy animacy;
  public Person person;
  public String headString;
  public String nerString;

  public int startIndex;
  public int endIndex;
  public int headIndex;
<span class="nc" id="L103">  public int mentionID = -1;</span>
<span class="nc" id="L104">  public int originalRef = -1;</span>
  public IndexedWord headIndexedWord;

<span class="nc" id="L107">  public int goldCorefClusterID = -1;</span>
<span class="nc" id="L108">  public int corefClusterID = -1;</span>
  public int mentionNum;
<span class="nc" id="L110">  public int sentNum = -1;</span>
<span class="nc" id="L111">  public int utter = -1;</span>
<span class="nc" id="L112">  public int paragraph = -1;</span>
  public boolean isSubject;
  public boolean isDirectObject;
  public boolean isIndirectObject;
  public boolean isPrepositionObject;
  public IndexedWord dependingVerb;
<span class="nc" id="L118">  public boolean hasTwin = false;</span>
<span class="nc" id="L119">  public boolean generic = false;   // generic pronoun or generic noun (bare plurals)</span>
  public boolean isSingleton;

  public List&lt;CoreLabel&gt; sentenceWords;
  public List&lt;CoreLabel&gt; originalSpan;

  public Tree mentionSubTree;
  public Tree contextParseTree;
  public CoreLabel headWord;
  public SemanticGraph basicDependency;
  public SemanticGraph enhancedDependency;

<span class="nc" id="L131">  public Set&lt;String&gt; dependents = Generics.newHashSet();</span>
  public List&lt;String&gt; preprocessedTerms;
  public Object synsets;

  /** Set of other mentions in the same sentence that are syntactic appositions to this */
<span class="nc" id="L136">  public Set&lt;Mention&gt; appositions = null;</span>
<span class="nc" id="L137">  public Set&lt;Mention&gt; predicateNominatives = null;</span>
<span class="nc" id="L138">  public Set&lt;Mention&gt; relativePronouns = null;</span>

  /** Set of other mentions in the same sentence that below to this list */
<span class="nc" id="L141">  public Set&lt;Mention&gt; listMembers = null;</span>
  /** Set of other mentions in the same sentence that I am a member of */
<span class="nc" id="L143">  public Set&lt;Mention&gt; belongToLists = null;</span>

  // Mention is identified as being this speaker....
  public SpeakerInfo speakerInfo;

<span class="nc" id="L148">  transient private String spanString = null;</span>
<span class="nc" id="L149">  transient private String lowercaseNormalizedSpanString = null;</span>

<span class="nc" id="L151">  public IntCounter&lt;Integer&gt; antecedentOrdering = new IntCounter&lt;&gt;();</span>

  @Override
  public Class&lt;Mention&gt; getType() {
<span class="nc" id="L155">    return Mention.class;</span>
  }

  public boolean isPronominal() {
<span class="nc bnc" id="L159" title="All 2 branches missed.">    return mentionType == MentionType.PRONOMINAL;</span>
  }

  @Override
  public String toString() {
<span class="nc" id="L164">    return spanToString();</span>
  }

  public String spanToString() {
//    synchronized(this) {
<span class="nc bnc" id="L169" title="All 2 branches missed.">      if (spanString == null) {</span>
<span class="nc" id="L170">        StringBuilder os = new StringBuilder();</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">        for(int i = 0; i &lt; originalSpan.size(); i ++){</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">          if(i &gt; 0) os.append(&quot; &quot;);</span>
<span class="nc" id="L173">          os.append(originalSpan.get(i).get(CoreAnnotations.TextAnnotation.class));</span>
        }
<span class="nc" id="L175">        spanString = os.toString();</span>
      }
//    }
<span class="nc" id="L178">    return spanString;</span>
  }

  public String lowercaseNormalizedSpanString() {
//    synchronized(this) {
<span class="nc bnc" id="L183" title="All 2 branches missed.">      if (lowercaseNormalizedSpanString == null) {</span>
        // We always normalize to lowercase!!!
<span class="nc" id="L185">        lowercaseNormalizedSpanString = spanToString().toLowerCase();</span>
      }
//    }
<span class="nc" id="L188">    return lowercaseNormalizedSpanString;</span>
  }

  // Retrieves part of the span that corresponds to the NER (going out from head)
  public List&lt;CoreLabel&gt; nerTokens() {
<span class="nc bnc" id="L193" title="All 4 branches missed.">    if (nerString == null || &quot;O&quot;.equals(nerString)) return null;</span>

<span class="nc" id="L195">    int start = headIndex-startIndex;</span>
<span class="nc" id="L196">    int end = headIndex-startIndex+1;</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">    while (start &gt; 0) {</span>
<span class="nc" id="L198">      CoreLabel prev = originalSpan.get(start-1);</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">      if (nerString.equals(prev.ner())) {</span>
<span class="nc" id="L200">        start--;</span>
      } else {
        break;
      }
<span class="nc" id="L204">    }</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">    while (end &lt; originalSpan.size()) {</span>
<span class="nc" id="L206">      CoreLabel next = originalSpan.get(end);</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">      if (nerString.equals(next.ner())) {</span>
<span class="nc" id="L208">        end++;</span>
      } else {
        break;
      }
<span class="nc" id="L212">    }</span>
<span class="nc" id="L213">    return originalSpan.subList(start, end);</span>
  }

  // Retrieves part of the span that corresponds to the NER (going out from head)
  public String nerName() {
<span class="nc" id="L218">    List&lt;CoreLabel&gt; t = nerTokens();</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">    return (t != null)? StringUtils.joinWords(t, &quot; &quot;):null;</span>
  }

  /** Set attributes of a mention:
   * head string, mention type, NER label, Number, Gender, Animacy
   * @throws Exception
   */
  public void process(Dictionaries dict, Semantics semantics) throws Exception {
<span class="nc" id="L227">    setHeadString();</span>
<span class="nc" id="L228">    setType(dict);</span>
<span class="nc" id="L229">    setNERString();</span>
<span class="nc" id="L230">    List&lt;String&gt; mStr = getMentionString();</span>
<span class="nc" id="L231">    setNumber(dict);</span>
<span class="nc" id="L232">    setGender(dict, getGender(dict, mStr));</span>
<span class="nc" id="L233">    setAnimacy(dict);</span>
<span class="nc" id="L234">    setPerson(dict);</span>
<span class="nc" id="L235">    setDiscourse();</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">    if(semantics!=null) setSemantics(dict, semantics);</span>
<span class="nc" id="L237">  }</span>

  public void process(Dictionaries dict, Semantics semantics,
      LogisticClassifier&lt;String, String&gt; singletonPredictor) throws Exception {
<span class="nc" id="L241">    process(dict, semantics);</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">    if(singletonPredictor != null) setSingleton(singletonPredictor, dict);</span>
<span class="nc" id="L243">  }</span>

  private void setSingleton(LogisticClassifier&lt;String, String&gt; predictor, Dictionaries dict){
<span class="nc" id="L246">    double coreference_score = predictor.probabilityOf(</span>
<span class="nc" id="L247">            new BasicDatum&lt;&gt;(getSingletonFeatures(dict), &quot;1&quot;));</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">    if(coreference_score &lt; 0.2) this.isSingleton = true;</span>
<span class="nc" id="L249">  }</span>

  /**
   * Returns the features used by the singleton predictor (logistic
   * classifier) to decide whether the mention belongs to a singleton entity
   */
  public ArrayList&lt;String&gt; getSingletonFeatures(Dictionaries dict){
<span class="nc" id="L256">    ArrayList&lt;String&gt; features = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L257">    features.add(mentionType.toString());</span>
<span class="nc" id="L258">    features.add(nerString);</span>
<span class="nc" id="L259">    features.add(animacy.toString());</span>

<span class="nc" id="L261">    int personNum = 3;</span>
<span class="nc bnc" id="L262" title="All 4 branches missed.">    if(person.equals(Person.I) || person.equals(Person.WE)) personNum = 1;</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">    if(person.equals(Person.YOU)) personNum = 2;</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">    if(person.equals(Person.UNKNOWN)) personNum = 0;</span>
<span class="nc" id="L265">    features.add(String.valueOf(personNum));</span>
<span class="nc" id="L266">    features.add(number.toString());</span>
<span class="nc" id="L267">    features.add(getPosition());</span>
<span class="nc" id="L268">    features.add(getRelation());</span>
<span class="nc" id="L269">    features.add(getQuantification(dict));</span>
<span class="nc" id="L270">    features.add(String.valueOf(getModifiers(dict)));</span>
<span class="nc" id="L271">    features.add(String.valueOf(getNegation(dict)));</span>
<span class="nc" id="L272">    features.add(String.valueOf(getModal(dict)));</span>
<span class="nc" id="L273">    features.add(String.valueOf(getReportEmbedding(dict)));</span>
<span class="nc" id="L274">    features.add(String.valueOf(getCoordination()));</span>

<span class="nc" id="L276">    return features;</span>
  }

  private List&lt;String&gt; getMentionString() {
<span class="nc" id="L280">    List&lt;String&gt; mStr = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">    for(CoreLabel l : this.originalSpan) {</span>
<span class="nc" id="L282">      mStr.add(l.get(CoreAnnotations.TextAnnotation.class).toLowerCase());</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">      if(l==this.headWord) break;   // remove words after headword</span>
<span class="nc" id="L284">    }</span>
<span class="nc" id="L285">    return mStr;</span>
  }

  private Gender getGender(Dictionaries dict, List&lt;String&gt; mStr) {
<span class="nc" id="L289">    int len = mStr.size();</span>
<span class="nc" id="L290">    char firstLetter = headWord.get(CoreAnnotations.TextAnnotation.class).charAt(0);</span>
<span class="nc bnc" id="L291" title="All 6 branches missed.">    if(len &gt; 1 &amp;&amp; Character.isUpperCase(firstLetter) &amp;&amp; nerString.startsWith(&quot;PER&quot;)) {</span>
<span class="nc" id="L292">      int firstNameIdx = len-2;</span>
<span class="nc" id="L293">      String secondToLast = mStr.get(firstNameIdx);</span>
<span class="nc bnc" id="L294" title="All 8 branches missed.">      if(firstNameIdx &gt; 1 &amp;&amp; (secondToLast.length()==1 || (secondToLast.length()==2 &amp;&amp; secondToLast.endsWith(&quot;.&quot;)))) {</span>
<span class="nc" id="L295">        firstNameIdx--;</span>
      }

<span class="nc bnc" id="L298" title="All 2 branches missed.">      for(int i = 0 ; i &lt;= firstNameIdx ; i++){</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">        if(dict.genderNumber.containsKey(mStr.subList(i, len))) return dict.genderNumber.get(mStr.subList(i, len));</span>
      }

      // find converted string with ! (e.g., &quot;dr. martin luther king jr. boulevard&quot; -&gt; &quot;dr. !&quot;)
<span class="nc" id="L303">      List&lt;String&gt; convertedStr = new ArrayList&lt;&gt;(2);</span>
<span class="nc" id="L304">      convertedStr.add(mStr.get(firstNameIdx));</span>
<span class="nc" id="L305">      convertedStr.add(&quot;!&quot;);</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">      if(dict.genderNumber.containsKey(convertedStr)) return dict.genderNumber.get(convertedStr);</span>

<span class="nc bnc" id="L308" title="All 2 branches missed.">      if(dict.genderNumber.containsKey(mStr.subList(firstNameIdx, firstNameIdx+1))) return dict.genderNumber.get(mStr.subList(firstNameIdx, firstNameIdx+1));</span>
    }

<span class="nc bnc" id="L311" title="All 4 branches missed.">    if(mStr.size() &gt; 0 &amp;&amp; dict.genderNumber.containsKey(mStr.subList(len-1, len))) return dict.genderNumber.get(mStr.subList(len-1, len));</span>
<span class="nc" id="L312">    return null;</span>
  }
  private void setDiscourse() {
//    utter = headWord.get(CoreAnnotations.UtteranceAnnotation.class);

<span class="nc" id="L317">    Pair&lt;IndexedWord, String&gt; verbDependency = findDependentVerb(this);</span>
<span class="nc" id="L318">    String dep = verbDependency.second();</span>
<span class="nc" id="L319">    dependingVerb = verbDependency.first();</span>

<span class="nc" id="L321">    isSubject = false;</span>
<span class="nc" id="L322">    isDirectObject = false;</span>
<span class="nc" id="L323">    isIndirectObject = false;</span>
<span class="nc" id="L324">    isPrepositionObject = false;</span>

<span class="nc bnc" id="L326" title="All 2 branches missed.">    if(dep==null) {</span>
<span class="nc" id="L327">      return;</span>
<span class="nc bnc" id="L328" title="All 4 branches missed.">    } else if(dep.equals(&quot;nsubj&quot;) || dep.equals(&quot;csubj&quot;)) {</span>
<span class="nc" id="L329">      isSubject = true;</span>
<span class="nc bnc" id="L330" title="All 4 branches missed.">    } else if(dep.equals(&quot;dobj&quot;) || dep.equals(&quot;nsubjpass&quot;)){</span>
<span class="nc" id="L331">      isDirectObject = true;</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">    } else if(dep.equals(&quot;iobj&quot;)){</span>
<span class="nc" id="L333">      isIndirectObject = true;</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">    } else if(dep.startsWith(&quot;nmod&quot;)</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">        &amp;&amp; ! dep.equals(&quot;nmod:npmod&quot;)</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">        &amp;&amp; ! dep.equals(&quot;nmod:tmod&quot;)</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">        &amp;&amp; ! dep.equals(&quot;nmod:poss&quot;)</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">        &amp;&amp; ! dep.equals(&quot;nmod:agent&quot;)) {</span>
<span class="nc" id="L339">      isPrepositionObject = true;</span>
    }
<span class="nc" id="L341">  }</span>

  private void setPerson(Dictionaries dict) {
    // only do for pronoun
<span class="nc bnc" id="L345" title="All 2 branches missed.">    if(!this.isPronominal()) {</span>
<span class="nc" id="L346">      person = Person.UNKNOWN;</span>
<span class="nc" id="L347">      return;</span>
    }
<span class="nc" id="L349">    String spanToString = this.spanToString().toLowerCase();</span>

<span class="nc bnc" id="L351" title="All 2 branches missed.">    if(dict.firstPersonPronouns.contains(spanToString)) {</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">      if (number == Number.SINGULAR) {</span>
<span class="nc" id="L353">        person = Person.I;</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">      } else if (number == Number.PLURAL) {</span>
<span class="nc" id="L355">        person = Person.WE;</span>
      } else {
<span class="nc" id="L357">        person = Person.UNKNOWN;</span>
      }
<span class="nc bnc" id="L359" title="All 2 branches missed.">    } else if(dict.secondPersonPronouns.contains(spanToString)) {</span>
<span class="nc" id="L360">      person = Person.YOU;</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">    } else if(dict.thirdPersonPronouns.contains(spanToString)) {</span>
<span class="nc bnc" id="L362" title="All 4 branches missed.">      if (gender == Gender.MALE &amp;&amp; number == Number.SINGULAR) {</span>
<span class="nc" id="L363">        person = Person.HE;</span>
<span class="nc bnc" id="L364" title="All 4 branches missed.">      } else if (gender == Gender.FEMALE &amp;&amp; number == Number.SINGULAR) {</span>
<span class="nc" id="L365">        person = Person.SHE;</span>
<span class="nc bnc" id="L366" title="All 6 branches missed.">      } else if ((gender == Gender.NEUTRAL || animacy == Animacy.INANIMATE) &amp;&amp; number == Number.SINGULAR) {</span>
<span class="nc" id="L367">        person = Person.IT;</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">      } else if (number == Number.PLURAL) {</span>
<span class="nc" id="L369">        person = Person.THEY;</span>
      } else {
<span class="nc" id="L371">        person = Person.UNKNOWN;</span>
      }
    } else {
<span class="nc" id="L374">      person = Person.UNKNOWN;</span>
    }
<span class="nc" id="L376">  }</span>

  private void setSemantics(Dictionaries dict, Semantics semantics) throws Exception {

<span class="nc" id="L380">    preprocessedTerms = this.preprocessSearchTerm();</span>

<span class="nc bnc" id="L382" title="All 2 branches missed.">    if(dict.statesAbbreviation.containsKey(this.spanToString())) {  // states abbreviations</span>
<span class="nc" id="L383">      preprocessedTerms = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L384">      preprocessedTerms.add(dict.statesAbbreviation.get(this.spanToString()));</span>
    }

<span class="nc" id="L387">    Method meth = semantics.wordnet.getClass().getDeclaredMethod(&quot;findSynset&quot;, List.class);</span>
<span class="nc" id="L388">    synsets = meth.invoke(semantics.wordnet, new Object[]{preprocessedTerms});</span>

<span class="nc bnc" id="L390" title="All 2 branches missed.">    if(this.isPronominal()) return;</span>
<span class="nc" id="L391">  }</span>

  /** Check list member? True if this mention is inside the other mention and the other mention is a list */
  public boolean isListMemberOf(Mention m) {
<span class="nc bnc" id="L395" title="All 2 branches missed.">    if (this.equals(m)) return false;</span>
<span class="nc bnc" id="L396" title="All 4 branches missed.">    if (m.mentionType == MentionType.LIST &amp;&amp; this.mentionType == MentionType.LIST) return false; // Don't handle nested lists</span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">    if (m.mentionType == MentionType.LIST) {</span>
<span class="nc" id="L398">      return this.includedIn(m);</span>
    }
<span class="nc" id="L400">    return false;</span>
  }

  public void addListMember(Mention m) {
<span class="nc bnc" id="L404" title="All 2 branches missed.">    if(listMembers == null) listMembers = Generics.newHashSet();</span>
<span class="nc" id="L405">    listMembers.add(m);</span>
<span class="nc" id="L406">  }</span>

  public void addBelongsToList(Mention m) {
<span class="nc bnc" id="L409" title="All 2 branches missed.">    if(belongToLists == null) belongToLists = Generics.newHashSet();</span>
<span class="nc" id="L410">    belongToLists.add(m);</span>
<span class="nc" id="L411">  }</span>

  public boolean isMemberOfSameList(Mention m) {
<span class="nc" id="L414">    Set&lt;Mention&gt; l1 = belongToLists;</span>
<span class="nc" id="L415">    Set&lt;Mention&gt; l2 = m.belongToLists;</span>
<span class="nc bnc" id="L416" title="All 6 branches missed.">    if (l1 != null &amp;&amp; l2 != null &amp;&amp; CollectionUtils.containsAny(l1, l2)) {</span>
<span class="nc" id="L417">      return true;</span>
    } else {
<span class="nc" id="L419">      return false;</span>
    }
  }

  private boolean isListLike() {
    // See if this mention looks to be a conjunction of things
    // Check for &quot;or&quot; and &quot;and&quot; and &quot;,&quot;
<span class="nc" id="L426">    int commas = 0;</span>
//    boolean firstLabelLike = false;
//    if (originalSpan.size() &gt; 1) {
//      String w = originalSpan.get(1).word();
//      firstLabelLike = (w.equals(&quot;:&quot;) || w.equals(&quot;-&quot;));
//    }
<span class="nc" id="L432">    String mentionSpanString = spanToString();</span>
<span class="nc" id="L433">    String subTreeSpanString = StringUtils.joinWords(mentionSubTree.yieldWords(), &quot; &quot;);</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">    if (subTreeSpanString.equals(mentionSpanString)) {</span>
      // subtree represents this mention well....
<span class="nc" id="L436">      List&lt;Tree&gt; children = mentionSubTree.getChildrenAsList();</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">      for (Tree t:children) {</span>
<span class="nc" id="L438">        String label = t.value();</span>
<span class="nc" id="L439">        String ner = null;</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">        if (t.isLeaf()) { ner = ((CoreLabel) t.getLeaves().get(0).label()).ner(); }</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">        if (&quot;CC&quot;.equals(label)) {</span>
          // Check NER type
<span class="nc bnc" id="L443" title="All 4 branches missed.">          if (ner == null || &quot;O&quot;.equals(ner)) {</span>
<span class="nc" id="L444">            return true;</span>
          }
<span class="nc bnc" id="L446" title="All 2 branches missed.">        } else if (label.equals(&quot;,&quot;)) {</span>
<span class="nc bnc" id="L447" title="All 4 branches missed.">          if (ner == null || &quot;O&quot;.equals(ner)) {</span>
<span class="nc" id="L448">            commas++;</span>
          }
        }
<span class="nc" id="L451">      }</span>
    }

<span class="nc bnc" id="L454" title="All 2 branches missed.">    if (commas &lt;= 2) {</span>
      // look at the string for and/or
<span class="nc" id="L456">      boolean first = true;</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">      for (CoreLabel t:originalSpan) {</span>
<span class="nc" id="L458">        String tag = t.tag();</span>
<span class="nc" id="L459">        String ner = t.ner();</span>
<span class="nc" id="L460">        String w = t.word();</span>
<span class="nc bnc" id="L461" title="All 6 branches missed.">        if (tag.equals(&quot;TO&quot;) || tag.equals(&quot;IN&quot;) || tag.startsWith(&quot;VB&quot;)) {</span>
          // prepositions and verbs are too hard for us
<span class="nc" id="L463">          return false;</span>
        }
<span class="nc bnc" id="L465" title="All 2 branches missed.">        if (!first) {</span>
<span class="nc bnc" id="L466" title="All 4 branches missed.">          if (w.equalsIgnoreCase(&quot;and&quot;) || w.equalsIgnoreCase(&quot;or&quot;)) {</span>
            // Check NER type
<span class="nc bnc" id="L468" title="All 4 branches missed.">            if (ner == null || &quot;O&quot;.equals(ner)) {</span>
<span class="nc" id="L469">              return true;</span>
            }
          }
        }
<span class="nc" id="L473">        first = false;</span>
<span class="nc" id="L474">      }</span>
    }

<span class="nc bnc" id="L477" title="All 2 branches missed.">    return (commas &gt; 2);</span>
  }
  private boolean isListLikeByDependency() {
<span class="nc bnc" id="L480" title="All 2 branches missed.">    if(this.headIndexedWord==null) return false;    // probably parser error: default is not LIST</span>
<span class="nc" id="L481">    IndexedWord conj = this.basicDependency.getChildWithReln(this.headIndexedWord, UniversalEnglishGrammaticalRelations.CONJUNCT);</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">    boolean hasConjunction = (conj!=null);</span>
<span class="nc bnc" id="L483" title="All 6 branches missed.">    boolean conjInMention = (hasConjunction)? this.startIndex &lt; conj.index()-1 &amp;&amp; conj.index()-1 &lt; this.endIndex : false;</span>
<span class="nc" id="L484">    return conjInMention;</span>
  }

  private void setType(Dictionaries dict) {
<span class="nc bnc" id="L488" title="All 6 branches missed.">    if ((this.mentionSubTree!=null &amp;&amp; isListLike())</span>
<span class="nc bnc" id="L489" title="All 2 branches missed.">        || (this.mentionSubTree==null &amp;&amp; isListLikeByDependency()) ) {</span>
<span class="nc" id="L490">      mentionType = MentionType.LIST;</span>
      //Redwood.log(&quot;debug-mention&quot;, &quot;IS LIST: &quot; + this);
<span class="nc bnc" id="L492" title="All 2 branches missed.">    } else if (headWord.containsKey(CoreAnnotations.EntityTypeAnnotation.class)){    // ACE gold mention type</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">      if (headWord.get(CoreAnnotations.EntityTypeAnnotation.class).equals(&quot;PRO&quot;)) {</span>
<span class="nc" id="L494">        mentionType = MentionType.PRONOMINAL;</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">      } else if (headWord.get(CoreAnnotations.EntityTypeAnnotation.class).equals(&quot;NAM&quot;)) {</span>
<span class="nc" id="L496">        mentionType = MentionType.PROPER;</span>
      } else {
<span class="nc" id="L498">        mentionType = MentionType.NOMINAL;</span>
      }
    } else {    // MUC
<span class="nc bnc" id="L501" title="All 2 branches missed.">      if(!headWord.containsKey(CoreAnnotations.NamedEntityTagAnnotation.class)) {   // temporary fix</span>
<span class="nc" id="L502">        mentionType = MentionType.NOMINAL;</span>
        //Redwood.log(&quot;debug-mention&quot;, &quot;no NamedEntityTagAnnotation: &quot;+headWord);
<span class="nc bnc" id="L504" title="All 4 branches missed.">      } else if (headWord.tag().startsWith(&quot;PRP&quot;) || headWord.tag().startsWith(&quot;PN&quot;)</span>
<span class="nc bnc" id="L505" title="All 4 branches missed.">          || (originalSpan.size() == 1 &amp;&amp; headWord.get(CoreAnnotations.NamedEntityTagAnnotation.class).equals(&quot;O&quot;)</span>
<span class="nc bnc" id="L506" title="All 4 branches missed.">              &amp;&amp; (dict.allPronouns.contains(headString) || dict.relativePronouns.contains(headString) ))) {</span>
<span class="nc" id="L507">        mentionType = MentionType.PRONOMINAL;</span>
<span class="nc bnc" id="L508" title="All 4 branches missed.">      } else if (!headWord.get(CoreAnnotations.NamedEntityTagAnnotation.class).equals(&quot;O&quot;) || headWord.get(CoreAnnotations.PartOfSpeechAnnotation.class).startsWith(&quot;NNP&quot;)) {</span>
<span class="nc" id="L509">        mentionType = MentionType.PROPER;</span>
      } else {
<span class="nc" id="L511">        mentionType = MentionType.NOMINAL;</span>
      }
    }
<span class="nc" id="L514">  }</span>

  private void setGender(Dictionaries dict, Gender genderNumberResult) {
<span class="nc" id="L517">    gender = Gender.UNKNOWN;</span>
<span class="nc bnc" id="L518" title="All 4 branches missed.">    if(genderNumberResult!=null &amp;&amp; this.number!=Number.PLURAL){</span>
<span class="nc" id="L519">      gender = genderNumberResult;</span>
    }
<span class="nc bnc" id="L521" title="All 2 branches missed.">    if (mentionType == MentionType.PRONOMINAL) {</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">      if (dict.malePronouns.contains(headString)) {</span>
<span class="nc" id="L523">        gender = Gender.MALE;</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">      } else if (dict.femalePronouns.contains(headString)) {</span>
<span class="nc" id="L525">        gender = Gender.FEMALE;</span>
      }
    } else {
      // Bergsma or user provided list
<span class="nc bnc" id="L529" title="All 2 branches missed.">      if(gender == Gender.UNKNOWN)  {</span>
<span class="nc bnc" id="L530" title="All 4 branches missed.">        if (&quot;PERSON&quot;.equals(nerString) || &quot;PER&quot;.equals(nerString)) {</span>
          // Try to get gender of the named entity
          // Start with first name until we get gender...
<span class="nc" id="L533">          List&lt;CoreLabel&gt; nerToks = nerTokens();</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">          for (CoreLabel t:nerToks) {</span>
<span class="nc" id="L535">            String name = t.word().toLowerCase();</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">            if(dict.maleWords.contains(name)) {</span>
<span class="nc" id="L537">              gender = Gender.MALE;</span>
<span class="nc" id="L538">              break;</span>
            }
<span class="nc bnc" id="L540" title="All 2 branches missed.">            else if(dict.femaleWords.contains(name))  {</span>
<span class="nc" id="L541">              gender = Gender.FEMALE;</span>
<span class="nc" id="L542">              break;</span>
            }
<span class="nc" id="L544">          }</span>
<span class="nc" id="L545">        } else {</span>
<span class="nc bnc" id="L546" title="All 2 branches missed.">          if(dict.maleWords.contains(headString)) {</span>
<span class="nc" id="L547">            gender = Gender.MALE;</span>
          }
<span class="nc bnc" id="L549" title="All 2 branches missed.">          else if(dict.femaleWords.contains(headString))  {</span>
<span class="nc" id="L550">            gender = Gender.FEMALE;</span>
          }
<span class="nc bnc" id="L552" title="All 2 branches missed.">          else if(dict.neutralWords.contains(headString))   {</span>
<span class="nc" id="L553">            gender = Gender.NEUTRAL;</span>
          }
        }
      }
    }
<span class="nc" id="L558">  }</span>

  protected void setNumber(Dictionaries dict) {
<span class="nc bnc" id="L561" title="All 2 branches missed.">    if (mentionType == MentionType.PRONOMINAL) {</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">      if (dict.pluralPronouns.contains(headString)) {</span>
<span class="nc" id="L563">        number = Number.PLURAL;</span>
<span class="nc bnc" id="L564" title="All 2 branches missed.">      } else if (dict.singularPronouns.contains(headString)) {</span>
<span class="nc" id="L565">        number = Number.SINGULAR;</span>
      } else {
<span class="nc" id="L567">        number = Number.UNKNOWN;</span>
      }
<span class="nc bnc" id="L569" title="All 2 branches missed.">    } else if (mentionType == MentionType.LIST) {</span>
<span class="nc" id="L570">      number = Number.PLURAL;</span>
<span class="nc bnc" id="L571" title="All 4 branches missed.">    } else if(! nerString.equals(&quot;O&quot;) &amp;&amp; mentionType!=MentionType.NOMINAL){</span>
      // Check to see if this is a list of things
<span class="nc bnc" id="L573" title="All 4 branches missed.">      if(! (nerString.equals(&quot;ORGANIZATION&quot;) || nerString.startsWith(&quot;ORG&quot;))){</span>
<span class="nc" id="L574">        number = Number.SINGULAR;</span>
      } else {
        // ORGs can be both plural and singular
<span class="nc" id="L577">        number = Number.UNKNOWN;</span>
      }
    } else {
<span class="nc" id="L580">      String tag = headWord.get(CoreAnnotations.PartOfSpeechAnnotation.class);</span>
<span class="nc bnc" id="L581" title="All 4 branches missed.">      if (tag.startsWith(&quot;N&quot;) &amp;&amp; tag.endsWith(&quot;S&quot;)) {</span>
<span class="nc" id="L582">        number = Number.PLURAL;</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">      } else if (tag.startsWith(&quot;N&quot;)) {</span>
<span class="nc" id="L584">        number = Number.SINGULAR;</span>
      } else {
<span class="nc" id="L586">        number = Number.UNKNOWN;</span>
      }
    }

<span class="nc bnc" id="L590" title="All 2 branches missed.">    if(mentionType != MentionType.PRONOMINAL) {</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">      if(number == Number.UNKNOWN){</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">        if(dict.singularWords.contains(headString)) {</span>
<span class="nc" id="L593">          number = Number.SINGULAR;</span>
        }
<span class="nc bnc" id="L595" title="All 2 branches missed.">        else if(dict.pluralWords.contains(headString))  {</span>
<span class="nc" id="L596">          number = Number.PLURAL;</span>
        }
      }

//      // replace this with LIST mention type
//      if(Constants.USE_CONSTITUENT) {
//        final String enumerationPattern = &quot;NP &lt; (NP=tmp $.. (/,|CC/ $.. NP))&quot;;
//
//        TregexPattern tgrepPattern = TregexPattern.compile(enumerationPattern);
//        TregexMatcher m = tgrepPattern.matcher(this.mentionSubTree);
//        while (m.find()) {
//          //        Tree t = m.getMatch();
//          if(this.mentionSubTree==m.getNode(&quot;tmp&quot;)
//              &amp;&amp; this.spanToString().toLowerCase().contains(&quot; and &quot;)) {
//            number = Number.PLURAL;
//          }
//        }
//      }
    }
<span class="nc" id="L615">  }</span>

  private void setAnimacy(Dictionaries dict) {
<span class="nc bnc" id="L618" title="All 2 branches missed.">    if (mentionType == MentionType.PRONOMINAL) {</span>
<span class="nc bnc" id="L619" title="All 2 branches missed.">      if (dict.animatePronouns.contains(headString)) {</span>
<span class="nc" id="L620">        animacy = Animacy.ANIMATE;</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">      } else if (dict.inanimatePronouns.contains(headString)) {</span>
<span class="nc" id="L622">        animacy = Animacy.INANIMATE;</span>
      } else {
<span class="nc" id="L624">        animacy = Animacy.UNKNOWN;</span>
      }
<span class="nc bnc" id="L626" title="All 4 branches missed.">    } else if (nerString.equals(&quot;PERSON&quot;) || nerString.startsWith(&quot;PER&quot;)) {</span>
<span class="nc" id="L627">      animacy = Animacy.ANIMATE;</span>
<span class="nc bnc" id="L628" title="All 4 branches missed.">    } else if (nerString.equals(&quot;LOCATION&quot;)|| nerString.startsWith(&quot;LOC&quot;)) {</span>
<span class="nc" id="L629">      animacy = Animacy.INANIMATE;</span>
<span class="nc bnc" id="L630" title="All 2 branches missed.">    } else if (nerString.equals(&quot;MONEY&quot;)) {</span>
<span class="nc" id="L631">      animacy = Animacy.INANIMATE;</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">    } else if (nerString.equals(&quot;NUMBER&quot;)) {</span>
<span class="nc" id="L633">      animacy = Animacy.INANIMATE;</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">    } else if (nerString.equals(&quot;PERCENT&quot;)) {</span>
<span class="nc" id="L635">      animacy = Animacy.INANIMATE;</span>
<span class="nc bnc" id="L636" title="All 2 branches missed.">    } else if (nerString.equals(&quot;DATE&quot;)) {</span>
<span class="nc" id="L637">      animacy = Animacy.INANIMATE;</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">    } else if (nerString.equals(&quot;TIME&quot;)) {</span>
<span class="nc" id="L639">      animacy = Animacy.INANIMATE;</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">    } else if (nerString.equals(&quot;MISC&quot;)) {</span>
<span class="nc" id="L641">      animacy = Animacy.UNKNOWN;</span>
<span class="nc bnc" id="L642" title="All 2 branches missed.">    } else if (nerString.startsWith(&quot;VEH&quot;)) {</span>
<span class="nc" id="L643">      animacy = Animacy.UNKNOWN;</span>
<span class="nc bnc" id="L644" title="All 2 branches missed.">    } else if (nerString.startsWith(&quot;FAC&quot;)) {</span>
<span class="nc" id="L645">      animacy = Animacy.INANIMATE;</span>
<span class="nc bnc" id="L646" title="All 2 branches missed.">    } else if (nerString.startsWith(&quot;GPE&quot;)) {</span>
<span class="nc" id="L647">      animacy = Animacy.INANIMATE;</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">    } else if (nerString.startsWith(&quot;WEA&quot;)) {</span>
<span class="nc" id="L649">      animacy = Animacy.INANIMATE;</span>
<span class="nc bnc" id="L650" title="All 2 branches missed.">    } else if (nerString.startsWith(&quot;ORG&quot;)) {</span>
<span class="nc" id="L651">      animacy = Animacy.INANIMATE;</span>
    } else {
<span class="nc" id="L653">      animacy = Animacy.UNKNOWN;</span>
    }
<span class="nc bnc" id="L655" title="All 2 branches missed.">    if(mentionType != MentionType.PRONOMINAL) {</span>
      // Better heuristics using DekangLin:
<span class="nc bnc" id="L657" title="All 2 branches missed.">      if(animacy == Animacy.UNKNOWN)  {</span>
<span class="nc bnc" id="L658" title="All 2 branches missed.">        if(dict.animateWords.contains(headString))  {</span>
<span class="nc" id="L659">          animacy = Animacy.ANIMATE;</span>
        }
<span class="nc bnc" id="L661" title="All 2 branches missed.">        else if(dict.inanimateWords.contains(headString)) {</span>
<span class="nc" id="L662">          animacy = Animacy.INANIMATE;</span>
        }
      }
    }
<span class="nc" id="L666">  }</span>

<span class="nc" id="L668">  private static final String [] commonNESuffixes = {</span>
    &quot;Corp&quot;, &quot;Co&quot;, &quot;Inc&quot;, &quot;Ltd&quot;
  };

  private static boolean knownSuffix(String s) {
<span class="nc bnc" id="L673" title="All 2 branches missed.">    if(s.endsWith(&quot;.&quot;)) s = s.substring(0, s.length() - 1);</span>
<span class="nc bnc" id="L674" title="All 2 branches missed.">    for(String suff: commonNESuffixes){</span>
<span class="nc bnc" id="L675" title="All 2 branches missed.">      if(suff.equalsIgnoreCase(s)){</span>
<span class="nc" id="L676">        return true;</span>
      }
    }
<span class="nc" id="L679">    return false;</span>
  }

  private void setHeadString() {
<span class="nc" id="L683">    this.headString = headWord.get(CoreAnnotations.TextAnnotation.class).toLowerCase();</span>
<span class="nc" id="L684">    String ner = headWord.get(CoreAnnotations.NamedEntityTagAnnotation.class);</span>
<span class="nc bnc" id="L685" title="All 4 branches missed.">    if (ner != null &amp;&amp; !ner.equals(&quot;O&quot;)) {</span>
      // make sure that the head of a NE is not a known suffix, e.g., Corp.
<span class="nc" id="L687">      int start = headIndex - startIndex;</span>
<span class="nc bnc" id="L688" title="All 4 branches missed.">      if (originalSpan.size() &gt; 0 &amp;&amp; start &gt;= originalSpan.size()) {</span>
<span class="nc" id="L689">        throw new RuntimeException(&quot;Invalid start index &quot; + start + &quot;=&quot; + headIndex + &quot;-&quot; + startIndex</span>
<span class="nc" id="L690">                + &quot;: originalSpan=[&quot; + StringUtils.joinWords(originalSpan, &quot; &quot;) + &quot;], head=&quot; + headWord);</span>
      }
<span class="nc bnc" id="L692" title="All 2 branches missed.">      while (start &gt;= 0) {</span>
<span class="nc bnc" id="L693" title="All 2 branches missed.">        String head = originalSpan.size() &gt; 0 ? originalSpan.get(start).get(CoreAnnotations.TextAnnotation.class).toLowerCase() : &quot;&quot;;</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">        if (knownSuffix(head)) {</span>
<span class="nc" id="L695">          start --;</span>
        } else {
<span class="nc" id="L697">          this.headString = head;</span>
<span class="nc" id="L698">          this.headWord = originalSpan.get(start);</span>
<span class="nc" id="L699">          this.headIndex = startIndex + start;</span>
<span class="nc" id="L700">          break;</span>
        }
<span class="nc" id="L702">      }</span>
    }
<span class="nc" id="L704">    this.headIndexedWord = basicDependency.getNodeByIndexSafe(headWord.index());</span>
<span class="nc" id="L705">  }</span>

  private void setNERString() {
<span class="nc bnc" id="L708" title="All 2 branches missed.">    if(headWord.containsKey(CoreAnnotations.EntityTypeAnnotation.class)){ // ACE</span>
<span class="nc bnc" id="L709" title="All 2 branches missed.">      if(headWord.containsKey(CoreAnnotations.NamedEntityTagAnnotation.class) &amp;&amp;</span>
<span class="nc bnc" id="L710" title="All 2 branches missed.">              headWord.get(CoreAnnotations.EntityTypeAnnotation.class).equals(&quot;NAM&quot;)){</span>
<span class="nc" id="L711">        this.nerString = headWord.get(CoreAnnotations.NamedEntityTagAnnotation.class);</span>
      } else {
<span class="nc" id="L713">        this.nerString = &quot;O&quot;;</span>
      }
    }
    else{ // MUC
<span class="nc bnc" id="L717" title="All 2 branches missed.">      if (headWord.containsKey(CoreAnnotations.NamedEntityTagAnnotation.class)) {</span>
<span class="nc" id="L718">        this.nerString = headWord.get(CoreAnnotations.NamedEntityTagAnnotation.class);</span>
      } else {
<span class="nc" id="L720">        this.nerString = &quot;O&quot;;</span>
      }
    }
<span class="nc" id="L723">  }</span>

  public boolean sameSentence(Mention m) {
<span class="nc bnc" id="L726" title="All 2 branches missed.">    return m.sentenceWords == sentenceWords;</span>
  }

  private static boolean included(CoreLabel small, List&lt;CoreLabel&gt; big) {
<span class="nc bnc" id="L730" title="All 2 branches missed.">    if(small.tag().equals(&quot;NNP&quot;)){</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">      for(CoreLabel w: big){</span>
<span class="nc bnc" id="L732" title="All 2 branches missed.">        if(small.word().equals(w.word()) ||</span>
<span class="nc bnc" id="L733" title="All 4 branches missed.">            small.word().length() &gt; 2 &amp;&amp; w.word().startsWith(small.word())){</span>
<span class="nc" id="L734">          return true;</span>
        }
<span class="nc" id="L736">      }</span>
    }
<span class="nc" id="L738">    return false;</span>
  }

  public boolean headsAgree(Mention m) {
    // we allow same-type NEs to not match perfectly, but rather one could be included in the other, e.g., &quot;George&quot; -&gt; &quot;George Bush&quot;
<span class="nc bnc" id="L743" title="All 6 branches missed.">    if (!nerString.equals(&quot;O&quot;) &amp;&amp; !m.nerString.equals(&quot;O&quot;) &amp;&amp; nerString.equals(m.nerString) &amp;&amp;</span>
<span class="nc bnc" id="L744" title="All 4 branches missed.">            (included(headWord, m.originalSpan) || included(m.headWord, originalSpan))) {</span>
<span class="nc" id="L745">      return true;</span>
    }
<span class="nc" id="L747">    return headString.equals(m.headString);</span>
  }

  public boolean numbersAgree(Mention m){
<span class="nc" id="L751">    return numbersAgree(m, false);</span>
  }
  private boolean numbersAgree(Mention m, boolean strict) {
<span class="nc bnc" id="L754" title="All 2 branches missed.">    if (strict) {</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">      return number == m.number;</span>
    } else {
<span class="nc bnc" id="L757" title="All 6 branches missed.">      return number == Number.UNKNOWN ||</span>
              m.number == Number.UNKNOWN ||
              number == m.number;
    }
  }

  public boolean gendersAgree(Mention m){
<span class="nc" id="L764">    return gendersAgree(m, false);</span>
  }
  public boolean gendersAgree(Mention m, boolean strict) {
<span class="nc bnc" id="L767" title="All 2 branches missed.">    if (strict) {</span>
<span class="nc bnc" id="L768" title="All 2 branches missed.">      return gender == m.gender;</span>
    } else {
<span class="nc bnc" id="L770" title="All 6 branches missed.">      return gender == Gender.UNKNOWN ||</span>
              m.gender == Gender.UNKNOWN ||
              gender == m.gender;
    }
  }

  public boolean animaciesAgree(Mention m){
<span class="nc" id="L777">    return animaciesAgree(m, false);</span>
  }
  public boolean animaciesAgree(Mention m, boolean strict) {
<span class="nc bnc" id="L780" title="All 2 branches missed.">    if (strict) {</span>
<span class="nc bnc" id="L781" title="All 2 branches missed.">      return animacy == m.animacy;</span>
    } else {
<span class="nc bnc" id="L783" title="All 6 branches missed.">      return animacy == Animacy.UNKNOWN ||</span>
              m.animacy == Animacy.UNKNOWN ||
              animacy == m.animacy;
    }
  }

  public boolean entityTypesAgree(Mention m, Dictionaries dict){
<span class="nc" id="L790">    return entityTypesAgree(m, dict, false);</span>
  }

  public boolean entityTypesAgree(Mention m, Dictionaries dict, boolean strict) {
<span class="nc bnc" id="L794" title="All 2 branches missed.">    if (strict) {</span>
<span class="nc" id="L795">      return nerString.equals(m.nerString);</span>
    } else {
<span class="nc bnc" id="L797" title="All 2 branches missed.">      if (isPronominal()) {</span>
<span class="nc bnc" id="L798" title="All 4 branches missed.">        if (nerString.contains(&quot;-&quot;) || m.nerString.contains(&quot;-&quot;)) { //for ACE with gold NE</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">          if (m.nerString.equals(&quot;O&quot;)) {</span>
<span class="nc" id="L800">            return true;</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">          } else if (m.nerString.startsWith(&quot;ORG&quot;)) {</span>
<span class="nc" id="L802">            return dict.organizationPronouns.contains(headString);</span>
<span class="nc bnc" id="L803" title="All 2 branches missed.">          } else if (m.nerString.startsWith(&quot;PER&quot;)) {</span>
<span class="nc" id="L804">            return dict.personPronouns.contains(headString);</span>
<span class="nc bnc" id="L805" title="All 2 branches missed.">          } else if (m.nerString.startsWith(&quot;LOC&quot;)) {</span>
<span class="nc" id="L806">            return dict.locationPronouns.contains(headString);</span>
<span class="nc bnc" id="L807" title="All 2 branches missed.">          } else if (m.nerString.startsWith(&quot;GPE&quot;)) {</span>
<span class="nc" id="L808">            return dict.GPEPronouns.contains(headString);</span>
<span class="nc bnc" id="L809" title="All 6 branches missed.">          } else if (m.nerString.startsWith(&quot;VEH&quot;) || m.nerString.startsWith(&quot;FAC&quot;) || m.nerString.startsWith(&quot;WEA&quot;)) {</span>
<span class="nc" id="L810">            return dict.facilityVehicleWeaponPronouns.contains(headString);</span>
          } else {
<span class="nc" id="L812">            return false;</span>
          }
        } else {  // ACE w/o gold NE or MUC
<span class="nc bnc" id="L815" title="All 39 branches missed.">          switch (m.nerString) {</span>
            case &quot;O&quot;:
<span class="nc" id="L817">              return true;</span>
            case &quot;MISC&quot;:
<span class="nc" id="L819">              return true;</span>
            case &quot;ORGANIZATION&quot;:
<span class="nc" id="L821">              return dict.organizationPronouns.contains(headString);</span>
            case &quot;PERSON&quot;:
<span class="nc" id="L823">              return dict.personPronouns.contains(headString);</span>
            case &quot;LOCATION&quot;:
<span class="nc" id="L825">              return dict.locationPronouns.contains(headString);</span>
            case &quot;DATE&quot;:
            case &quot;TIME&quot;:
<span class="nc" id="L828">              return dict.dateTimePronouns.contains(headString);</span>
            case &quot;MONEY&quot;:
            case &quot;PERCENT&quot;:
            case &quot;NUMBER&quot;:
<span class="nc" id="L832">              return dict.moneyPercentNumberPronouns.contains(headString);</span>
            default:
<span class="nc" id="L834">              return false;</span>
          }
        }
      }
<span class="nc bnc" id="L838" title="All 2 branches missed.">      return nerString.equals(&quot;O&quot;) ||</span>
<span class="nc bnc" id="L839" title="All 2 branches missed.">              m.nerString.equals(&quot;O&quot;) ||</span>
<span class="nc bnc" id="L840" title="All 2 branches missed.">              nerString.equals(m.nerString);</span>
    }
  }



  /**
   * Verifies if this mention's tree is dominated by the tree of the given mention
   */
  public boolean includedIn(Mention m) {
<span class="nc bnc" id="L850" title="All 2 branches missed.">    if (!m.sameSentence(this)) {</span>
<span class="nc" id="L851">      return false;</span>
    }
<span class="nc bnc" id="L853" title="All 4 branches missed.">    if(this.startIndex &lt; m.startIndex || this.endIndex &gt; m.endIndex) return false;</span>
<span class="nc" id="L854">    return true;</span>
  }

  /**
   * Detects if the mention and candidate antecedent agree on all attributes respectively.
   * @param potentialAntecedent
   * @return true if all attributes agree between both mention and candidate, else false.
   */
  public boolean attributesAgree(Mention potentialAntecedent, Dictionaries dict){
<span class="nc bnc" id="L863" title="All 2 branches missed.">    return (this.animaciesAgree(potentialAntecedent) &amp;&amp;</span>
<span class="nc bnc" id="L864" title="All 2 branches missed.">        this.entityTypesAgree(potentialAntecedent, dict) &amp;&amp;</span>
<span class="nc bnc" id="L865" title="All 2 branches missed.">        this.gendersAgree(potentialAntecedent) &amp;&amp;</span>
<span class="nc bnc" id="L866" title="All 2 branches missed.">        this.numbersAgree(potentialAntecedent));</span>
  }

  /** Find apposition */
  public void addApposition(Mention m) {
<span class="nc bnc" id="L871" title="All 2 branches missed.">    if(appositions == null) appositions = Generics.newHashSet();</span>
<span class="nc" id="L872">    appositions.add(m);</span>
<span class="nc" id="L873">  }</span>

  /** Check apposition */
  public boolean isApposition(Mention m) {
<span class="nc bnc" id="L877" title="All 4 branches missed.">    if(appositions != null &amp;&amp; appositions.contains(m)) return true;</span>
<span class="nc" id="L878">    return false;</span>
  }
  /** Find predicate nominatives */
  public void addPredicateNominatives(Mention m) {
<span class="nc bnc" id="L882" title="All 2 branches missed.">    if(predicateNominatives == null) predicateNominatives = Generics.newHashSet();</span>
<span class="nc" id="L883">    predicateNominatives.add(m);</span>
<span class="nc" id="L884">  }</span>

  /** Check predicate nominatives */
  public boolean isPredicateNominatives(Mention m) {
<span class="nc bnc" id="L888" title="All 4 branches missed.">    if(predicateNominatives != null &amp;&amp; predicateNominatives.contains(m)) return true;</span>
<span class="nc" id="L889">    return false;</span>
  }

  /** Find relative pronouns */
  public void addRelativePronoun(Mention m) {
<span class="nc bnc" id="L894" title="All 2 branches missed.">    if(relativePronouns == null) relativePronouns = Generics.newHashSet();</span>
<span class="nc" id="L895">    relativePronouns.add(m);</span>
<span class="nc" id="L896">  }</span>

  /** Find which mention appears first in a document */
  public boolean appearEarlierThan(Mention m){
<span class="nc bnc" id="L900" title="All 2 branches missed.">    if (this.sentNum &lt; m.sentNum) {</span>
<span class="nc" id="L901">      return true;</span>
<span class="nc bnc" id="L902" title="All 2 branches missed.">    } else if (this.sentNum &gt; m.sentNum) {</span>
<span class="nc" id="L903">      return false;</span>
    } else {
<span class="nc bnc" id="L905" title="All 2 branches missed.">      if (this.startIndex &lt; m.startIndex) {</span>
<span class="nc" id="L906">        return true;</span>
<span class="nc bnc" id="L907" title="All 2 branches missed.">      } else if (this.startIndex &gt; m.startIndex) {</span>
<span class="nc" id="L908">        return false;</span>
      } else {
<span class="nc bnc" id="L910" title="All 2 branches missed.">        if (this.endIndex &gt; m.endIndex) {</span>
<span class="nc" id="L911">          return true;</span>
<span class="nc bnc" id="L912" title="All 2 branches missed.">        } else if (this.endIndex &lt; m.endIndex) {</span>
<span class="nc" id="L913">          return false;</span>
<span class="nc bnc" id="L914" title="All 2 branches missed.">        } else if (this.headIndex != m.headIndex) {</span>
          // Meaningless, but an arbitrary tiebreaker
<span class="nc bnc" id="L916" title="All 2 branches missed.">          return this.headIndex &lt; m.headIndex;</span>
<span class="nc bnc" id="L917" title="All 2 branches missed.">        } else if (this.mentionType != m.mentionType) {</span>
          // Meaningless, but an arbitrary tiebreaker
<span class="nc bnc" id="L919" title="All 2 branches missed.">          return this.mentionType.representativeness &gt; m.mentionType.representativeness;</span>
        } else {
          // Meaningless, but an arbitrary tiebreaker
<span class="nc bnc" id="L922" title="All 2 branches missed.">          return this.hashCode() &lt; m.hashCode();</span>
        }
      }
    }
  }

  public String longestNNPEndsWithHead (){
<span class="nc" id="L929">    String ret = &quot;&quot;;</span>
<span class="nc bnc" id="L930" title="All 2 branches missed.">    for (int i = headIndex; i &gt;=startIndex ; i--){</span>
<span class="nc" id="L931">      String pos = sentenceWords.get(i).get(CoreAnnotations.PartOfSpeechAnnotation.class);</span>
<span class="nc bnc" id="L932" title="All 2 branches missed.">      if(!pos.startsWith(&quot;NNP&quot;)) break;</span>
<span class="nc bnc" id="L933" title="All 2 branches missed.">      if(!ret.equals(&quot;&quot;)) ret = &quot; &quot;+ret;</span>
<span class="nc" id="L934">      ret = sentenceWords.get(i).get(CoreAnnotations.TextAnnotation.class)+ret;</span>
    }
<span class="nc" id="L936">    return ret;</span>
  }

  public String lowestNPIncludesHead (){
<span class="nc" id="L940">    String ret = &quot;&quot;;</span>
<span class="nc" id="L941">    Tree head = this.contextParseTree.getLeaves().get(this.headIndex);</span>
<span class="nc" id="L942">    Tree lowestNP = head;</span>
    String s;
    while(true) {
<span class="nc bnc" id="L945" title="All 2 branches missed.">      if(lowestNP==null) return ret;</span>
<span class="nc" id="L946">      s = ((CoreLabel) lowestNP.label()).get(CoreAnnotations.ValueAnnotation.class);</span>
<span class="nc bnc" id="L947" title="All 4 branches missed.">      if(s.equals(&quot;NP&quot;) || s.equals(&quot;ROOT&quot;)) break;</span>
<span class="nc" id="L948">      lowestNP = lowestNP.ancestor(1, this.contextParseTree);</span>
    }
<span class="nc bnc" id="L950" title="All 2 branches missed.">    if (s.equals(&quot;ROOT&quot;)) lowestNP = head;</span>
<span class="nc bnc" id="L951" title="All 2 branches missed.">    for (Tree t : lowestNP.getLeaves()){</span>
<span class="nc bnc" id="L952" title="All 2 branches missed.">      if (!ret.equals(&quot;&quot;)) ret = ret + &quot; &quot;;</span>
<span class="nc" id="L953">      ret = ret + ((CoreLabel) t.label()).get(CoreAnnotations.TextAnnotation.class);</span>
<span class="nc" id="L954">    }</span>
<span class="nc bnc" id="L955" title="All 2 branches missed.">    if(!this.spanToString().contains(ret)) return this.sentenceWords.get(this.headIndex).get(CoreAnnotations.TextAnnotation.class);</span>
<span class="nc" id="L956">    return ret;</span>
  }

  public String stringWithoutArticle(String str) {
<span class="nc bnc" id="L960" title="All 2 branches missed.">    String ret = (str==null)? this.spanToString() : str;</span>
<span class="nc bnc" id="L961" title="All 4 branches missed.">    if (ret.startsWith(&quot;a &quot;) || ret.startsWith(&quot;A &quot;)) {</span>
<span class="nc" id="L962">      return ret.substring(2);</span>
<span class="nc bnc" id="L963" title="All 4 branches missed.">    } else if (ret.startsWith(&quot;an &quot;) || ret.startsWith(&quot;An &quot;)) {</span>
<span class="nc" id="L964">      return ret.substring(3);</span>
<span class="nc bnc" id="L965" title="All 4 branches missed.">    } else if (ret.startsWith(&quot;the &quot;) || ret.startsWith(&quot;The &quot;))</span>
<span class="nc" id="L966">      return ret.substring(4);</span>
<span class="nc" id="L967">    return ret;</span>
  }

  public List&lt;String&gt; preprocessSearchTerm (){
<span class="nc" id="L971">    List&lt;String&gt; searchTerms = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L972">    String[] terms = new String[4];</span>

<span class="nc" id="L974">    terms[0] = this.stringWithoutArticle(this.removePhraseAfterHead());</span>
<span class="nc" id="L975">    terms[1] = this.stringWithoutArticle(this.lowestNPIncludesHead());</span>
<span class="nc" id="L976">    terms[2] = this.stringWithoutArticle(this.longestNNPEndsWithHead());</span>
<span class="nc" id="L977">    terms[3] = this.headString;</span>

<span class="nc bnc" id="L979" title="All 2 branches missed.">    for (String term : terms){</span>

<span class="nc bnc" id="L981" title="All 2 branches missed.">      if(term.contains(&quot;\&quot;&quot;)) term = term.replace(&quot;\&quot;&quot;, &quot;\\\&quot;&quot;);</span>
<span class="nc bnc" id="L982" title="All 2 branches missed.">      if(term.contains(&quot;(&quot;)) term = term.replace(&quot;(&quot;,&quot;\\(&quot;);</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">      if(term.contains(&quot;)&quot;)) term = term.replace(&quot;)&quot;, &quot;\\)&quot;);</span>
<span class="nc bnc" id="L984" title="All 2 branches missed.">      if(term.contains(&quot;!&quot;)) term = term.replace(&quot;!&quot;, &quot;\\!&quot;);</span>
<span class="nc bnc" id="L985" title="All 2 branches missed.">      if(term.contains(&quot;:&quot;)) term = term.replace(&quot;:&quot;, &quot;\\:&quot;);</span>
<span class="nc bnc" id="L986" title="All 2 branches missed.">      if(term.contains(&quot;+&quot;)) term = term.replace(&quot;+&quot;, &quot;\\+&quot;);</span>
<span class="nc bnc" id="L987" title="All 2 branches missed.">      if(term.contains(&quot;-&quot;)) term = term.replace(&quot;-&quot;, &quot;\\-&quot;);</span>
<span class="nc bnc" id="L988" title="All 2 branches missed.">      if(term.contains(&quot;~&quot;)) term = term.replace(&quot;~&quot;, &quot;\\~&quot;);</span>
<span class="nc bnc" id="L989" title="All 2 branches missed.">      if(term.contains(&quot;*&quot;)) term = term.replace(&quot;*&quot;, &quot;\\*&quot;);</span>
<span class="nc bnc" id="L990" title="All 2 branches missed.">      if(term.contains(&quot;[&quot;)) term = term.replace(&quot;[&quot;, &quot;\\[&quot;);</span>
<span class="nc bnc" id="L991" title="All 2 branches missed.">      if(term.contains(&quot;]&quot;)) term = term.replace(&quot;]&quot;, &quot;\\]&quot;);</span>
<span class="nc bnc" id="L992" title="All 2 branches missed.">      if(term.contains(&quot;^&quot;)) term = term.replace(&quot;^&quot;, &quot;\\^&quot;);</span>
<span class="nc bnc" id="L993" title="All 2 branches missed.">      if(term.equals(&quot;&quot;)) continue;</span>

<span class="nc bnc" id="L995" title="All 4 branches missed.">      if(term.equals(&quot;&quot;) || searchTerms.contains(term)) continue;</span>
<span class="nc bnc" id="L996" title="All 4 branches missed.">      if(term.equals(terms[3]) &amp;&amp; !terms[2].equals(&quot;&quot;)) continue;</span>
<span class="nc" id="L997">      searchTerms.add(term);</span>
    }
<span class="nc" id="L999">    return searchTerms;</span>
  }
  public static String buildQueryText(List&lt;String&gt; terms) {
<span class="nc" id="L1002">    String query = &quot;&quot;;</span>
<span class="nc bnc" id="L1003" title="All 2 branches missed.">    for (String t : terms){</span>
<span class="nc" id="L1004">      query += t + &quot; &quot;;</span>
<span class="nc" id="L1005">    }</span>
<span class="nc" id="L1006">    return query.trim();</span>
  }

  /** Remove any clause after headword */
  public String removePhraseAfterHead(){
<span class="nc" id="L1011">    String removed =&quot;&quot;;</span>
<span class="nc" id="L1012">    int posComma = -1;</span>
<span class="nc" id="L1013">    int posWH = -1;</span>
<span class="nc bnc" id="L1014" title="All 2 branches missed.">    for(int i = 0 ; i &lt; this.originalSpan.size() ; i++){</span>
<span class="nc" id="L1015">      CoreLabel w = this.originalSpan.get(i);</span>
<span class="nc bnc" id="L1016" title="All 4 branches missed.">      if(posComma == -1 &amp;&amp; w.get(CoreAnnotations.PartOfSpeechAnnotation.class).equals(&quot;,&quot;)) posComma = this.startIndex + i;</span>
<span class="nc bnc" id="L1017" title="All 4 branches missed.">      if(posWH == -1 &amp;&amp; w.get(CoreAnnotations.PartOfSpeechAnnotation.class).startsWith(&quot;W&quot;)) posWH = this.startIndex + i;</span>
    }
<span class="nc bnc" id="L1019" title="All 4 branches missed.">    if(posComma!=-1 &amp;&amp; this.headIndex &lt; posComma){</span>
<span class="nc" id="L1020">      StringBuilder os = new StringBuilder();</span>
<span class="nc bnc" id="L1021" title="All 2 branches missed.">      for(int i = 0; i &lt; posComma-this.startIndex; i++){</span>
<span class="nc bnc" id="L1022" title="All 2 branches missed.">        if(i &gt; 0) os.append(&quot; &quot;);</span>
<span class="nc" id="L1023">        os.append(this.originalSpan.get(i).get(CoreAnnotations.TextAnnotation.class));</span>
      }
<span class="nc" id="L1025">      removed = os.toString();</span>
    }
<span class="nc bnc" id="L1027" title="All 6 branches missed.">    if(posComma==-1 &amp;&amp; posWH != -1 &amp;&amp; this.headIndex &lt; posWH){</span>
<span class="nc" id="L1028">      StringBuilder os = new StringBuilder();</span>
<span class="nc bnc" id="L1029" title="All 2 branches missed.">      for(int i = 0; i &lt; posWH-this.startIndex; i++){</span>
<span class="nc bnc" id="L1030" title="All 2 branches missed.">        if(i &gt; 0) os.append(&quot; &quot;);</span>
<span class="nc" id="L1031">        os.append(this.originalSpan.get(i).get(CoreAnnotations.TextAnnotation.class));</span>
      }
<span class="nc" id="L1033">      removed = os.toString();</span>
    }
<span class="nc bnc" id="L1035" title="All 4 branches missed.">    if(posComma==-1 &amp;&amp; posWH == -1){</span>
<span class="nc" id="L1036">      removed = this.spanToString();</span>
    }
<span class="nc" id="L1038">    return removed;</span>
  }

  public static String removeParenthesis(String text) {
<span class="nc bnc" id="L1042" title="All 2 branches missed.">    if (text.split(&quot;\\(&quot;).length &gt; 0) {</span>
<span class="nc" id="L1043">      return text.split(&quot;\\(&quot;)[0].trim();</span>
    } else {
<span class="nc" id="L1045">      return &quot;&quot;;</span>
    }
  }

  // the mention is 'the + commonNoun' form
  protected boolean isTheCommonNoun() {
<span class="nc bnc" id="L1051" title="All 2 branches missed.">    if (this.mentionType == MentionType.NOMINAL</span>
<span class="nc bnc" id="L1052" title="All 2 branches missed.">         &amp;&amp; this.spanToString().toLowerCase().startsWith(&quot;the &quot;)</span>
<span class="nc bnc" id="L1053" title="All 2 branches missed.">         &amp;&amp; this.spanToString().split(&quot; &quot;).length == 2) {</span>
<span class="nc" id="L1054">      return true;</span>
    } else {
<span class="nc" id="L1056">      return false;</span>
    }
  }

  private static Pair&lt;IndexedWord, String&gt; findDependentVerb(Mention m) {
<span class="nc bnc" id="L1061" title="All 2 branches missed.">    if (m.enhancedDependency.getRoots().size() == 0) {</span>
<span class="nc" id="L1062">      return new Pair&lt;&gt;();</span>
    }
    // would be nice to condense this pattern, but sadly =reln
    // always uses the last relation in the sequence, not the first
<span class="nc" id="L1066">    SemgrexPattern pattern = SemgrexPattern.compile(&quot;{idx:&quot; + (m.headIndex+1) + &quot;} [ &lt;=reln {tag:/^V.*/}=verb | &lt;=reln ({} &lt;&lt; {tag:/^V.*/}=verb) ]&quot;);</span>
<span class="nc" id="L1067">    SemgrexMatcher matcher = pattern.matcher(m.enhancedDependency);</span>
<span class="nc bnc" id="L1068" title="All 2 branches missed.">    while (matcher.find()) {</span>
<span class="nc" id="L1069">      return Pair.makePair(matcher.getNode(&quot;verb&quot;), matcher.getRelnString(&quot;reln&quot;));</span>
    }
<span class="nc" id="L1071">    return new Pair&lt;&gt;();</span>
  }

  /** Returns true if this mention is contained inside m. That is, it is a subspan of the same sentence. */
  public boolean insideIn(Mention m){
<span class="nc bnc" id="L1076" title="All 6 branches missed.">    return this.sentNum == m.sentNum</span>
            &amp;&amp; m.startIndex &lt;= this.startIndex
            &amp;&amp; this.endIndex &lt;= m.endIndex;
  }

  public boolean moreRepresentativeThan(Mention m){
<span class="nc bnc" id="L1082" title="All 2 branches missed.">    if(m==null) return true;</span>
<span class="nc bnc" id="L1083" title="All 2 branches missed.">    if (mentionType.representativeness &gt; m.mentionType.representativeness) { return true; }</span>
<span class="nc bnc" id="L1084" title="All 2 branches missed.">    else if (m.mentionType.representativeness &gt; mentionType.representativeness) { return false; }</span>
    else {
      // pick mention with better NER
<span class="nc bnc" id="L1087" title="All 4 branches missed.">      if (nerString != null &amp;&amp; m.nerString == null) return true;</span>
<span class="nc bnc" id="L1088" title="All 4 branches missed.">      if (nerString == null &amp;&amp; m.nerString != null) return false;</span>
<span class="nc bnc" id="L1089" title="All 4 branches missed.">      if (nerString != null &amp;&amp; !nerString.equals(m.nerString)) {</span>
<span class="nc bnc" id="L1090" title="All 2 branches missed.">        if (&quot;O&quot;.equals(m.nerString)) return true;</span>
<span class="nc bnc" id="L1091" title="All 2 branches missed.">        if (&quot;O&quot;.equals(nerString)) return false;</span>
<span class="nc bnc" id="L1092" title="All 2 branches missed.">        if (&quot;MISC&quot;.equals(m.nerString)) return true;</span>
<span class="nc bnc" id="L1093" title="All 2 branches missed.">        if (&quot;MISC&quot;.equals(nerString)) return false;</span>
      }
      // Ensure that both NER tags are neither MISC nor O, or are both not existent
<span class="nc bnc" id="L1096" title="All 14 branches missed.">      assert nerString == null || nerString.equals(m.nerString) || (!nerString.equals(&quot;O&quot;) &amp;&amp; !nerString.equals(&quot;MISC&quot;) &amp;&amp; !m.nerString.equals(&quot;O&quot;) &amp;&amp; !m.nerString.equals(&quot;MISC&quot;));</span>
      // Return larger headIndex - startIndex
<span class="nc bnc" id="L1098" title="All 2 branches missed.">      if (headIndex - startIndex &gt; m.headIndex - m.startIndex) { return true; }</span>
<span class="nc bnc" id="L1099" title="All 2 branches missed.">      else if (headIndex - startIndex &lt; m.headIndex - m.startIndex) { return false; }</span>
      // Return earlier sentence number
<span class="nc bnc" id="L1101" title="All 2 branches missed.">      else if (sentNum &lt; m.sentNum) { return true; }</span>
<span class="nc bnc" id="L1102" title="All 2 branches missed.">      else if (sentNum &gt; m.sentNum) { return false; }</span>
      // Return earlier head index
<span class="nc bnc" id="L1104" title="All 2 branches missed.">      else if (headIndex &lt; m.headIndex) { return true; }</span>
<span class="nc bnc" id="L1105" title="All 2 branches missed.">      else if (headIndex &gt; m.headIndex) { return false; }</span>
      // If the mentions are short, take the longer one
<span class="nc bnc" id="L1107" title="All 4 branches missed.">      else if (originalSpan.size() &lt;= 5 &amp;&amp; originalSpan.size() &gt; m.originalSpan.size()) { return true; }</span>
<span class="nc bnc" id="L1108" title="All 4 branches missed.">      else if (originalSpan.size() &lt;= 5 &amp;&amp; originalSpan.size() &lt; m.originalSpan.size()) { return false; }</span>
      // If the mentions are long, take the shorter one (we're getting into the realm of nonsense by here)
<span class="nc bnc" id="L1110" title="All 2 branches missed.">      else if (originalSpan.size() &lt; m.originalSpan.size()) { return true; }</span>
<span class="nc bnc" id="L1111" title="All 2 branches missed.">      else if (originalSpan.size() &gt; m.originalSpan.size()) { return false; }</span>
      else {
<span class="nc" id="L1113">        throw new IllegalStateException(&quot;Comparing a mention with itself for representativeness&quot;);</span>
      }
    }
  }

  // Returns filtered premodifiers (no determiners or numerals)
  public ArrayList&lt;ArrayList&lt;IndexedWord&gt;&gt; getPremodifiers(){

<span class="nc" id="L1121">    ArrayList&lt;ArrayList&lt;IndexedWord&gt;&gt; premod = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L1123" title="All 2 branches missed.">    if(headIndexedWord == null) return premod;</span>
<span class="nc bnc" id="L1124" title="All 2 branches missed.">    for(Pair&lt;GrammaticalRelation,IndexedWord&gt; child : enhancedDependency.childPairs(headIndexedWord)){</span>
<span class="nc" id="L1125">      String function = child.first().getShortName();</span>
<span class="nc bnc" id="L1126" title="All 2 branches missed.">      if(child.second().index() &lt; headWord.index()</span>
<span class="nc bnc" id="L1127" title="All 4 branches missed.">          &amp;&amp; !child.second.tag().equals(&quot;DT&quot;) &amp;&amp; !child.second.tag().equals(&quot;WRB&quot;)</span>
<span class="nc bnc" id="L1128" title="All 4 branches missed.">          &amp;&amp; !function.endsWith(&quot;det&quot;) &amp;&amp; !function.equals(&quot;nummod&quot;)</span>
<span class="nc bnc" id="L1129" title="All 4 branches missed.">          &amp;&amp; !function.startsWith(&quot;acl&quot;) &amp;&amp; !function.startsWith(&quot;advcl&quot;)</span>
<span class="nc bnc" id="L1130" title="All 2 branches missed.">          &amp;&amp; !function.equals(&quot;punct&quot;)){</span>
<span class="nc" id="L1131">        ArrayList&lt;IndexedWord&gt; phrase = new ArrayList&lt;&gt;(enhancedDependency.descendants(child.second()));</span>
<span class="nc" id="L1132">        Collections.sort(phrase);</span>
<span class="nc" id="L1133">        premod.add(phrase);</span>
      }
<span class="nc" id="L1135">    }</span>
<span class="nc" id="L1136">    return premod;</span>
  }

  // Returns filtered postmodifiers (no relative, -ed or -ing clauses)
  public ArrayList&lt;ArrayList&lt;IndexedWord&gt;&gt; getPostmodifiers(){

<span class="nc" id="L1142">    ArrayList&lt;ArrayList&lt;IndexedWord&gt;&gt; postmod = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L1144" title="All 2 branches missed.">    if(headIndexedWord == null) return postmod;</span>
<span class="nc bnc" id="L1145" title="All 2 branches missed.">    for(Pair&lt;GrammaticalRelation,IndexedWord&gt; child : enhancedDependency.childPairs(headIndexedWord)){</span>
<span class="nc" id="L1146">      String function = child.first().getShortName();</span>
<span class="nc bnc" id="L1147" title="All 2 branches missed.">      if(child.second().index() &gt; headWord.index() &amp;&amp;</span>
<span class="nc bnc" id="L1148" title="All 4 branches missed.">          ! function.endsWith(&quot;det&quot;) &amp;&amp; ! function.equals(&quot;nummod&quot;)</span>
<span class="nc bnc" id="L1149" title="All 4 branches missed.">          &amp;&amp; ! function.startsWith(&quot;acl&quot;) &amp;&amp; ! function.startsWith(&quot;advcl&quot;)</span>
<span class="nc bnc" id="L1150" title="All 2 branches missed.">          &amp;&amp; ! function.equals(&quot;punct&quot;) &amp;&amp;</span>
          //possessive clitic
<span class="nc bnc" id="L1152" title="All 4 branches missed.">          ! (function.equals(&quot;case&quot;) &amp;&amp; enhancedDependency.descendants(child.second()).size() == 1</span>
<span class="nc bnc" id="L1153" title="All 2 branches missed.">              &amp;&amp; child.second.tag().equals(&quot;POS&quot;))){</span>
<span class="nc" id="L1154">        ArrayList&lt;IndexedWord&gt; phrase = new ArrayList&lt;&gt;(enhancedDependency.descendants(child.second()));</span>
<span class="nc" id="L1155">        Collections.sort(phrase);</span>
<span class="nc" id="L1156">        postmod.add(phrase);</span>
      }
<span class="nc" id="L1158">    }</span>
<span class="nc" id="L1159">    return postmod;</span>
  }


  public String[] getSplitPattern(){

<span class="nc" id="L1165">    ArrayList&lt;ArrayList&lt;IndexedWord&gt;&gt; premodifiers = getPremodifiers();</span>

<span class="nc" id="L1167">    String[] components = new String[4];</span>

<span class="nc" id="L1169">    components[0] = headWord.lemma();</span>

<span class="nc bnc" id="L1171" title="All 2 branches missed.">    if(premodifiers.size() == 0){</span>
<span class="nc" id="L1172">      components[1] = headWord.lemma();</span>
<span class="nc" id="L1173">      components[2] = headWord.lemma();</span>
<span class="nc bnc" id="L1174" title="All 2 branches missed.">    } else if(premodifiers.size() == 1){</span>
<span class="nc" id="L1175">      ArrayList&lt;AbstractCoreLabel&gt; premod = Generics.newArrayList();</span>
<span class="nc" id="L1176">      premod.addAll(premodifiers.get(premodifiers.size()-1));</span>
<span class="nc" id="L1177">      premod.add(headWord);</span>
<span class="nc" id="L1178">      components[1] = getPattern(premod);</span>
<span class="nc" id="L1179">      components[2] = getPattern(premod);</span>
<span class="nc" id="L1180">    } else {</span>
<span class="nc" id="L1181">      ArrayList&lt;AbstractCoreLabel&gt; premod1 = Generics.newArrayList();</span>
<span class="nc" id="L1182">      premod1.addAll(premodifiers.get(premodifiers.size()-1));</span>
<span class="nc" id="L1183">      premod1.add(headWord);</span>
<span class="nc" id="L1184">      components[1] = getPattern(premod1);</span>

<span class="nc" id="L1186">      ArrayList&lt;AbstractCoreLabel&gt; premod2 = Generics.newArrayList();</span>
<span class="nc bnc" id="L1187" title="All 2 branches missed.">      for(ArrayList&lt;IndexedWord&gt; premodifier : premodifiers){</span>
<span class="nc" id="L1188">        premod2.addAll(premodifier);</span>
<span class="nc" id="L1189">      }</span>
<span class="nc" id="L1190">      premod2.add(headWord);</span>
<span class="nc" id="L1191">      components[2] = getPattern(premod2);</span>
    }

<span class="nc" id="L1194">    components[3] = getPattern();</span>
<span class="nc" id="L1195">    return components;</span>
  }

  public String getPattern(){

<span class="nc" id="L1200">    ArrayList&lt;AbstractCoreLabel&gt; pattern = Generics.newArrayList();</span>
<span class="nc bnc" id="L1201" title="All 2 branches missed.">    for(ArrayList&lt;IndexedWord&gt; premodifier : getPremodifiers()){</span>
<span class="nc" id="L1202">      pattern.addAll(premodifier);</span>
<span class="nc" id="L1203">    }</span>
<span class="nc" id="L1204">    pattern.add(headWord);</span>
<span class="nc bnc" id="L1205" title="All 2 branches missed.">    for(ArrayList&lt;IndexedWord&gt; postmodifier : getPostmodifiers()){</span>
<span class="nc" id="L1206">      pattern.addAll(postmodifier);</span>
<span class="nc" id="L1207">    }</span>
<span class="nc" id="L1208">    return getPattern(pattern);</span>
  }

  public String getPattern(List&lt;AbstractCoreLabel&gt; pTokens){

<span class="nc" id="L1213">    ArrayList&lt;String&gt; phrase_string = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L1214">    String ne = &quot;&quot;;</span>
<span class="nc bnc" id="L1215" title="All 2 branches missed.">    for(AbstractCoreLabel token : pTokens){</span>
<span class="nc bnc" id="L1216" title="All 2 branches missed.">      if(token.index() == headWord.index()){</span>
<span class="nc" id="L1217">        phrase_string.add(token.lemma());</span>
<span class="nc" id="L1218">        ne = &quot;&quot;;</span>

<span class="nc bnc" id="L1220" title="All 4 branches missed.">      } else if( (token.lemma().equals(&quot;and&quot;) || StringUtils.isPunct(token.lemma()))</span>
<span class="nc bnc" id="L1221" title="All 2 branches missed.">          &amp;&amp; pTokens.size() &gt; pTokens.indexOf(token)+1</span>
<span class="nc bnc" id="L1222" title="All 2 branches missed.">          &amp;&amp; pTokens.indexOf(token) &gt; 0</span>
<span class="nc bnc" id="L1223" title="All 2 branches missed.">          &amp;&amp; pTokens.get(pTokens.indexOf(token)+1).ner().equals(pTokens.get(pTokens.indexOf(token)-1).ner())){</span>

<span class="nc bnc" id="L1225" title="All 2 branches missed.">      } else if(token.index() == headWord.index()-1</span>
<span class="nc bnc" id="L1226" title="All 2 branches missed.">          &amp;&amp; token.ner().equals(nerString)){</span>
<span class="nc" id="L1227">        phrase_string.add(token.lemma());</span>
<span class="nc" id="L1228">        ne = &quot;&quot;;</span>

<span class="nc bnc" id="L1230" title="All 2 branches missed.">      } else if(!token.ner().equals(&quot;O&quot;)){</span>
<span class="nc bnc" id="L1231" title="All 2 branches missed.">        if(!token.ner().equals(ne)){</span>
<span class="nc" id="L1232">          ne = token.ner();</span>
<span class="nc" id="L1233">          phrase_string.add(&quot;&lt;&quot;+ne+&quot;&gt;&quot;);</span>
        }

      } else {
<span class="nc" id="L1237">        phrase_string.add(token.lemma());</span>
<span class="nc" id="L1238">        ne = &quot;&quot;;</span>
      }
<span class="nc" id="L1240">    }</span>
<span class="nc" id="L1241">    return StringUtils.join(phrase_string);</span>
  }

  public boolean isCoordinated(){
<span class="nc bnc" id="L1245" title="All 2 branches missed.">    if(headIndexedWord == null) return false;</span>
<span class="nc bnc" id="L1246" title="All 2 branches missed.">    for(Pair&lt;GrammaticalRelation,IndexedWord&gt; child : enhancedDependency.childPairs(headIndexedWord)){</span>
<span class="nc bnc" id="L1247" title="All 2 branches missed.">      if(child.first().getShortName().equals(&quot;cc&quot;)) return true;</span>
<span class="nc" id="L1248">    }</span>
<span class="nc" id="L1249">    return false;</span>
  }

  private static List&lt;String&gt; getContextHelper(List&lt;? extends AbstractCoreLabel&gt; words) {
<span class="nc" id="L1253">    List&lt;List&lt;AbstractCoreLabel&gt;&gt; namedEntities = Generics.newArrayList();</span>
<span class="nc" id="L1254">    List&lt;AbstractCoreLabel&gt; ne = Generics.newArrayList();</span>
<span class="nc" id="L1255">    String previousNEType = &quot;&quot;;</span>
<span class="nc" id="L1256">    int previousNEIndex = -1;</span>
<span class="nc bnc" id="L1257" title="All 2 branches missed.">    for (int i = 0; i &lt; words.size(); i++) {</span>
<span class="nc" id="L1258">      AbstractCoreLabel word = words.get(i);</span>
<span class="nc bnc" id="L1259" title="All 2 branches missed.">      if(!word.ner().equals(&quot;O&quot;)) {</span>
<span class="nc bnc" id="L1260" title="All 4 branches missed.">        if (!word.ner().equals(previousNEType) || previousNEIndex != i-1) {</span>
<span class="nc" id="L1261">          ne = Generics.newArrayList();</span>
<span class="nc" id="L1262">          namedEntities.add(ne);</span>
        }
<span class="nc" id="L1264">        ne.add(word);</span>
<span class="nc" id="L1265">        previousNEType = word.ner();</span>
<span class="nc" id="L1266">        previousNEIndex = i;</span>
      }
    }

<span class="nc" id="L1270">    List&lt;String&gt; neStrings = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L1271">    Set&lt;String&gt; hs = Generics.newHashSet();</span>
<span class="nc bnc" id="L1272" title="All 2 branches missed.">    for (List&lt;AbstractCoreLabel&gt; namedEntity : namedEntities) {</span>
<span class="nc" id="L1273">      String ne_str = StringUtils.joinWords(namedEntity, &quot; &quot;);</span>
<span class="nc" id="L1274">      hs.add(ne_str);</span>
<span class="nc" id="L1275">    }</span>
<span class="nc" id="L1276">    neStrings.addAll(hs);</span>
<span class="nc" id="L1277">    return neStrings;</span>
  }

  public List&lt;String&gt; getContext() {
<span class="nc" id="L1281">    return getContextHelper(sentenceWords);</span>
  }

  public List&lt;String&gt; getPremodifierContext() {
<span class="nc" id="L1285">    List&lt;String&gt; neStrings = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L1286" title="All 2 branches missed.">    for (List&lt;IndexedWord&gt; words : getPremodifiers()) {</span>
<span class="nc" id="L1287">      neStrings.addAll(getContextHelper(words));</span>
<span class="nc" id="L1288">    }</span>
<span class="nc" id="L1289">    return neStrings;</span>
  }

  /** Check relative pronouns */
  public boolean isRelativePronoun(Mention m) {
<span class="nc bnc" id="L1294" title="All 4 branches missed.">    return relativePronouns != null &amp;&amp; relativePronouns.contains(m);</span>
  }

  public boolean isRoleAppositive(Mention m, Dictionaries dict) {
<span class="nc" id="L1298">    String thisString = this.spanToString();</span>
<span class="nc" id="L1299">    String thisStringLower = this.lowercaseNormalizedSpanString();</span>
<span class="nc bnc" id="L1300" title="All 4 branches missed.">    if(this.isPronominal() || dict.allPronouns.contains(thisStringLower)) return false;</span>
<span class="nc bnc" id="L1301" title="All 4 branches missed.">    if(!m.nerString.startsWith(&quot;PER&quot;) &amp;&amp; !m.nerString.equals(&quot;O&quot;)) return false;</span>
<span class="nc bnc" id="L1302" title="All 4 branches missed.">    if(!this.nerString.startsWith(&quot;PER&quot;) &amp;&amp; !this.nerString.equals(&quot;O&quot;)) return false;</span>
<span class="nc bnc" id="L1303" title="All 4 branches missed.">    if(!sameSentence(m) || !m.spanToString().startsWith(thisString)) return false;</span>
<span class="nc bnc" id="L1304" title="All 4 branches missed.">    if(m.spanToString().contains(&quot;'&quot;) || m.spanToString().contains(&quot; and &quot;)) return false;</span>
<span class="nc bnc" id="L1305" title="All 8 branches missed.">    if (!animaciesAgree(m) || this.animacy == Animacy.INANIMATE</span>
         || this.gender == Gender.NEUTRAL || m.gender == Gender.NEUTRAL
<span class="nc bnc" id="L1307" title="All 2 branches missed.">         || !this.numbersAgree(m)) {</span>
<span class="nc" id="L1308">      return false;</span>
    }
<span class="nc bnc" id="L1310" title="All 2 branches missed.">    if (dict.demonymSet.contains(thisStringLower)</span>
<span class="nc bnc" id="L1311" title="All 2 branches missed.">         || dict.demonymSet.contains(m.lowercaseNormalizedSpanString())) {</span>
<span class="nc" id="L1312">      return false;</span>
    }
<span class="nc" id="L1314">    return true;</span>
  }

  public boolean isDemonym(Mention m, Dictionaries dict) {
<span class="nc" id="L1318">    String thisCasedString = this.spanToString();</span>
<span class="nc" id="L1319">    String antCasedString = m.spanToString();</span>

    // The US state matching part (only) is done cased
<span class="nc" id="L1322">    String thisNormed = dict.lookupCanonicalAmericanStateName(thisCasedString);</span>
<span class="nc" id="L1323">    String antNormed = dict.lookupCanonicalAmericanStateName(antCasedString);</span>
<span class="nc bnc" id="L1324" title="All 4 branches missed.">    if (thisNormed != null &amp;&amp; thisNormed.equals(antNormed)) {</span>
<span class="nc" id="L1325">      return true;</span>
    }

    // The rest is done uncased
<span class="nc" id="L1329">    String thisString = thisCasedString.toLowerCase(Locale.ENGLISH);</span>
<span class="nc" id="L1330">    String antString = antCasedString.toLowerCase(Locale.ENGLISH);</span>
<span class="nc bnc" id="L1331" title="All 2 branches missed.">    if (thisString.startsWith(&quot;the &quot;)) {</span>
<span class="nc" id="L1332">      thisString = thisString.substring(4);</span>
    }
<span class="nc bnc" id="L1334" title="All 2 branches missed.">    if (antString.startsWith(&quot;the &quot;)) {</span>
<span class="nc" id="L1335">      antString = antString.substring(4);</span>
    }

<span class="nc" id="L1338">    Set&lt;String&gt; thisDemonyms = dict.getDemonyms(thisString);</span>
<span class="nc" id="L1339">    Set&lt;String&gt; antDemonyms = dict.getDemonyms(antString);</span>
<span class="nc bnc" id="L1340" title="All 4 branches missed.">    if (thisDemonyms.contains(antString) || antDemonyms.contains(thisString)) {</span>
<span class="nc" id="L1341">      return true;</span>
    }
<span class="nc" id="L1343">    return false;</span>
  }

  public String getPosition() {
<span class="nc" id="L1347">    int size = sentenceWords.size();</span>
<span class="nc bnc" id="L1348" title="All 2 branches missed.">    if(headIndex == 0) {</span>
<span class="nc" id="L1349">      return &quot;first&quot;;</span>
<span class="nc bnc" id="L1350" title="All 2 branches missed.">    } else if (headIndex == size -1) {</span>
<span class="nc" id="L1351">      return &quot;last&quot;;</span>
    } else {
<span class="nc bnc" id="L1353" title="All 4 branches missed.">      if(headIndex &gt; 0 &amp;&amp; headIndex &lt; size/3) {</span>
<span class="nc" id="L1354">        return &quot;begin&quot;;</span>
<span class="nc bnc" id="L1355" title="All 4 branches missed.">      } else if (headIndex &gt;= size/3 &amp;&amp; headIndex &lt; 2 * size/3) {</span>
<span class="nc" id="L1356">        return &quot;middle&quot;;</span>
<span class="nc bnc" id="L1357" title="All 4 branches missed.">      } else if (headIndex &gt;= 2 * size/3 &amp;&amp; headIndex &lt; size -1) {</span>
<span class="nc" id="L1358">        return &quot;end&quot;;</span>
      }
    }
<span class="nc" id="L1361">    return null;</span>
  }

  private IndexedWord headParent;
  private IndexedWord getHeadParent() {
<span class="nc bnc" id="L1366" title="All 2 branches missed.">    return headParent == null ?</span>
<span class="nc" id="L1367">        (headParent = enhancedDependency.getParent(headIndexedWord)) : headParent;</span>
  }

  private Collection&lt;IndexedWord&gt; headChildren;
  private Collection&lt;IndexedWord&gt; getHeadChildren() {
<span class="nc bnc" id="L1372" title="All 2 branches missed.">    return headChildren == null ?</span>
<span class="nc" id="L1373">        (headChildren = enhancedDependency.getChildList(headIndexedWord)) : headChildren;</span>
  }

  private Collection&lt;IndexedWord&gt; headSiblings;
  private Collection&lt;IndexedWord&gt; getHeadSiblings() {
<span class="nc bnc" id="L1378" title="All 2 branches missed.">    return headSiblings == null ?</span>
<span class="nc" id="L1379">        (headSiblings = enhancedDependency.getSiblings(headIndexedWord)): headSiblings;</span>
  }

  private List&lt;IndexedWord&gt; headPathToRoot;
  private List&lt;IndexedWord&gt; getHeadPathToRoot() {
<span class="nc bnc" id="L1384" title="All 2 branches missed.">    return headPathToRoot == null ?</span>
<span class="nc" id="L1385">        (headPathToRoot = enhancedDependency.getPathToRoot(headIndexedWord)) : headPathToRoot;</span>
  }

  public String getRelation() {
<span class="nc bnc" id="L1389" title="All 2 branches missed.">    if(headIndexedWord == null) return null;</span>

<span class="nc bnc" id="L1391" title="All 2 branches missed.">    if(enhancedDependency.getRoots().isEmpty()) return null;</span>
    // root relation
<span class="nc bnc" id="L1393" title="All 2 branches missed.">    if(enhancedDependency.getFirstRoot().equals(headIndexedWord)) return &quot;root&quot;;</span>
<span class="nc bnc" id="L1394" title="All 2 branches missed.">    if(!enhancedDependency.containsVertex(getHeadParent())) return null;</span>
<span class="nc" id="L1395">    GrammaticalRelation relation = enhancedDependency.reln(getHeadParent(), headIndexedWord);</span>

    // adjunct relations
<span class="nc bnc" id="L1398" title="All 2 branches missed.">    if ((relation.toString().startsWith(&quot;nmod&quot;)</span>
<span class="nc bnc" id="L1399" title="All 10 branches missed.">        &amp;&amp; getHeadChildren().stream().anyMatch(c -&gt; c.tag().equals(&quot;IN&quot;)))</span>
        || relation == UniversalEnglishGrammaticalRelations.TEMPORAL_MODIFIER
        || relation == UniversalEnglishGrammaticalRelations.ADV_CLAUSE_MODIFIER
        || relation == UniversalEnglishGrammaticalRelations.ADVERBIAL_MODIFIER
        || relation == UniversalEnglishGrammaticalRelations.NOMINAL_MODIFIER)
<span class="nc" id="L1404">      return &quot;adjunct&quot;;</span>

    // subject relations
<span class="nc bnc" id="L1407" title="All 4 branches missed.">    if(relation == UniversalEnglishGrammaticalRelations.NOMINAL_SUBJECT</span>
<span class="nc" id="L1408">        || relation == UniversalEnglishGrammaticalRelations.CLAUSAL_SUBJECT) return &quot;subject&quot;;</span>
<span class="nc bnc" id="L1409" title="All 4 branches missed.">    if(relation == UniversalEnglishGrammaticalRelations.NOMINAL_PASSIVE_SUBJECT</span>
<span class="nc" id="L1410">        || relation == UniversalEnglishGrammaticalRelations.CLAUSAL_PASSIVE_SUBJECT) return &quot;subject&quot;;</span>

    // verbal argument relations
<span class="nc bnc" id="L1413" title="All 10 branches missed.">    if(relation == UniversalEnglishGrammaticalRelations.CLAUSAL_COMPLEMENT</span>
        || relation == UniversalEnglishGrammaticalRelations.XCLAUSAL_COMPLEMENT
        || relation == UniversalEnglishGrammaticalRelations.AGENT
        || relation == UniversalEnglishGrammaticalRelations.DIRECT_OBJECT
<span class="nc" id="L1417">        || relation == UniversalEnglishGrammaticalRelations.INDIRECT_OBJECT) return &quot;verbArg&quot;;</span>

    // noun argument relations
<span class="nc bnc" id="L1420" title="All 10 branches missed.">    if(relation == UniversalEnglishGrammaticalRelations.RELATIVE_CLAUSE_MODIFIER</span>
        || relation == UniversalEnglishGrammaticalRelations.COMPOUND_MODIFIER //
        || relation == UniversalEnglishGrammaticalRelations.ADJECTIVAL_MODIFIER
        || relation == UniversalEnglishGrammaticalRelations.APPOSITIONAL_MODIFIER
<span class="nc" id="L1424">        || relation == UniversalEnglishGrammaticalRelations.POSSESSION_MODIFIER) return &quot;nounArg&quot;;</span>

<span class="nc" id="L1426">    return null;</span>
  }

  public int getModifiers(Dictionaries dict){

<span class="nc bnc" id="L1431" title="All 2 branches missed.">    if(headIndexedWord == null) return 0;</span>

<span class="nc" id="L1433">    int count = 0;</span>
<span class="nc" id="L1434">    List&lt;Pair&lt;GrammaticalRelation, IndexedWord&gt;&gt; childPairs = enhancedDependency.childPairs(headIndexedWord);</span>
<span class="nc bnc" id="L1435" title="All 2 branches missed.">    for(Pair&lt;GrammaticalRelation, IndexedWord&gt; childPair : childPairs) {</span>
<span class="nc" id="L1436">      GrammaticalRelation gr = childPair.first;</span>
<span class="nc" id="L1437">      IndexedWord word = childPair.second;</span>
<span class="nc bnc" id="L1438" title="All 4 branches missed.">      if(gr == UniversalEnglishGrammaticalRelations.ADJECTIVAL_MODIFIER</span>
          || gr == UniversalEnglishGrammaticalRelations.RELATIVE_CLAUSE_MODIFIER
<span class="nc bnc" id="L1440" title="All 2 branches missed.">          || gr.toString().startsWith(&quot;prep_&quot;)) {</span>
<span class="nc" id="L1441">        count++;</span>
      }

      // add possessive if not a personal determiner
<span class="nc bnc" id="L1445" title="All 4 branches missed.">      if(gr == UniversalEnglishGrammaticalRelations.POSSESSION_MODIFIER &amp;&amp; !dict.determiners.contains(word.lemma())) {</span>
<span class="nc" id="L1446">        count++;</span>
      }
<span class="nc" id="L1448">    }</span>
<span class="nc" id="L1449">    return count;</span>
  }

  public String getQuantification(Dictionaries dict){

<span class="nc bnc" id="L1454" title="All 2 branches missed.">    if(headIndexedWord == null) return null;</span>

<span class="nc bnc" id="L1456" title="All 2 branches missed.">    if(!nerString.equals(&quot;O&quot;)) return &quot;definite&quot;;</span>

<span class="nc" id="L1458">    Set&lt;IndexedWord&gt; quant = enhancedDependency.getChildrenWithReln(headIndexedWord, UniversalEnglishGrammaticalRelations.DETERMINER);</span>
<span class="nc" id="L1459">    Set&lt;IndexedWord&gt; poss = enhancedDependency.getChildrenWithReln(headIndexedWord, UniversalEnglishGrammaticalRelations.POSSESSION_MODIFIER);</span>
<span class="nc bnc" id="L1460" title="All 2 branches missed.">    if (!quant.isEmpty()) {</span>
<span class="nc bnc" id="L1461" title="All 2 branches missed.">      for (IndexedWord word : quant) {</span>
<span class="nc" id="L1462">        String det = word.lemma();</span>
<span class="nc bnc" id="L1463" title="All 2 branches missed.">        if (dict.determiners.contains(det)) {</span>
<span class="nc" id="L1464">          return &quot;definite&quot;;</span>
<span class="nc bnc" id="L1465" title="All 2 branches missed.">        } else if (dict.quantifiers2.contains(det)) {</span>
<span class="nc" id="L1466">          return &quot;quantified&quot;;</span>
        }
<span class="nc" id="L1468">      }</span>
<span class="nc bnc" id="L1469" title="All 2 branches missed.">    } else if (!poss.isEmpty()) {</span>
<span class="nc" id="L1470">      return &quot;definite&quot;;</span>
    } else {
<span class="nc" id="L1472">      quant = enhancedDependency.getChildrenWithReln(headIndexedWord, UniversalEnglishGrammaticalRelations.NUMERIC_MODIFIER);</span>
<span class="nc bnc" id="L1473" title="All 2 branches missed.">      if (!quant.isEmpty()) {</span>
<span class="nc" id="L1474">        return &quot;quantified&quot;;</span>
      }
    }
<span class="nc" id="L1477">    return &quot;indefinite&quot;;</span>
  }

  public int getNegation(Dictionaries dict) {

<span class="nc bnc" id="L1482" title="All 2 branches missed.">    if(headIndexedWord == null) return 0;</span>

    // direct negation in a child
<span class="nc" id="L1485">    Collection&lt;IndexedWord&gt; children = enhancedDependency.getChildren(headIndexedWord);</span>
<span class="nc bnc" id="L1486" title="All 2 branches missed.">    for(IndexedWord child : children) {</span>
<span class="nc bnc" id="L1487" title="All 2 branches missed.">      if(dict.negations.contains(child.lemma())) return 1;</span>
<span class="nc" id="L1488">    }</span>

    // or has a sibling
<span class="nc bnc" id="L1491" title="All 2 branches missed.">    for(IndexedWord sibling : getHeadSiblings()) {</span>
<span class="nc bnc" id="L1492" title="All 4 branches missed.">      if(dict.negations.contains(sibling.lemma()) &amp;&amp; !enhancedDependency.hasParentWithReln(headIndexedWord, UniversalEnglishGrammaticalRelations.NOMINAL_SUBJECT)) return 1;</span>
<span class="nc" id="L1493">    }</span>
    // check the parent
<span class="nc" id="L1495">    List&lt;Pair&lt;GrammaticalRelation,IndexedWord&gt;&gt; parentPairs = enhancedDependency.parentPairs(headIndexedWord);</span>
<span class="nc bnc" id="L1496" title="All 2 branches missed.">    if (!parentPairs.isEmpty()) {</span>
<span class="nc" id="L1497">      Pair&lt;GrammaticalRelation,IndexedWord&gt; parentPair = parentPairs.get(0);</span>
<span class="nc" id="L1498">      GrammaticalRelation gr = parentPair.first;</span>
      // check negative prepositions
<span class="nc bnc" id="L1500" title="All 2 branches missed.">      if(dict.neg_relations.contains(gr.toString())) return 1;</span>
    }
<span class="nc" id="L1502">    return 0;</span>
  }

  public int getModal(Dictionaries dict) {

<span class="nc bnc" id="L1507" title="All 2 branches missed.">    if(headIndexedWord == null) return 0;</span>

    // direct modal in a child
<span class="nc" id="L1510">    Collection&lt;IndexedWord&gt; children = enhancedDependency.getChildren(headIndexedWord);</span>
<span class="nc bnc" id="L1511" title="All 2 branches missed.">    for(IndexedWord child : children) {</span>
<span class="nc bnc" id="L1512" title="All 2 branches missed.">      if(dict.modals.contains(child.lemma())) return 1;</span>
<span class="nc" id="L1513">    }</span>

    // check the parent
<span class="nc" id="L1516">    IndexedWord parent = getHeadParent();</span>
<span class="nc bnc" id="L1517" title="All 2 branches missed.">    if (parent != null) {</span>
<span class="nc bnc" id="L1518" title="All 2 branches missed.">      if(dict.modals.contains(parent.lemma())) return 1;</span>
      // check the children of the parent (that is needed for modal auxiliaries)
<span class="nc" id="L1520">      IndexedWord child = enhancedDependency.getChildWithReln(parent,UniversalEnglishGrammaticalRelations.AUX_MODIFIER);</span>
<span class="nc bnc" id="L1521" title="All 6 branches missed.">      if(!enhancedDependency.hasParentWithReln(headIndexedWord, UniversalEnglishGrammaticalRelations.NOMINAL_SUBJECT) &amp;&amp; child != null &amp;&amp; dict.modals.contains(child.lemma())) return 1;</span>
    }

    // look at the path to root
<span class="nc" id="L1525">    List&lt;IndexedWord&gt; path = getHeadPathToRoot();</span>
<span class="nc bnc" id="L1526" title="All 2 branches missed.">    if(path == null) return 0;</span>
<span class="nc bnc" id="L1527" title="All 2 branches missed.">    for(IndexedWord word : path) {</span>
<span class="nc bnc" id="L1528" title="All 2 branches missed.">      if(dict.modals.contains(word.lemma())) return 1;</span>
<span class="nc" id="L1529">    }</span>
<span class="nc" id="L1530">    return 0;</span>
  }

  public int getReportEmbedding(Dictionaries dict) {

<span class="nc bnc" id="L1535" title="All 2 branches missed.">    if(headIndexedWord == null) return 0;</span>

    // check adverbial clause with marker &quot;as&quot;
<span class="nc bnc" id="L1538" title="All 2 branches missed.">    for(IndexedWord sibling : getHeadSiblings()) {</span>
<span class="nc bnc" id="L1539" title="All 4 branches missed.">      if(dict.reportVerb.contains(sibling.lemma()) &amp;&amp; enhancedDependency.hasParentWithReln(sibling,UniversalEnglishGrammaticalRelations.ADV_CLAUSE_MODIFIER)) {</span>
<span class="nc" id="L1540">        IndexedWord marker = enhancedDependency.getChildWithReln(sibling,UniversalEnglishGrammaticalRelations.MARKER);</span>
<span class="nc bnc" id="L1541" title="All 4 branches missed.">        if (marker != null &amp;&amp; marker.lemma().equals(&quot;as&quot;)) {</span>
<span class="nc" id="L1542">          return 1;</span>
        }
      }
<span class="nc" id="L1545">    }</span>

    // look at the path to root
<span class="nc" id="L1548">    List&lt;IndexedWord&gt; path = getHeadPathToRoot();</span>
<span class="nc bnc" id="L1549" title="All 2 branches missed.">    if(path == null) return 0;</span>
<span class="nc" id="L1550">    boolean isSubject = false;</span>

    // if the node itself is a subject, we will not take into account its parent in the path
<span class="nc bnc" id="L1553" title="All 2 branches missed.">    if(enhancedDependency.hasParentWithReln(headIndexedWord, UniversalEnglishGrammaticalRelations.NOMINAL_SUBJECT)) isSubject = true;</span>

<span class="nc bnc" id="L1555" title="All 2 branches missed.">    for (IndexedWord word : path) {</span>
<span class="nc bnc" id="L1556" title="All 6 branches missed.">      if(!isSubject &amp;&amp; (dict.reportVerb.contains(word.lemma()) || dict.reportNoun.contains(word.lemma()))) {</span>
<span class="nc" id="L1557">        return 1;</span>
      }
      // check how to put isSubject
<span class="nc" id="L1560">      isSubject = enhancedDependency.hasParentWithReln(word, UniversalEnglishGrammaticalRelations.NOMINAL_SUBJECT);</span>
<span class="nc" id="L1561">    }</span>
<span class="nc" id="L1562">    return 0;</span>
  }

  public int getCoordination() {

<span class="nc bnc" id="L1567" title="All 2 branches missed.">    if(headIndexedWord == null) return 0;</span>

<span class="nc" id="L1569">    Set&lt;GrammaticalRelation&gt; relations = enhancedDependency.childRelns(headIndexedWord);</span>
<span class="nc bnc" id="L1570" title="All 2 branches missed.">    for (GrammaticalRelation rel : relations) {</span>
<span class="nc bnc" id="L1571" title="All 2 branches missed.">      if(rel.toString().startsWith(&quot;conj:&quot;)) {</span>
<span class="nc" id="L1572">        return 1;</span>
      }
<span class="nc" id="L1574">    }</span>

<span class="nc" id="L1576">    Set&lt;GrammaticalRelation&gt; parent_relations = enhancedDependency.relns(headIndexedWord);</span>
<span class="nc bnc" id="L1577" title="All 2 branches missed.">    for (GrammaticalRelation rel : parent_relations) {</span>
<span class="nc bnc" id="L1578" title="All 2 branches missed.">      if(rel.toString().startsWith(&quot;conj:&quot;)) {</span>
<span class="nc" id="L1579">        return 1;</span>
      }
<span class="nc" id="L1581">    }</span>
<span class="nc" id="L1582">    return 0;</span>
  }

  @Override
  public boolean equals(Object obj) {

<span class="nc bnc" id="L1588" title="All 2 branches missed.">    if (obj == this) { return true; }</span>
<span class="nc bnc" id="L1589" title="All 2 branches missed.">    if (obj == null) { return false; }</span>
<span class="nc bnc" id="L1590" title="All 2 branches missed.">    if (obj.getClass() != getClass()) { return false; }</span>

<span class="nc" id="L1592">    Mention rhs = (Mention) obj;</span>

<span class="nc bnc" id="L1594" title="All 2 branches missed.">    if (!Objects.equals(mentionType, rhs.mentionType)) { return false; }</span>
<span class="nc bnc" id="L1595" title="All 2 branches missed.">    if (!Objects.equals(number, rhs.number)) { return false; }</span>
<span class="nc bnc" id="L1596" title="All 2 branches missed.">    if (!Objects.equals(gender, rhs.gender)) { return false; }</span>
<span class="nc bnc" id="L1597" title="All 2 branches missed.">    if (!Objects.equals(animacy, rhs.animacy)) { return false; }</span>
<span class="nc bnc" id="L1598" title="All 2 branches missed.">    if (!Objects.equals(person, rhs.person)) { return false; }</span>
<span class="nc bnc" id="L1599" title="All 2 branches missed.">    if (!Objects.equals(headString, rhs.headString)) { return false; }</span>
<span class="nc bnc" id="L1600" title="All 2 branches missed.">    if (!Objects.equals(nerString, rhs.nerString)) { return false; }</span>

<span class="nc bnc" id="L1602" title="All 2 branches missed.">    if (startIndex != rhs.startIndex) { return false; }</span>
<span class="nc bnc" id="L1603" title="All 2 branches missed.">    if (endIndex != rhs.endIndex) { return false; }</span>
<span class="nc bnc" id="L1604" title="All 2 branches missed.">    if (headIndex != rhs.headIndex) { return false; }</span>
<span class="nc bnc" id="L1605" title="All 2 branches missed.">    if (mentionID != rhs.mentionID) { return false; }</span>
<span class="nc bnc" id="L1606" title="All 2 branches missed.">    if (originalRef != rhs.originalRef) { return false; }</span>

<span class="nc bnc" id="L1608" title="All 2 branches missed.">    if (!Objects.equals(headIndexedWord, rhs.headIndexedWord)) { return false; }</span>
<span class="nc bnc" id="L1609" title="All 2 branches missed.">    if (!Objects.equals(dependingVerb, rhs.dependingVerb)) { return false; }</span>
<span class="nc bnc" id="L1610" title="All 2 branches missed.">    if (!Objects.equals(headWord, rhs.headWord)) { return false; }</span>

<span class="nc bnc" id="L1612" title="All 2 branches missed.">    if (goldCorefClusterID != rhs.goldCorefClusterID) { return false; }</span>
<span class="nc bnc" id="L1613" title="All 2 branches missed.">    if (corefClusterID != rhs.corefClusterID) { return false; }</span>
<span class="nc bnc" id="L1614" title="All 2 branches missed.">    if (mentionNum != rhs.mentionNum) { return false; }</span>
<span class="nc bnc" id="L1615" title="All 2 branches missed.">    if (sentNum != rhs.sentNum) { return false; }</span>
<span class="nc bnc" id="L1616" title="All 2 branches missed.">    if (utter != rhs.utter) { return false; }</span>
<span class="nc bnc" id="L1617" title="All 2 branches missed.">    if (paragraph != rhs.paragraph) { return false; }</span>

<span class="nc bnc" id="L1619" title="All 2 branches missed.">    if (isSubject != rhs.isSubject) { return false; }</span>
<span class="nc bnc" id="L1620" title="All 2 branches missed.">    if (isDirectObject != rhs.isDirectObject) { return false; }</span>
<span class="nc bnc" id="L1621" title="All 2 branches missed.">    if (isIndirectObject != rhs.isIndirectObject) { return false; }</span>
<span class="nc bnc" id="L1622" title="All 2 branches missed.">    if (isPrepositionObject != rhs.isPrepositionObject) { return false; }</span>

<span class="nc bnc" id="L1624" title="All 2 branches missed.">    if (hasTwin != rhs.hasTwin) { return false; }</span>
<span class="nc bnc" id="L1625" title="All 2 branches missed.">    if (generic != rhs.generic) { return false; }</span>
<span class="nc bnc" id="L1626" title="All 2 branches missed.">    if (isSingleton != rhs.isSingleton) { return false; }</span>

<span class="nc bnc" id="L1628" title="All 2 branches missed.">    if (!Objects.equals(originalSpan, rhs.originalSpan)) { return false; }</span>
<span class="nc bnc" id="L1629" title="All 2 branches missed.">    if (!Objects.equals(sentenceWords, rhs.sentenceWords))  { return false; }</span>

<span class="nc bnc" id="L1631" title="All 2 branches missed.">    if (!Objects.equals(basicDependency, rhs.basicDependency)) { return false; }</span>
<span class="nc bnc" id="L1632" title="All 2 branches missed.">    if (!Objects.equals(enhancedDependency, rhs.enhancedDependency)) { return false; }</span>
<span class="nc bnc" id="L1633" title="All 2 branches missed.">    if (!Objects.equals(contextParseTree, rhs.contextParseTree)) { return false; }</span>

<span class="nc bnc" id="L1635" title="All 2 branches missed.">    if (!Objects.equals(dependents, rhs.dependents)) { return false; }</span>
<span class="nc bnc" id="L1636" title="All 2 branches missed.">    if (!Objects.equals(preprocessedTerms, rhs.preprocessedTerms)) { return false; }</span>

<span class="nc" id="L1638">    return true;</span>
  }

  @Override
  public int hashCode() {

<span class="nc" id="L1644">    int result = 49;</span>
<span class="nc" id="L1645">    int c = 0;</span>

<span class="nc" id="L1647">    c += startIndex;</span>
<span class="nc" id="L1648">    c += endIndex;</span>

<span class="nc" id="L1650">    result = (37 * result) + c;</span>

<span class="nc" id="L1652">    return result;</span>

  }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>